//>>built
require({cache:{"url:widgets/Chart/Preview.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"results-section" data-dojo-attach-point\x3d"resultsSection"\x3e\r\n\t\t\x3cdiv class\x3d"results-header" data-dojo-attach-point\x3d"resultsHeader" style\x3d"margin-bottom:15px;"\x3e\r\n\t\t\t\x3cdiv class\x3d"chart-title jimu-float-leading" data-dojo-attach-point\x3d"chartTitle"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"paging-section jimu-float-leading"\x3e\r\n\t\t\t\t\x3cul data-dojo-attach-point\x3d"pagingUl" data-dojo-attach-event\x3d"onclick:_onPagingUlClicked"\x3e\x3c/ul\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"settings jimu-float-trailing" data-dojo-attach-point\x3d"settingsIcon"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"chart-section"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" style\x3d"width:100%;table-layout:fixed;"\x3e\r\n\t\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\t\x3ccol width\x3d"15px;"\x3e\x3c/col\x3e\r\n\t\t\t\t\t\x3ccol width\x3d"auto;"\x3e\x3c/col\x3e\r\n\t\t\t\t\t\x3ccol width\x3d"15px;"\x3e\x3c/col\x3e\r\n\t\t    \t\x3c/colgroup\x3e\r\n\t\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\x3cdiv class\x3d"chart-section-item left-arrow arrow" data-dojo-attach-point\x3d"leftArrow" data-dojo-attach-event\x3d"onclick:_onLeftArrowClicked"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\x3cdiv class\x3d"chart-section-item chart-container" data-dojo-attach-point\x3d"chartContainer" dir\x3d"ltr" style\x3d"direction:ltr;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\x3cdiv class\x3d"chart-section-item right-arrow arrow" data-dojo-attach-point\x3d"rightArrow" data-dojo-attach-event\x3d"onclick:_onRightArrowClicked"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3c/tbody\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"chart-description" data-dojo-attach-point\x3d"descriptionNode"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"noresults-section" data-dojo-attach-point\x3d"noresultsSection"\x3e\r\n\t\t${nls.noResults}\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/query dojo/_base/Color dojo/on dojo/sniff dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/TooltipDialog dijit/popup dojo/text!./Preview.html dojox/charting/Chart dojox/charting/axis2d/Default dojox/charting/axis2d/Invisible dojox/charting/plot2d/Columns dojox/charting/plot2d/Bars dojox/charting/plot2d/Lines dojox/charting/plot2d/Pie dojox/charting/plot2d/ClusteredColumns dojox/charting/plot2d/ClusteredBars dojox/charting/action2d/Tooltip dojox/charting/action2d/Highlight dojox/charting/action2d/MoveSlice dojox/charting/action2d/Magnify dojox/charting/SimpleTheme esri/symbols/jsonUtils esri/graphic esri/graphicsUtils esri/lang jimu/utils ./common/Parameters jimu/dijit/LoadingIndicator dojox/charting/action2d/MouseIndicator".split(" "),
function(N,l,q,r,D,C,I,O,P,Q,R,S,J,T,w,t,u,K,L,F,G,U,V,x,y,A,H,M,E,W,X,Y,z,Z){return N([P,Q,R],{baseClass:"jimu-widget-chart-preview",templateString:T,charts:[],paramsDijits:[],tooltipDialogs:[],currentChartIndex:-1,layerDefinition:null,config:null,featureSet:null,map:null,resultLayer:null,tempGraphics:null,maxHorLabelSpace:100,maxVerLabelSpace:100,folderUrl:"",maxPreviewFeaturesCount:20,pieScale:1.1,postCreate:function(){this.inherited(arguments);this.map?this.own(I(document.body,"click",l.hitch(this,
this._onDocumentBodyClick))):r.destroy(this.settingsIcon)},onClose:function(){this._hideAllTooltipDialogs()},destroy:function(){this.clear();this.inherited(arguments)},resize:function(){0<=this.currentChartIndex&&this._recreateChart(this.currentChartIndex)},_calculateChartBox:function(){var a=r.getContentBox(this.domNode),c=r.getMarginBox(this.resultsHeader),d=r.getMarginBox(this.descriptionNode),a=a.h-c.h-d.h,c=60;a<c&&(c=a);r.setStyle(this.leftArrow,"height",c+"px");r.setStyle(this.rightArrow,"height",
c+"px");r.setStyle(this.chartContainer,"height",a+"px");return r.getContentBox(this.chartContainer)},createCharts:function(a){try{this.loading.hide();this.clear();if(!this.map){var c=this.maxPreviewFeaturesCount;a.featureSet.features.length>c&&(a.featureSet.features=a.featureSet.features.slice(0,c))}r.setStyle(this.resultsSection,"display","block");r.setStyle(this.noresultsSection,"display","none");D(".chart-section-item",this.domNode).forEach(l.hitch(this,function(a){r.setStyle(a,"height",0)}));
this.config=a.config;this.featureSet=a.featureSet;this.layerDefinition=a.layerDefinition;this.resultLayer=a.resultLayer;this.chartTitle.innerHTML=this.config.name||"";this.chartTitle.title=this.chartTitle.innerHTML;this.descriptionNode.innerHTML=this.config.description||"";r.setStyle(this.resultsSection,"display","block");for(var d=0,e,c=[],b=this._getTypes(a.config),p=this._calculateChartBox(),h=p.w+"px",m=p.h+"px",d=0;d<b.length;d++){e=r.create("div",{"class":"chart-div",style:{width:h,height:m}},
this.chartContainer);c.push(e);var g=r.toDom("\x3cli class\x3d'paging-li'\x3e\x3ca class\x3d'paging-a'\x3e\x3c/a\x3e\x3c/li\x3e");r.place(g,this.pagingUl)}var f=a.config;e=null;"feature"===f.mode?e=this._createFeatureModeCharts(a,c):"category"===f.mode?e=this._createCategoryModeCharts(a,c):"count"===f.mode?e=this._createCountModeCharts(a,c):"field"===f.mode&&(e=this._createFieldModeCharts(a,c));this.charts=e.charts;this.paramsDijits=e.paramsDijits;this.tooltipDialogs=q.map(this.paramsDijits,l.hitch(this,
function(a){var b=r.create("div");a.placeAt(b);return new S({content:b})}));this.map&&q.forEach(this.paramsDijits,l.hitch(this,function(a,b){this.own(I(a,"change",l.hitch(this,function(){a.showShelter();this._recreateChart(b);a.hideShelter()})))}));this._showChart(0);0===a.featureSet.features.length&&(r.setStyle(this.resultsSection,"display","none"),r.setStyle(this.noresultsSection,"display","block"))}catch(n){console.error(n)}},_onDocumentBodyClick:function(a){if(0<=this.currentChartIndex&&this.tooltipDialogs){var c=
this.tooltipDialogs[this.currentChartIndex];if(c){var d=!!c.isOpendNow;this._hideAllTooltipDialogs();var e=a.target||a.srcElement;if(!(e===this.leftArrow||e===this.rightArrow)&&!r.hasClass(e,"paging-a")&&!r.hasClass(e,"paging-li"))e===this.settingsIcon?d?this._hideTooltipDialog(c):this._showTooltipDialog(c):(a=e===c.domNode,e=r.isDescendant(e,c.domNode),a||e?d?this._showTooltipDialog(c):this._hideTooltipDialog(c):this._hideTooltipDialog(c))}else this._hideAllTooltipDialogs()}else this._hideAllTooltipDialogs()},
clear:function(){this.resultLayer=this.layerDefinition=this.featureSet=this.config=null;this.chartTitle.innerHTML="";this.chartTitle.title="";this.descriptionNode.innerHTML="";this.currentChartIndex=-1;D(".chart-div",this.chartContainer).style({display:"none"});D("li",this.pagingUl).removeClass("selected");this._hideAllTooltipDialogs();this.charts||(this.charts=[]);this.paramsDijits||(this.paramsDijits=[]);this.tooltipDialogs||(this.tooltipDialogs=[]);for(var a=0;a<this.charts.length;a++)this.charts[a]&&
this.charts[a].destroy(),this.charts[a]=null,this.paramsDijits[a]&&this.paramsDijits[a].destroy(),this.paramsDijits[a]=null,this.tooltipDialogs[a]&&this.tooltipDialogs[a].destroy(),this.tooltipDialogs[a]=null;this.charts=[];this.paramsDijits=[];this.tooltipDialogs=[];r.empty(this.pagingUl);r.empty(this.chartContainer);r.setStyle(this.resultsSection,"display","none");r.setStyle(this.noresultsSection,"display","none")},_recreateChart:function(a){if(0>a||a!==this.currentChartIndex||!this.charts||!this.charts[a])return null;
this.loading.show();var c=D(".chart-div",this.chartContainer)[a];r.setStyle(c,"display","block");var d=this._calculateChartBox();r.setStyle(c,"width",d.w+"px");r.setStyle(c,"height",d.h+"px");c=this.charts[a].createSelf;this.charts[a].createSelf=null;this.charts[a].destroy();this.charts[a]=null;this.charts[a]=c();this.loading.hide();return this.charts[a]},_showChart:function(a){this.currentChartIndex=-1;var c=D(".chart-div",this.chartContainer);c.style({display:"none"});var d=D("li",this.pagingUl);
d.removeClass("selected");if(!(0>a)){if(c=c[a])this.currentChartIndex=a,r.setStyle(c,"display","block");(d=d[a])&&r.addClass(d,"selected");d=null;if(this.charts&&0<this.charts.length&&(d=this.charts[a])){var e=this._calculateChartBox(),b=r.getContentBox(c);if(e.w!==b.w||e.h!==b.h){this.loading.show();if(O("svg")){r.setStyle(c,"width",e.w+"px");r.setStyle(c,"height",e.h+"px");if((a=d.getPlot("default"))&&"dojox.charting.plot2d.Pie"===a.declaredClass&&a.opt)c=Math.floor(Math.min(e.w,e.h)/2/this.pieScale),
a.opt.radius=c-3;d.resize(e.w,e.h)}else this._recreateChart(a);this.loading.hide()}}}},_hideAllTooltipDialogs:function(){this.tooltipDialogs&&0<this.tooltipDialogs.length&&q.forEach(this.tooltipDialogs,l.hitch(this,function(a){this._hideTooltipDialog(a)}))},_hideTooltipDialog:function(a){a&&(J.close(a),a.isOpendNow=!1)},_showTooltipDialog:function(a){a&&(J.open({popup:a,around:this.settingsIcon}),a.isOpendNow=!0)},_onPagingUlClicked:function(a){a.stopPropagation();this._hideAllTooltipDialogs();a=
a.target||a.srcElement;if("a"===a.tagName.toLowerCase()){var c=D("a",this.pagingUl);a=q.indexOf(c,a);0<=a&&this._showChart(a)}},_onLeftArrowClicked:function(a){a.stopPropagation();this._hideAllTooltipDialogs();a=(this.currentChartIndex-1+this.charts.length)%this.charts.length;0<=a&&this._showChart(a)},_onRightArrowClicked:function(a){a.stopPropagation();this._hideAllTooltipDialogs();a=(this.currentChartIndex+1+this.charts.length)%this.charts.length;0<=a&&this._showChart(a)},_getHighLightMarkerSymbol:function(){var a=
E.fromJson(this.config.symbol),a=Math.max(a.size||0,a.width||0,a.height,18),a=a+1,c=E.fromJson({color:[255,255,255,0],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSSquare",outline:{color:[0,0,128,255],width:0.75,type:"esriSLS",style:"esriSLSSolid"}});c.setSize(a);c.outline.setColor(new C(this.config.highLightColor));return c},_getHighLightLineSymbol:function(){var a=E.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"});a.setColor(new C(this.config.highLightColor));
return a},_getHighLightFillSymbol:function(){var a=E.fromJson(this.config.symbol),c=E.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"});c.setColor(new C(this.config.highLightColor));a.setOutline(c);return a},_zoomToGraphics:function(a){if(this.resultLayer&&this.resultLayer.visible&&a&&0<a.length){var c=null;try{var d=q.filter(a,function(a){return!!a.geometry});0<d.length&&(c=X.graphicsExtent(d))}catch(e){console.error(e)}if(c)this.map.setExtent(c.expand(1.4));else if(a=
(a=a[0])&&a.geometry)c=l.hitch(this,function(a){var c=this.map.getNumLevels(),d=this.map.getLevel(),c=Math.max(d,Math.floor(2*c/3));this.map.setLevel(c).then(l.hitch(this,function(){this.map.centerAt(a)}))}),"point"===a.type?c(a):"multipoint"===a.type&&1===a.points.length&&c(a.getPoint(0))}},_removeTempGraphics:function(){if(this.resultLayer&&this.tempGraphics&&0<this.tempGraphics.length)for(;0<this.tempGraphics.length;)this.resultLayer.remove(this.tempGraphics[0]),this.tempGraphics.splice(0,1);this.tempGraphics=
null},_mouseOverChartItem:function(a){this._removeTempGraphics();if(this.resultLayer&&this.resultLayer.visible){var c=z.getTypeByGeometryType(this.layerDefinition.geometryType),d=null;if("point"===c)d=this._getHighLightMarkerSymbol(),this.tempGraphics=[],q.forEach(a,l.hitch(this,function(a){a=new W(a.geometry,d);this.tempGraphics.push(a);this.resultLayer.add(a)}));else if("polyline"===c||"polygon"===c)d="polyline"===c?this._getHighLightLineSymbol():this._getHighLightFillSymbol(),q.forEach(a,l.hitch(this,
function(a){a.setSymbol(d)})),this.featureSet.features.length!==a.length&&"polygon"===c&&(q.forEach(a,l.hitch(this,function(a){this.resultLayer.remove(a)})),q.forEach(a,l.hitch(this,function(a){this.resultLayer.add(a)})))}},_mouseOutChartItem:function(){this._removeTempGraphics();this.resultLayer&&q.forEach(this.resultLayer.graphics,l.hitch(this,function(a){a.setSymbol(null)}))},_isNumber:function(a){return"[object number]"===Object.prototype.toString.call(a).toLowerCase()},_tryLocaleNumber:function(a){var c=
a;if(Y.isDefined(a)&&isFinite(a))try{var d=z.localizeNumber(a);"string"===typeof d&&(c=d)}catch(e){console.error(e)}return c+""},_getBestDisplayValue:function(a,c){var d=this._tryLocaleNumber(c);if(this.layerDefinition.typeIdField===a){var e=this.layerDefinition.types;if(e&&0<e.length&&(e=q.filter(e,l.hitch(this,function(a){return a.id===c})),0<e.length))return d=e[0].name}if((e=this._getFieldInfo(a))&&e.domain)(e=e.domain.codedValues)&&0<e.length&&q.some(e,function(a){return a.code===c?(d=a.name,
!0):!1});return d},_getFieldAliasArray:function(a){return q.map(a,l.hitch(this,function(a){return this._getFieldAlias(a)}))},_getFieldAlias:function(a){var c=a;(a=this._getFieldInfo(a))&&(c=a.alias||c);return c},_getFieldInfo:function(a){if(this.layerDefinition)for(var c=this.layerDefinition.fields,d=0;d<c.length;d++)if(c[d].name===a)return c[d];return null},_isNumberField:function(a){var c=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"];return q.some(this.layerDefinition.fields,
l.hitch(this,function(d){return d.name===a&&0<=c.indexOf(d.type)}))},_getColors:function(a,c){var d=[],e=l.clone(a);if(2===e.colors.length)d=this._createGradientColors(e.colors[0],e.colors[e.colors.length-1],c);else{for(var b=Math.ceil(c/e.colors.length),p=0;p<b;p++)d=d.concat(e.colors);d=d.slice(0,c)}return d},_createPieTheme:function(a,c){var d=l.clone(a).colors,e=[];if(2===d.length)e=this._createGradientColors(d[0],d[d.length-1],c);else if(c<=d.length)e=d;else{for(var b=q.map(d,function(a){return new C(a)}),
p=0.5,h=1.5,m=0.1,d=Math.ceil(c/d.length),m=m*Math.floor(d/2),p=Math.max(1-m,p),h=Math.min(1+m,h),m=(h-p)/d,g=p,p=0;p<d;p++)q.forEach(b,l.hitch(this,function(a){var b=Math.min(Math.floor(a.r*g),255),c=Math.min(Math.floor(a.g*g),255);a=Math.min(Math.floor(a.b*g),255);var d=new C;d.r=b;d.g=c;d.b=a;b=d.toHex();e.push(b)})),g+=m;e=e.slice(0,c)}b={series:{stroke:{width:1.5,color:"#fff"}},seriesThemes:q.map(e,l.hitch(this,function(a){return{fill:a}}))};return new M(b)},_createGradientColors:function(a,
c,d){var e=[];a=new C(a);var b=new C(c);c=(b.r-a.r)/d;for(var l=(b.g-a.g)/d,b=(b.b-a.b)/d,h=new C,m=0,g=0,f=0,n=0;n<d;n++)m=parseInt(a.r+c*n,10),g=parseInt(a.g+l*n,10),f=parseInt(a.b+b*n,10),h.setColor([m,g,f]),e.push(h.toHex());return e},_getTypes:function(a){var c=[];a.column&&c.push("column");a.pie&&c.push("pie");a.bar&&c.push("bar");a.line&&c.push("line");return c},_calculateHorizontalRotation:function(a,c){var d=r.getContentBox(a),e=0,b=0;q.forEach(c,l.hitch(this,function(a){b=Math.max(b,a.text.length)}));
Math.floor((d.w-100)/c.length)<11.9*b&&(e=-45);return e},_createParamsDijit:function(a,c){return new Z({isInWidget:this.map?!0:!1,imagesUrl:this.folderUrl+"common/images",type:a,nls:this.nls,config:c})},_createColumnParamsDijit:function(a){return this._createParamsDijit("column",a.column)},_createBarParamsDijit:function(a){return this._createParamsDijit("bar",a.bar)},_createLineParamsDijit:function(a){return this._createParamsDijit("line",a.line)},_createPieParamsDijit:function(a){return this._createParamsDijit("pie",
a.pie)},_getRecreateChartFunction:function(a,c,d,e,b){return l.hitch(this,a,c,d,e,b)},_createFeatureModeCharts:function(a,c){var d=[],e=[],b=a.config,p=b.labelField,h=b.valueFields,m=this._getTypes(b),g="des"!==b.sortOrder;a.featureSet.features=q.filter(a.featureSet.features,l.hitch(this,function(a){return q.every(h,l.hitch(this,function(b){var c=a.attributes;return c&&this._isNumber(c[b])}))}));var f=[],f=q.map(a.featureSet.features,l.hitch(this,function(a){var b=a.attributes;a={category:b[p],valueFields:[],
dataFeatures:[a]};a.valueFields=q.map(h,l.hitch(this,function(a){return b[a]}));return a}));g?f.sort(function(a,b){return a.category<b.category?-1:a.category>b.category?1:0}):f.sort(function(a,b){return a.category<b.category?1:a.category>b.category?-1:0});q.forEach(m,l.hitch(this,function(g,k){try{var h=c[k],v=null,B=null;"column"===g?(B=this._createColumnParamsDijit(b),v=this._createFeatureModeColumnChart(a,h,f,B)):"bar"===g?(B=this._createBarParamsDijit(b),v=this._createFeatureModeBarChart(a,h,
f,B)):"line"===g?(B=this._createLineParamsDijit(b),v=this._createFeatureModeLineChart(a,h,f,B)):"pie"===g&&(B=this._createPieParamsDijit(b),v=this._createFeatureModePieChart(a,h,f,B));e.push(B);d.push(v)}catch(m){console.error(m)}}));return{charts:d,paramsDijits:e}},_createFeatureModeColumnChart:function(a,c,d,e){return this._createCategoryModeColumnChart(a,c,d,e)},_createFeatureModeBarChart:function(a,c,d,e){return this._createCategoryModeBarChart(a,c,d,e)},_createFeatureModeLineChart:function(a,
c,d,e){return this._createCategoryModeLineChart(a,c,d,e)},_createFeatureModePieChart:function(a,c,d,e){return this._createCategoryModePieChart(a,c,d,e)},_createCategoryModeCharts:function(a,c){var d=[],e=[],b=a.config,p=b.categoryField,h=b.valueFields,m=this._getTypes(b),g="des"!==b.sortOrder;a.featureSet.features=q.filter(a.featureSet.features,l.hitch(this,function(a){return q.every(h,l.hitch(this,function(b){var c=a.attributes;return c&&this._isNumber(c[b])}))}));var f=[],n=a.config.operation,k=
{};q.forEach(a.featureSet.features,l.hitch(this,function(a){var b=a.attributes[p],c=null;k.hasOwnProperty(b)?(c=k[b],c.dataFeatures.push(a)):(c={dataFeatures:[a]},k[b]=c)}));var s=null,v;for(v in k)this._isNumberField(p)&&(v=parseFloat(v)),s=k[v],s.valueFields=q.map(h,l.hitch(this,function(a){var b=q.map(s.dataFeatures,l.hitch(this,function(b){return b.attributes[a]})),c=0;"max"===n?c=-Infinity:"min"===n&&(c=Infinity);q.forEach(b,l.hitch(this,function(a){"average"===n||"sum"===n?c+=a:"max"===n?c=
Math.max(c,a):"min"===n&&(c=Math.min(c,a))}));"average"===n&&(c/=b.length);return c})),f.push({category:v,valueFields:s.valueFields,dataFeatures:s.dataFeatures});g?f.sort(function(a,b){return a.category<b.category?-1:a.category>b.category?1:0}):f.sort(function(a,b){return a.category<b.category?1:a.category>b.category?-1:0});q.forEach(m,l.hitch(this,function(k,g){try{var h=c[g],n=null,s=null;"column"===k?(s=this._createColumnParamsDijit(b),n=this._createCategoryModeColumnChart(a,h,f,s)):"bar"===k?
(s=this._createBarParamsDijit(b),n=this._createCategoryModeBarChart(a,h,f,s)):"line"===k?(s=this._createLineParamsDijit(b),n=this._createCategoryModeLineChart(a,h,f,s)):"pie"===k&&(s=this._createPieParamsDijit(b),n=this._createCategoryModePieChart(a,h,f,s));e.push(s);d.push(n)}catch(m){console.error(m)}}));return{charts:d,paramsDijits:e}},_bindCategoryModeChartEvent:function(a,c){this.map&&a.connectToPlot("default",l.hitch(this,function(a){var e="onmouseout"===a.type,b="onclick"===a.type;if("onmouseover"===
a.type||e||b)e=c[a.index].dataFeatures,"onmouseover"===a.type?this._mouseOverChartItem(e):"onmouseout"===a.type?this._mouseOutChartItem(e):"onclick"===a.type&&this._zoomToGraphics(e)}))},_createCategoryModeColumnChart:function(a,c,d,e){for(var b=a.config,p=b.valueFields,h=this._getFieldAliasArray(p),m=b.labelField||b.categoryField,g=e.getConfig(),f=[],n=[],k=0;k<p.length;k++)n.push([]);q.forEach(d,l.hitch(this,function(a,b){var c=this._getBestDisplayValue(m,a.category);f.push({value:b+1,text:c});
for(var d=0;d<a.valueFields.length;d++){var e=a.valueFields[d],k=h[d],g=this.nls.category,l=this._getBestDisplayValue(p[d],e);n[d].push({y:e,tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap'\x3e"+g+" : "+c+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+k+" : "+l+"\x3c/span\x3e\x3c/div\x3e"})}}));b=new w(c);b.setTheme(this._createTransparentTheme());b.addPlot("default",{type:U,enableCache:!0,markers:!0,gap:10,minBarSize:2,
maxBarSize:60});k=this._calculateHorizontalRotation(c,f);b.addAxis("x",{type:!1===g.horizontalAxis?u:t,natural:!0,labels:f,rotation:k,majorLabels:!0,minorLabels:!0,majorTickStep:1});b.addAxis("y",{type:!1===g.verticalAxis?u:t,vertical:!0,natural:!0,includeZero:!0});g=this._getColors(g,n.length);for(k=0;k<n.length;k++)b.addSeries(p[k],n[k],{stroke:{color:g[k%g.length]},fill:g[k%g.length]});new A(b,"default");new y(b,"default");new x(b,"default");b.render();this._bindCategoryModeChartEvent(b,d);b.createSelf=
this._getRecreateChartFunction(this._createCategoryModeColumnChart,a,c,d,e);return b},_createCategoryModeBarChart:function(a,c,d,e){for(var b=a.config,p=b.valueFields,h=this._getFieldAliasArray(p),m=b.labelField||b.categoryField,g=e.getConfig(),f=[],n=[],b=0;b<p.length;b++)n.push([]);q.forEach(d,l.hitch(this,function(a,b){var c=this._getBestDisplayValue(m,a.category);f.push({value:b+1,text:c});for(var d=0;d<a.valueFields.length;d++){var e=a.valueFields[d],k=h[d],g=this.nls.category,l=this._getBestDisplayValue(p[d],
e);n[d].push({y:e,tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap'\x3e"+g+" : "+c+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+k+" : "+l+"\x3c/span\x3e\x3c/div\x3e"})}}));var k=new w(c);k.setTheme(this._createTransparentTheme());k.addPlot("default",{type:V,enableCache:!0,markers:!0,gap:10,minBarSize:2,maxBarSize:60});k.addAxis("x",{type:!1===g.verticalAxis?u:t,vertical:!0,natural:!0,labels:f,majorLabels:!0,minorLabels:!0,
majorTickStep:1});k.addAxis("y",{type:!1===g.horizontalAxis?u:t,natural:!0,includeZero:!0});g=this._getColors(g,n.length);for(b=0;b<n.length;b++)k.addSeries(p[b],n[b],{stroke:{color:g[b%g.length]},fill:g[b%g.length]});new A(k,"default");new y(k,"default");new x(k,"default");k.render();this._bindCategoryModeChartEvent(k,d);k.createSelf=this._getRecreateChartFunction(this._createCategoryModeBarChart,a,c,d,e);return k},_createCategoryModeLineChart:function(a,c,d,e){for(var b=a.config,p=b.valueFields,
h=this._getFieldAliasArray(p),m=b.labelField||b.categoryField,g=e.getConfig(),f=[],n=[],k=0;k<p.length;k++)n.push([]);q.forEach(d,l.hitch(this,function(a,b){var c=this._getBestDisplayValue(m,a.category);f.push({value:b+1,text:c});for(var d=0;d<a.valueFields.length;d++){var e=a.valueFields[d],k=h[d],g=this.nls.category,l=this._getBestDisplayValue(p[d],e);n[d].push({y:e,tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap'\x3e"+g+" : "+c+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+
k+" : "+l+"\x3c/span\x3e\x3c/div\x3e"})}}));b=new w(c);b.setTheme(this._createTransparentTheme());b.addPlot("default",{type:F,markers:!0,tension:"X"});k=this._calculateHorizontalRotation(c,f);b.addAxis("x",{type:!1===g.horizontalAxis?u:t,natural:!0,includeZero:!0,labels:f,rotation:k,majorLabels:!0,minorLabels:!0,majorTickStep:1});b.addAxis("y",{type:!1===g.verticalAxis?u:t,vertical:!0,natural:!0});g=this._getColors(g,n.length);for(k=0;k<n.length;k++)b.addSeries(p[k],n[k],{stroke:{color:g[k%g.length]},
fill:g[k%g.length]});new H(b,"default");new y(b,"default");new x(b,"default");b.render();this._bindCategoryModeChartEvent(b,d);b.createSelf=this._getRecreateChartFunction(this._createCategoryModeLineChart,a,c,d,e);return b},_createCategoryModePieChart:function(a,c,d,e){var b=a.config,p=b.valueFields,h=this._getFieldAliasArray(p),m=b.labelField||b.categoryField,b=e.getConfig(),g=r.getContentBox(c),f=Math.floor(Math.min(g.w,g.h)/2/this.pieScale)-3,n=[],k=[],s=[];q.forEach(p,l.hitch(this,function(a,
b){k.push([]);var c=0;q.forEach(d,l.hitch(this,function(a){c+=Math.abs(a.valueFields[b])}));s.push(c)}));q.forEach(d,l.hitch(this,function(a,b){var c=this._getBestDisplayValue(m,a.category);n.push({value:b+1,text:c});for(var d=0;d<a.valueFields.length;d++){var e=a.valueFields[d],f=p[d],g=h[d],l=this._tryLocaleNumber((100*(e/s[d])).toFixed(1))+"%",v=this.nls.category,f=this._getBestDisplayValue(f,e);k[d].push({y:Math.abs(e),text:c,tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap'\x3e"+
v+" : "+c+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+g+" : "+f+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d'white-space:nowrap'\x3e"+l+"\x3c/span\x3e\x3c/div\x3e"})}}));var g=new w(c),v=this._createPieTheme(b,d.length);v.plotarea.fill="transparent";v.chart.fill="transparent";g.setTheme(v);g.addPlot("default",{type:G,radius:f,labels:!!b.label});for(b=0;b<k.length;b++)g.addSeries(p[b],k[b]);new A(g,"default");new y(g,"default");new x(g,"default");g.render();
this._bindCategoryModeChartEvent(g,d);g.createSelf=this._getRecreateChartFunction(this._createCategoryModePieChart,a,c,d,e);return g},_createCountModeCharts:function(a,c){var d=[],e=[],b=a.config,p=this._getTypes(b),h=b.categoryField,m="des"!==b.sortOrder,g={};q.forEach(a.featureSet.features,l.hitch(this,function(a){var b=a.attributes[h],c=null;g.hasOwnProperty(b)?(c=g[b],c.count++,c.dataFeatures.push(a)):(c={count:1,dataFeatures:[a]},g[b]=c)}));var f=[],n=null,k;for(k in g)n=g[k],this._isNumberField(h)&&
(k=parseFloat(k)),f.push({fieldValue:k,count:n.count,dataFeatures:n.dataFeatures});m?f.sort(function(a,b){return a.fieldValue<b.fieldValue?-1:a.fieldValue>b.fieldValue?1:0}):f.sort(function(a,b){return a.fieldValue<b.fieldValue?1:a.fieldValue>b.fieldValue?-1:0});q.forEach(p,l.hitch(this,function(k,g){try{var h=c[g],n=null,l=null;"column"===k?(l=this._createColumnParamsDijit(b),n=this._createCountModeColumnChart(a,h,f,l)):"bar"===k?(l=this._createBarParamsDijit(b),n=this._createCountModeBarChart(a,
h,f,l)):"line"===k?(l=this._createLineParamsDijit(b),n=this._createCountModeLineChart(a,h,f,l)):"pie"===k&&(l=this._createPieParamsDijit(b),n=this._createCountModePieChart(a,h,f,l));e.push(l);d.push(n)}catch(m){console.error(m)}}));return{charts:d,paramsDijits:e}},_bindCountModeChartEvent:function(a,c){this.map&&a.connectToPlot("default",l.hitch(this,function(a){var e="onmouseout"===a.type,b="onclick"===a.type;if("onmouseover"===a.type||e||b)e=c[a.index].dataFeatures,"onmouseover"===a.type?this._mouseOverChartItem(e):
"onmouseout"===a.type?this._mouseOutChartItem(e):"onclick"===a.type&&this._zoomToGraphics(e)}))},_createCountModeColumnChart:function(a,c,d,e){var b=a.config.categoryField,p=this._getFieldAlias(b),h=e.getConfig(),m=[],g=[];q.forEach(d,l.hitch(this,function(a,c){var d=a.count,e=a.fieldValue,f=z.localizeNumber(d),e=this._getBestDisplayValue(b,e);m.push({value:c+1,text:e});g.push({y:d,tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+p+" : "+e+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+
this.nls.count+" : "+f+"\x3c/span\x3e\x3c/div\x3e"})}));var f=new w(c);f.setTheme(this._createTransparentTheme());f.addPlot("default",{type:K,enableCache:!0,markers:!0,gap:10,minBarSize:2,maxBarSize:60});var n=this._calculateHorizontalRotation(c,m);f.addAxis("x",{type:!1===h.horizontalAxis?u:t,natural:!0,labels:m,rotation:n,majorLabels:!0,minorLabels:!0,majorTickStep:1});f.addAxis("y",{type:!1===h.verticalAxis?u:t,vertical:!0,includeZero:!0,natural:!0});h=this._getColors(h,1);f.addSeries("default",
g,{stroke:{color:h[0]},fill:h[0]});new A(f,"default");new y(f,"default");new x(f,"default");f.render();this._bindCountModeChartEvent(f,d);f.createSelf=this._getRecreateChartFunction(this._createCountModeColumnChart,a,c,d,e);return f},_createCountModeBarChart:function(a,c,d,e){var b=a.config.categoryField,p=this._getFieldAlias(b),h=e.getConfig(),m=[],g=[];q.forEach(d,l.hitch(this,function(a,c){var d=a.count,e=a.fieldValue,f=z.localizeNumber(d),e=this._getBestDisplayValue(b,e);m.push({value:c+1,text:e});
g.push({y:d,tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+p+" : "+e+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+this.nls.count+" : "+f+"\x3c/span\x3e\x3c/div\x3e"})}));var f=new w(c);f.setTheme(this._createTransparentTheme());f.addPlot("default",{type:L,enableCache:!0,markers:!0,gap:10,minBarSize:2,maxBarSize:60});f.addAxis("x",{type:!1===h.verticalAxis?u:t,vertical:!0,natural:!0,labels:m,majorLabels:!0,
minorLabels:!0,majorTickStep:1});f.addAxis("y",{type:!1===h.horizontalAxis?u:t,includeZero:!0,natural:!0});h=this._getColors(h,1);f.addSeries("default",g,{stroke:{color:h[0]},fill:h[0]});new A(f,"default");new y(f,"default");new x(f,"default");f.render();this._bindCountModeChartEvent(f,d);f.createSelf=this._getRecreateChartFunction(this._createCountModeBarChart,a,c,d,e);return f},_createCountModeLineChart:function(a,c,d,e){var b=a.config.categoryField,p=this._getFieldAlias(b),h=e.getConfig(),m=[],
g=[];q.forEach(d,l.hitch(this,function(a,c){var d=a.count,e=a.fieldValue,f=z.localizeNumber(d),e=this._getBestDisplayValue(b,e);m.push({value:c+1,text:e});g.push({y:d,text:"",tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+p+" : "+e+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+this.nls.count+" : "+f+"\x3c/span\x3e\x3c/div\x3e"})}));var f=new w(c);f.setTheme(this._createTransparentTheme());f.addPlot("default",
{type:F,markers:!0,tension:"X"});var n=this._calculateHorizontalRotation(c,m);f.addAxis("x",{type:!1===h.horizontalAxis?u:t,natural:!0,includeZero:!0,labels:m,rotation:n,majorLabels:!0,minorLabels:!0,majorTickStep:1});f.addAxis("y",{type:!1===h.verticalAxis?u:t,vertical:!0,natural:!0});h=this._getColors(h,1);f.addSeries("default",g,{stroke:{color:h[0]},fill:h[0]});new H(f,"default");new y(f,"default");new x(f,"default");f.render();this._bindCountModeChartEvent(f,d);f.createSelf=this._getRecreateChartFunction(this._createCountModeLineChart,
a,c,d,e);return f},_createCountModePieChart:function(a,c,d,e){var b=a.config.categoryField,p=this._getFieldAlias(b),h=e.getConfig(),m=r.getContentBox(c),m=Math.floor(Math.min(m.w,m.h)/2/this.pieScale)-3,g=[],f=[],n=0;q.forEach(d,l.hitch(this,function(a){n+=a.count}));q.forEach(d,l.hitch(this,function(a,c){var d=a.count,e=this._getBestDisplayValue(b,a.fieldValue),k=this._tryLocaleNumber((100*(d/n)).toFixed(1))+"%",h=z.localizeNumber(d),l=this.nls.count;g.push({value:c+1,text:e});f.push({text:e,y:d,
tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+p+" : "+e+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+l+" : "+h+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+k+"\x3c/span\x3e\x3c/div\x3e"})}));var k=new w(c),s=this._createPieTheme(h,d.length);s.plotarea.fill="transparent";s.chart.fill="transparent";k.setTheme(s);k.addPlot("default",{type:G,radius:m,labels:!!h.label});k.addSeries("default",
f);new A(k,"default");new y(k,"default");new x(k,"default");k.render();this._bindCountModeChartEvent(k,d);k.createSelf=this._getRecreateChartFunction(this._createCountModePieChart,a,c,d,e);return k},_createFieldModeCharts:function(a,c){var d=[],e=[],b=a.config,p=this._getTypes(b),h=b.valueFields,m=b.operation;a.featureSet.features=q.filter(a.featureSet.features,l.hitch(this,function(a){return q.every(h,l.hitch(this,function(b){var c=a.attributes;return c&&this._isNumber(c[b])}))}));var g=q.map(a.featureSet.features,
l.hitch(this,function(a){return a.attributes})),f={};q.forEach(h,l.hitch(this,function(a){f[a]=0;"max"===m?f[a]=-Infinity:"min"===m&&(f[a]=Infinity)}));q.forEach(g,l.hitch(this,function(a){q.forEach(h,l.hitch(this,function(b){var c=a[b];f.hasOwnProperty(b)?"average"===m||"sum"===m?f[b]+=c:"max"===m?f[b]=Math.max(f[b],c):"min"===m&&(f[b]=Math.min(f[b],c)):f[b]=c}))}));"average"===m&&q.forEach(h,l.hitch(this,function(a){f[a]/=g.length}));q.forEach(p,l.hitch(this,function(g,k){try{var h=c[k],l=null,
m=null;"column"===g?(m=this._createColumnParamsDijit(b),l=this._createFieldModeColumnChart(a,h,f,m)):"bar"===g?(m=this._createBarParamsDijit(b),l=this._createFieldModeBarChart(a,h,f,m)):"line"===g?(m=this._createLineParamsDijit(b),l=this._createFieldModeLineChart(a,h,f,m)):"pie"===g&&(m=this._createPieParamsDijit(b),l=this._createFieldModePieChart(a,h,f,m));e.push(m);d.push(l)}catch(p){console.error(p)}}));return{charts:d,paramsDijits:e}},_bindFieldModeChartEvent:function(a){this.map&&a.connectToPlot("default",
l.hitch(this,function(a){var d="onmouseout"===a.type,e="onclick"===a.type;if("onmouseover"===a.type||d||e)d=this.featureSet&&this.featureSet.features,"onmouseover"===a.type?this._mouseOverChartItem(d):"onmouseout"===a.type?this._mouseOutChartItem(d):"onclick"===a.type&&this._zoomToGraphics(d)}))},_createFieldModeColumnChart:function(a,c,d,e){var b=a.config.valueFields,p=this._getFieldAliasArray(b),h=e.getConfig(),m=[],g=[];q.forEach(b,l.hitch(this,function(a,b){var c=p[b],e=d[a],f=z.localizeNumber(e);
m.push({value:b+1,text:c});g.push({y:e,tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+c+" : "+f+"\x3c/span\x3e\x3c/div\x3e"})}));b=new w(c);b.setTheme(this._createTransparentTheme());b.addPlot("default",{type:K,enableCache:!0,markers:!0,gap:10,minBarSize:2,maxBarSize:60});var f=this._calculateHorizontalRotation(c,m);b.addAxis("x",{type:!1===h.horizontalAxis?u:t,natural:!0,labels:m,rotation:f,majorLabels:!0,minorLabels:!0,majorTickStep:1});
b.addAxis("y",{type:!1===h.verticalAxis?u:t,vertical:!0,includeZero:!0,natural:!0});h=this._getColors(h,1);b.addSeries("default",g,{stroke:{color:h[0]},fill:h[0]});new A(b,"default");new y(b,"default");new x(b,"default");b.render();this._bindFieldModeChartEvent(b);b.createSelf=this._getRecreateChartFunction(this._createFieldModeColumnChart,a,c,d,e);return b},_createFieldModeBarChart:function(a,c,d,e){var b=a.config.valueFields,p=this._getFieldAliasArray(b),h=e.getConfig(),m=[],g=[];q.forEach(b,l.hitch(this,
function(a,b){var c=p[b],e=d[a],h=z.localizeNumber(e);m.push({value:b+1,text:c});g.push({y:e,tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+c+" : "+h+"\x3c/span\x3e\x3c/div\x3e"})}));b=new w(c);b.setTheme(this._createTransparentTheme());b.addPlot("default",{type:L,enableCache:!0,markers:!0,gap:10,minBarSize:2,maxBarSize:60});b.addAxis("x",{type:!1===h.verticalAxis?u:t,vertical:!0,natural:!0,labels:m,majorLabels:!0,minorLabels:!0,majorTickStep:1});
b.addAxis("y",{type:!1===h.horizontalAxis?u:t,includeZero:!0,natural:!0});h=this._getColors(h,1);b.addSeries("default",g,{stroke:{color:h[0]},fill:h[0]});new A(b,"default");new y(b,"default");new x(b,"default");b.render();this._bindFieldModeChartEvent(b);b.createSelf=this._getRecreateChartFunction(this._createFieldModeBarChart,a,c,d,e);return b},_createFieldModeLineChart:function(a,c,d,e){var b=a.config.valueFields,p=this._getFieldAliasArray(b),h=e.getConfig(),m=[],g=[];q.forEach(b,l.hitch(this,function(a,
b){var c=p[b],e=d[a],f=z.localizeNumber(e);m.push({value:b+1,text:c});g.push({y:e,tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+c+" : "+f+"\x3c/span\x3e\x3c/div\x3e"})}));b=new w(c);b.setTheme(this._createTransparentTheme());b.addPlot("default",{type:F,markers:!0,tension:"X"});var f=this._calculateHorizontalRotation(c,m);b.addAxis("x",{type:!1===h.horizontalAxis?u:t,natural:!0,includeZero:!0,labels:m,rotation:f,majorLabels:!0,minorLabels:!0,
majorTickStep:1});b.addAxis("y",{type:!1===h.verticalAxis?u:t,vertical:!0,natural:!0});h=this._getColors(h,1);b.addSeries("default",g,{stroke:{color:h[0]},fill:h[0]});new H(b,"default");new y(b,"default");new x(b,"default");b.render();this._bindFieldModeChartEvent(b);b.createSelf=this._getRecreateChartFunction(this._createFieldModeLineChart,a,c,d,e);return b},_createFieldModePieChart:function(a,c,d,e){var b=a.config.valueFields,p=this._getFieldAliasArray(b),h=e.getConfig(),m=r.getContentBox(c),m=
Math.floor(Math.min(m.w,m.h)/2/this.pieScale)-3,g=[],f=[],n=0,k;for(k in d)n+=Math.abs(d[k]);q.forEach(b,l.hitch(this,function(a,b){var c=p[b],e=d[a],h=this._tryLocaleNumber((100*(e/n)).toFixed(1))+"%",k=z.localizeNumber(e);g.push({value:b+1,text:c});f.push({text:c,y:Math.abs(e),tooltip:"\x3cdiv style\x3d'color:green;margin:5px 10px;'\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+c+" : "+k+"\x3c/span\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d'white-space:nowrap;'\x3e"+h+"\x3c/span\x3e\x3c/div\x3e"})}));
b=new w(c);k=this._createPieTheme(h,d.length);k.plotarea.fill="transparent";k.chart.fill="transparent";b.setTheme(k);b.addPlot("default",{type:G,radius:m,labels:!!h.label});b.addSeries("default",f);new A(b,"default");new y(b,"default");new x(b,"default");b.render();this._bindFieldModeChartEvent(b);b.createSelf=this._getRecreateChartFunction(this._createFieldModePieChart,a,c,d,e);return b},_createTransparentTheme:function(){return new M({plotarea:{fill:"transparent"},chart:{fill:"transparent"}})}})});