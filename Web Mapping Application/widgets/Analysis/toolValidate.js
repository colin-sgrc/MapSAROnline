//>>built
define(["dojo/_base/lang","dojo/_base/array","./privilegeUtil"],function(h,e,k){function f(a,b,c){var d=null;e.some(a,h.hitch(this,function(a){if(a&&c!==a.id)if(1===b.length){if("*"===b[0]||b[0]===a.geometryType)return d=a.id,!0}else if(-1<b.indexOf(a.geometryType))return d=a.id,!0}));return d}return{isValid:function(a,b){var c=!1,c=a.layerObjects;if(-1!==b.dijitID.indexOf("MergeLayers"))c=this.mergeAvailable(c);else if(-1!==b.dijitID.indexOf("ExtractData"))c=this.extractAvailable(a);else{var d=null;
"requiredParam"in b&&(d=b.requiredParam);c=this.paramAvailable(c,b.analysisLayer,d)}return c},mergeAvailable:function(a){return e.some(a,function(b){return e.some(a,function(a){return a!==b&&a.geometryType===b.geometryType})})},extractAvailable:function(a){var b=k.getUser(),c=a.layerInfos,d=a.layerInfosObject.getMapNotesLayerInfoArray(),g=!1;e.forEach(c,function(a){var c=this._isMapNotes(d,a),f="esri.layers.GeoRSSLayer"===a.layerObject.declaredClass,l="esri.layers.CSVLayer"===a.layerObject.declaredClass,
m="FeatureCollection"===a.layerObject.type,h=m&&!c;m||f||l||c?f||l?g=this._addExtractCapability(a):c||h?(a=a.getSubLayers())&&0<a.length&&e.forEach(a,function(a){g=this._addExtractCapability(a)},this):g=this._addExtractCapability(a):k.isAdmin()&&(a.layerObject.url&&-1<a.layerObject.url.indexOf("/"+b.accountId+"/"))&&(g=this._addExtractCapability(a))},this);return g},_isMapNotes:function(a,b){return e.some(a,function(a){return a.id===b.id})},_addExtractCapability:function(a){a.layerObject.capabilities?
-1===a.layerObject.capabilities.indexOf("Extract")&&(a.layerObject.capabilities+=",Extract"):a.layerObject.capabilities="Extract";return!0},paramAvailable:function(a,b,c){var d;d=b.geomTypes;b=f(a,d);return null===b?!1:null!==c?(d=c.geomTypes,null!==f(a,d,b)):!0}}});