//>>built
define(["dojo/_base/lang","dojo/_base/array","jimu/portalUtils","jimu/portalUrlUtils","esri/kernel"],function(d,e,f,h,k){var b={},l=["org_admin","account_admin","org_publisher","account_publisher"];b.loadPrivileges=function(a){this.userProfile=null;a=f.getPortal(a);return a.haveSignIn()?this._loadUserInfo(a):this._signIn(a)};b._signIn=function(a){return a.loadSelfInfo().then(d.hitch(this,function(a){var c=f.getPortal(a.portalHostname);return null===c?!1:c.signIn().then(d.hitch(this,function(a){return this._loadUserInfo(c,
a)}))}))};b._registerOrgCredential=function(a,b){b=h.getStandardPortalUrl(b);var c=d.clone(a.toJson()),g=b+"/sharing/rest";c.server=g;c.resources=[g];k.id.registerToken(c)};b._loadUserInfo=function(a,b){return a.loadSelfInfo().then(d.hitch(this,function(a){return a.urlKey&&a&&a.user?(this.user=d.clone(a.user),this.userProfile={role:a.user.role||a.user.id,isCustomRole:"roleId"in a.user,portalUrl:a.urlKey+"."+a.customBaseUrl,privileges:{}},e.forEach(a.user.privileges,function(a){"string"===typeof a&&
(a=a.split(":"),3===a.length&&(this.userProfile.privileges[a[2]]=!0))},this),b&&this._registerOrgCredential(b,this.userProfile.portalUrl),!0):!1}))};b._privilegeLoaded=function(){return"undefined"!==typeof this.userProfile&&null!==this.userProfile};b.getUserPortal=function(){return this._privilegeLoaded()?this.userProfile.portalUrl:null};b.isAdmin=function(){return this._privilegeLoaded()?"org_admin"===this.userProfile.role||"account_admin"===this.userProfile.role:!1};b.getUser=function(){return this._privilegeLoaded()?
this.user:null};b.isAnalysisAvailable=function(){return this._privilegeLoaded()?this.userProfile.isCustomRole?this._hasPrivilege("createItem")&&this._hasPrivilege("publishFeatures")&&this._hasPrivilege("spatialanalysis"):-1!==e.indexOf(l,this.userProfile.role):!1};b.hasPrivileges=function(a){return d.isArray(a)?e.every(a,function(a){return this._hasPrivilege(a)},this):!0};b._hasPrivilege=function(a){return this._privilegeLoaded()?!0===this.userProfile.privileges[a]:!1};return b});