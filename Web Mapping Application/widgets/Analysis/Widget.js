//>>built
require({cache:{"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(k,b,r,q,c){k=k(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(f){this.messages=[];b.mixin(this,f);f=this.messages;var e,g=f.length;for(e=0;e<g;e++)f[e]=new c(f[e])},jobId:"",jobStatus:""});b.mixin(k,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",
STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});return k})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(k,b,r,q){k=k(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(c){b.mixin(this,c)}});b.mixin(k,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",
TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});return k})},"esri/dijit/analysis/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/_base/json dojo/dom-attr dojo/has dojo/i18n dojo/io-query dojo/i18n!../../nls/jsapi dojo/json dojo/string dojo/query dojo/dom-style dojo/dom-class dojo/dom-construct dojo/Deferred dojo/number dojo/_base/window dojo/when dojo/data/ItemFileWriteStore dijit/registry dijit/Dialog dijit/form/CheckBox ../../kernel ../../lang ../../request ./HelpWindow ../../tasks/query ../../dijit/BrowseItems ../../layers/FeatureLayer ./PluginAnalysisLayers ../../tasks/Geoprocessor".split(" "),
function(k,b,r,q,c,f,e,g,t,l,z,u,m,p,n,E,w,B,y,F,D,C,a,h,d,s,x,A,H,J,K,G,L,M){k={};b.mixin(k,{_helpDialog:null,i18n:null,initHelpLinks:function(v,d,h){this._helpDialog||(this._helpDialog=new H);if(v){var s=a.byNode(v),g=s?s.get("helpFileName"):h&&h.helpFileName?h.helpFileName:null;p("[esriHelpTopic]",v).forEach(function(a,s,I){a&&(n.set(a,"display",!x.isDefined(d)||!0===d?"":"none"),q.connect(a,"onclick",b.hitch(this,function(d){c.stop(d);this._helpDialog.show(d,{helpId:e.get(a,"esriHelpTopic"),helpFileName:g,
analysisGpServer:h&&h.analysisGpServer?h.analysisGpServer:null,helpParentNode:v})})))},this)}},constructAnalysisFeatColl:function(v){var a={},d;a.featureCollection=v.layerDefinition;for(d in a.featureCollection)a.featureCollection.hasOwnProperty(d)&&"objectIdField"===d&&(a.featureCollection.objectIdFieldName=b.clone(a.featureCollection.objectIdField),delete a.featureCollection.objectIdField);a.featureCollection.features=v.featureSet.features;return a},constructAnalysisInputLyrObj:function(v){var a=
{};if(v.url&&!v._collection)a={url:v.url},v.getDefinitionExpression&&v.getDefinitionExpression()?a.filter=v.getDefinitionExpression():x.isDefined(v.definitionExpression)&&""!==v.definitionExpression&&(a.filter=v.definitionExpression),v.credential&&(a.serviceToken=v.credential.token),-1!==a.url.indexOf("?")&&(v=a.url.substring(a.url.indexOf("?")+1,a.url.length),v=l.queryToObject(v),b.mixin(a,v),a.url=a.url.substring(0,a.url.indexOf("?")));else if(!v.url||v._collection)try{a=v.toJson()}catch(d){v._json=
u.parse(v._json),a=v.toJson()}return a},buildReport:function(a,d){var h="";d||(d={},b.mixin(d,z.analysisMsgCodes));r.forEach(a,function(a,v){var s,c,n;"string"===typeof a.message?(s=x.isDefined(d[a.messageCode])?d[a.messageCode]:a.message,h+=a.style.substring(0,a.style.indexOf("\x3c/"))+(!this._isEmptyObject(a.params)?m.substitute(s,a.params):s)+a.style.substring(a.style.indexOf("\x3c/"))):b.isArray(a.message)&&(n=[],c=b.clone(a.style),r.forEach(a.message,function(v,h){c=c.replace(/<\//,"${"+h+"}");
s=x.isDefined(d[a.messageCode+"_"+h])?d[a.messageCode+"_"+h]:v;s=!this._isEmptyObject(a.params)?m.substitute(s,a.params):s;n.push(s+"\x3c/")},this),c=m.substitute(c,n),h+=c)},this);return h},getLayerFeatureCount:function(a,d){var h=new J;h.geometry=d.geometry||"";h.where=d.where||"1\x3d1";h.geometryType=d.geometryType||"esriGeometryEnvelope";return a.queryCount(h)},createPolygonFeatureCollection:function(a){var d;d={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPolygon"}};
d.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:"esriGeometryPolygon",minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",allowGeometryUpdates:!0,htmlPopupType:"",hasM:!1,hasZ:!1,globalIdField:"",
supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",
name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return d},createPointFeatureCollection:function(a){var d;d={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPoint"}};d.layerDefinition={objectIdField:"OBJECTID",templates:[],type:"Feature Layer",drawingInfo:{renderer:{field1:"TYPEID",type:"simple",symbol:{height:24,
xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/GreenStickpin.png"},description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:"esriGeometryPoint",fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",
name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return d},createFolderStore:function(a,d){var h=new C({data:{identifier:"id",label:"name",items:[]}});h.newItem({name:d,id:""});r.forEach(a,function(a){h.newItem({name:a.title,id:a.id})});return h},setupFoldersUI:function(a){a.folderSelect.set("store",a.folderStore);a.folderSelect.set("required",
!0);a.folderSelect.set("searchAttr","name");x.isDefined(a.folderId)?a.folderStore.get(a.folderId).then(b.hitch(this,function(d){x.isDefined(d)?a.folderSelect.set("item",d):a.folderStore.get("").then(function(d){a.folderSelect.set("item",d)},this)})):a.folderName?a.folderStore.fetch({query:{name:a.folderName},onComplete:b.hitch(this,function(d){x.isDefined(d)&&0<d.length?a.folderSelect.set("item",d[0]):a.folderStore.get("").then(function(d){a.folderSelect.set("item",d)},this)})}):a.username?a.folderSelect.set("displayedValue",
a.username):a.folderStore.get("").then(function(d){a.folderSelect.set("item",d)},this)},_isEmptyObject:function(a){for(var d in a)if(a.hasOwnProperty(d))return!1;return!0},validateServiceName:function(a,d){var h=/(:|&|<|>|%|#|\?|\\|\"|\/|\+)/.test(a),b=!0,s,c;x.isDefined(d)&&d.textInput&&(c=d.textInput);this.initI18n();0===a.length||0===m.trim(a).length?(s=this.i18n.requiredValue,b=!1):h?(s=this.i18n.invalidServiceName,b=!1):98<a.length?(s=this.i18n.invalidServiceNameLength,b=!1):170<encodeURIComponent(a).length&&
(s=this.i18n.invalidEncodedServiceNameLength,b=!1);c&&!b&&c.set("invalidMessage",s);return b},getStepNumber:function(a){p(".esriAnalysisNumberLabel",a).forEach(function(a,d){var v=this._getNumberLabel(d);e.set(a,"innerHTML",v)},this)},_getNumberLabel:function(a){var d="";this.initI18n();switch(a){case 0:d=this.i18n.oneLabel;break;case 1:d=this.i18n.twoLabel;break;case 2:d=this.i18n.threeLabel;break;case 3:d=this.i18n.fourLabel;break;case 4:d=this.i18n.fiveLabel;break;case 5:d=this.i18n.sixLabel;break;
case 6:d=this.i18n.sevenLabel;break;case 7:d=this.i18n.eightLabel;break;case 8:d=this.i18n.nineLabel}return d},populateAnalysisLayers:function(a,d,h,b){if(a){var s=[],c=a.get(d);a._titleRow&&n.set(a._titleRow,"display","none");a._analysisLabelRow&&n.set(a._analysisLabelRow,"display","table-row");a._selectAnalysisRow&&(n.set(a._selectAnalysisRow,"display","table-row"),E.add(a._analysisSelect.domNode,"esriTrailingMargin3"),n.set(a._analysisSelect.domNode.parentNode,"padding-bottom","1em"));a.domNode&&
this.getStepNumber(a.domNode);x.isDefined(b)&&b.chooseLabel&&s.push({value:-1,label:this.i18n.chooseLabel});r.forEach(a.get(h),function(a,d){var v={value:x.isDefined(b)&&b.chooseLabel?d+1:d,label:a.name};c&&a.name===c.name&&(v.selected=!0);s.push(v)},this);a._analysisSelect.addOption(s);a._analysisSelect.set("required",!0)}},isValidAnalysisLayer:function(a){var d,h,b,s,c,n,g,l="",A=!0;d={isValid:A,validationMessage:l};var f,e,p=0,H=0,E=0;if(!x.isDefined(a)||!x.isDefined(a.toolName))return d;this.initI18n();
d=a.toolName;h=a.featureLayers;b=a.analysisLayer;s=d.charAt(0).toLowerCase()+d.substring(1);g=this.i18n;a=a.showReadyToUseLayers||!1;r.forEach(h,function(a){"esriGeometryPoint"===a.geometryType&&(n=!0,p++);if("esriGeometryPoint"===a.geometryType||"esriGeometryMultipoint"===a.geometryType)f=!0;"esriGeometryPolyline"===a.geometryType&&(e=!0,E++);"esriGeometryPolygon"===a.geometryType&&(c=!0,H++)},this);-1!==r.indexOf(["CreateDriveTimeAreas","PlanRoutes","ConnectOriginsToDestinations"],d)&&(!n||b&&"esriGeometryPoint"!==
b.geometryType)?(l=m.substitute(this.i18n.selectPointLayer,{toolName:g[s]}),A=!1):("AggregatePoints"===d||"InterpolatePoints"===d)&&(b&&!("esriGeometryPoint"===b.geometryType||"esriGeometryMultipoint"===b.geometryType)||!f)?(l=m.substitute(this.i18n.selectPointLayer,{toolName:g[s]}),A=!1):"CalculateDensity"===d&&(!f&&!e||b&&!("esriGeometryPoint"===b.geometryType||"esriGeometryMultipoint"===b.geometryType||"esriGeometryPolyline"===b.geometryType))?(l=m.substitute(this.i18n.areaFeatureInvalidMsg,{toolName:g[s]}),
A=!1):"FindHotSpots"===d&&(!f&&!c||b&&!("esriGeometryPoint"===b.geometryType||"esriGeometryMultipoint"===b.geometryType||"esriGeometryPolygon"===b.geometryType))?(l=m.substitute(this.i18n.hotspotsLineFeatureMsg,{toolName:g[s]}),A=!1):("OverlayLayers"===d||"AggregatePoints"===d||"SummarizeWithin"===d||"SummarizeNearby"===d||"FindNearest"===d||"MergeLayers"===d)&&!a&&(0===h.length||1===h.length&&(h[0]===b||!x.isDefined(b)))?(l=m.substitute(this.i18n.overlayValidationMsg,{toolName:g[s]}),A=!1):"ConnectOriginsToDestinations"===
d&&!a&&(0===h.length||2>p)?(l=m.substitute(this.i18n.odPointMsg,{toolName:g[s]}),A=!1):"AggregatePoints"===d&&!a&&1<h.length?(c=r.some(h,function(a){return"esriGeometryPolygon"===a.geometryType}),c||(l=m.substitute(this.i18n.aggregatePolyMsg,{toolName:g[s]}),A=!1)):"MergeLayers"===d&&!a&&1<h.length?1<p||(1<E||1<H)||(l=this.i18n.mergeValidationMsg,A=!1):("SummarizeWithin"===d||"DissolveBoundaries"===d)&&(b&&"esriGeometryPolygon"!==b.geometryType||!c)?(l=m.substitute(this.i18n.selectPolyLayer,{toolName:g[s]}),
A=!1):"ExtractData"===d?(A=r.some(h,function(a){return-1!==a.capabilities.indexOf("Extract")}))||(l=m.substitute(this.i18n.extractValidationMsg)):"ConnectOriginsToDestinations"===d&&1<h.length&&(n=r.some(h,function(a){var d=x.isDefined(b)&&b.id===a.id;return"esriGeometryPoint"===a.geometryType&&!d}),n||(l=m.substitute(this.i18n.odPointMsg,{toolName:g[s]}),A=!1));return d={isValid:A,validationMessage:l}},initI18n:function(){this.i18n||(this.i18n={},b.mixin(this.i18n,z.common),b.mixin(this.i18n,z.analysisTools),
b.mixin(this.i18n,z.analysisMsgCodes),b.mixin(this.i18n,z.browseLayersDlg),b.mixin(this.i18n,z.driveTimes))},addBrowseAnalysisDialog:function(a){var b=[];if(a&&a.widget){this.i18n||this.initI18n();b.push({label:this.i18n.categoryAll,value:"analysis ready"});b.push({label:this.i18n.categoryBoundaries,value:"boundaries OR places"});b.push({label:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+this.i18n.subCategoryBoundaries,value:"boundaries"});b.push({label:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+this.i18n.subCategoryPlaces,
value:"places"});b.push({label:this.i18n.categoryHexBins,value:"hex"});b.push({label:this.i18n.categoryTransportation,value:"transportation"});var s=F.doc.createDocumentFragment(),s=w.create("div",{style:"width:100%;height:100%;"},s),c=w.create("div",{style:"width:100%;height:10%;"},s),n=w.create("div",{style:"width:100%"},s),b=new K({portalUrl:a.widget.get("portalUrl"),message:"",plugin:"esri/dijit/analysis/PluginAnalysisLayers",sortDescending:!0,sort:"title",self:a.widget.get("portalSelf"),categories:b,
categoryType:"tags",selectedCategory:"boundaries OR places",pagingLinks:3,itemsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",closePopupPerRow:!1,galleryTemplate:'\x3cdiv style\x3d\'opacity:1;\' class\x3d\'grid-item gallery-view galleryNode\'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3cdiv class\x3d"linksDiv" style\x3d\'display:none;\'\x3e\x3cdiv class\x3d"esriItemLinks"\x3e\x3cdiv class\x3d"esriFloatLeading"\x3e\x3ca style\x3d"text-decoration: none;"\x3e\x3cspan\x3eAdd layer to analysis\x3c/span\x3e\x3cdiv class\x3d"dijitReset dijitInline esriArrows"\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
formatThumbnail:function(a){return"\x3cimg class\x3d'grid-item galleryThumbnail' width\x3d'120px' height\x3d'80px' alt\x3d'' src\x3d'"+(a.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+"'\x3e"},formatItemTitle:function(a){return'\x3cdiv class\x3d"galleryLabelContainer"\x3e\x3cspan alt\x3d\''+(a.title||a.name||"\x3cNo Title\x3e")+"'\x3e"+(a.title.replace(/_/g," ")||a.name.replace(/_/g," ")||"\x3cNo Title\x3e")+"\x3c/span\x3e\x3c/div\x3e"},style:"width:600px;height:90%;clear:both;"},
n);w.create("label",{"for":a.widget.id+"_addlayercheck","class":"esriFloatTrailing",style:"padding-bottom:0.5em;",innerHTML:this.i18n.addLayer},c);a=new d({name:"addlayer",id:a.widget.id+"_addlayercheck","class":"esriFloatTrailing",value:!1,checked:!1},w.create("input",{},c,"last"));return new h({title:this.i18n.browseAnalysisTitle,content:s,doLayout:!0,browseItems:b,addlayerCheckBox:a,style:"padding:.75em 0;background-color: #fff;"})}},addAnalysisReadyLayer:function(a){if(x.isDefined(a)&&x.isDefined(a.item)&&
x.isDefined(a.layersSelect)&&x.isDefined(a.layers)&&x.isDefined(a.browseDialog)){a.browseDialog.browseItems._closePopup();a.browseDialog.hide();var d={url:a.item.url+"/0",itemId:a.item.id,title:a.item.title,analysisReady:!0},h,s=r.some(a.layers,function(a,b){var v=a.analysisReady&&d.analysisReady&&a.itemId===d.itemId;v&&(h=b);return v}),c,n,g,l=new B,f;s?(a.posIncrement&&(h+=a.posIncrement),a.browseDialog.addlayerCheckBox.get("checked")&&(a.posIncrement||(a.posIncrement=0),f=a.layers[h-a.posIncrement],
a.widget.map.getLayer(f.lyr.id)||(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",b.hitch(this,function(d){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:d.layer,layerInfo:f.linfo,item:f})})),a.widget.map.addLayer(f.lyr))),a.layersSelect.set("value",h),a.browseDialog.browseItems.clear(),l.resolve()):(l=A({url:d.url,content:{f:"json"}}),l.then(b.hitch(this,function(h){var s=new G(d.url,{outFields:["*"]});b.mixin(d,s);
b.mixin(d,h);d.id=d.title+"_"+h.id;d.title=d.title.replace(/_/g," ");d.name=d.title;d.version=d.currentVersion;g=a.layersSelect.getOptions();c=g.splice(g.length-2,2);a.layersSelect.removeOption(c);n=a.layers.length;a.posIncrement&&(n+=a.posIncrement);c.unshift({value:n,label:d.title,selected:!0});a.layersSelect.addOption(c);a.layersSelect.set("value",n);d.lyr=s;d.linfo=h;a.layers.push(d);s.name=d.name;a.browseDialog.addlayerCheckBox.get("checked")&&(this._addLayerHandle&&this._addLayerHandle.remove(),
this._addLayerHandle=a.widget.map.on("layer-add",b.hitch(this,function(b){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:b.layer,layerInfo:h,item:d})})),a.widget.map.addLayer(s));a.browseDialog.browseItems.clear()})));return l.promise}},addReadyToUseLayerOption:function(a,d){a&&a.showReadyToUseLayers&&(d||(d=[]),a.signInPromise.then(b.hitch(this,function(){r.forEach(d,function(d){d.addOption({type:"separator",value:""});d.addOption({value:"browse",label:a.i18n.browseAnalysisTitle})},
this);x.isDefined(a._browsedlg)||(a._browsedlg=this.addBrowseAnalysisDialog({widget:a}),a.own(a._browsedlg.browseItems.on("select-change",b.hitch(a,a._handleBrowseItemsSelect)),a._browsedlg.on("hide",b.hitch(a,function(){a._browsedlg.browseItems._closePopup();r.forEach(d,function(a){"browse"===a.get("value")&&a.reset()})}))))})))},getMaxInputByMode:function(a){var d;if(a&&a.units&&a.type){if("StraightLine"===a.type)"Miles"===a.units?d=1E3:"Yards"===a.units?d=176E4:"Kilometers"===a.units?d=y.format(1609.34,
{places:2}):"Meters"===a.units?d=y.format(1609340,{places:2}):"Feet"===a.units&&(d=528E4);else if("DrivingDistance"===a.type||"TruckingDistance"===a.type||"WalkingDistance"===a.type)"Miles"===a.units?d=300:"Yards"===a.units?d=528E3:"Kilometers"===a.units?d=y.format(482.802,{places:2}):"Meters"===a.units?d=y.format(482802,{places:2}):"Feet"===a.units&&(d=1584E3);else if("DrivingTime"===a.type||"TruckingTime"===a.type||"WalkingTime"===a.type)"Minutes"===a.units?d=300:"Seconds"===a.units?d=18E3:"Hours"===
a.units&&(d=5);return d}},updateModeConstraints:function(a){var d;a&&(a.validateWidget&&a.units&&a.type)&&(d=a.validateWidget.get("constraints"),d.max=this.getMaxInputByMode(a),a.validateWidget.set(d))},getTravelModes:function(a){var d=new B,h,s,c,n;x.isDefined(this.travelModes)&&0<this.travelModes.length?d.resolve(this.travelModes):!a||!a.widget?d.reject(Error("Missing parameter: params.widget required parameter")):a.widget.signInPromise.then(b.hitch(this,function(g){(n=a.widget.get("helperServices"))&&
n.routingUtilities?(c=n.routingUtilities.url,h="sync"):h=a.widget._getSelf(a.widget.portalUrl);D(h,b.hitch(this,function(a){var h={};a&&(a.helperServices&&a.helperServices.routingUtilities)&&(c=a.helperServices.routingUtilities.url);x.isDefined(c)?(s=new M(c+"/GetTravelModes"),s.execute(h).then(b.hitch(this,function(a){this.travelModes=r.map(a[0].value&&a[0].value.features,function(a){return f.fromJson(a.attributes.TravelMode)});a[1]&&(a[1].paramName&&"defaultTravelMode"===a[1].paramName)&&(this.defaultTravelModeId=
a[1].value);d.resolve(this.travelModes)}),b.hitch(this,function(a){d.reject(a)}))):d.reject(Error("Missing Routing Utility Service to get Travel Modes"))}),function(a){d.reject(a)})}));return d.promise},populateTravelModes:function(a){if(a&&a.selectWidget&&a.widget){var d=[],h=a.allowmode||"all";this.initI18n();a.addStraightLine&&d.push({value:"StraightLine",label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esriStraightLineDistanceIcon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+
this.i18n.straightLineDistance+"\x3c/div\x3e"});this.getTravelModes({widget:a.widget}).then(b.hitch(this,function(b){r.forEach(b,function(b,s){var c=b.name,n=c.replace(/\s/g,a.separator||""),g="AUTOMOBILE"===b.type?"Driving":"TRUCK"===b.type?"Trucking":"WALK"===b.type?"Walking":"Other",l=g.toLowerCase(),A=b.units||c.split(/\s/)[1],f=x.isDefined(a.enableTravelModes)&&!a.enableTravelModes,A=b.impedanceAttributeName===b.timeAttributeName?"Time":b.impedanceAttributeName===b.distanceAttributeName?"Distance":
"Other",c={label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esri'+g+A+'Icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+c+"\x3c/div\x3e",value:n,travelMode:b,disabled:f,modei18nKey:l,units:A};if("all"===h||h===A.toLowerCase())"all"!==h&&(c.value=c.value.replace(A,"")),a.selectDefaultMode&&(this.defaultTravelModeId&&this.defaultTravelModeId===b.id)&&(c.selected=!0),d.push(c)},this);a.selectWidget.removeOption();a.selectWidget.addOption(d);
a.selectWidget.set("value",a.value);a.widget.emit("travelmodes-added",{travelOptions:d})}),b.hitch(this,function(b){d&&0<d.length&&(a.selectWidget.removeOption(),a.selectWidget.addOption(d),a.selectWidget.set("value",a.value),a.widget.emit("travelmodes-added",{travelOptions:d}))}))}}});return k})},"esri/dijit/analysis/HelpWindow":function(){define("require dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/_base/kernel dojo/aspect dojo/has dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/dom-style dojo/query dojo/window dojo/dom-geometry dijit/_Widget dijit/TooltipDialog dijit/popup ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi".split(" "),
function(k,b,r,q,c,f,e,g,t,l,z,u,m,p,n,E,w,B,y,F,D,C,a,h){return r([w],{declaredClass:"esri.dijit.analysis.HelpWindow",i18n:null,onlineHelpMap:null,showLearnMore:!1,"class":"esriAnalyisHelpWindow",postMixInProperties:function(){this.inherited(arguments);this.i18n={};q.mixin(this.i18n,h.common);q.mixin(this.i18n,h.analysisHelp)},postCreate:function(){this.inherited(arguments);var a=["ar","he"],b,h;this.onlineHelpMap={};for(b=0;b<a.length;b+=1)h=a[b],e.locale&&-1!==e.locale.indexOf(h)&&(-1!==e.locale.indexOf("-")?
-1!==e.locale.indexOf(h+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);a=k.toUrl("./help/helpmap.json");C({url:a}).then(q.hitch(this,function(a){this.onlineHelpMap=a.map}))},_getAbsoluteUrl:function(a){if(/^https?\:/i.test(a))return a;if(/^\/\//i.test(a))return window.location.protocol+a;if(/^\//i.test(a))return window.location.protocol+"//"+window.location.host+a},_computeSize:function(a){var b={w:400,h:200};-1!==a.indexOf("Category")?(b.w=400,b.h=320):-1!==a.indexOf("Tool")?(b.w=400,b.h=
320):-1!==a.indexOf("toolDescription")&&(b.w=400,b.h=520);return b},_setHelpTopicAttr:function(a){this.tooltipHelpDlg&&(y.close(this.tooltipHelpDlg),this.tooltipHelpDlg.destroy(),this.tooltipHelpDlg=null);var h,c,n,g;this.showLearnMore=!1;c=this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("dev")?"dev":this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("qa")?"uat":"";h=q.clone(e.locale);"nb"===h&&(h="no");n=k.toUrl("esri/dijit/analysis/help/"+this.helpFileName+".html");D.isDefined(this.onlineHelpMap[this.helpFileName])&&
D.isDefined(this.onlineHelpMap[this.helpFileName][a])&&(this.showLearnMore=!0,g="http://doc"+c+".arcgis.com/en/arcgis-online/use-maps/"+this.onlineHelpMap[this.helpFileName][a]);-1!==b.indexOf("ar cs da de es el et fi fr it ja ko lt lv ru nl no pl pt-br pt-pt ro sv th tr vi zh-cn zh-hk zh-tw".split(" "),h)&&(-1!==h.indexOf("-")&&(n=h.split("-"),h=n[0]+"-"+n[1].toUpperCase()),n=k.toUrl("esri/dijit/analysis/help/"+h+"/"+this.helpFileName+".html"));-1!==b.indexOf("ar de es fr it ja ko ru nl pl pt-br pt-pt ro zh-cn zh-hk zh-tw".split(" "),
h)&&this.showLearnMore&&(g="http://doc"+c+".arcgis.com/"+h+"/arcgis-online/use-maps/"+this.onlineHelpMap[this.helpFileName][a]);this._size=c=this._computeSize(a);this.tooltipHelpDlg=new B({preload:!0,content:"\x3cdiv class\x3d'' style\x3d'position:relative'\x3cdiv class\x3d'sizer content'\x3e\x3cdiv class\x3d'contentPane'\x3e\x3cdiv class\x3d'esriFloatTrailing' style\x3d'padding:0;'\x3e\x3ca href\x3d'#' class\x3d'esriAnalysisCloseIcon' title\x3d'"+this.i18n.close+"'\x3e\x3c/a\x3e\x3c/div\x3e\x3ciframe frameborder\x3d'0'  id\x3d'"+
a+"' src\x3d'"+n+"#"+a+"' width\x3d'"+c.w+"' height\x3d'"+c.h+"' marginheight\x3d'0' marginwidth\x3d'0'\x3e\x3c/iframe\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'actionsPane'\x3e\x3cdiv class\x3d'actionList"+(this.showLearnMore?"'\x3e":" hidden'\x3e")+"\x3ca class\x3d'action zoomTo' href\x3d'"+(this.showLearnMore?g:"#")+"' target\x3d'_help'\x3e"+this.i18n.learnMore+"\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e","class":"esriHelpPopup esriHelpPopupWrapper esriAnalyisHelpWindow"});
this.tooltipHelpDlg.startup()},show:function(a,b){this.helpFileName=b.helpFileName;this._analysisGpServer=b.analysisGpServer;this.set("helpTopic",b.helpId);var h=g.after(y,"open",q.hitch(this,function(){p(".esriAnalysisCloseIcon",this.tooltipHelpDlg.domNode).on("click",q.hitch(this,this.close));h.remove()})),c=a.pageX,l=n.getBox(),f,e,t;t=!1;b.helpParentNode&&(f=b.helpParentNode);f&&(e=E.position(f));e&&l.w-a.pageX<e.w?(t=!0,c=e.x-this._size.w-10,this._isRightToLeft&&(c-=10)):this._isRightToLeft&&
c-40<this._size.w&&(c=e.w+this._size.w+80);y.open({popup:this.tooltipHelpDlg,x:!0===this._isRightToLeft||t?c-40:c+40,y:a.screenY-a.pageY+10,onCancel:q.hitch(this,function(){this.close()}),onExecute:function(){this.close()}});this.tooltipHelpDlg.domNode.parentNode&&m.set(this.tooltipHelpDlg.domNode.parentNode,"overflowY","hidden")},close:function(a,b){y.close(this.tooltipHelpDlg)}})})},"esri/dijit/BrowseItems":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/dom-class dojo/dom-style dojo/dom-attr dojo/string dojo/on dojo/aspect dojo/has dojo/dom dojo/dom-construct dojo/mouse dojo/query dojo/parser dijit/registry dijit/TooltipDialog dijit/popup dojo/promise/all dojo/Deferred dgrid/Grid dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/OnDemandGrid dgrid/Selection dgrid/selector dgrid/Keyboard dgrid/util/mouse dgrid/util/touch put-selector/put dojo/store/Observable dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_FocusMixin dijit/form/Select ../arcgis/Portal ../Evented ../PluginTarget dojo/i18n!../nls/jsapi ./_RefreshMixin ../kernel ../lang".split(" "),
function(k,b,r,q,c,f,e,g,t,l,z,u,m,p,n,E,w,B,y,F,D,C,a,h,d,s,x,A,H,J,K,G,L,M,v,O,P,I,U,Q,R,S,V,N){var T=k(null,{idProperty:"id",constructor:function(a){k.safeMixin(this,a)},get:function(a,d){return I.PortalUtil.request(this.portalUrl+"content/items/"+a,d).then(function(a){return new I.PortalItem(b.mixin(a,{portal:this.portal}))})},getIdentity:function(a){return a[this.idProperty]},query:function(a,d){var h=b.isObject(a)?a:{q:a};if(d&&(h=b.mixin(h,{num:d.count,start:(d.start||0)+1}),d.sort&&d.sort.length))var c=
d.sort[0],h=b.mixin(h,{sortField:encodeURIComponent("created"===c.attribute?"uploaded":c.attribute),sortOrder:c.descending?"desc":"asc"});h=this.portal.queryItems(h,!0).then(function(a){a.results.total=a.total;return a.results});return I.PortalResult(h)}});return k([L,M,v,Q,O],{templateString:'\x3cdiv\x3e\x3cp data-dojo-attach-point\x3d"messageNode" class\x3d"hide"\x3e\x3c/p\x3e\x3cdiv style\x3d"width:100%" class\x3d"esriLeadingMargin1"\x3e\x3cselect id\x3d"${id}_categorySelect"class\x3d"categorySelect"\x3e\x3c/select\x3e\x3cdiv id\x3d"${id}_search"class\x3d"esriTrailingMargin2 esriFloatTrailing searchBar"\x3e\x3cinput class\x3d"esriSearchBox dijitTextBox" type\x3d"text" placeholder:\'${i18n.searchFor}\'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"${id}_grid"class\x3d"dgrid-autoheight"\x3e\x3c/div\x3e\x3cbr /\x3e\x3c/div\x3e',
_galleryTemplate:"\x3cdiv style\x3d'opacity:1;' class\x3d'grid-item gallery-view'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3c/div\x3e",_popupTemplate:'\x3cdiv class\x3d"esriBrowsePopup quiet-scroll"\x3e\x3cp\x3e{summary}\x3c/p\x3e\x3c/div\x3e',baseClass:"esriBrowseItems",closePopupPerRow:!0,postMixInProperties:function(){this.inherited(arguments);this.i18n={};b.mixin(this.i18n,R.gallery)},postCreate:function(){this.inherited(arguments);this.self?(this._portal=new I.Portal({url:this.portalUrl,
self:this.self}),this._portal.on("load",b.hitch(this,this._fetchData))):(this._portal=new I.Portal(this.portalUrl),this._portal.signIn().then(b.hitch(this,this._fetchData)))},destroy:function(){this.inherited(arguments);this._grid&&this._grid.destroy();this._img_connect.remove();this._img_connect_error.remove();this._queryTimer&&clearTimeout(this._queryTimer);this._grid=this._portal=null},_setPortalUrlAttr:function(a){this.portalUrl=a},_setSelfAttr:function(a){this.self=a},_setPluginAttr:function(a){this.addPlugin(a)},
_setMessageAttr:function(a){e.set(this.messageNode,"innerHTML",a);c.remove(this.messageNode,"hide")},_setCategoriesAttr:function(a){this.categories=a},_setDisabledAttr:function(a){var d=w.findWidgets(this.domNode).concat(w.findWidgets(this._content));r.forEach(d,function(d){d.set("disabled",a)});c[a?"add":"remove"](this._interval.domNode,"dijitTextBoxDisabled")},_setSortAttr:function(a){this.sortAttribute=a},_setSortDescendingAttr:function(a){this.sortDescending=a},_getSelectionAttr:function(){var a=
this._grid.selection,d;for(d in a)if(a.hasOwnProperty(d))break;return d&&this._grid.row(d).data},_setGalleryTemplateAttr:function(a){N.isDefined(a)&&(this._galleryTemplate=a)},_setFormatThumbnailAttr:function(a){N.isDefined(a)&&"function"===typeof a&&(this._formatThumbnail=a)},_setFormatItemTitleAttr:function(a){N.isDefined(a)&&"function"===typeof a&&(this._formatItemTitle=a)},_setItemsPerPageAttr:function(a){this._set("itemsPerPage",a)},_setPagingLinksAttr:function(a){this._set("pagingLinks",a)},
_setCategoryTypeAttr:function(a){this._set("categoryType",a)},_getQueryAttr:function(){return this._grid&&this._grid.get("query")},_setQueryAttr:function(a){this._grid&&(this._grid.set("query",a),this._categorySelect&&(this._categorySelect.reset(),this.get("selectedCategory")?(this._origQuery=null,this._categorySelect.set("value",this.get("selectedCategory"))):(this._origQuery=null,this._categorySelect.set("value",this.categories[0].value))))},_setSelectedCategoryAttr:function(a){this._set("selectedCategory",
a)},_setClosePopupPerRowAttr:function(a){this._set("closePopupPerRow",a)},_validate:function(){return!!this.get("selection")},_showPopup:function(a){if(!this._isInsideTooltipDialog){this._closePopup();var d=this._grid.row(a),h=n("img",d.element)[0];if((d={summary:d.data.snippet})&&d.summary)this._tooltip=new B({content:b.replace(this._popupTemplate,d),onMouseEnter:b.hitch(this,function(){this._isInsideTooltipDialog=!0}),onMouseLeave:b.hitch(this,function(){this._isInsideTooltipDialog=!1;this._closePopup(a)})}),
y.open({className:"esriBrowsePopup",popup:this._tooltip,around:h,orient:["after-centered","before-centered"]}),this._onCloseConnect=n(".dijitDialogCloseIcon",this._tooltip.domNode).on("click",b.hitch(this,function(a){a.preventDefault();this._closePopup()}))}},_closePopup:function(){this._tooltip&&(this._onCloseConnect.remove(),y.close(this._tooltip),this._tooltip.destroyRecursive(),this._tooltip=this._onCloseConnect=void 0)},_clearQueryTimeout:function(){clearTimeout(this._queryTimer)},_createGrid:function(){var d=
k([C,a,s,S,h]),c=new G(new T({portal:this._portal})),v=this._currentFilter,x=b.hitch(this,function(a){a.snippet=a.snippet||"";var d=K("div");a=g.substitute(this._galleryTemplate,{item:a,i18n:this.i18n},null,this);m.place(a,d);return d});this._grid=new d({store:c,className:"dgrid-autoheight",query:v,selectionMode:"single",pagingLinks:this.get("pagingLinks")||2,rowsPerPage:this.get("itemsPerPage")||6,loadingMessage:"Loading items...",showLoadingMessage:!1,renderRow:x,noDataMessage:this.i18n.noItemsToDisplay,
sort:[{attribute:"title"}]},this.id+"_grid");this._grid.startup();this.categories&&0<this.categories.length&&(this._categorySelect=new P({options:this.categories,sortByLabel:!1,"class":"categorySelect"},this.id+"_categorySelect"),this.own(this._categorySelect.on("change",b.hitch(this,function(a){var d;this._closePopup();this._origQuery||(this._origQuery=this._grid.get("query"));d=this._origQuery;a&&(d+=" AND ("+this.get("categoryType")+":"+a+")");this._fetchItems(d)}))));this.own(this._grid.on(H.enterRow,
b.hitch(this,function(a){this._showPopup(a)})),this._grid.on(H.leaveRow,b.hitch(this,function(a){this.get("closePopupPerRow")&&this._closePopup(a)})),t(n(".dgrid-footer,.dgrid-header",this._grid.domNode),p.leave,b.hitch(this,function(a){this._closePopup(a)})),this._grid.on("dgrid-refresh-complete",b.hitch(this,function(a){this._closePopup(a);n(".dgrid-footer",this.domNode)[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide")})),this._grid.on("refresh",b.hitch(this,function(){this._img_connect&&
(this._img_connect.remove(),this._img_connect_error.remove(),this._img_connect_error=this._img_connect=null);this._img_connect=n(".grid-item-thumb",this._grid.domNode).on("load",b.hitch(this,function(a){(a=this._grid.row(a))&&a.element&&n(".grid-item",a.element).addClass("fadeIn").style("opacity","1")}));this._img_connect_error=n(".grid-item-thumb",this._grid.domNode).on("error",b.hitch(this,function(a){e.set(a.target,"src",this._portal.staticImagesUrl+"/desktopapp.png")}))})),this._grid.on("dgrid-select,dgrid-deselect",
b.hitch(this,function(){var a={selection:this.get("selection")};this.emit("select-change",a)})),t(u.byId(this.id+"_search"),"keyup",b.hitch(this,function(a){a.preventDefault();this._closePopup();this._clearQueryTimeout();this._queryTimer=setTimeout(b.hitch(this,function(){this._fetchItems(this._currentFilter,e.get(a.target,"value"))}),this.searchKeypressDelay||250)})))},_fetchData:function(){this._user=this._portal.getPortalUser();return this.plugIn.fetchData()},_fetchItems:function(a,d){var h={sort:[{attribute:this.sortAttribute||
"title",descending:this.sortDescending||!1}]},c=d?" title:"+d+"* ":"",s=new D;setTimeout(b.hitch(this,function(){this._currentFilter=a;this._grid?this._grid.set("query",this._currentFilter+c,h):this._createGrid();s.resolve(this._grid)}),60);return s},_formatThumbnail:function(a){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'187px' height\x3d'125px' alt\x3d'' src\x3d'"+(a.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+"'\x3e"},_formatItemTitle:function(a){return"\x3ch5\x3e"+(a.title||
a.name||"\x3cNo Title\x3e")+"\x3c/h5\x3e"},clear:function(){this._grid.clearSelection()}})})},"dgrid/extensions/Pagination":function(){define("../_StoreMixin dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Deferred dojo/on dojo/query dojo/string dojo/has put-selector/put ../util/misc dojo/i18n!./nls/pagination dojo/_base/sniff xstyle/css!../css/extensions/Pagination.css".split(" "),function(k,b,r,q,c,f,e,g,t,l,z,u){function m(b){b.noDataNode?(l(b.noDataNode,"!"),delete b.noDataNode):
b.cleanup();b.contentNode.innerHTML=""}function p(b){if(b.loadingNode)l(b.loadingNode,"!"),delete b.loadingNode;else if(b._oldPageNodes){for(var c in b._oldPageNodes)b.removeRow(b._oldPageNodes[c]);delete b._oldPageNodes;b._oldPageObserver&&(b._oldPageObserver.cancel(),b._numObservers--,delete b._oldPageObserver)}delete b._isLoading}return b("dgrid.extensions.Pagination",k,{rowsPerPage:10,pagingTextBox:!1,previousNextArrows:!0,firstLastArrows:!1,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:!0,
i18nPagination:u,showFooter:!0,_currentPage:1,_total:0,buildRendering:function(){this.inherited(arguments);var b=this,c=this.paginationNode=l(this.footerNode,"div.dgrid-pagination"),e=this.paginationStatusNode=l(c,"div.dgrid-status"),m=this.i18nPagination;e.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();e.innerHTML=g.substitute(m.status,{start:1,end:1,total:0});c=this.paginationNavigationNode=l(c,"div.dgrid-navigation");this.firstLastArrows&&(e=this.paginationFirstNode=
l(c,"span.dgrid-first.dgrid-page-link","\u00ab"),e.setAttribute("aria-label",m.gotoFirst),e.tabIndex=0);this.previousNextArrows&&(e=this.paginationPreviousNode=l(c,"span.dgrid-previous.dgrid-page-link","\u2039"),e.setAttribute("aria-label",m.gotoPrev),e.tabIndex=0);this.paginationLinksNode=l(c,"span.dgrid-pagination-links");this.previousNextArrows&&(e=this.paginationNextNode=l(c,"span.dgrid-next.dgrid-page-link","\u203a"),e.setAttribute("aria-label",m.gotoNext),e.tabIndex=0);this.firstLastArrows&&
(e=this.paginationLastNode=l(c,"span.dgrid-last.dgrid-page-link","\u00bb"),e.setAttribute("aria-label",m.gotoLast),e.tabIndex=0);this._listeners.push(f(c,".dgrid-page-link:click,.dgrid-page-link:keydown",function(c){if(!("keydown"===c.type&&13!==c.keyCode)){c=this.className;var g,l;b._isLoading||-1<c.indexOf("dgrid-page-disabled")||(g=b._currentPage,l=Math.ceil(b._total/b.rowsPerPage),this===b.paginationPreviousNode?b.gotoPage(g-1):this===b.paginationNextNode?b.gotoPage(g+1):this===b.paginationFirstNode?
b.gotoPage(1):this===b.paginationLastNode?b.gotoPage(l):"dgrid-page-link"===c&&b.gotoPage(+this.innerHTML))}}))},destroy:function(){this.inherited(arguments);this._pagingTextBoxHandle&&this._pagingTextBoxHandle.remove()},_updatePaginationSizeSelect:function(){var b=this.pageSizeOptions,c=this.paginationSizeSelect,g;if(b&&b.length){c||(c=this.paginationSizeSelect=l(this.paginationNode,"select.dgrid-page-size[aria-label\x3d"+this.i18nPagination.rowsPerPage+"]"),g=this._paginationSizeChangeHandle=f(c,
"change",q.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value)})),this._listeners.push(g));for(g=c.options.length=0;g<b.length;g++)l(c,"option",b[g],{value:b[g],selected:this.rowsPerPage===b[g]});this._updateRowsPerPageOption()}else if((!b||!b.length)&&c)l(c,"!"),this.paginationSizeSelect=null,this._paginationSizeChangeHandle.remove()},_setPageSizeOptions:function(b){this.pageSizeOptions=b&&b.sort(function(b,c){return b-c});this._updatePaginationSizeSelect()},_updateRowsPerPageOption:function(){var b=
this.rowsPerPage,c=this.pageSizeOptions,g=this.paginationSizeSelect;g&&(0>r.indexOf(c,b)?this._setPageSizeOptions(c.concat([b])):g.value=""+b)},_setRowsPerPage:function(b){this.rowsPerPage=b;this._updateRowsPerPageOption();this.gotoPage(1)},_updateNavigation:function(){function b(h,c){var e,n;g.pagingTextBox&&h==t&&1<a?(e=l(p,"input.dgrid-page-input[type\x3dtext][value\x3d$]",t),e.setAttribute("aria-label",m.jumpPage),g._pagingTextBoxHandle=f(e,"change",function(){var d=+this.value;!isNaN(d)&&(0<
d&&d<=a)&&g.gotoPage(+this.value)}),d&&"INPUT"===d.tagName&&e.focus()):(n=h===t,e=l(p,"span"+(n?".dgrid-page-disabled":"")+".dgrid-page-link",h+(c?" ":"")),e.setAttribute("aria-label",m.gotoPage),e.tabIndex=n?-1:0,s===h&&(n?h<a?s++:x.focus():e.focus()),n||(x=e))}function c(a,d){l(a,(d?".":"!")+"dgrid-page-disabled");a.tabIndex=d?-1:0}var g=this,m=this.i18nPagination,p=this.paginationLinksNode,t=this._currentPage,k=this.pagingLinks,q=this.paginationNavigationNode,a=Math.ceil(this._total/this.rowsPerPage),
h=this._pagingTextBoxHandle,d=document.activeElement,s,x;!d||!z.contains(this.paginationNavigationNode,d)?d=null:"dgrid-page-link"===d.className&&(s=+d.innerHTML);h&&h.remove();p.innerHTML="";e(".dgrid-first, .dgrid-previous",q).forEach(function(a){c(a,1===t)});e(".dgrid-last, .dgrid-next",q).forEach(function(d){c(d,t>=a)});if(k&&0<a){b(1,!0);q=t-k;for(2<q?l(p,"span.dgrid-page-skip","..."):q=2;q<Math.min(t+k+1,a);q++)b(q,!0);t+k+1<a&&l(p,"span.dgrid-page-skip","...");1<a&&b(a)}else g.pagingTextBox&&
b(t);d&&-1===d.tabIndex&&(k=e("[tabindex\x3d'0']",this.paginationNavigationNode),d===this.paginationPreviousNode||d===this.paginationFirstNode?d=k[0]:k.length&&(d=k[k.length-1]),d&&d.focus())},refresh:function(){var b=this;this.inherited(arguments);if(this.store)return this.gotoPage(1).then(function(c){setTimeout(function(){f.emit(b.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:b,results:c})},0);return c});console.warn("Pagination requires a store to operate.")},_onNotification:function(b){b.length!==
this._rowsOnPage&&this.gotoPage(this._currentPage)},renderArray:function(b,g){var l=this,e=this.inherited(arguments);this._lastCollection=null;g||(this._topLevelRequest&&this._topLevelRequest!==b&&(this._topLevelRequest.cancel(),delete this._topLevelRequest),"function"===typeof b.cancel&&(this._topLevelRequest=b),c.when(b,function(){l._topLevelRequest&&delete l._topLevelRequest}));return e},insertRow:function(){var b=this._oldPageNodes,c=this.inherited(arguments);b&&c===b[c.id]&&delete b[c.id];return c},
gotoPage:function(b){var e=this,f=new c;this._trackError(function(){var k=e.rowsPerPage,u=(b-1)*k,r=q.mixin(e.get("queryOptions"),{start:u,count:k}),z,C=e.contentNode,a,h,d;if(e.showLoadingMessage)m(e),a=e.loadingNode=l(C,"div.dgrid-loading"),a.innerHTML=e.loadingMessage;else{e._oldPageNodes=a={};C=C.children;h=0;for(d=C.length;h<d;h++)a[C[h].id]=C[h];e._oldPageObserver=e.observers.pop()}e._isLoading=!0;z=e.store.query(e.query,r);c.when(e.renderArray(z,null,r),function(a){p(e);e.scrollTo({y:0});c.when(z.total,
function(d){d||(e.noDataNode&&(l(e.noDataNode,"!"),delete e.noDataNode),e.noDataNode=l(e.contentNode,"div.dgrid-no-data"),e.noDataNode.innerHTML=e.noDataMessage);e.paginationStatusNode.innerHTML=g.substitute(e.i18nPagination.status,{start:Math.min(u+1,d),end:Math.min(d,u+k),total:d});e._total=d;e._currentPage=b;e._rowsOnPage=a.length;e._updateNavigation()});(7>t("ie")||t("ie")&&t("quirks"))&&e.resize();f.resolve(z)},function(a){p(e);f.reject(a)});return f.promise})||f.reject();return f.promise}})})},
"dgrid/extensions/DijitRegistry":function(){define(["dojo/_base/declare","dojo/dom-geometry","dijit/registry"],function(k,b,r){return k("dgrid.extensions.DijitRegistry",null,{minSize:0,maxSize:Infinity,layoutPriority:0,showTitle:!0,buildRendering:function(){r.add(this);this.inherited(arguments);this.domNode.setAttribute("widgetId",this.id)},startup:function(){if(!this._started){this.inherited(arguments);var b=r.getEnclosingWidget(this.domNode.parentNode);b&&b.isLayoutContainer&&this._resizeHandle.remove()}},
destroyRecursive:function(){this.destroy()},destroy:function(){this.inherited(arguments);r.remove(this.id)},getChildren:function(){return[]},isLeftToRight:function(){return!this.isRTL},resize:function(k){k&&b.setMarginBox(this.domNode,k);this.inherited(arguments)},_set:function(b,c){this[b]=c},watch:function(){},getParent:function(){return r.getEnclosingWidget(this.domNode.parentNode)}})})},"dgrid/selector":function(){define("dojo/_base/kernel dojo/_base/array dojo/_base/lang dojo/on dojo/aspect dojo/_base/sniff put-selector/put".split(" "),
function(k,b,r,q,c,f,e){r.getObject("dgrid.selector",!0);return dgrid.selector=function(g,t){function l(b){return!n.allowSelect(n.row(b))}function q(b){return function(c){var e=c.rows,l=e.length;c="false";var f;for(f=0;f<l;f++){var a=n.cell(e[f],g.id).element;if(a&&(a=(a.contents||a).input)&&!a.disabled)a.checked=b,a.setAttribute("aria-checked",b)}if("checkbox"==r.type){e=n.selection;l=!1;for(f in e)if(e[f]!=n.allSelected){l=!0;break}r.indeterminate=l;r.checked=n.allSelected;l?c="mixed":n.allSelected&&
(c="true");r.setAttribute("aria-checked",c)}}}function u(b){if("click"==b.type||32==b.keyCode||!f("opera")&&13==b.keyCode||0===b.keyCode){var c=n.row(b);n._selectionTriggerEvent=b;if(c){if(n.allowSelect(c)){var g=n._lastSelected&&n.row(n._lastSelected);if("radio"==t){if(!g||g.id!=c.id)n.clearSelection(),n.select(c,null,!0),n._lastSelected=c.element}else c&&(b.shiftKey?q(!0)({rows:[c]}):g=null,g=b.shiftKey?g:null,n.select(g||c,c,g?void 0:null),n._lastSelected=c.element)}}else e(this,(n.allSelected?
"!":".")+"dgrid-select-all"),n[n.allSelected?"clearSelection":"selectAll"]();n._selectionTriggerEvent=null}}function m(){n._hasSelectorInputListener=!0;p.push(n.on(".dgrid-selector:click,.dgrid-selector:keydown",u));var b=n._handleSelect;n._handleSelect=function(c){this.cell(c).column!=g&&b.apply(this,arguments)};if("function"==typeof g.disabled){var c=n.allowSelect,e=g.disabled;n.allowSelect=function(b){var f=c.call(this,b);return e===l?f:f&&!e.call(g,b.data)}}g.disabled=l;p.push(n.on("dgrid-select",
q(!0)));p.push(n.on("dgrid-deselect",q(!1)))}var p=[],n,r;g||(g={});g.type&&(g.selectorType=g.type,k.deprecated("columndef.type","use columndef.selectorType instead","dgrid 0.4"));g.selectorType=t=t||g.selectorType||"checkbox";g.sortable=!1;var w="function"==typeof t?t:function(b,c,l){var f=c.parentNode,k;n._hasSelectorInputListener||m();k=g.disabled;e(f&&f.contents?f:c,".dgrid-selector");c=c.input||(c.input=e(c,"input[type\x3d"+t+"]",{tabIndex:isNaN(g.tabIndex)?-1:g.tabIndex,disabled:k&&("function"==
typeof k?k.call(g,l):k),checked:b}));c.setAttribute("aria-checked",!!b);return c};c.after(g,"init",function(){n=g.grid});c.after(g,"destroy",function(){b.forEach(p,function(b){b.remove()});n._hasSelectorInputListener=!1});g.renderCell=function(b,c,g,e,l){c=(c=b&&n.row(b))&&n.selection[c.id];w(c,g,b)};g.renderHeaderCell=function(b){var c="label"in g?g.label:g.field||"";"radio"==t||!n.allowSelectAll?(b.appendChild(document.createTextNode(c)),n._hasSelectorInputListener||m()):w(!1,b,{});r=b.lastChild};
return g}})},"dgrid/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/on dojo/_base/lang dojo/has put-selector/put ./util/misc dojo/_base/Deferred dojo/_base/sniff".split(" "),function(k,b,r,q,c,f,e,g){function t(a){a.preventDefault()}var l={checkbox:1,radio:1,button:1},z=/\bdgrid-cell\b/,u=/\bdgrid-row\b/,m=k("dgrid.Keyboard",null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=q.mixin({},m.defaultKeyMap));
this.headerKeyMap||(this.headerKeyMap=q.mixin({},m.defaultHeaderKeyMap))},postCreate:function(){function a(d){var b=d.target;return b.type&&(!l[b.type]||32==d.keyCode)}function h(s){function l(){c._focusedHeaderNode&&(c._focusedHeaderNode.tabIndex=-1);if(c.showHeader){if(f)for(var a=0,d,b=c.headerNode.getElementsByTagName("th");d=b[a];++a){if(k.test(d.className)){c._focusedHeaderNode=m=d;break}}else c._focusedHeaderNode=m=c.headerNode;m&&(m.tabIndex=c.tabIndex)}}var f=c.cellNavigation,k=f?z:u,n=s===
c.headerNode,m=s;n?(l(),b.after(c,"renderHeader",l,!0)):b.after(c,"renderArray",function(a){return g.when(a,function(a){var d=c._focusedNode||m;if(k.test(d.className)&&e.contains(s,d))return a;for(var b=0,h=s.getElementsByTagName("*"),g;g=h[b];++b)if(k.test(g.className)){d=c._focusedNode=g;break}d.tabIndex=c.tabIndex;return a})});c._listeners.push(r(s,"mousedown",function(b){a(b)||c._focusOnNode(b.target,n,b)}));c._listeners.push(r(s,"keydown",function(b){if(!b.metaKey&&!b.altKey){var h=c[n?"headerKeyMap":
"keyMap"][b.keyCode];h&&!a(b)&&h.call(c,b)}}))}this.inherited(arguments);var c=this;this.tabableHeader&&(h(this.headerNode),r(this.headerNode,"dgrid-cellfocusin",function(){c.scrollTo({x:this.scrollLeft})}));h(this.contentNode);this._debouncedEnsureRowScroll=e.debounce(this._ensureRowScroll,this)},removeRow:function(a){if(!this._focusedNode)return this.inherited(arguments);var b=this,c=document.activeElement===this._focusedNode,h=this[this.cellNavigation?"cell":"row"](this._focusedNode),g=h.row||
h,e;a=a.element||a;if(a===g.element){e=this.down(g,!0);if(!e||e.element===a)e=this.up(g,!0);this._removedFocus={active:c,rowId:g.id,columnId:h.column&&h.column.id,siblingId:!e||e.element===a?void 0:e.id};setTimeout(function(){b._removedFocus&&b._restoreFocus(g.id)},0);this._focusedNode=null}this.inherited(arguments)},insertRow:function(a){var b=this.inherited(arguments);this._removedFocus&&!this._removedFocus.wait&&this._restoreFocus(b);return b},_restoreFocus:function(a){var b=this._removedFocus,
c;if((a=(a=a&&this.row(a))&&a.element&&a.id===b.rowId?a:"undefined"!==typeof b.siblingId&&this.row(b.siblingId))&&a.element){if(!a.element.parentNode.parentNode){b.wait=!0;return}"undefined"!==typeof b.columnId&&(c=this.cell(a,b.columnId))&&c.element&&(a=c);b.active&&0!==a.element.offsetHeight?this._focusOnNode(a,!1,null):(f(a.element,".dgrid-focus"),a.element.tabIndex=this.tabIndex,this._focusedNode=a.element)}delete this._removedFocus},addKeyHandler:function(a,c,h){return b.after(this[h?"headerKeyMap":
"keyMap"],a,c,!0)},_ensureRowScroll:function(a){var b=this.getScrollPosition().y;b>a.offsetTop?this.scrollTo({y:a.offsetTop}):b+this.contentNode.offsetHeight<a.offsetTop+a.offsetHeight&&this.scrollTo({y:a.offsetTop-this.contentNode.offsetHeight+a.offsetHeight})},_focusOnNode:function(a,b,h){var g="_focused"+(b?"Header":"")+"Node",e=this[g],l=this.cellNavigation?"cell":"row",k=this[l](a),m,n,t,v,p;if(a=k&&k.element){if(this.cellNavigation){m=a.getElementsByTagName("input");p=0;for(t=m.length;p<t;p++)if(n=
m[p],(-1!=n.tabIndex||"_dgridLastValue"in n)&&!n.disabled){8>c("ie")&&(n.style.position="relative");n.focus();8>c("ie")&&(n.style.position="");v=!0;break}}null!==h&&(h=q.mixin({grid:this},h),h.type&&(h.parentType=h.type),h.bubbles||(h.bubbles=!0));e&&(f(e,"!dgrid-focus[!tabIndex]"),8>c("ie")&&(e.style.position=""),h&&(h[l]=this[l](e),r.emit(e,"dgrid-cellfocusout",h)));e=this[g]=a;h&&(h[l]=k);g=this.cellNavigation?z:u;!v&&g.test(a.className)&&(8>c("ie")&&(a.style.position="relative"),a.tabIndex=this.tabIndex,
a.focus());f(a,".dgrid-focus");h&&r.emit(e,"dgrid-cellfocusin",h);this.cellNavigation&&((this.columnSets||1<this.subRows.length)&&!b)&&this._debouncedEnsureRowScroll(k.row.element)}},focusHeader:function(a){this._focusOnNode(a||this._focusedHeaderNode,!0)},focus:function(a){(a=a||this._focusedNode)?this._focusOnNode(a,!1):this.contentNode.focus()}}),p=m.moveFocusVertical=function(a,b){var h=this.cellNavigation,c=this[h?"cell":"row"](a),c=h&&c.column.id,g=this.down(this._focusedNode,b,!0);h&&(g=this.cell(g,
c));this._focusOnNode(g,!1,a);a.preventDefault()};k=m.moveFocusUp=function(a){p.call(this,a,-1)};var n=m.moveFocusDown=function(a){p.call(this,a,1)},E=m.moveFocusPageUp=function(a){p.call(this,a,-this.pageSkip)},w=m.moveFocusPageDown=function(a){p.call(this,a,this.pageSkip)},B=m.moveFocusHorizontal=function(a,b){if(this.cellNavigation){var h=!this.row(a);this._focusOnNode(this.right(this["_focused"+(h?"Header":"")+"Node"],b),h,a);a.preventDefault()}},y=m.moveFocusLeft=function(a){B.call(this,a,-1)},
F=m.moveFocusRight=function(a){B.call(this,a,1)},D=m.moveHeaderFocusEnd=function(a,b){var h;this.cellNavigation&&(h=this.headerNode.getElementsByTagName("th"),this._focusOnNode(h[b?0:h.length-1],!0,a));a.preventDefault()},C=m.moveHeaderFocusHome=function(a){D.call(this,a,!0)},a=m.moveFocusEnd=function(a,h){var e=this,l=this.cellNavigation,f=this.contentNode,n=f.scrollTop+(h?0:f.scrollHeight),f=f[h?"firstChild":"lastChild"],k=-1<f.className.indexOf("dgrid-preload"),m=k?f[(h?"next":"previous")+"Sibling"]:
f,p=m.offsetTop+(h?0:m.offsetHeight),t;if(k){for(;m&&0>m.className.indexOf("dgrid-row");)m=m[(h?"next":"previous")+"Sibling"];if(!m)return}!k||1>f.offsetHeight?(l&&(m=this.cell(m,this.cell(a).column.id)),this._focusOnNode(m,!1,a)):(c("dom-addeventlistener")||(a=q.mixin({},a)),t=b.after(this,"renderArray",function(b){t.remove();return g.when(b,function(b){b=b[h?0:b.length-1];l&&(b=e.cell(b,e.cell(a).column.id));e._focusOnNode(b,!1,a)})}));n===p&&a.preventDefault()},h=m.moveFocusHome=function(b){a.call(this,
b,!0)};m.defaultKeyMap={32:t,33:E,34:w,35:a,36:h,37:y,38:k,39:F,40:n};m.defaultHeaderKeyMap={32:t,35:D,36:C,37:y,39:F};return m})},"dgrid/util/mouse":function(){define(["dojo/_base/lang","dojo/on","dojo/dom","dojo/query"],function(k,b,r){function q(c,e){return function(g,k){return b(g,c+":"+e,function(b){if(!r.isDescendant(b.relatedTarget,this))return k.call(this,b)})}}var c={enterRow:q(".dgrid-content .dgrid-row","mouseover"),enterCell:q(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:q(".dgrid-header .dgrid-cell",
"mouseover"),leaveRow:q(".dgrid-content .dgrid-row","mouseout"),leaveCell:q(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:q(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:q};k.getObject("dgrid.util.mouse",!0);k.mixin(dgrid.util.mouse,c);return c})},"dgrid/util/touch":function(){define(["dojo/on","dojo/query"],function(k,b){function r(b,f,e,g){if(!(1<e.targetTouches.length)){var t=e.changedTouches[0],l=t.screenX,r=t.screenY;g&&e.preventDefault();var u=k(b,"touchend",function(b){var c=
b.changedTouches[0];b.targetTouches.length||(Math.abs(c.screenX-l)<q.tapRadius&&Math.abs(c.screenY-r)<q.tapRadius&&(g&&b.preventDefault(),f.call(this,b)),u.remove())})}}var q={tapRadius:10,dbltapTime:250,selector:function(c,f,e){return function(g,t){var l=f.bubble;l?f=l:!1!==e&&(e=!0);return k(g,f,function(l){var f=l.target;3==f.nodeType&&(f=f.parentNode);for(;!b.matches(f,c,g);)if(f==g||!e||!(f=f.parentNode))return;return t.call(f,l)})}},countCurrentTouches:function(b,f){if(!("touches"in b))return-1;
var e,g,k;for(g=e=0;k=b.touches[e];++e)f.contains(k.target)&&++g;return g},tap:function(b,f){return k(b,"touchstart",function(e){r(b,f,e)})},dbltap:function(b,f){var e,g;return k(b,"touchstart",function(k){e?r(b,function(b){if(e){var c=b.changedTouches[0];Math.abs(c.screenX-e.screenX)<q.tapRadius&&Math.abs(c.screenY-e.screenY)<q.tapRadius&&(g&&clearTimeout(g),e=g=null,f.call(this,b))}},k,!0):r(b,function(b){e=b.changedTouches[0];g=setTimeout(function(){e=g=null},q.dbltapTime)},k)})}};return q})},
"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(k,b,r,q){k=function(c){function f(b,g){var e=c[b];e&&(c[b]=function(f){var k;"put"===b&&(k=c.getIdentity(f));if(l)return e.apply(this,arguments);l=!0;try{var t=e.apply(this,arguments);r(t,function(b){g("object"==typeof b&&b||f,k)});return t}finally{l=!1}})}var e=[],g=0;c=b.delegate(c);c.notify=function(b,c){g++;for(var f=e.slice(),l=0,k=f.length;l<k;l++)f[l](b,c)};var k=c.query;c.query=
function(f,l){l=l||{};var m=k.apply(this,arguments);if(m&&m.forEach){var p=b.mixin({},l);delete p.start;delete p.count;var n=c.queryEngine&&c.queryEngine(f,p),E=g,w=[],B;m.observe=function(b,f){1==w.push(b)&&e.push(B=function(b,a){r(m,function(h){var d=h.length!=l.count,e,k;if(++E!=g)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var m,t=-1,p=-1;if(void 0!==a){e=0;for(k=h.length;e<k;e++){var r=h[e];if(c.getIdentity(r)==a){m=r;t=e;(n||!b)&&h.splice(e,
1);break}}}if(n){if(b&&(n.matches?n.matches(b):n([b]).length))e=-1<t?t:h.length,h.splice(e,0,b),p=q.indexOf(n(h),b),h.splice(e,1),l.start&&0==p||!d&&p==h.length?p=-1:h.splice(p,0,b)}else b&&(void 0!==a?p=t:l.start||(p=c.defaultIndex||0,h.splice(p,0,b)));if((-1<t||-1<p)&&(f||!n||t!=p)){d=w.slice();for(e=0;h=d[e];e++)h(b||m,t,p)}})});var k={};k.remove=k.cancel=function(){var c=q.indexOf(w,b);-1<c&&(w.splice(c,1),w.length||e.splice(q.indexOf(e,B),1))};return k}}return m};var l;f("put",function(b,g){c.notify(b,
g)});f("add",function(b){c.notify(b)});f("remove",function(b){c.notify(void 0,b)});return c};b.setObject("dojo.store.Observable",k);return k})},"esri/arcgis/Portal":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../kernel ../lang ../request ../Evented ../IdentityManager".split(" "),function(k,b,r,q,c,f,e,g,t,l,z){var u={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},m=function(a){function h(b){a[b]||
(a[b]=function(){var h=arguments;return q.when(a,function(a){Array.prototype.unshift.call(h,a.results||a);return m(c[b].apply(c,h))})})}if(!a)return a;a.then&&(a=b.delegate(a));a.total||(a.total=q.when(a,function(a){return t.isDefined(a.total)?a.total:a.length||0}));h("forEach");h("filter");h("map");h("some");h("every");return a},p={useSSL:function(a,b){var d=u&&u.self||{};if(d&&!d.isPortal)return-1!==a.indexOf("https:")||d.allSSL?b.replace("http:","https:"):b;var c=p.getLocation(b);if(-1<d.portalHostname.toLowerCase().indexOf(c.hostname.toLowerCase())&&
c.port&&"80"!==c.port&&"443"!==c.port){var g=c.pathname,g=0===g.indexOf("/")?g:"/"+g;return d.allSSL||-1<a.indexOf("https:")?"https://"+c.hostname+(d.httpsPort&&"443"!==d.httpsPort?":"+d.httpsPort:"")+g+c.search:"http://"+c.hostname+(d.httpPort&&"80"!==d.httpPort?":"+d.httpPort:"")+g+c.search}return-1!==a.indexOf("https:")||d.allSSL?b.replace("http:","https:"):b},formatUrl:function(a){var b=u.currentToken;return-1!==a.indexOf("null")?null:p.useSSL(window.location.protocol,b?a+(-1!==a.indexOf("?")?
"\x26":"?")+("token\x3d"+b):a)},getLocation:function(a){var b=document.createElement("a");b.href=a;return{protocol:b.protocol,hostname:b.hostname,port:b.port,pathname:b.pathname,search:b.search,hash:b.hash,host:b.host}},resultsToTypedArray:function(a,h,d){d=d?d.listings||d.notifications||d.userInvitations||d.tags||d.items||d.groups||d.comments||d.provisions||d.results||d:[];return c.map(d,function(d){d=b.mixin(d,h||{});return a?new a(d):d})},clearFieldsFromObject:function(a,c){var d,g=a.length;if(b.isArray(a))for(d=
0;d<g;d++)delete c[a[d]];else for(d in a)delete c[d];return c},requestToTypedArray:function(a,c,d,g,e){return m(p.request(a,c,d).then(b.partial(p.resultsToTypedArray,g,e)))},request:function(a,c,d){var g;c&&c.portal&&delete c.portal;c&&c.form&&(g=c.form,delete c.form);c=b.mixin(b.mixin({},c||{}),u.requestParams);d=b.mixin(d||{},u.options);return l({url:p.useSSL(window.location.protocol,a.url||a),content:c,callbackParamName:"callback",timeout:d&&d.timeout||0,form:g},d)},formatQueryParams:function(a,
c,d){a=b.mixin(b.mixin({},a),b.isString(c)?{q:c}:c||{});a.q=!d&&u.extraQuery?"("+a.q+")"+u.extraQuery:a.q;return a}},n=k([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(a){b.mixin(this,a);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),E=k([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(a){b.mixin(this,a);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),w=k([],
{declaredClass:"esri.arcgis.PortalItem",constructor:function(a){b.mixin(this,a);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("content","content/users/"+this.owner+(this.folderId?"/"+this.folderId:"")):null;this.itemDataUrl=p.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=p.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();
this.iconUrl=this._getIconUrl();this.isPremiumContent=this._getIsPremiumContent();this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null},getTypeInfo:function(){var a=this.type;return{source:-1<c.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===a?a:null,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},
addComment:function(a){var c=b.isString(a)?{comment:a}:a;return p.request(this.itemUrl+"/addComment",c,{usePost:!0}).then(b.hitch(this,function(a){return new n(b.mixin(c,{id:a.commentId,item:this}))}))},updateComment:function(a){if(a&&a.url&&a.comment)return p.request(a.url+"/update",{comment:a.comment},{usePost:!0}).then(function(b){a.id=b.commentId;return a});throw Error();},getComments:function(){return p.requestToTypedArray(this.itemUrl+"/comments",null,null,n,{item:this})},deleteComment:function(a){if(a&&
a.url)return p.request(a.url+"/delete",null,{usePost:!0});throw Error();},addRating:function(a){var c=b.isObject(a)?a:{rating:parseFloat(a)};return p.request(this.itemUrl+"/addRating",c,{usePost:!0}).then(b.hitch(this,function(a){return new E(b.mixin(c,{id:a.ratingId,item:this}))}))},getRating:function(){return p.request(this.itemUrl+"/rating").then(b.hitch(this,function(a){return new E(b.mixin(a,{item:this}))}))},deleteRating:function(){return p.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},
_getDisplayName:function(){var a=this.type,b=this.typeKeywords||[],d=a;"Feature Service"===a||"Feature Collection"===a?d=-1<c.indexOf(b,"Table")?"Table":"Feature Layer":"Image Service"===a?d=-1<c.indexOf(b,"Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":"Scene Service"===a?d="Scene Layer":"Stream Service"===a?d="Feature Layer":"Microsoft Powerpoint"===a?d="Microsoft PowerPoint":"GeoJson"===a?this.type=d="GeoJSON":"Globe Service"===a?d="Globe Layer":"Map Service"===a&&(d=-1<c.indexOf(b,"Hosted Service")||
-1<c.indexOf(b,"Tiled")?"Tile Layer":"Map Image Layer");return d},_getIconUrl:function(){var a=this.type&&this.type.toLowerCase()||"",b=this.typeKeywords||[],d=!1,g=!1;0<a.indexOf("service")||"feature collection"===a||"kml"===a||"wms"===a||"wmts"===a?(d=-1<c.indexOf(b,"Hosted Service"),a="feature service"===a||"feature collection"===a||"kml"===a?(g=-1<c.indexOf(b,"Table"))?"table":d?"featureshosted":"features":"map service"===a||"wms"===a||"wmts"===a?d||-1<c.indexOf(b,"Tiled")?"maptiles":"mapimages":
"scene service"===a?"sceneweblayer":"image service"===a?-1<c.indexOf(b,"Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===a?"streamlayer":"layers"):a="web map"===a||"cityengine web scene"===a?"maps":"web scene"===a?"webscene":"web mapping application"===a||"mobile application"===a||"application"===a||"operation view"===a||"desktop application"===a?"apps":"map document"===a||"map package"===a||"published map"===a||"scene document"===a||"globe document"===a||"basemap package"===a||
"mobile basemap package"===a||"mobile map package"===a||"project package"===a||"project template"===a||"pro map"===a||"layout"===a||"layer"===a&&-1<c.indexOf(b,"ArcGIS Pro")||"explorer map"===a&&c.indexOf(b,"Explorer Document")?"mapsgray":"service definition"===a||"csv"===a||"shapefile"===a||"cad drawing"===a||"geojson"===a?"datafiles":"explorer add in"===a||"desktop add in"===a||"windows viewer add in"===a||"windows viewer configuration"===a?"appsgray":"rule package"===a||"file geodatabase"===a||
"csv collection"===a||"kml collection"===a||"windows mobile package"===a||"map template"===a||"desktop application template"===a||"arcpad package"===a||"code sample"===a||"document link"===a||"tile package"===a||"scene package"===a||"operations dashboard add in"===a||"rules package"===a||"image"===a||"workflow manager package"===a||"desktop style"===a||"explorer map"===a&&-1<c.indexOf(b,"Explorer Mapping Application")||-1<c.indexOf(b,"Document")?"datafilesgray":"geocoding service"===a||"network analysis service"===
a||"geoprocessing service"===a||"geodata service"===a||"geometry service"===a||"geoprocessing package"===a||"locator package"===a||"geoprocessing sample"===a||"workflow manager service"===a||"raster function template"===a?"toolsgray":"layer"===a||"layer package"===a||"explorer layer"===a?"layersgray":"task file"===a?"taskfile":"maps";return a?e.toUrl("../css/images/item_type_icons/"+a+"16.png"):null},_getIsPremiumContent:function(){var a=this.typeKeywords,b=!1;if(-1<c.indexOf(a,"Service")&&(-1<c.indexOf(a,
"Requires Subscription")||-1<c.indexOf(this.typeKeywords,"Requires Credits")))b=!0;return b},_getPremiumIconUrl:function(){var a=this.typeKeywords,b;this.isPremiumContent&&(b=-1<c.indexOf(a,"Requires Credits")?"premiumcredits":"premiumitem");return b?e.toUrl("../css/images/item_type_icons/"+b+"16.png"):null}}),B=k([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(a){b.mixin(this,a);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":
"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=this.banner?p.formatUrl(this.url+"/info/"+this.banner):"";this.thumbnail=this.thumbnail?p.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?p.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||
{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var h in this.listingProperties)this[h]&&(this.listingProperties[h]=this[h]);this.properties=this.properties||{systemRequirements:"",termsAndConditions:"",version:"1.0"};this.screenshots=c.map(this.screenshots,b.hitch(this,function(a){return p.formatUrl(this.url+"/info/"+a)}));this.vendorName=this.vendor.name;this.vendor.thumbnail=this.vendor.thumbnail?this.userItemUrl?p.formatUrl(this.portal.portalUrl+
"/accounts/self/resources/"+this.vendor.thumbnail):p.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return p.requestToTypedArray(this.commentsUrl,null,null,n,{item:this})},getVendor:function(){return this.vendor}}),y=k([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(a){b.mixin(this,a);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&-1!==this.endDate?
new Date(this.endDate):null;this.listing=a.listing?new B(b.mixin(a.listing,{portal:this.portal})):null}}),F=k([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(a){b.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=p.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getMembers:function(){return p.request(this.url+"/users")},
queryItems:function(a,b){a=p.formatQueryParams({},a,b);a.q="group:"+this.id+(a.q?" "+a.q:"");return this.portal.queryItems(a)}}),D=k([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(a){b.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return p.requestToTypedArray(this.url,null,null,w,{portal:this.portal,folderId:this.id})}}),C=k([],{declaredClass:"esri.arcgis.PortalUser",
constructor:function(a){b.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=p.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getGroups:function(){return m(p.request(this.url).then(b.hitch(this,function(a){return p.resultsToTypedArray(F,{portal:this.portal},
a.groups)})))},getNotifications:function(){return p.requestToTypedArray(this.url+"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return p.requestToTypedArray(this.url+"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return p.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return m(this.getContent().then(function(a){return a.folders}))},getItems:function(a){return m(this.getContent(a).then(function(a){return a.items}))},
getItem:function(a){return p.request(this.portal.portalUrl+"content/items/"+a).then(b.hitch(this,function(a){return new w(b.mixin(a,{portal:this.portal}))}))},getContent:function(a){var c=this.url.replace("community","content")+(a?"/"+a:"");return p.request(c).then(b.hitch(this,function(b){b.folders=p.resultsToTypedArray(D,{portal:this.portal},b.folders);b.items=p.resultsToTypedArray(w,{portal:this.portal,folderId:a},b.items);return b}))}});return{Portal:k([z],{declaredClass:"esri.arcgis.Portal",
onLoad:function(){},onError:function(){},constructor:function(a){a=b.isObject(a)?a:{url:a};this.registerConnectEvents();u={options:{disableIdentityLookup:!0},requestParams:{f:"json"}};a.self?(u.self=a.self,b.mixin(this,{url:a.url||window.location.protocol+"//"+(a.self.urlKey?a.self.urlKey+"."+a.self.customBaseUrl:a.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",a=a.self.user?this.signIn():this.init(this.url)):(a.url&&b.mixin(this,{url:a.url}),
a=this.init(this.url));a.then(b.hitch(this,function(){this.emit("ready",this);this.onLoad(this)}))},init:function(a,c){a=(a||this.portalUrl).replace(/\/+$/,"");this.portalUrl=-1!==a.indexOf("/sharing")?a+"/":a+"/sharing/rest/";return this._getSelf(this.portalUrl).then(b.hitch(this,function(a){u.self=b.mixin({},a);if((a=a.user)&&c)u.currentToken=c&&c.token,u.loggedInUser=new C(b.mixin(a,{portal:this,credential:c}));u.self.id&&!1===u.self.canSearchPublic&&(u.extraQuery=" AND orgid:"+u.self.id);b.mixin(this,
u.self);this.thumbnailUrl=p.formatUrl(this.portalUrl+"accounts/self/resources/"+this.thumbnail);this.isOrganization=this.access&&this.access.length||!1;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this}),b.hitch(this,function(a){this.onError(a);throw a;}))},signIn:function(){var a=new q,c=b.hitch(this,function(){this._onSignIn().then(b.hitch(this,function(){a.resolve(u.loggedInUser)}),b.hitch(this,function(b){a.reject(b)}))});
if(!u||!u.self)this.on("load",b.hitch(this,function(){c()}));else u&&u.loggedInUser?setTimeout(function(){a.resolve(u.loggedInUser)},0):c();return a},signOut:function(){u.loggedInUser.credential&&u.loggedInUser.credential.destroy();u.loggedInUser=null;u.options.disableIdentityLookup=!0;p.clearFieldsFromObject(u.self,this);u.self=null;return this.init(this.url)},getPortalUser:function(){return u.loggedInUser},addResource:function(a,b){return p.request(this.portalUrl+"portals/self/addResource",{key:a,
text:b},{usePost:!0})},update:function(a){return p.request(this.portalUrl+"portals/self/update",a,{usePost:!0})},queryGroups:function(a,b){return this._queryPortal(this.portalUrl+"community/groups",p.formatQueryParams({},a,b),F)},queryItems:function(a,b){return this._queryPortal(this.portalUrl+"search",p.formatQueryParams({},a,b),w)},queryListings:function(a){a=p.formatQueryParams({},a,!0);var b="";a.q&&-1<a.q.toLowerCase().indexOf("mylistings:true")?(a.q=a.q.toLowerCase().replace("mylistings:true",
""),b="?mylistings\x3dtrue"):a.q||(a.q='""');return this._queryPortal(this.portalUrl+"content/listings"+b,a,B)},queryCustomerList:function(a,b){var c=p.formatQueryParams({},a,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",c)},getProvisions:function(){return this.getCustomers().then(b.hitch(this,function(a){return a.purchases}))},getInterests:function(){return this.getCustomers().then(b.hitch(this,function(a){return a.interests}))},getTrials:function(){return this.getCustomers().then(b.hitch(this,
function(a){return a.trials}))},getCustomers:function(a){return p.request(this.portalUrl+"portals/self/customers",{status:a||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(a){return a.purchases})},getMyInterests:function(){return this.getPurchases().then(function(a){return a.interests})},getPurchases:function(){return p.request(this.portalUrl+"portals/self/purchases").then(b.hitch(this,function(a){a.interests=c.map(a.interests,function(a){return b.mixin(a.provision,{listing:a.listing})});
a.purchases=c.map(a.purchases,function(a){return b.mixin(a.provision,{listing:a.listing})});a.trials=c.map(a.trials,function(a){return b.mixin(a.provision,{listing:a.listing})});a.interests=p.resultsToTypedArray(y,{portal:this},a.interests);a.trials=p.resultsToTypedArray(y,{portal:this},a.trials);a.purchases=p.resultsToTypedArray(y,{portal:this},a.purchases);return a}))},queryUsers:function(a,b){return this._queryPortal(this.portalUrl+"community/users",p.formatQueryParams({sortField:"username"},a,
b),C)},_onSignIn:function(){u.options.disableIdentityLookup=!1;if(!u.self||!u.self.user)u.self=null;return g.id.getCredential(this.portalUrl).then(b.hitch(this,"init",this.url)).then(function(){return u.loggedInUser},b.hitch(this,function(a){u.options.disableIdentityLookup=!0;this.onError(a);throw a;}))},_getSelf:function(a){var b;a=a+"accounts/self?culture\x3d"+r.locale;u.self?(b=new q,setTimeout(function(){b.resolve(u.self)},0)):b=p.request(a);return b},_queryPortal:function(a,c,d){var g=b.mixin({num:10,
start:0,sortField:"title",sortOrder:"asc"},c),e=["start","query","num","nextStart"];a=p.request(a,g).then(b.hitch(this,function(a){a.results=p.resultsToTypedArray(d,{portal:this},a);a.queryParams=b.mixin({},g);a.nextQueryParams=b.mixin(g,{start:a.nextStart});return p.clearFieldsFromObject(e,a)}));a=b.delegate(a);a.queryParams=b.mixin({},g);a.nextQueryParams=q.when(a,function(a){return a.nextQueryParams});return m(a)}}),PortalFolder:D,PortalGroup:F,PortalItem:w,PortalComment:n,PortalRating:E,PortalUtil:p,
PortalResult:m,PortalListing:B}})},"esri/dijit/_RefreshMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/has ../kernel".split(" "),function(k,b,r,q,c,f){function e(b){"object"!==typeof b&&(b=Error(b));b.grid=this;q.emit(this.domNode,"dgrid-error",{grid:this,error:b,cancelable:!0,bubbles:!0})&&console.error(b)}return k(null,{_trackError:function(c){var f;"string"===typeof c&&(c=b.hitch(this,c));try{f=c()}catch(l){e.call(this,l)}return r.when(f,b.hitch(this,
function(){q.emit(this.domNode,"refresh",{cancelable:!0,bubbles:!0})}),b.hitch(this,e))}})})},"esri/dijit/analysis/PluginAnalysisLayers":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/has ../../kernel".split(" "),function(k,b,r,q,c,f){var e=k(null,{constructor:function(c){b.mixin(this,c)},fetchData:function(){this._portal=this.parent._portal;var c;return this._fetchGroups().then(b.hitch(this,function(b){c=r.map(b||[],function(b){if(b)return'group:"'+b.id+
'"'}).join(" OR ");return this._fetchGroupItems(c)}))},_fetchGroup:function(c,e){this._groups=this._groups||[];return this._groups[c]||this._portal.queryGroups(e,!0).then(b.hitch(this,function(b){0<b.total&&b.results&&(this._groups[c]=b.results);return this._groups[c]||[]}))},_fetchGroupItems:function(b,c){var e='(type:"Map Service" OR type:"Feature Service") typekeywords:"Analysis Ready" ('+b+")"+(c?" "+c:"");this._portal.user.demographics||(e+=' -typekeywords:"Requires Credits"');return this.parent._fetchItems(e)},
_fetchGroups:function(){return this._fetchEsriAnalysisLayers()},_fetchEsriAnalysisLayers:function(){var c;this._portal&&this._portal.livingAtlasGroupQuery&&(c=this._portal.livingAtlasGroupQuery.replace('title:"Featured Maps And Apps"','title:"Living Atlas Analysis Layers"'));return this._fetchGroup("esriAnalysisLayers",{q:c,num:100,start:0}).then(b.hitch(this,function(b){return b}))}});b.mixin(e,{add:function(b,c){if(!b.plugIn){var f=c||{};f.parent=b;b.plugIn=new e(f)}},remove:function(b){b.plugIn&&
(b.plugIn.destroy(),delete b.plugIn)}});return e})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),function(k,b,r,q,c,f,e,g,t,l,z,u,m,
p,n,E,w,B,y,F,D,C,a){k=k(u,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(a){this._jobUpdateHandler=b.hitch(this,this._jobUpdateHandler);this._getJobStatus=b.hitch(this,this._getJobStatus);this._getResultDataHandler=b.hitch(this,
this._getResultDataHandler);this._getResultImageHandler=b.hitch(this,this._getResultImageHandler);this._executeHandler=b.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(a){this.updateDelay=a},setProcessSpatialReference:function(a){this.processSpatialReference=a},setOutputSpatialReference:function(a){this._setOutSR(a)},setOutSpatialReference:function(a){this._setOutSR(a)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(a){this.outSpatialReference=this.outputSpatialReference=a},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(a,d,e){for(var g in a){var f=a[g];b.isArray(f)?a[g]=c.toJson(r.map(f,function(a){return this._gpEncode({item:a},!0).item},this)):f instanceof Date&&(a[g]=f.getTime())}return this._encode(a,d,e)},_decode:function(c){var d=c.dataType,
e=new F(c);if(-1!==r.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],d))return e;if("GPLinearUnit"===d)e.value=new E(e.value);else if("GPFeatureRecordSetLayer"===d||"GPRecordSet"===d)e.value=new m(e.value);else if("GPDataFile"===d)e.value=new w(e.value);else if("GPDate"===d)c=e.value,b.isString(c)?e.value=new y({date:c}):e.value=new Date(c);else if("GPRasterData"===d||"GPRasterDataLayer"===d)c=c.value.mapImage,e.value=c?new a(c):new B(e.value);else if(-1!==d.indexOf("GPMultiValue:")){var g=d.split(":")[1];
c=e.value;e.value=r.map(c,function(a){return this._decode({paramName:"_name",dataType:g,value:a}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+e.dataType),e=null;return e},submitJob:function(a,d,e,g,f){var l=this._getOutSR(),k=f.assembly;a=this._gpEncode(b.mixin({},this._url.query,{f:"json","env:outSR":l?l.wkid||c.toJson(l.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||c.toJson(this.processSpatialReference.toJson()):
null},a),null,k&&k[0]);var m=this._jobUpdateHandler,n=this._errorHandler;return t({url:this._url.path+"/submitJob",content:a,callbackParamName:"callback",load:function(a,b){m(a,b,!1,d,e,f.dfd)},error:function(a){n(a,g,f.dfd)}})},_jobUpdateHandler:function(a,b,c,e,g,f){var l=a.jobId;b=new p(a);this._successHandler([b],"onStatusUpdate",g,c&&f);if(!c)switch(clearTimeout(this._updateTimers[l]),this._updateTimers[l]=null,f&&f.progress(b),a.jobStatus){case p.STATUS_SUBMITTED:case p.STATUS_EXECUTING:case p.STATUS_WAITING:case p.STATUS_NEW:var k=
this._getJobStatus;this._updateTimers[l]=setTimeout(function(){k(l,c,e,g,f)},this.updateDelay);break;default:this._successHandler([b],"onJobComplete",e,f)}},_getJobStatus:function(a,c,e,g,f){var l=this._jobUpdateHandler;t({url:this._url.path+"/jobs/"+a,content:b.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,b){l(a,b,c,e,g,f)},error:this._errorHandler})},_getResultDataHandler:function(a,b,c,e,g){try{var f=this._decode(a);this._successHandler([f],"onGetResultDataComplete",
c,g)}catch(l){this._errorHandler(l,e,g)}},getResultData:function(a,c,e,g){var f=this._getResultDataHandler,k=this._errorHandler,m=new q(l._dfdCanceller);m._pendingDfd=t({url:this._url.path+"/jobs/"+a+"/results/"+c,content:b.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(a,b){f(a,b,e,g,m)},error:function(a){k(a,g,m)}});return m},checkJobStatus:function(a,c,e){var g=this._jobUpdateHandler,f=this._errorHandler,k=new q(l._dfdCanceller);k._pendingDfd=
t({url:this._url.path+"/jobs/"+a,content:b.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,b){g(a,b,!0,null,c,k)},error:function(a){f(a,e,k)}});return k},cancelJob:function(a,c,e){var g=this._errorHandler,f=new q(l._dfdCanceller);f._pendingDfd=t({url:this._url.path+"/jobs/"+a+"/cancel",content:b.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:b.hitch(this,function(a,b){this._successHandler([a],"onJobCancel",c,f)}),error:function(a){g(a,e,f)}});
return f},execute:function(a,d,e,g){var f=this._getOutSR(),l=g.assembly;a=this._gpEncode(b.mixin({},this._url.query,{f:"json","env:outSR":f?f.wkid||c.toJson(f.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||c.toJson(this.processSpatialReference.toJson()):null},a),null,l&&l[0]);var k=this._executeHandler,m=this._errorHandler;return t({url:this._url.path+"/execute",content:a,callbackParamName:"callback",load:function(a,b){k(a,b,d,e,g.dfd)},error:function(a){m(a,
e,g.dfd)}})},_executeHandler:function(a,b,c,e,g){try{var f=a.results,l,k,m=a.messages;l=0;for(k=f.length;l<k;l++)f[l]=this._decode(f[l]);l=0;for(k=m.length;l<k;l++)m[l]=new n(m[l]);this._successHandler([f,m],"onExecuteComplete",c,g)}catch(p){this._errorHandler(p,e,g)}},_getResultImageHandler:function(a,b,c,e,g){try{var f=this._decode(a);this._successHandler([f],"onGetResultImageComplete",c,g)}catch(l){this._errorHandler(l,e,g)}},getResultImage:function(a,c,e,g,f){var k=this._getResultImageHandler,
m=this._errorHandler;e=this._gpEncode(b.mixin({},this._url.query,{f:"json"},e.toJson()));var n=new q(l._dfdCanceller);n._pendingDfd=t({url:this._url.path+"/jobs/"+a+"/results/"+c,content:e,callbackParamName:"callback",load:function(a,b){k(a,b,g,f,n)},error:function(a){m(a,f,n)}});return n},cancelJobStatusUpdates:function(a){clearTimeout(this._updateTimers[a]);this._updateTimers[a]=null},getResultImageLayer:function(a,b,c,g){if(null==b){var f=this._url.path.indexOf("/GPServer/");a=this._url.path.substring(0,
f)+"/MapServer/jobs/"+a}else a=this._url.path+"/jobs/"+a+"/results/"+b;this._url.query&&(a+="?"+e.objectToQuery(this._url.query));b=null==b?new C(a,{imageParameters:c}):new D(a,{imageParameters:c},!0);this.onGetResultImageLayerComplete(b);g&&g(b);return b},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});z._createWrappers(k);
return k})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(k,b,r,q){return k(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(c){c&&b.mixin(this,c)},distance:0,units:null,toJson:function(){var b={};this.distance&&(b.distance=this.distance);this.units&&(b.units=this.units);return b}})})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(k,b,r,q){return k(null,
{declaredClass:"esri.tasks.DataFile",constructor:function(c){c&&b.mixin(this,c)},url:null,itemID:null,toJson:function(){var b={};this.url&&(b.url=this.url);this.itemID&&(b.itemID=this.itemID);return b}})})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(k,b,r,q){return k(null,{declaredClass:"esri.tasks.RasterData",constructor:function(c){c&&b.mixin(this,c)},url:null,format:null,itemID:null,toJson:function(){var b={};this.url&&(b.url=
this.url);this.format&&(b.format=this.format);this.itemID&&(b.itemID=this.itemID);return b}})})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(k,b,r,q,c){return k(null,{declaredClass:"esri.tasks.Date",constructor:function(b){b&&(b.format&&(this.format=b.format),this.date=r.parse(b.date,{selector:"date",datePattern:this.format}))},date:new Date,format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:r.format(this.date,
{selector:"date",datePattern:this.format}),format:this.format}}})})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(k,b,r,q){return k(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(c){b.mixin(this,c)}})})},"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(k,b,r,
q,c,f,e){return k(e,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(c,e){e&&(e.imageParameters&&e.imageParameters.extent)&&(this.initialExtent=this.fullExtent=e.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=b.hitch(this,this.getImageUrl);this.loaded=!0;this.onLoad(this)},getImageUrl:function(e,f,l,k){var q=e.spatialReference.wkid;k(this._url.path+"?"+c.objectToQuery(b.mixin(this._params,{f:"image",bbox:r.toJson(e.toJson()),
bboxSR:q,imageSR:q,size:f+","+l})))}})})},"widgets/Analysis/layerUtil":function(){define(["dojo/_base/array","dojo/promise/all","jimu/LayerInfos/LayerInfos"],function(k,b,r){return{getLayerObjects:function(q){return r.getInstance(q,q.itemInfo).then(function(c){var f=[];c.traversal(function(b){f.push(b)});var e=k.map(f,function(b){return b.getLayerObject()});return b(e).then(function(b){var e=[];k.forEach(b,function(b,c){b.id=b.id||f[c].id;b&&"esri.layers.FeatureLayer"===b.declaredClass&&e.push(b)});
return{layerInfosObject:c,layerInfos:f,layerObjects:e}})})}}})},"widgets/Analysis/toolValidate":function(){define(["dojo/_base/lang","dojo/_base/array","./privilegeUtil"],function(k,b,r){function q(c,f,e){var g=null;b.some(c,k.hitch(this,function(b){if(b&&e!==b.id)if(1===f.length){if("*"===f[0]||f[0]===b.geometryType)return g=b.id,!0}else if(-1<f.indexOf(b.geometryType))return g=b.id,!0}));return g}return{isValid:function(b,f){var e=!1,e=b.layerObjects;if(-1!==f.dijitID.indexOf("MergeLayers"))e=this.mergeAvailable(e);
else if(-1!==f.dijitID.indexOf("ExtractData"))e=this.extractAvailable(b);else{var g=null;"requiredParam"in f&&(g=f.requiredParam);e=this.paramAvailable(e,f.analysisLayer,g)}return e},mergeAvailable:function(c){return b.some(c,function(f){return b.some(c,function(b){return b!==f&&b.geometryType===f.geometryType})})},extractAvailable:function(c){var f=r.getUser(),e=c.layerInfos,g=c.layerInfosObject.getMapNotesLayerInfoArray(),k=!1;b.forEach(e,function(c){var e=this._isMapNotes(g,c),q="esri.layers.GeoRSSLayer"===
c.layerObject.declaredClass,m="esri.layers.CSVLayer"===c.layerObject.declaredClass,p="FeatureCollection"===c.layerObject.type,n=p&&!e;p||q||m||e?q||m?k=this._addExtractCapability(c):e||n?(c=c.getSubLayers())&&0<c.length&&b.forEach(c,function(b){k=this._addExtractCapability(b)},this):k=this._addExtractCapability(c):r.isAdmin()&&(c.layerObject.url&&-1<c.layerObject.url.indexOf("/"+f.accountId+"/"))&&(k=this._addExtractCapability(c))},this);return k},_isMapNotes:function(c,f){return b.some(c,function(b){return b.id===
f.id})},_addExtractCapability:function(b){b.layerObject.capabilities?-1===b.layerObject.capabilities.indexOf("Extract")&&(b.layerObject.capabilities+=",Extract"):b.layerObject.capabilities="Extract";return!0},paramAvailable:function(b,f,e){var g;g=f.geomTypes;f=q(b,g);return null===f?!1:null!==e?(g=e.geomTypes,null!==q(b,g,f)):!0}}})},"widgets/Analysis/privilegeUtil":function(){define(["dojo/_base/lang","dojo/_base/array","jimu/portalUtils","jimu/portalUrlUtils","esri/kernel"],function(k,b,r,q,c){var f=
{},e=["org_admin","account_admin","org_publisher","account_publisher"];f.loadPrivileges=function(b){this.userProfile=null;b=r.getPortal(b);return b.haveSignIn()?this._loadUserInfo(b):this._signIn(b)};f._signIn=function(b){return b.loadSelfInfo().then(k.hitch(this,function(b){var c=r.getPortal(b.portalHostname);return null===c?!1:c.signIn().then(k.hitch(this,function(b){return this._loadUserInfo(c,b)}))}))};f._registerOrgCredential=function(b,e){e=q.getStandardPortalUrl(e);var f=k.clone(b.toJson()),
r=e+"/sharing/rest";f.server=r;f.resources=[r];c.id.registerToken(f)};f._loadUserInfo=function(c,e){return c.loadSelfInfo().then(k.hitch(this,function(c){return c.urlKey&&c&&c.user?(this.user=k.clone(c.user),this.userProfile={role:c.user.role||c.user.id,isCustomRole:"roleId"in c.user,portalUrl:c.urlKey+"."+c.customBaseUrl,privileges:{}},b.forEach(c.user.privileges,function(b){"string"===typeof b&&(b=b.split(":"),3===b.length&&(this.userProfile.privileges[b[2]]=!0))},this),e&&this._registerOrgCredential(e,
this.userProfile.portalUrl),!0):!1}))};f._privilegeLoaded=function(){return"undefined"!==typeof this.userProfile&&null!==this.userProfile};f.getUserPortal=function(){return this._privilegeLoaded()?this.userProfile.portalUrl:null};f.isAdmin=function(){return this._privilegeLoaded()?"org_admin"===this.userProfile.role||"account_admin"===this.userProfile.role:!1};f.getUser=function(){return this._privilegeLoaded()?this.user:null};f.isAnalysisAvailable=function(){return this._privilegeLoaded()?this.userProfile.isCustomRole?
this._hasPrivilege("createItem")&&this._hasPrivilege("publishFeatures")&&this._hasPrivilege("spatialanalysis"):-1!==b.indexOf(e,this.userProfile.role):!1};f.hasPrivileges=function(c){return k.isArray(c)?b.every(c,function(b){return this._hasPrivilege(b)},this):!0};f._hasPrivilege=function(b){return this._privilegeLoaded()?!0===this.userProfile.privileges[b]:!1};return f})},"widgets/Analysis/toolSettings":function(){define(["dojo/_base/lang","dojo/_base/array"],function(k,b){var r={},q="AggregatePoints CalculateDensity ConnectOriginsToDestinations CreateBuffers CreateDriveTimeAreas CreateViewshed CreateWatersheds DeriveNewLocations DissolveBoundaries EnrichLayer ExtractData FindExistingLocations FindHotSpots FindNearest FindSimilarLocations InterpolatePoints MergeLayers OverlayLayers PlanRoutes SummarizeNearby SummarizeWithin TraceDownstream".split(" "),
c=[{id:0,dijitID:"esri/dijit/analysis/AggregatePoints",title:"aggregateTool",imgDisplay:"images/aggregate-points.png",usage:"aggregatePointsUsage",analysisLayer:{name:"pointLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},requiredParam:{name:"polygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},icon:"images/AggregatePoints32.png"},{id:1,dijitID:"esri/dijit/analysis/CalculateDensity",title:"calculateDensity",imgDisplay:"images/calculate-density.png",usage:"calculateDensityUsage",
analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/CreateDensitySurface32.png"},{id:2,dijitID:"esri/dijit/analysis/ConnectOriginsToDestinations",title:"connectOriginsToDestinations",imgDisplay:"images/connect-origins-to-destinations.png",usage:"connectOriginsToDestinationsUsage",analysisLayer:{name:"originsLayer",geomTypes:["esriGeometryPoint"]},
requiredParam:{name:"featureLayers",isArray:!0,geomTypes:["esriGeometryPoint"]},icon:"images/ConnectOriginstoDestinations32.png"},{id:3,dijitID:"esri/dijit/analysis/CreateBuffers",title:"createBuffers",imgDisplay:"images/create-buffers.png",usage:"createBuffersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},icon:"images/CreateBuffers32.png"},{id:4,dijitID:"esri/dijit/analysis/CreateDriveTimeAreas",title:"createDriveTimeAreas",imgDisplay:"images/create-drivetime.png",usage:"createDriveTimeAreasUsage",
analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},icon:"images/CreateDriveTimeAreas32.png",cannotCancel:!0,privileges:["networkanalysis"]},{id:5,dijitID:"esri/dijit/analysis/CreateViewshed",title:"createViewshed",imgDisplay:"images/create-viewshed.png",usage:"createViewshedUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},icon:"images/Viewshed32.png"},{id:6,dijitID:"esri/dijit/analysis/CreateWatersheds",title:"createWatershed",imgDisplay:"images/create-watersheds.png",
usage:"createWatershedsUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},icon:"images/Watershed32.png"},{id:7,dijitID:"esri/dijit/analysis/DeriveNewLocations",title:"deriveNewLocations",imgDisplay:"images/derive-new-locations.png",usage:"deriveNewLocationsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},optionalParams:[{name:"inputLayers",isArray:!0,geomTypes:["*"]}],icon:"images/FindNewLocations32.png"},{id:8,dijitID:"esri/dijit/analysis/DissolveBoundaries",title:"dissolveBoundaries",
imgDisplay:"images/dissolve-boundaries.png",usage:"dissolveBoundariesUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPolygon"]},icon:"images/DissolveBoundaries32.png"},{id:9,dijitID:"esri/dijit/analysis/EnrichLayer",title:"enrichLayer",imgDisplay:"images/enrich-layer.png",usage:"enrichLayerUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},icon:"images/GeoenrichFeatures32.png",privileges:["geoenrichment"]},{id:10,dijitID:"esri/dijit/analysis/ExtractData",title:"extractData",
imgDisplay:"images/extract-data.png",usage:"extractDataDesc",optionalParams:[{name:"featureLayers",isArray:!0,geomTypes:["*"]}],icon:"images/ClipAndShip32.png"},{id:11,dijitID:"esri/dijit/analysis/FindExistingLocations",title:"findExistingLocations",imgDisplay:"images/find-existing-locations.png",usage:"findExistingLocationsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},optionalParams:[{name:"inputLayers",isArray:!0,geomTypes:["*"]}],icon:"images/FindExistingLocations32.png"},{id:12,
dijitID:"esri/dijit/analysis/FindHotSpots",title:"findHotSpots",imgDisplay:"images/find-hot-spots.png",usage:"findHotSpotsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolygon"]},optionalParams:[{name:"aggregationPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/FindHotSpots32.png"},{id:13,dijitID:"esri/dijit/analysis/FindNearest",title:"findNearest",
imgDisplay:"images/find-nearest.png",usage:"findNearestUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},requiredParam:{name:"nearLayers",isArray:!0,geomTypes:["*"]},icon:"images/FindNearest32.png",cannotCancel:!0,privileges:["networkanalysis"]},{id:14,dijitID:"esri/dijit/analysis/FindSimilarLocations",title:"findSimilarLocations",imgDisplay:"images/find-similar-locations.png",usage:"findSimilarLocationsUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},optionalParams:[{name:"searchLayers",
isArray:!0,geomTypes:["*"]}],icon:"images/FindSimilarLocations32.png"},{id:15,dijitID:"esri/dijit/analysis/InterpolatePoints",title:"interpolatePoints",imgDisplay:"images/interpolate-points.png",usage:"interpolatePointsUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},{name:"predictAtPointLayers",isArray:!0,geomTypes:["esriGeometryPoint"]}],icon:"images/CreateInterpolatedSurface32.png"},
{id:16,dijitID:"esri/dijit/analysis/MergeLayers",title:"mergeLayers",imgDisplay:"images/merge-layers.png",usage:"mergeLayersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},requiredParam:{name:"mergeLayers",isArray:!0,geomTypes:["*"]},icon:"images/MergeLayers32.png"},{id:17,dijitID:"esri/dijit/analysis/OverlayLayers",title:"overlayLayers",imgDisplay:"images/overlay-layers.png",usage:"overlayLayersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},requiredParam:{name:"overlayLayer",isArray:!0,
geomTypes:["*"]},icon:"images/OverlayLayers32.png"},{id:18,dijitID:"esri/dijit/analysis/PlanRoutes",title:"planRoutes",imgDisplay:"images/plan-routes.png",usage:"planRoutesUsage",analysisLayer:{name:"stopsLayer",geomTypes:["esriGeometryPoint"]},optionalParams:[{name:"featureLayers",isArray:!0,geomTypes:["esriGeometryPoint"]}],icon:"images/PlanRoutes32.png",cannotCancel:!0,privileges:["networkanalysis"]},{id:19,dijitID:"esri/dijit/analysis/SummarizeNearby",title:"summarizeNearby",imgDisplay:"images/summarize-nearby.png",
usage:"summarizeNearbyUsage",analysisLayer:{name:"sumNearbyLayer",geomTypes:["*"]},requiredParam:{name:"summaryLayers",isArray:!0,geomTypes:["*"]},icon:"images/SummarizeNearby32.png",privileges:["networkanalysis"]},{id:20,dijitID:"esri/dijit/analysis/SummarizeWithin",title:"summarizeWithin",imgDisplay:"images/summarize-within.png",usage:"summarizeWithinUsage",analysisLayer:{name:"sumWithinLayer",geomTypes:["esriGeometryPolygon"]},requiredParam:{name:"summaryLayers",isArray:!0,geomTypes:["*"]},icon:"images/SummarizeWithin32.png"},
{id:21,dijitID:"esri/dijit/analysis/TraceDownstream",title:"traceDownstream",imgDisplay:"images/trace-downstream.png",usage:"traceDownstreamUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/TraceDownstream32.png"}];r.findToolSetting=function(f){f=b.indexOf(q,f);return-1!==f?k.clone(c[f]):null};r.getToolName=function(b){return"id"in b&&0<=b.id&&b.id<q.length?q[b.id]:null};
r.getAllSettings=function(){return k.clone(c)};return r})},"widgets/Analysis/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings","dojo/text!./config.json"],function(){})},"url:widgets/Analysis/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"widgetContent" class\x3d"analysis-widget-content"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"toolListPanel" class\x3d"tool-list"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"toolsSection" class\x3d"toolsSection"\x3e\r\n        \x3cdiv class\x3d"execute-tip"\x3e\r\n          ${nls.executeAnalysisTip}\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"tools-table-container"\x3e\r\n          \x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"tools-table" onselectstart\x3d"return false;"\x3e\r\n            \x3ctbody data-dojo-attach-point\x3d"toolsTbody"\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noQueryTipSection" class\x3d"jimu-widget"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"toolPanel" class\x3d"tool-panel"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"toolLoadErrorNode" class\x3d"analysis-error-tip" style\x3d"display:none"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"messagePanel" class\x3d"message-panel"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"inputHeader" class\x3d"input-header esriAnalysis"\x3e\r\n        \x3cimg data-dojo-attach-point\x3d"smallIcon" class\x3d"small-icon"/\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"toolTitle" class\x3d"tool-title"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3chr\x3e\r\n      \x3cdiv class\x3d"message-title"\x3e${nls.messages}\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"messageSection" class\x3d\'message-section\'\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"resultSection" style\x3d"display:none" \x3e\r\n        \x3cdiv class\x3d"message-title outputs"\x3e${nls.outputs}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"outputSection" class\x3d\'result-section\'\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"job-message outputtip" data-dojo-attach-point\x3d"outputtip"\x3e${nls.outputtip}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"resultLoading" class\x3d"result-loading" style\x3d"display:none"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"buttonSection" style\x3d"display:none" class\x3d"buttonNode"\x3e\r\n        \x3cdiv class\x3d"jimu-btn"\r\n            data-dojo-attach-event\x3d"onclick: _switchToPrevious"\x3e${nls.back}\x3c/div\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"homeBtn"\r\n            data-dojo-attach-event\x3d"onclick: _switchToHome"\x3e${nls.home}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Analysis/css/style.css":".esriAnalysis .dijitComboBox{height: 30px !important;}.jimu-widget-analysis{position: relative; width: 100%; height: 100%; min-width: 300px; min-height: 237px; overflow-x: hidden; -ms-overflow-x: hidden; overflow-y: auto; -ms-overflow-y: auto;}.jimu-widget-analysis .execute-tip{font-size: 14px; color: #66699c; font-weight: bold;}.jimu-widget-analysis .tools-table-container{width: 100%;}.jimu-widget-analysis .tools-table{margin: 0 auto; padding-top: 10px; width: 100%; border-collapse: collapse;}.jimu-widget-analysis .tool-name{font-size: 14px; margin-left: 10px; margin-top: 10px; color: #686868;}.jimu-rtl .jimu-widget-analysis .tool-name{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .tools-table-tr{height:107px; display: block; cursor: pointer;}.jimu-widget-analysis .tools-table-tr.even{background-color: #ffffff;}.jimu-widget-analysis .tools-table-tr.odd{background-color: #f0f0f0;}.jimu-widget-analysis .tools-table-tr.disabled{background-color: #979797; cursor: default; border-bottom: 1px solid #ffffff;}.jimu-widget-analysis .tools-table-tr .icon-div{margin: 10px;}.jimu-widget-analysis .tools-table-tr .icon-div .tool-icon{height: 60px; width: auto;}.jimu-widget-analysis .tools-table-tr .tooltip-td{margin: 10px;}.jimu-widget-analysis .tooltip-icon{width: 16px; height: 16px; cursor: pointer; margin-left: 30px;}.jimu-rtl .jimu-widget-analysis .tooltip-icon{margin-left: auto; margin-right: 30px;}.jimu-widget-analysis .tools-table-tr:hover{background: #d9dde0;}.jimu-widget-analysis .tools-table-tr.disabled:hover{background-color: #979797;}.jimu-widget-analysis .tool-params{width: 100%; height: 100%;}.jimu-widget-analysis .input-header{position: relative; width: 100%;}.jimu-widget-analysis .input-header .small-icon{margin-left: 15px;}.jimu-rtl .jimu-widget-analysis .input-header .small-icon{margin-left: auto; margin-right: 15px;}.jimu-widget-analysis .input-header .tool-title{margin-left: 15px; margin-bottom: 15px; font-size: 16px;}.jimu-rtl .jimu-widget-analysis .input-header .tool-title{margin-left: auto; margin-right: 15px;}.jimu-widget-analysis .input-header .help-icon{margin-top: 15px; cursor: pointer;}.jimu-widget-analysis .input-tip{width: 100%; height: auto; margin-top: 20px; font-size: 14px;}.jimu-widget-analysis .layerNode{position: relative; width:100%; margin: 0 auto; margin-top: 10px;}.jimu-widget-analysis .layerNode .param-name{margin-top: 15px; margin-bottom: 10px;}.jimu-widget-analysis .layer-name {height: 30px; line-height: 30px; width: 100%; border: solid 1px rgba(0,0,0,0.1); cursor: pointer;}.jimu-widget-analysis .tool-params .buttonNode{width: 100%; height: auto; margin-top: 20px; text-align: center;}.jimu-widget-analysis .switch-button{margin-left: 20px;}.jimu-rtl .jimu-widget-analysis .switch-button{margin-left: auto; margin-right: 20px;}.jimu-widget-analysis .tool-panel{width: 100%; height: auto; position: relative; top:-20px;}.jimu-widget-analysis .tool-panel .esriAnalysisCloseIcon{display:none;}.jimu-widget-analysis .jimu-btn{margin-left: 10px; margin-right: 10px;}.jimu-widget-analysis .toolpanel-button{text-align: center;}.jimu-widget-analysis .analysis-error-tip{width: 100%; min-height: 150px; margin-top: 30px; margin-left: 15px; margin-right: 15px; color:#ff0000; font-size: 14px;}.jimu-widget-analysis .message-panel{width: 100%; margin-bottom: 15px; position: relative;}.jimu-widget-analysis .message-panel .message-title{margin-top: 20px; font-size: 14px; color: #66696c; font-weight: bold;}.jimu-widget-analysis .message-panel .message-title.outputs{margin-top: 30px;}.jimu-widget-analysis .message-panel .job-message{margin-top: 10px; font-size: 12px; color: #686868;}.jimu-widget-analysis .message-panel .job-message.outputtip{margin-top: 30px;}.jimu-widget-analysis .message-panel .job-message.success{color: #00B050;}.jimu-widget-analysis .message-panel .job-message.failed{color:#E84B4B;}.jimu-widget-analysis .message-panel .job-message.cancelled{color: #51B1FE;}.jimu-widget-analysis .message-panel .job-running-icon{width: 16px; height: 16px; margin-left: 10px;}.jimu-rtl .jimu-widget-analysis .message-panel .job-running-icon{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .message-panel .job-cancel-icon{width: 16px; height: 16px; cursor: pointer; margin-left: 10px;}.jimu-rtl .jimu-widget-analysis .message-panel .job-cancel-icon{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .message-panel .output-item{margin-top: 10px; color: #51B1FE; font-size: 12px;}.jimu-widget-analysis .message-panel .output-item\x3ea{color: #51B1FE;}.jimu-widget-analysis .message-panel .button-section{width: 100%; margin-top: 20px;}.jimu-widget-analysis .message-panel .buttonNode{width: 100%; height: auto; margin-top: 20px; text-align: center;}.jimu-widget-analysis .result-section{width: 100%; margin-top: 15px; margin-bottom: 15px; font-size: 14px; color: #66699c;}.jimu-widget-analysis .result-loading{width: 100%; height: 40px; margin-top: 15px; margin-bottom: 15px; background-image: url(images/loading.gif); background-repeat: no-repeat; background-position: center;}.jimu-widget-analysis .hidden{display: none;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton{margin-left: 0px;}.jimu-rtl .jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton{margin-right: 0px; margin-left: auto;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton.dijitButton\x3espan.dijitButtonNode{cursor:pointer; min-width: 70px; display:inline-block; padding:6px; font-size:15px; text-align:center; background:#485566; vertical-align:middle; color:#ffffff; -webkit-border-radius:5px; -moz-border-radius:5px; -o-border-radius:5px; -ms-border-radius:5px; border-radius: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton.dijitButtonHover\x3espan.dijitButtonNode{background-color: #15a4fa;}.dijitDialog .esriAnalysis{overflow: hidden;}.dijitDialog .esriAnalysis .esriAnalysisSubmitButton{margin-left: 10px;}.jimu-rtl .dijitDialog .esriAnalysis .esriAnalysisSubmitButton{margin-left: auto; margin-right: 10px;}",
"url:widgets/Analysis/config.json":'{\r\n  "analysisTools": []\r\n}\r\n',"*now":function(k){k(['dojo/i18n!*preload*widgets/Analysis/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/dom-style dojo/dom-attr dojo/dom-class dojo/_base/event dojo/Deferred dojo/on dojo/query dojo/promise/all dojo/dom-construct dojo/i18n!esri/nls/jsapi dojo/json dijit/_WidgetsInTemplateMixin esri/request esri/tasks/JobInfo esri/layers/FeatureLayer esri/dijit/PopupTemplate esri/dijit/analysis/utils esri/geometry/Extent jimu/BaseWidget jimu/dijit/ViewStack jimu/dijit/Message jimu/utils jimu/portalUtils jimu/portalUrlUtils jimu/LayerInfos/LayerInfos ./layerUtil ./toolValidate ./privilegeUtil ./toolSettings dojo/i18n!./setting/nls/strings dijit/form/Button".split(" "),function(k,
b,r,q,c,f,e,g,t,l,z,u,m,p,n,E,w,B,y,F,D,C,a,h,d,s,x,A,H,J,K,G,L,M){return k([a,E],{baseClass:"jimu-widget-analysis esriAnalysis",_hasContent:null,currentStack:0,toolCountInList:0,postMixInProperties:function(){this.inherited(arguments);b.mixin(this.nls,p.analysisTools);this.nls.toolNotAvailable=M.toolNotAvailable},postCreate:function(){this.inherited(arguments);this.viewStack=new h({viewType:"dom",views:[this.toolListPanel,this.toolPanel,this.messagePanel]});r.place(this.viewStack.domNode,this.widgetContent);
0===this.config.analysisTools.length&&this._noPrivilegeHandler(this.nls.noToolTip);this._switchView(0)},onClose:function(){D._helpDialog&&"function"===typeof D._helpDialog.close&&D._helpDialog.close();this._deactiveDrawTool()},onDeActive:function(){this._deactiveDrawTool()},_checkValidation:function(){m.empty(this.toolsTbody);0!==this.config.analysisTools.length&&(this.shelter.show(),G.loadPrivileges(this._getPortalUrl()).then(b.hitch(this,function(a){!a||!G.isAnalysisAvailable()?this._noPrivilegeHandler(this.nls.privilegeError):
(c.set(this.toolsSection,"display","block"),c.set(this.noQueryTipSection,"display","none"),1===this.config.analysisTools.length?this._initSingleTool().then(b.hitch(this,function(){this.shelter.hide()})):this._initToolList().then(b.hitch(this,function(){this.shelter.hide()})))}),b.hitch(this,function(){this._noPrivilegeHandler(this.nls.privilegeError);this.shelter.hide()})))},_clearContent:function(){m.empty(this.toolsTbody);this.currentAnalysisDijit&&(this.currentAnalysisDijit.destroy(),this.currentAnalysisDijit=
null);this.currentToolSetting=null},_noPrivilegeHandler:function(a){c.set(this.toolsSection,"display","none");f.set(this.noQueryTipSection,"innerHTML",a);c.set(this.noQueryTipSection,"display","block")},_initSingleTool:function(){c.set(this.homeBtn,"display","none");this.currentToolSetting=L.findToolSetting(this.config.analysisTools[0].name);if(null===this.currentToolSetting)this._noPrivilegeHandler(this.nls.noToolTip);else{this.currentToolSetting=b.mixin(this.currentToolSetting,this.config.analysisTools[0]);
this.currentToolSetting.toolLabel||(this.currentToolSetting.toolLabel=this.nls[this.currentToolSetting.title]);if(G.hasPrivileges(this.currentToolSetting.privileges))return J.getLayerObjects(this.map).then(b.hitch(this,function(){this._setIconAndLink(this.currentToolSetting);this.toolCountInList=1;this._switchToAnalysisTool()}));this._noPrivilegeHandler(this.nls.privilegeError)}},_initToolList:function(){c.set(this.homeBtn,"display","");this.toolCountInList=0;var a=null;return J.getLayerObjects(this.map).then(b.hitch(this,
function(c){q.forEach(this.config.analysisTools,b.hitch(this,function(d,e){var f=L.findToolSetting(d.name);if(null!==f&&(f=b.mixin(f,this.config.analysisTools[e]),f.toolLabel||(f.toolLabel=this.nls[f.title]),G.hasPrivileges(f.privileges))){var g=K.isValid(c,f);this._addTool(f,e,g);this.toolCountInList+=1;a=f}}));0===this.toolCountInList?this._noPrivilegeHandler(this.nls.privilegeError):1===this.toolCountInList&&(this._setIconAndLink(a),this._switchToAnalysisTool())}),b.hitch(this,function(){console.error("layerUtil: getLayerObjects error")}))},
destroy:function(){this._clearContent();this.inherited(arguments)},_addTool:function(a,c,d){var h=m.create("tr",{"class":"tools-table-tr"},this.toolsTbody);0===c%2?e.add(h,"even"):e.add(h,"odd");h.rowData=a;c=m.create("td",{"class":"icon-td"},h);m.create("div",{"class":"tool-name",innerHTML:a.toolLabel},c);c=m.create("div",{"class":"icon-div"},c);m.create("img",{src:this.folderUrl+a.imgDisplay,"class":"tool-icon"},c);c=m.create("td",{"class":"tooltip-td esriAnalysis"},h);a.showHelp&&(c=m.create("a",
{href:"#",esriHelpTopic:"toolDescription"},c),m.create("img",{src:this.folderUrl+"images/helpIcon.png",title:a.toolLabel,"class":"tooltip-icon"},c),c=a.dijitID.lastIndexOf("/"),c=a.dijitID.substring(c+1),D.initHelpLinks(h,!0,{helpFileName:c}));!0===d?(f.set(h,"title",""),this.own(l(h,"click",b.hitch(this,function(b){g.stop(b);this._setIconAndLink(a);this.currentToolSetting=a;this._switchToAnalysisTool()})))):(f.set(h,"title",this.nls.toolNotAvailable),e.remove(h,"even"),e.remove(h,"odd"),e.add(h,
"disabled"))},_setIconAndLink:function(a){f.set(this.smallIcon,"src",this.folderUrl+a.icon);f.set(this.toolTitle,"innerHTML",a.toolLabel);var b=a.dijitID.lastIndexOf("/"),b=a.dijitID.substring(b+1);this.helpLink&&(m.destroy(this.helpLink),this.helpLink=null);a.showHelp&&(this.helpLink=m.create("a",{href:"#",esriHelpTopic:"toolDescription"},this.inputHeader),m.create("img",{height:16,width:16,"class":"help-icon jimu-float-trailing",src:this.folderUrl+"images/helpIcon.png"},this.helpLink),D.initHelpLinks(this.inputHeader,
!0,{helpFileName:b}))},_getAnalysisLayers:function(a){var b,c,d=["point","polyline","polygon"],e=[];"*"!==a.geomTypes[0]&&(d=q.map(a.geomTypes,function(a){return s.getTypeByGeometryType(a)}));q.forEach(this.map.graphicsLayerIds,function(a){b=this.map.getLayer(a);"esri.layers.FeatureLayer"===b.declaredClass&&(c=s.getTypeByGeometryType(b.geometryType),0<=d.indexOf(c)&&(b.url||0<b.graphics.length)&&e.push(b))},this);e.reverse();return e},_switchToAnalysisTool:function(){c.set(this.toolLoadErrorNode,
"display","none");this.shelter.show();require([this.currentToolSetting.dijitID],b.hitch(this,function(a){this.currentAnalysisDijit&&(this.currentAnalysisDijit.destroy(),this.currentAnalysisDijit=null);var d={map:this.map,showSelectFolder:!0,portalUrl:this._getPortalUrl(G.getUserPortal()),showCredits:this.currentToolSetting.showCredits,showHelp:this.currentToolSetting.showHelp,showChooseExtent:this.currentToolSetting.showChooseExtent,returnFeatureCollection:this.currentToolSetting.returnFeatureCollection,
showReadyToUseLayers:this.currentToolSetting.showReadyToUseLayers};"returnFeatureCollection"in this.currentToolSetting&&(d.showSelectFolder=!this.currentToolSetting.returnFeatureCollection);this.currentToolSetting.analysisLayer&&(d.showSelectAnalysisLayer=!0,d[this.currentToolSetting.analysisLayer.name+"s"]=this._getAnalysisLayers(this.currentToolSetting.analysisLayer));this._prepareLayerParams().then(b.hitch(this,function(g){b.mixin(d,g);try{if(-1!==this.currentToolSetting.dijitID.indexOf("DeriveNewLocations")||
-1!==this.currentToolSetting.dijitID.indexOf("FindExistingLocations")||-1!==this.currentToolSetting.dijitID.indexOf("FindSimilarLocations"))d.primaryActionButttonClass="esriAnalysisSubmitButton";this.currentAnalysisDijit=new a(d);this.currentAnalysisDijit._setTitleAttr(this.currentToolSetting.toolLabel);this._bindAnalysisEvents(this.currentAnalysisDijit);m.place(this.currentAnalysisDijit.domNode,this.toolPanel,"first");this.currentDijitID=this.currentToolSetting.dijitID;var h;if(1<this.toolCountInList&&
(h=z(".esriAnalysis .esriAnalysisSubmitButton",this.toolPanel)[0],"undefined"!==typeof h)){e.add(h,"multiTool");var k=m.create("div",{"class":"toolpanel-button"}),n=m.create("div",{"class":"jimu-btn",innerHTML:this.nls.back},k);m.place(k,h,"before");m.place(h,k);this.currentAnalysisDijit.own(l(n,"click",b.hitch(this,this._switchToPrevious)))}}catch(p){console.error(p),f.set(this.toolLoadErrorNode,"innerHTML",p),c.set(this.toolLoadErrorNode,"display","")}this.shelter.hide()}))}),b.hitch(this,function(a){f.set(this.toolLoadErrorNode,
"innerHTML",a);c.set(this.toolLoadErrorNode,"display","");this.shelter.hide()}));this._switchView(1)},_prepareLayerParams:function(){var a=new t,c={};"optionalParams"in this.currentToolSetting||"requiredParam"in this.currentToolSetting?this._getLayerObjects().then(b.hitch(this,function(b){var d;"requiredParam"in this.currentToolSetting&&(d=this._prepareLayers(b,this.currentToolSetting.requiredParam.geomTypes),c[this.currentToolSetting.requiredParam.name]=this.currentToolSetting.requiredParam.isArray?
d:0<d.length?d[0]:null);"optionalParams"in this.currentToolSetting&&q.forEach(this.currentToolSetting.optionalParams,function(a){d=this._prepareLayers(b,a.geomTypes);c[a.name]=a.isArray?d:0<d.length?d[0]:null},this);a.resolve(c)})):a.resolve(c);return a},_prepareLayers:function(a,b){var c,d=["point","polyline","polygon"],e=[];"*"!==b[0]&&(d=q.map(b,function(a){return s.getTypeByGeometryType(a)}));q.forEach(a,function(a){"esri.layers.FeatureLayer"===a.declaredClass&&(c=s.getTypeByGeometryType(a.geometryType),
0<=d.indexOf(c)&&(a.url||0<a.graphics.length)&&e.push(a))},this);return e},_getLayerObjects:function(){var a=new t;H.getInstance(this.map,this.map.itemInfo).then(b.hitch(this,function(c){var d=[];c.traversal(function(a){d.push(a);return!1});c=q.map(d,function(a){return a.getLayerObject()});u(c).then(b.hitch(this,function(b){var c=[];q.forEach(b,function(a){a&&c.push(a)});a.resolve(c)}),function(b){a.resolve([])})}));return a},_deactiveDrawTool:function(){if(this.currentAnalysisDijit)if("findHotSpots"===
this.currentToolSetting.title||"calculateDensity"===this.currentToolSetting.title||"traceDownstream"===this.currentToolSetting.title||"interpolatePoints"===this.currentToolSetting.title||"findSimilarLocations"===this.currentToolSetting.title)this.currentAnalysisDijit.clear();else if("planRoutes"===this.currentToolSetting.title||"extractData"===this.currentToolSetting.title)this.currentAnalysisDijit.clear(),this.map.setInfoWindowOnClick(!0)},_bindAnalysisEvents:function(a){this.own(l(a,"start",b.hitch(this,
this._onJobStart)));this.own(l(a,"job-submit",b.hitch(this,this._onJobSubmitted)));this.own(l(a,"job-cancel",b.hitch(this,this._onJobCancelled)));this.own(l(a,"job-fail",b.hitch(this,this._onJobFailed)));this.own(l(a,"job-success",b.hitch(this,this._onJobSucceed)));this.own(l(a,"job-status",b.hitch(this,this._onJobStatusChange)));this.own(l(a,"job-result",b.hitch(this,this._onJobResultData)));this.own(l(a,"drawtool-activate",b.hitch(this,function(){this.map.setInfoWindowOnClick(!1)})));this.own(l(a,
"drawtool-deactivate",b.hitch(this,function(){this.map.setInfoWindowOnClick(!0)})))},_onJobStart:function(){this._clearMessageLogs();this.shelter.show();this._switchView(2)},_onJobSubmitted:function(a){this.shelter.hide();this.outputProperties=null;a.OutputName&&(this.outputProperties=n.parse(a.OutputName,!0));this._appendMessage(this.nls[this.currentToolSetting.title]+" "+this.nls.jobSubmitted);a=m.create("div",{"class":"job-message waiting"},this.messageSection);m.create("img",{"class":"job-running-icon",
src:this.folderUrl+"images/loading.gif"},a)},_onJobCancelled:function(a){a.jobStatus?this._appendMessage(this.nls.jobCancelled+": "+a.jobStatus,"cancelled"):this._appendMessage(this.nls.jobCancelled,"cancelled");this._onJobDone();c.set(this.buttonSection,"display","")},_onJobFailed:function(a){this.shelter.hide();"warning"===a.type?(this.currentAnalysisDijit.set("disableRunAnalysis",!1),this._switchView(1),new d({message:a.message})):(2!==this.currentStack&&(this._clearMessageLogs(),this._switchView(2)),
this._appendMessage(this.nls.jobFailed+": "+(a.analysisReport||a.message),"failed"),this._onJobDone(),c.set(this.buttonSection,"display",""))},_onJobSucceed:function(a){this._appendMessage(this.nls.jobSuccess,"success");this._onJobDone();0<=this.currentToolSetting.dijitID.indexOf("ExtractData")&&(c.set(this.resultSection,"display",""),f.set(this.outputtip,"innerHTML",this.nls.outputSaveInPortal));c.set(this.buttonSection,"display","");c.set(this.resultLoading,"display","")},_onJobDone:function(){z("img.job-executing",
this.messagePanel).forEach(function(a){m.destroy(a)})},_onJobStatusChange:function(a){this.shelter.hide();a.jobId&&a.jobId!==this.currentToolJobId&&(this.currentToolJobId=a.jobId);if(a.jobStatus===B.STATUS_EXECUTING)this._appendExecutingMessage();else switch(a.jobStatus){case B.STATUS_FAILED:case B.STATUS_CANCELLED:case B.STATUS_DELETED:case B.STATUS_TIMED_OUT:this.shelter.hide();"string"===typeof a.message&&this._appendMessage(a.message,"failed");this._onJobDone();c.set(this.buttonSection,"display",
"");break;case B.STATUS_SUCCEEDED:"string"===typeof a.message&&this._appendMessage(a.message),this._onJobDone(),c.set(this.buttonSection,"display","")}},_onJobResultData:function(a){c.set(this.resultLoading,"display","none");f.set(this.outputtip,"innerHTML",this.nls.outputtip);c.set(this.resultSection,"display","");c.set(this.buttonSection,"display","");var b=this._appendResultMessage(a);console.debug("outputLayerName: "+b);if(0>this.currentToolSetting.dijitID.indexOf("ExtractData")){var d;if(a.value.itemId)d=
null,"layerInfo"in a.value&&(d=a.value.layerInfo.popupInfo),this._fetchResultByItemId(b,a.value.itemId,d);else if("layerDefinition"in a.value){var e={title:b?b:"output",fieldInfos:[]};q.forEach(a.value.layerDefinition.fields,function(b){b.name!==a.value.layerDefinition.objectIdField&&e.fieldInfos.push({fieldName:b.name,visible:!0,label:b.alias,isEditable:!1})});d=new F(e);d=new y(a.value,{infoTemplate:d});d.title=b?b:"output";this.map.addLayer(d)}}},_fetchResultByItemId:function(a,c,d){x.getPortal(this._getPortalUrl(G.getUserPortal())).getItemById(c).then(b.hitch(this,
function(e){var f=e.url;w({url:f,content:{f:"json"},handleAs:"json"}).then(b.hitch(this,function(e){var g=e.tables||[],h=e.layers||[];g.reverse();h.reverse();q.forEach(g,function(b){var c=f+"/"+b.id;H.getInstance(this.map,this.map.itemInfo).then(function(d){d.addTable({url:c,title:a+" - "+b.name,options:{outFields:["*"]}})})},this);q.forEach(h,function(a){var e=f+"/"+a.id,g=null;1===h.length&&(g=d);this._buildFeatureLayer(a.name,e,g,c).then(b.hitch(this,function(a){this.map.addLayer(a)}))},this);
e.initialExtent&&this.map.setExtent(new C(e.initialExtent))}))}))},_buildFeatureLayer:function(a,c,d,e){if(null!==d){var f=new t;d.title=a;d=new y(c,{mode:y.MODE_SNAPSHOT,infoTemplate:new F(d),outFields:["*"]});d._itemId=e;f.resolve(d);return f}return w({url:c,content:{f:"json"},handleAs:"json"}).then(b.hitch(this,function(b){var d={title:a,fieldInfos:[]};q.forEach(b.fields,function(a){a.name!==b.objectIdField&&d.fieldInfos.push({fieldName:a.name,visible:!0,label:a.alias,isEditable:!1})});var f=new y(c,
{mode:y.MODE_SNAPSHOT,infoTemplate:new F(d),outFields:["*"]});f._itemId=e;return f}),b.hitch(this,function(){var a=new y(c);a._itemId=e;return a}))},_clearMessageLogs:function(){m.empty(this.messageSection);m.empty(this.outputSection);c.set(this.resultSection,"display","none");c.set(this.buttonSection,"display","none")},_appendMessage:function(a,b){m.create("div",{"class":"job-message "+(b?b:""),innerHTML:a},this.messageSection)},_appendExecutingMessage:function(){z("div.waiting",this.messagePanel).forEach(function(a){m.destroy(a)});
if(0===z("div.job-executing",this.messagePanel).length){var a=m.create("div",{"class":"job-message job-executing"},this.messageSection);m.create("span",{innerHTML:this.nls.executing},a);m.create("img",{"class":"job-running-icon job-executing",src:this.folderUrl+"images/loading.gif"},a);var c=!1;!0===this.currentToolSetting.cannotCancel?c=!0:0<=this.currentToolSetting.dijitID.indexOf("EnrichLayer")&&this.currentAnalysisDijit&&this.currentAnalysisDijit.enableTravelModes&&(c=!0);c||(a=m.create("img",
{"class":"job-cancel-icon job-executing",src:this.folderUrl+"images/cancel.png",title:this.nls.cancelJob},a),this.own(l(a,"click",b.hitch(this,this._cancelTask))))}},_appendResultMessage:function(a){if(a.paramName){var b=a.paramName,c=m.create("div",{"class":"output-item"},this.outputSection);if(a.value&&a.value.itemId){var d=A.getItemDetailsPageUrl(this._getPortalUrl(G.getUserPortal()),a.value.itemId);"object"===typeof this.outputProperties&&a.value.itemId===this.outputProperties.itemProperties.itemId&&
(b=this.outputProperties.serviceProperties.name);m.create("a",{href:d,target:"_blank",innerHTML:b},c)}else f.set(c,"innerHTML",a.paramName);return b}return null},_getPortalUrl:function(a){return a?A.getStandardPortalUrl(a):A.getStandardPortalUrl(this.appConfig.portalUrl)},_cancelTask:function(){this.currentToolJobId&&this.currentAnalysisDijit&&this.currentAnalysisDijit.cancel({jobId:this.currentToolJobId})},_switchToPrevious:function(){2===this.currentStack?this._switchToAnalysisTool():(this._deactiveDrawTool(),
this._switchView(0))},_switchToHome:function(){1<this.toolCountInList?this._switchView(0):this._switchToAnalysisTool()},_switchView:function(a){0===a&&this._checkValidation();this.currentStack=a;this.viewStack.switchView(a)}})});