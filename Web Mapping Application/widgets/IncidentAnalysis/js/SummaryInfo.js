//>>built
define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Color dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-style dojo/number dojo/on dojo/has dijit/form/Button jimu/dijit/Popup esri/config esri/geometry/mathUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/graphic esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query".split(" "),function(l,m,h,r,s,e,g,t,n,p,q,u,v,w,x,y,z,A,B,C,D,E,k){return l("SummaryInfo",
null,{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],constructor:function(a,c,b){this.tab=a;this.container=c;this.parent=b},updateForIncident:function(a,c){this.container.innerHTML="Loading...";0<this.tab.tabLayers.length&&(this.summaryLayer=this.tab.tabLayers[0]);this.summaryFields=this._getFields(this.summaryLayer);this.summaryIds=[];this.summaryFeatures=[];this._queryFeatures(c.geometry)},_queryFeatures:function(a){var c=new k;c.geometry=a;this.summaryLayer.queryIds(c,h.hitch(this,
function(b){this.summaryIds=b;0<this.summaryIds.length?this._queryFeaturesByIds():this._processResults()}))},_queryFeaturesByIds:function(){var a=this.summaryLayer.maxRecordCount||1E3,c=this.summaryIds.slice(0,a);this.summaryIds.splice(0,a);a=new k;a.returnGeometry=!1;var b=[];m.forEach(this.summaryFields,function(a){b.push(a.field)});a.outFields=b;a.objectIds=c;this.summaryLayer.queryFeatures(a,h.hitch(this,function(a){for(var b=a.features,c=0;c<b.length;c++)for(var g=b[c].attributes,e=0;e<this.summaryFields.length;e++){var h=
this.summaryFields[e];h.total+=g[h.field]}this.summaryFeatures=this.summaryFeatures.concat(a.features);this._processResults();0<this.summaryIds.length&&this._queryFeaturesByIds()}))},_processResults:function(){this.container.innerHTML="";var a=this.summaryFields,c=g.create("div",{id:"tpc",style:"width:"+220*(a.length+1)+"px;"},this.container);e.add(c,"IMT_tabPanelContent");var b=g.create("div",{},c);e.add(b,"IMTcol");b=g.create("div",{innerHTML:this.parent.nls.downloadCSV},b);e.add(b,"btnExport");
p(b,"click",h.hitch(this,this._exportToCSV));for(b=0;b<a.length;b++){var f=a[b],d=f.alias+"\x3cbr/\x3e",f=Math.round(f.total);isNaN(f)&&(f=0);d+="\x3cdiv class\x3d'colSummary'\x3e"+n.format(f)+"\x3c/div\x3e\x3cbr/\x3e";d=g.create("div",{id:"Demographics_"+b,innerHTML:d},c);e.add(d,"IMTcol")}},_exportToCSV:function(){if(0===this.summaryFeatures.length)return!1;var a="",c,b,f=this.summaryFeatures;c=f[0].attributes;for(b in c)a+=(0===a.length?"":",")+'"'+b+'"';for(var a=a+"\r\n",d="",e=0;e<f.length;e++){d=
"";c=f[e].attributes;for(b in c)d+=(0===d.length?"":",")+'"'+c[b]+'"';a+=d+"\r\n"}this._download(this.tab.tabLayers[0].id+".csv",a)},_download:function(a,c){if(q("ie")){var b=window.open("about:blank","_blank");b.document.write(c);b.document.close();b.document.execCommand("SaveAs",!0,a);b.close()}else b=g.create("a",{href:"data:text/plain;charset\x3dutf-8,"+encodeURIComponent(c),download:a}),b.click(),g.destroy(b)},_getFields:function(a){for(var c=[],b=a.infoTemplate.info.fieldInfos,f=0;f<b.length;f++){var d=
b[f],e=a.fields[f].type;d.visible&&(d.fieldName!==a.objectIdField&&("esriFieldTypeDouble"===e||"esriFieldTypeInteger"===e))&&c.push({field:d.fieldName,alias:d.label,total:0})}return c}})});