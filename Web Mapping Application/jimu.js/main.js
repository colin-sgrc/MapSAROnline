//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils esri/config esri/tasks/GeometryService".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m,p,s){function r(a){var c=e.clone(a),d=b.widgetProperties;delete c.mode;b.visitElement(c,function(a,g){a.widgets?(delete a.isOnScreen,delete a.gid,"jimu.js/images/group_icon.png"===a.icon&&
delete a.icon,delete a.openType,g.isOnScreen&&a.panel&&b.isEqual(a.panel,c.widgetOnScreen.panel)&&delete a.panel):(a.icon&&a.icon===a.amdFolder+"images/icon.png"&&delete a.icon,delete a.panel,delete a.folderUrl,delete a.amdFolder,delete a.thumbnail,delete a.configFile,delete a.gid,delete a.isOnScreen,d.forEach(function(b){delete a[b]}),a.visible&&delete a.visible,delete a.manifest)});delete c.rawAppConfig;delete c._ssl;delete c.getConfigElementById;delete c.getConfigElementsByName;delete c.processNoUriWidgets;
delete c.addElementId;delete c.getCleanConfig;delete c.visitElement;delete c.agolConfig;delete c._itemData;delete c.oldWabVersion;return c}var q=null,t;t=l(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(b){this.urlParams=b||{};this.listenBuilderEvents();this.versionManager=new a;this.widgetManager=c.getInstance();this.configLoader=g.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&(window.parent.setConfigViewerTopic&&
e.isFunction(window.parent.setConfigViewerTopic))&&window.parent.setConfigViewerTopic(d);"preview"===this.urlParams.mode&&(window.parent.setPreviewViewerTopic&&e.isFunction(window.parent.setPreviewViewerTopic))&&window.parent.setPreviewViewerTopic(d);n(window,"resize",e.hitch(this,this._onWindowResize))},listenBuilderEvents:function(){d.subscribe("builder/widgetChanged",e.hitch(this,this._onWidgetChanged));d.subscribe("builder/groupChanged",e.hitch(this,this._onGroupChanged));d.subscribe("builder/widgetPoolChanged",
e.hitch(this,this._onWidgetPoolChanged));d.subscribe("builder/openAtStartChange",e.hitch(this,this._onOpenAtStartChanged));d.subscribe("builder/mapChanged",e.hitch(this,this._onMapChanged));d.subscribe("builder/mapOptionsChanged",e.hitch(this,this._onMapOptionsChanged));d.subscribe("builder/appAttributeChanged",e.hitch(this,this._onAppAttributeChanged));d.subscribe("builder/setAppConfig",e.hitch(this,this._onAppConfigSet));d.subscribe("builder/themeChanged",e.hitch(this,this._onThemeChanged));d.subscribe("builder/layoutChanged",
e.hitch(this,this._onLayoutChanged));d.subscribe("builder/styleChanged",e.hitch(this,this._onStyleChanged));d.subscribe("builder/syncExtent",e.hitch(this,this._onSyncExtent));d.subscribe("builder/loadingPageChanged",e.hitch(this,this._onLoadingPageChanged));d.subscribe("builder/templateConfigChanged",e.hitch(this,this._onTemplateConfigChanged))},loadConfig:function(){if(!("preview"===this.urlParams.mode||"config"===this.urlParams.mode))return this.configLoader.loadConfig().then(e.hitch(this,function(b){this.portalSelf=
this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(b);window.appInfo.isRunInMobile=this._isRunInMobile();console.timeEnd("Load Config");b=this.getAppConfig();d.publish("appConfigLoaded",b);return b}),e.hitch(this,function(b){console.error(b);b&&(b.message&&"string"===typeof b.message)&&this._showErrorMessage(b.message)}))},_showErrorMessage:function(b){h.create("div",{"class":"create-map-error",innerHTML:"Unable to create map: "+b},document.body)},getAppConfig:function(){var a;window.appInfo.isRunInMobile?
(console.log("Switch to mobile mode."),a=e.clone(this._getMobileConfig(this.appConfig)),a._originConfig=e.clone(this.appConfig)):(console.log("Switch to desktop mode."),a=e.clone(this.appConfig));a.getConfigElementById=function(a){return b.getConfigElementById(this,a)};a.getConfigElementByLabel=function(a){return b.getConfigElementByLabel(this,a)};a.getConfigElementsByName=function(a){return b.getConfigElementsByName(this,a)};a.getCleanConfig=function(){return this._originConfig?r(this._originConfig):
r(this)};a.visitElement=function(a){b.visitElement(this,a)};return a},_onWindowResize:function(){var b=this._isRunInMobile();window.appInfo.isRunInMobile!==b&&(window.appInfo.isRunInMobile=b,this.appConfig&&d.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var b=h.getMarginBox(window.jimuConfig.layoutId);if(b.w<=window.jimuConfig.breakPoints[0]||b.h<=window.jimuConfig.breakPoints[0])return h.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;h.removeClass(window.jimuConfig.layoutId,
"jimu-ismobile");return!1},_getMobileConfig:function(a){return b.mixinAppConfigPosition(a,a.mobileLayout)},_onWidgetChanged:function(a){var c=b.reCreateObject(a);a=b.getConfigElementById(this.appConfig,a.id);!1===c.inPanel&&!a.uri&&(c.closeable=!0);for(var g in c)a[g]=c[g];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetChange",c)},_onGroupChanged:function(a){var c=b.reCreateObject(a);a=b.getConfigElementById(this.appConfig,
a.id);for(var g in c)a[g]=c[g];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"groupChange",c)},_onWidgetPoolChanged:function(a){a=b.reCreateObject(a);if(1===this.widgetManager.getControllerWidgets().length)this.appConfig.widgetPool.widgets=a.widgets,this.appConfig.widgetPool.groups=a.groups;else{var c=b.getConfigElementById(this.appConfig,a.controllerId);f.forEach(c.controlledWidgets,function(b){this._removeWidgetOrGroupFromPoolById(this.appConfig,
b)},this);f.forEach(c.controlledGroups,function(b){this._removeWidgetOrGroupFromPoolById(this.appConfig,b)},this);this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?a.widgets:this.appConfig.widgetPool.widgets.concat(a.widgets);this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?a.groups:this.appConfig.widgetPool.groups.concat(a.groups);this.configLoader.addNeedValues(this.appConfig);c.controlledWidgets=f.map(a.widgets,function(b){return b.id});
c.controlledGroups=f.map(a.groups,function(b){return b.id})}this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",a)},_removeWidgetOrGroupFromPoolById:function(b,a){f.some(b.widgetPool.widgets,function(c,d){if(c.id===a)return b.widgetPool.widgets.splice(d,1),!0});f.some(b.widgetPool.groups,function(c,d){if(c.id===a)return b.widgetPool.groups.splice(d,1),!0})},_onOpenAtStartChanged:function(a){var c=
b.reCreateObject(a),g=this.appConfig;a.isOnScreen?(g=g.widgetOnScreen&&g.widgetOnScreen.widgets)&&0<g.length&&f.forEach(g,e.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})):((g=g.widgetPool)&&(g.groups&&0<g.groups.length)&&f.forEach(g.groups,e.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})),g&&(g.widgets&&0<g.widgets.length)&&f.forEach(g.widgets,e.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})));
d.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",c)},_onAppAttributeChanged:function(a){a=b.reCreateObject(a);e.mixin(this.appConfig,a);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"attributeChange",a)},_onLoadingPageChanged:function(a){a=b.reCreateObject(a);var c;"backgroundColor"in a?this.appConfig.loadingPage.backgroundColor=a.backgroundColor:
"backgroundImage"in a?(c=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=e.mixin(c,a.backgroundImage)):"loadingGif"in a&&(c=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=e.mixin(c,a.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",a)},_onTemplateConfigChanged:function(a){a=b.reCreateObject(a);this.appConfig.templateConfig=
a;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",a)},_onMapChanged:function(a){a=b.reCreateObject(a);a.itemId&&a.itemId!==this.appConfig.map.itemId&&this.appConfig.map.mapOptions&&b.deleteMapOptions(this.appConfig.map.mapOptions);e.mixin(this.appConfig.map,a);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),
"mapChange",a)},_onMapOptionsChanged:function(a){a=b.reCreateObject(a);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});e.mixin(this.appConfig.map.mapOptions,a);d.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",a)},_onThemeChanged:function(a){this._getAppConfigFromTheme(a).then(e.hitch(this,function(b){this.appConfig=b;d.publish("appConfigChanged",this.getAppConfig(),"themeChange",a.getName())}))},_onLayoutChanged:function(a){this.appConfig=b.mixinAppConfigPosition(this.appConfig,
a.layoutConfig);this._addDefaultPanelAndPosition(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"layoutChange",a.name)},_onStyleChanged:function(a){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,a.name);d.publish("appConfigChanged",this.getAppConfig(),"styleChange",a.name)},_onSyncExtent:function(a){d.publish("syncExtent",a)},_genStyles:function(a,b){var c=[];c.push(b);f.forEach(a,function(a){0>c.indexOf(a)&&c.push(a)});return c},_getAppConfigFromTheme:function(a){var b=
new k,c,g=[],g=this.getAppConfig().getCleanConfig();g.mode=this.urlParams.mode;f.forEach(g.widgetPool.groups,function(a){delete a.panel},this);if(a.appConfig)c=e.clone(a.appConfig),c.map=g.map,c.map.position=a.appConfig.map.position,this._copyPoolToThemePool(g,c),g.links&&(c.links=g.links);else{var d=a.getCurrentLayout(),m=a.getCurrentStyle();c=e.clone(g);d=e.clone(d.layoutConfig);c.widgetOnScreen=d.widgetOnScreen;d.widgetPool&&(f.forEach(d.widgetPool.widgets,function(a){a.isPreconfiguredInTheme=
!0}),f.forEach(d.widgetPool.groups,function(a){a.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(g,d);c.widgetPool=d.widgetPool;d.map&&d.map.position&&(c.map.position=d.map.position);c.mobileLayout=d.mobileLayout;g=this._genStyles(f.map(a.getStyles(),function(a){return a.name}),m.name);c.theme={name:a.getName(),styles:g,version:a.getVersion()}}this.configLoader.addNeedValues(c);this.configLoader.loadWidgetsManifest(c).then(e.hitch(this,function(){this._addDefaultValues(c);b.resolve(c)}));return b},
_copyPoolToThemePool:function(a,b){var c=a.widgetPool;b.widgetPool||(b.widgetPool={});var d=b.widgetPool,g=f.filter(d.widgets,function(a){if(a.isPreconfiguredInTheme||!f.some(c.widgets,function(b){return b.name===a.name}))return!0}),m=f.filter(d.groups,function(a){return a.isPreconfiguredInTheme}),r=f.filter(c.widgets,function(a){return!a.isPreconfiguredInTheme}),q=f.filter(c.groups,function(a){return!a.isPreconfiguredInTheme}),r=this._getPoolWidgetsWithoutDuplicated(r,b.widgetOnScreen.widgets||[]);
d.widgets=r.concat(g);d.groups=q.concat(m)},_getPoolWidgetsWithoutDuplicated:function(a,c){for(var d=e.clone(a),g=a.length-1;0<=g;g--)for(var m=c.length-1;0<=m;m--)if(c[m].uri){var r=c[m].name;r||(r=b.getWidgetNameFromUri(c[m].uri));var q=a[g].id,q=this.getAppConfig().getConfigElementById(q);a[g]&&(a[g].name===r&&!1===q.supportMultiInstance)&&(console.log("Widget",a[g].name,"is not copied to new theme because this widget exists in new theme."),d.splice(g,1))}return d},_onAppConfigSet:function(a){a=
b.reCreateObject(a);window.appInfo.isRunInMobile=this._isRunInMobile();this.configLoader.processProxy(a);this.configLoader.addNeedValues(a);this._addDefaultValues(a);m.setPortalUrl(a.portalUrl);this.appConfig?(a.map.itemId&&a.map.itemId!==this.appConfig.map.itemId&&b.deleteMapOptions(a.map.mapOptions),this.appConfig=a,d.publish("appConfigChanged",this.getAppConfig(),"resetConfig",a)):(this.appConfig=a,d.publish("appConfigLoaded",this.getAppConfig()))},_addDefaultValues:function(a){this._addDefaultPortalUrl(a);
this._addDefaultGeometryService(a);this._addDefaultStyle(a);this._addDefaultMap(a);this._addDefaultVisible(a);"undefined"===typeof a.widgetOnScreen&&(a.widgetOnScreen={});"undefined"===typeof a.widgetPool&&(a.widgetPool={});this._addDefaultPanelAndPosition(a);this._addDefaultOfWidgetGroup(a);(a.widgetPool.widgets&&0<a.widgetPool.widgets.length&&void 0===a.widgetPool.widgets[0].index||a.widgetPool.groups&&0<a.widgetPool.groups.length&&void 0===a.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(a);
return a},_addDefaultPortalUrl:function(a){"undefined"===typeof a.portalUrl&&(a.portalUrl="http://www.arcgis.com/");a.portalUrl&&"/"!==a.portalUrl.substr(a.portalUrl.length-1)&&(a.portalUrl+="/")},_addDefaultGeometryService:function(a){var b=a&&a.geometryService,b=b&&"string"===typeof b&&e.trim(b)?e.trim(b):this.portalSelf.helperServices.geometry.url;a.geometryService=b;p.defaults.geometryService=new s(a.geometryService)},_addDefaultStyle:function(a){if(a.theme&&(!a.theme.styles||0===a.theme.styles.length))a.theme.styles=
["default"]},_addDefaultMap:function(a){a.map.id="map";"undefined"===typeof a.map["3D"]&&"undefined"===typeof a.map["2D"]&&(a.map["2D"]=!0);"undefined"===typeof a.map.position&&(a.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof a.map.portalUrl&&(a.map.portalUrl=a.portalUrl)},_addDefaultVisible:function(a){b.visitElement(a,function(a){void 0===a.visible&&(a.visible=!0)})},_addDefaultPanelAndPosition:function(a){this._addOnScreenDefaultPanelAndPosition(a);this._addPoolDefaultPanelAndPosition(a)},
_addOnScreenDefaultPanelAndPosition:function(a){var b,c;if(a=a.widgetOnScreen){b=a.panel&&a.panel.positionRelativeTo?a.panel.positionRelativeTo:"map";"undefined"===typeof a.panel||"undefined"===typeof a.panel.uri?a.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof a.panel.position?a.panel.position={relativeTo:b}:"undefined"===typeof a.panel.position.relativeTo&&(a.panel.position.relativeTo=b);if(a.widgets)for(b=0;b<a.widgets.length;b++)a.widgets[b].position||(a.widgets[b].position=
{}),a.widgets[b].position.relativeTo||(a.widgets[b].position.relativeTo=a.widgets[b]&&a.widgets[b].positionRelativeTo?a.widgets[b].positionRelativeTo:"map"),!0===a.widgets[b].inPanel&&!a.widgets[b].panel&&(a.widgets[b].panel=e.clone(a.panel),a.widgets[b].panel.position=a.widgets[b].position,a.widgets[b].panel.position.relativeTo=a.widgets[b].position.relativeTo);if(a.groups)for(b=0;b<a.groups.length;b++){a.groups[b].panel||(a.groups[b].panel=a.panel);a.groups[b].panel&&!a.groups[b].panel.position&&
(a.groups[b].panel.position={});a.groups[b].panel.position.relativeTo||(a.groups[b].panel.position.relativeTo=a.groups[b].panel.positionRelativeTo?a.groups[b].panel.positionRelativeTo:"map");a.groups[b].widgets||(a.groups[b].widgets=[]);for(c=0;c<a.groups[b].widgets.length;c++)a.groups[b].widgets[c].panel=a.groups[b].panel}}},_addPoolDefaultPanelAndPosition:function(a){var b,c,g=a.widgetPool;if(g){b=g.panel&&g.panel.positionRelativeTo?g.panel.positionRelativeTo:"map";"undefined"===typeof g.panel||
"undefined"===typeof g.panel.uri?g.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof g.panel.position?g.panel.position={relativeTo:b}:"undefined"===typeof g.panel.position.relativeTo&&(g.panel.position.relativeTo=b);if(g.groups)for(b=0;b<g.groups.length;b++){g.groups[b].panel?g.groups[b].panel.position.relativeTo||(g.groups[b].panel.position.relativeTo=g.groups[b].panel.positionRelativeTo?g.groups[b].panel.positionRelativeTo:"map"):g.groups[b].panel=g.panel;g.groups[b].widgets||
(g.groups[b].widgets=[]);for(c=0;c<g.groups[b].widgets.length;c++)g.groups[b].widgets[c].panel=g.groups[b].panel}if(g.widgets)for(b=0;b<g.widgets.length;b++)!1===g.widgets[b].inPanel?(c=g.widgets[b].positionRelativeTo?g.widgets[b].positionRelativeTo:"map",g.widgets[b].position?g.widgets[b].position.relativeTo||(g.widgets[b].position.relativeTo=c):g.widgets[b].position={relativeTo:c}):g.widgets[b].panel||(g.widgets[b].panel=a.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(a){b.visitElement(a,
e.hitch(this,function(a,c){a.isOnScreen=c.isOnScreen;a.widgets?(a.gid=a.id,1===a.widgets.length?(a.label||(a.label=a.widgets[0].label?a.widgets[0].label:"Group"),a.icon||(a.icon=a.widgets[0].uri?this._getDefaultIconFromUri(a.widgets[0].uri):"jimu.js/images/group_icon.png")):(a.icon=a.icon?a.icon:"jimu.js/images/group_icon.png",a.label=a.label?a.label:"Group_"+c.index)):(a.gid=c.groupId,a.uri&&b.processWidgetSetting(a))}))},_getDefaultIconFromUri:function(a){a=a.split("/");a.pop();return a.join("/")+
"/images/icon.png"},_addIndexForWidgetPool:function(a){var b=0,c,g;if(a.widgetPool.widgets)for(c=0;c<a.widgetPool.widgets.length;c++)a.widgetPool.widgets[c].index=b,b++;if(a.widgetPool.groups)for(c=0;c<a.widgetPool.groups.length;c++){a.widgetPool.groups[c].index=b;b++;for(g=0;g<a.widgetPool.groups[c].widgets.length;g++)a.widgetPool.groups[c].widgets[g].index=g}}});t.getInstance=function(a){null===q?q=new t(a):a&&(q.urlParams=a);window.getAppConfig=e.hitch(q,q.getAppConfig);return q};return t})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale esri/arcgis/utils esri/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/urlUtils esri/request jimu/portalUrlUtils ./shared/utils".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w,v,x,B,D,C,F,z,A){function E(a,b){var c=a.match(/url\([^)]+\)/gi),g,d;if(null===c||""===b)return a;for(g=0;g<c.length;g++)if(d=c[g].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=d.length){var m=d[2];b.endWith("/")||(b+="/");a=a.replace(d[1]+m+d[3],d[1]+b+m+d[3])}return a}function H(a,b){var c=Array.isArray(b),g=c&&[]||{};c?(a=a||[],g=g.concat(a),b.forEach(function(b,c){"undefined"===typeof a[c]?g[c]=b:"object"===typeof b?g[c]=H(a[c],b):-1===a.indexOf(b)&&
g.push(b)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(b){g[b]=a[b]}),Object.keys(b).forEach(function(c){g[c]="object"!==typeof b[c]||!b[c]?b[c]:a[c]?H(a[c],b[c]):b[c]}));return g}function K(a){var b,c={};b=a.indexOf("/");a.substring(0,b);a=a.substring(0,a.lastIndexOf("/")+1);c.folderUrl=require(y.getRequireConfig()).toUrl(a);c.amdFolder=a;return c}function O(a){a.panels.forEach(function(a){a.uri="panels/"+a.name+"/Panel.js"});a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});
a.layouts.forEach(function(a){a.uri="layouts/"+a.name+"/config.json";a.icon="layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+a.name+"/icon_rtl.png"})}function G(a,b,c){b=function(a){var b=[];a.split("_").forEach(function(a){var c=!1,g;"--"===a.slice(a.length-2)&&(c=!0,a=a.slice(0,a.length-2));g=a.search(/\[[0-9]+\]/);-1===g&&(g=a.length);b.push({key:a.slice(0,g),index:Number(a.slice(g+1,-1)),deleteFlag:c})});return b}(b);for(var g=1;g<b.length-1;g++)if(a=l.isArray(a[b[g].key])?a[b[g].key][b[g].index]:
a[b[g].key],!a)return;if(b[b.length-1].deleteFlag)!0===c&&(l.isArray(a[b[b.length-1].key])?delete a[b[b.length-1].key][b[b.length-1].index]:delete a[b[b.length-1].key]);else if(l.isArray(a[b[b.length-1].key])){if(void 0===c)return a[b[b.length-1].key][b[b.length-1].index];a[b[b.length-1].key][b[b.length-1].index]=c}else{if(void 0===c)return a[b[b.length-1].key];a[b[b.length-1].key]=c}}function J(a,b,c){function g(c){c=y.template.getSearchRange(b,c,"]");var d=b.slice(c.firstPos,c.lastPos);return-1!==
c.firstPos?(d=b.slice(c.firstPos+d.indexOf("[")+1,c.lastPos-1),c=b.slice(c.lastPos+1),(d=y.getConfigElementById(a,d))?{object:d,key:"section_"+c,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var d=a,m=b=b.replace(/\//g,"_"),r=g("groups\\[.+\\]");if("deleted"!==r.state&&("isSection"===r.state&&(d=r.object,m=r.key),r=g("widgets\\[.+\\]"),"delete"!==r.state))return"isSection"===r.state&&(d=r.object,m=r.key),G(d,m,c)}var y={},L={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};
l.mixin(y,A);var M=[];require.on("error",function(a){e.forEach(M,function(b){a.info[0]&&-1<a.info[0].indexOf(b.resKey)&&b.def.reject(a);for(var c in a.info)-1<c.indexOf(b.resKey)&&b.def.reject(a)})});y.checkError=function(a,b){M.push({resKey:a,def:b})};y.replacePlaceHolder=function(a,b){var c=g.stringify(a),d=c.match(/\$\{(\w)+\}/g),m;if(null===d)return a;for(m=0;m<d.length;m++){var r=d[m].match(/(\w)+/g)[0];b[r]&&(c=c.replace(d[m],b[r]))}return g.parse(c)};y.changeUnit=function(a){var b=Math.abs(a),
c;a=Math.floor(b);c=Math.floor(60*(b-a));b=(60*(60*(b-a)-c)).toFixed(2);return a+"\u00b0"+(10>c?"0"+c:c)+"'"+(10>b?"0"+b:b)+'"'};y.formatTime=function(a){var b=a/1E3;a=Math.floor(b/60);b=Number(b-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};y.parseTime=function(a){var b=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!b.test(a))return console.log("wrong time format."),-1;a=a.match(b);return 1E3*(60*parseInt(a[1],10)+parseInt(a[2],10)+parseInt(a[3],10)/10)};y.preloadImg=function(a,b){var c=[],c="string"===
typeof a?[a]:a;e.forEach(c,function(a){(new Image).src=b?b+a:a})};y.getPositionStyle=function(a){var b={};if(!a)return b;a=l.clone(a);if(window.isRTL){var c;"undefined"!==typeof a.left&&"undefined"!==typeof a.right?(c=a.left,a.left=a.right,a.right=c):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?(c=a.paddingLeft,a.paddingLeft=a.paddingRight,a.paddingRight=
c):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight)}c="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom".split(" ");for(var g=0;g<c.length;g++){var d=c[g];"number"===typeof a[d]?b[d]=a[d]+"px":"undefined"!==typeof a[d]?b[d]=a[d]:"padding"===d.substr(0,7)?b[d]=0:b[d]="auto"}b.zIndex="undefined"===typeof a.zIndex?"auto":a.zIndex;
return b};y.isEqual=function(a,b){function c(a,b){var m;if(isNaN(a)&&isNaN(b)&&"number"===typeof a&&"number"===typeof b||a===b)return!0;if("function"===typeof a&&"function"===typeof b||a instanceof Date&&b instanceof Date||a instanceof RegExp&&b instanceof RegExp||a instanceof String&&b instanceof String||a instanceof Number&&b instanceof Number)return a.toString()===b.toString();if(-1<g.indexOf(a)||-1<d.indexOf(b))return!1;if(null!==b){for(m in b)if(b.hasOwnProperty(m)!==a.hasOwnProperty(m)||typeof b[m]!==
typeof a[m])return!1;for(m in a){if(b.hasOwnProperty(m)!==a.hasOwnProperty(m)||typeof b[m]!==typeof a[m])return!1;switch(typeof a[m]){case "object":case "function":g.push(a);d.push(b);if(!c(a[m],b[m]))return!1;g.pop();d.pop();break;default:if(a[m]!==b[m])return!1}}}return!0}var g,d;g=[];d=[];return!c(a,b)?!1:!0};y.file={supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return h("safari")&&6>h("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?
!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(b){a=null}else navigator.plugins&&0<navigator.plugins.length&&(a=navigator.plugins["Shockwave Flash"]);return!!a},containSeparator:function(a){return 0<=a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var b="",b=0<=a.indexOf("/")?"/":"\\";a=a.split(b);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-y.file.getNameFromPath(a).length)},
readFile:function(a,b,c,g){if(this.supportHTML5()){var d=a.target.files[0];d&&(d.type.match(b)?d.size>=c?g({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){g(null,d.name,a.target.result)},a.readAsDataURL(d)):g({errCode:"invalidType"}))}else if(this.supportFileAPI()){var m=window.FileAPI.getFiles(a);m[0].type.match(b)?m[0].size>=c?g({errCode:"exceed"}):window.FileAPI.readAsDataURL(m[0],function(a){a&&a.result?g(null,m[0].name,a.result):g({errCode:"readError"})}):g({errCode:"invalidType"})}}};
y.processWidgetSetting=function(a){if(!a.uri)return a;l.mixin(a,K(a.uri));a.icon||(a.icon=a.amdFolder+"images/icon.png");a.thumbnail||(a.thumbnail=a.amdFolder+"images/thumbnail.png");return a};y.getRequireConfig=function(){if(jimuConfig){var a=[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};y.getTypeByGeometryType=function(a){var b=
"",c="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),g=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(a)?b="point":0<=c.indexOf(a)?b="polyline":0<=g.indexOf(a)&&(b="polygon");return b};y.getSymbolTypeByGeometryType=function(a){var b=null;a=y.getTypeByGeometryType(a);"point"===a?b="marker":"polyline"===a?b="line":"polygon"===a&&(b=
"fill");return b};y.getServices=function(){return L};y.getArcGISDefaultGeometryService=function(){return new B(L.geometryService)};y.restoreToDefaultWebMapExtent=function(a,b,g){var d=new c;if(!(a&&"esri.Map"===a.declaredClass))return setTimeout(function(){d.reject("Invalid map.")},0),d;b=b&&b.itemInfo;if(!b)return setTimeout(function(){d.reject("Invalid itemInfo")},0),d;b=b.item&&b.item.extent;if(!b)return setTimeout(function(){d.reject("Invalid itemInfo.item.extent")}),d;var m=new q({wkid:4326}),
m=new t(b[0][0],b[0][1],b[1][0],b[1][1],m);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(m);if(a.spatialReference.isWebMercator())return m=x.geographicToWebMercator(m),a.setExtent(m);b=new D;b.geometries=[m];b.outSR=a.spatialReference;m=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;m&&"esri.tasks.GeometryService"===m.declaredClass||(g&&"string"===typeof g&&l.trim(g)?(g=l.trim(g),m=new B(g)):m=y.getArcGISDefaultGeometryService());m.project(b).then(function(b){if(b=
b&&b[0])return a.setExtent(b);d.reject("Invalid projected geometry.");return d},function(a){console.error(a);d.reject(a);return d});return d};y.getAncestorWindow=function(){for(var a=window;a&&a.parent&&a!==a.parent;)a=a.parent;return a};y.getAncestorDom=function(a,b,c){if(a&&1===a.nodeType&&b&&"function"===typeof b){var g=100,d=document.body;c&&("number"===typeof c?(c=parseInt(c,10),0<c&&(g=c)):1===c.nodeType&&(d=c));for(c=0;a.parentNode&&c<g&&f.isDescendant(a.parentNode,d);){if(b(a.parentNode))return a.parentNode;
a=a.parentNode;c++}}return null};y.bindClickAndDblclickEvents=function(b,c,g,d){var m=null;if(b&&1===b.nodeType&&c&&"function"===typeof c&&g&&"function"===typeof g){var r=200;d&&"number"===typeof d&&(d=parseInt(d,10),0<d&&(r=d));var q=0,m=a(b,"click",function(a){q++;1===q?setTimeout(function(){1===q&&(q=0,c(a))},r):2===q&&(q=0,g(a))})}return m};y.isScrollToBottom=function(a){var b=f.getContentBox(a);return 0===a.scrollHeight-(a.scrollTop+b.h)};y.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map",
"Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service","Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));
return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer","Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};y.getItemQueryStringByTypes=function(a){var b=
"",c=y.getAllItemTypes();if(a&&0<a.length&&0<a.length){var g="";e.forEach(a,function(b,c){g+=' type:"'+b+'" ';c!==a.length-1&&(g+=" OR ")});b=" ( "+g+" ) ";c=a.concat(c);c=e.filter(c,function(b){return e.every(a,function(a){return 0>a.toLowerCase().indexOf(b.toLowerCase())})});e.forEach(c,function(a){b+=' -type:"'+a+'" '})}return b};y.getItemQueryStringByTypeKeywords=function(a){var b="";a&&0<a.length&&(b=' typekeywords:"'+a.join(",")+'" ');return b};y.isNotEmptyString=function(a,b){var c=a&&"string"===
typeof a;return c?b?c&&l.trim(a):!0:!1};y.isValidNumber=function(a){return"number"===typeof a&&!isNaN(a)};y.isObject=function(a){return a&&"object"===typeof a};y.createWebMap=function(a,b,c,g){a=z.getStandardPortalUrl(a);a=z.getBaseItemUrl(a);r.arcgisUrl=a;return r.createMap(b,c,g)};y.getRandomString=function(){var a=Math.random().toString();return a=a.slice(2,a.length)};y._getDomainsByServerName=function(a){var b=a.split("."),c=b.length;return e.map(b,l.hitch(this,function(a,g){var d=b.slice(g,c),
m="",r=d.length-1;e.forEach(d,l.hitch(this,function(a,b){m+=a;b!==r&&(m+=".")}));return m}))};y.removeCookie=function(a,b){var c=this._getDomainsByServerName(window.location.hostname);e.forEach(c,l.hitch(this,function(c){m(a,null,{expires:-1,path:b});m(a,null,{expires:-1,path:b,domain:c});m(a,null,{expires:-1,path:b,domain:"."+c})}))};y.isLocaleChanged=function(a,b){return!a.startWith(b)};y.hashToObject=function(a){a=a.replace("#","");a=k.queryToObject(a);for(var b in a)if(a.hasOwnProperty(b))try{a[b]=
g.parse(a[b])}catch(c){}return a};y.reCreateObject=function(a){function b(a){var g=[];a.forEach(function(a){Array.isArray(a)?g.push(b(a)):"object"===typeof a?g.push(c(a)):g.push(a)});return g}function c(a){var g={},d;for(d in a)a.hasOwnProperty(d)&&(null===a[d]?g[d]=null:Array.isArray(a[d])?g[d]=b(a[d]):g[d]="object"===typeof a[d]?c(a[d]):a[d]);return g}return Array.isArray(a)?b(a):c(a)};y.setVerticalCenter=function(a){setTimeout(function(){var b=n(".jimu-vcenter-text",a),c,g;e.forEach(b,function(a){c=
f.getContentBox(a).h;f.setStyle(a,{lineHeight:c+"px"})},this);b=n(".jimu-vcenter",a);e.forEach(b,function(a){c=f.getContentBox(a).h;g=f.getContentBox(n(a).parent()[0]).h;f.setStyle(a,{marginTop:(g-c)/2+"px"})},this)},10)};y.merge=H;y.loadStyleLink=function(b,g,d){var m=new c,r,q=require(y.getRequireConfig()).toUrl(g);if(require.cache["url:"+q]){r=require.cache["url:"+q];var p=q.split("/").pop(),q=q.substr(0,q.length-p.length);r=E(r,q);b=d?f.create("style",{id:b,type:"text/css"},f.byId(d),"before"):
f.create("style",{id:b,type:"text/css"},document.getElementsByTagName("head")[0]);b.styleSheet&&!b.sheet?b.styleSheet.cssText=r:b.appendChild(f.toDom(r));m.resolve("load");return m}r=d?f.create("link",{id:b,rel:"stylesheet",type:"text/css",href:q},f.byId(d),"before"):f.create("link",{id:b,rel:"stylesheet",type:"text/css",href:q},document.getElementsByTagName("head")[0]);a(r,"load",function(){m.resolve("load")});var k=setInterval(function(){var a;if(e.some(document.styleSheets,function(b){if(b.href&&
b.href.substr(b.href.indexOf(g),b.href.length)===g)return a=b,!0}))try{!m.isFulfilled()&&(a.cssRules&&a.cssRules.length||a.rules&&a.rules.length)&&m.resolve("load"),clearInterval(k)}catch(b){}},50);return m};y.changeLocation=function(a){window.history.pushState&&window.history.pushState({path:a},"",a)};y.urlToObject=function(a){var b=null;-1===a.indexOf("#")?(b=C.urlToObject(a),b.hash=null):(a=a.split("#"),b=C.urlToObject(a[0]),b.hash=a[1]?-1<a[1].indexOf("\x3d")?k.queryToObject(a[1]):a[1]:null);
return b};y.addManifestProperies=function(a){a.icon=a.url+"images/icon.png";"theme"===a.category?O(a):("undefined"!==typeof a["2D"]&&(a.support2D=a["2D"]),"undefined"!==typeof a["3D"]&&(a.support3D=a["3D"]),"undefined"===typeof a["2D"]&&"undefined"===typeof a["3D"]&&(a.support2D=!0),delete a["2D"],delete a["3D"],"undefined"===typeof a.properties&&(a.properties={}),A.processWidgetProperties(a))};y.getUniqueValues=function(a,b){var d=new c,m=a.replace(/\/*$/g,"")+"/generateRenderer",r=g.stringify({type:"uniqueValueDef",
uniqueValueFields:[b]});F({url:m,content:{classificationDef:r,f:"json"},handleAs:"json",callbackParamName:"callback"}).then(l.hitch(this,function(a){var b=[];(a=a&&a.uniqueValueInfos)&&0<a.length&&(b=e.map(a,l.hitch(this,function(a){return a.value})));d.resolve(b)}),l.hitch(this,function(a){d.reject(a)}));return d};y.combineRadioCheckBoxWithLabel=function(a,b){var c=!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var g=a.getAttribute("type")||"",g=g.toLowerCase();if("radio"===g||"checkbox"===
g)c=!0}g=!1;b&&(1===b.nodeType&&"label"===b.tagName.toLowerCase())&&(g=!0);c&&g&&(c=a.getAttribute("id"),c||(c="input_"+y.getRandomString(),a.setAttribute("id",c)),b.setAttribute("for",c),f.setStyle(b,"cursor","pointer"))};y.convertExtentToPolygon=function(a){var b=a.xmin,c=a.xmax,g=a.ymin,d=a.ymax;return new v({rings:[[[b,d],[c,d],[c,g],[b,g],[b,d]]],spatialReference:a.toJson()})};y.combineGeometries=function(a){function b(a){var c={points:[],spatialReference:a[0].spatialReference.toJson()};e.forEach(a,
function(a){c.points=c.points.concat(a.points)});return new u(c)}function c(a){var b={paths:[],spatialReference:a[0].spatialReference.toJson()};e.forEach(a,function(a){b.paths=b.paths.concat(a.paths)});return new w(b)}function g(a){var b={rings:[],spatialReference:a[0].spatialReference.toJson()};e.forEach(a,function(a){"polygon"===a.type?b.rings=b.rings.concat(a.rings):"extent"===a.type&&(a=y.convertExtentToPolygon(a),b.rings=b.rings.concat(a.rings))});return new v(b)}var d=null;if(a&&0<a.length)if(1===
a.length)d=a[0];else{for(var m=null,r=null,q=null,p=null,k=0;k<a.length;k++){m=a[k];switch(m.type){case "point":case "multipoint":p="point";break;case "polyline":p="polyline";break;case "polygon":case "extent":p="polygon";break;default:return null}if(0===k)q=p;else if(q!==p)return null;if(k!==a.length-1&&(r=a[k+1],!m.spatialReference.equals(r.spatialReference)))return null}"point"===p?d=b(a):"polyline"===p?d=c(a):"polygon"===p&&(d=g(a))}return d};y.isFeaturelayerUrlSupportQuery=function(a,b){var c=
!1,g=/\/featureserver\//gi.test(a),d=/\/mapserver\//gi.test(a);b=(b||"").toLowerCase();g?c=0<=b.indexOf("query"):d&&(c=0<=b.indexOf("data"));return c};y.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};y.isStringEndWith=function(a,b){return a.lastIndexOf(b)+b.length===a.length};y.processManifestLabel=function(a,b){a.label=a.i18nLabels&&(a.i18nLabels[b]||a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&e.forEach(a.layouts,function(c){var g="i18nLabels_layout_"+
c.name;c.label=a[g]&&(a[g][b]||a[g].defaultLabel)||c.label||c.name});a.styles&&e.forEach(a.styles,function(c){var g="i18nLabels_style_"+c.name;c.label=a[g]&&(a[g][b]||a[g].defaultLabel)||c.label||c.name})};y.addManifest2WidgetJson=function(a,b){l.mixin(a,b.properties);a.name=b.name;a.label||(a.label=b.label);a.manifest=b};y.addI18NLabel=function(a){var b=new c;if(a.i18nLabels)return b.resolve(a),b;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return b.resolve(a),b;var g="widget"===
a.category?"_widgetLabel":"_themeLabel";require(y.getRequireConfig(),["dojo/i18n!"+a.amdFolder+"/nls/strings"],function(c){a.i18nLabels[dojoConfig.locale]=c[g];"theme"===a.category&&(a.layouts&&a.layouts.forEach(function(b){a["i18nLabels_layout_"+b.name]={};a["i18nLabels_layout_"+b.name][dojoConfig.locale]=c["_layout_"+b.name]}),a.styles&&a.styles.forEach(function(b){a["i18nLabels_style_"+b.name]={};a["i18nLabels_style_"+b.name][dojoConfig.locale]=c["_style_"+b.name]}));b.resolve(a)});return b};y.localizeNumber=
function(a,b){var c=(a.toString().split(".")[1]||"").length,g="",g=0<c?"#,###,###,##0.0"+Array.prototype.join.call({length:c},"0"):"#,###,###,##0",c={locale:d.locale,pattern:g};l.mixin(c,b||{});try{return p.format(a,c)}catch(m){return console.error(m),a.toLocaleString()}};y.parseNumber=function(a,b){var c={locale:d.locale};l.mixin(c,b||{});try{return p.parse(a,c)}catch(g){return console.error(g),a}};y.localizeDate=function(a,b){var c={locale:d.locale,fullYear:!0};l.mixin(c,b||{});try{return s.format(a,
c)}catch(g){return console.error(g),"date"===c.selector?a.toLocaleDateString():"time"===c.selector?a.toLocaleTimeString():a.toLocaleString()}};y.addRelativePathInCss=E;y.url={isAbsolute:function(a){return!a?!1:a.startWith("http")||a.startWith("/")},removeQueryParamFromUrl:function(a,b){var c=C.urlToObject(a);c.query&&delete c.query[b];var g=c.path,d;for(d in c.query)g=g===c.path?g+"?"+d+"\x3d"+c.query[d]:g+"\x26"+d+"\x3d"+c.query[d];return g},addQueryParamToUrl:function(a,b,c){a=C.urlToObject(a);
a.query||(a.query={});a.query[b]=c;b=a.path;for(var g in a.query)b=b===a.path?b+"?"+g+"\x3d"+a.query[g]:b+"\x26"+g+"\x3d"+a.query[g];return b}};y.processUrlInWidgetConfig=function(a,b){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):b+a};y.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:window.appInfo.appPath+a};y.getLocationUrlWithoutHashAndQueryParams=
function(){var a=window.location,b=a.protocol+"//"+a.host+a.pathname,a=C.urlToObject(a.href);a.query&&a.query.apiurl&&(b=y.url.addQueryParamToUrl(b,"apiurl",a.query.apiurl));return b};y.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};y.invertColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?"#000000":"#ffffff"};y.mixinAppConfigPosition=function(a,
b){var c=l.clone(a);if(!b)return c;b=l.clone(b);var g=c.widgetOnScreen,d=b.widgetOnScreen;d&&d.widgets&&("[object Object]"===Object.prototype.toString.call(d.widgets)?e.forEach(g.widgets,function(a,b){var c;c=a.uri?a.uri:"ph_"+b;d.widgets[c]&&d.widgets[c].position&&(d.widgets[c].position.relativeTo||(d.widgets[c].position.relativeTo="map"),a.position=d.widgets[c].position)},this):e.forEach(d.widgets,function(a,b){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");g.widgets[b]&&a.position&&
(g.widgets[b].position=a.position)}));d&&d.groups&&("[object Object]"===Object.prototype.toString.call(d.groups)?e.forEach(g.groups,function(a,b){var c;c=a.label?a.label:"g_"+b;d.groups[c]&&(d.groups[c].panel&&d.groups[c].panel.position)&&(d.groups[c].panel.position.relativeTo||(d.groups[c].panel.position.relativeTo="map"),a.panel.position=d.groups[c].panel.position)},this):e.forEach(d.groups,function(a,b){a.panel&&(a.panel.position&&!a.panel.position.relativeTo)&&(a.panel.position.relativeTo="map");
g.groups[b]&&a.panel.position&&(g.groups[b].panel.position=a.panel.position)}));b.map&&b.map.position&&(c.map?c.map.position=b.map.position:c.map={position:b.map.position});b.widgetPool&&b.widgetPool.panel&&(b.widgetPool.panel.position&&!b.widgetPool.panel.position.relativeTo&&(b.widgetPool.panel.position.relativeTo="map"),c.widgetPool.panel.position=b.widgetPool.panel.position);b.mobileLayout&&(c.mobileLayout=b.mobileLayout);return c};y.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",
getSearchRange:function(a,b,c){var g=-1;b=a.search(RegExp(b));0<=b&&(a=a.slice(b,a.length),a=a.indexOf(c),g=b+a+c.length);return{firstPos:b,lastPos:g}},setConfigValue:function(a,b,c){G(a,b,c)},getConfigValue:function(a,b){return G(a,b)},setConfigValueWithId:function(a,b,c){J(a,b,c)},getConfigValueWithId:function(a,b){return J(a,b)},getKeyInfo:function(a){var b=this.getWidgetIdByKey(a);if(null!==b)return{type:"widget",id:b};a=this.getGroupIdByKey(a);return null!==a?{type:"group",id:a}:{type:"unknow",
id:null}},getWidgetIdByKey:function(a){var b=y.template.getSearchRange(a,y.template.widgetIdentification,"]");if(-1===b.firstPos)a=null;else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,b.lastPos-1)}return a},getGroupIdByKey:function(a){var b=y.template.getSearchRange(a,y.template.groupIdentification,"]");if(-1===b.firstPos)a=null;else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,b.lastPos-1)}return a},getConfigedWidgetsByTemplateConfig:function(a){var b=
[],c=y.template.widgetIdentification+"_config",g;e.forEach(a.configurationSettings,function(a){e.forEach(a.fields,function(a){a.fieldName&&(g=y.template.getSearchRange(a.fieldName,c,"]"),0<=g.firstPos&&(a=y.template.getWidgetIdByKey(a.fieldName),-1===b.indexOf(a)&&b.push(a)))},this)},this);return b},mergeTemplateAppConfigToAppConfig:function(a,b,c){function g(a){var b=[];e.forEach(a,function(a){a&&b.push(a)},this);return b}var d=a.widgetOnScreen,m=a.portalUrl;b.values.webmap&&(a.map.itemId=b.values.webmap);
c&&(a.map.mapOptions&&y.deleteMapOptions(a.map.mapOptions),a.map.portalUrl=m,b.values.app_title||(b.values.app_title=c.title),b.values.app_subtitle||(b.values.app_subtitle=c.snippet));for(var r in b.values)"webmap"!==r&&y.template.setConfigValueWithId(a,r,b.values[r]);a.widgetPool.widgets=g(a.widgetPool.widgets);d.widgets=g(d.widgets);if(a.widgetPool.groups)for(b=0;b<a.widgetPool.groups.length;b++)a.widgetPool.groups[b].widgets=g(a.widgetPool.groups[b].widgets);if(d.groups)for(b=0;b<d.groups.length;b++)d.groups[b].widgets=
g(d.groups[b].widgets);return a}};y.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,delete a.maxZoom,delete a.minScale,delete a.minZoom)};y.localeIsSame=function(a,b){return a.split("-")[0]===b.split("-")[0]};return y})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(l,e,f){var h=l.NodeList;e.extend(h,{_buildArrayFromCallback:function(d){for(var e=[],n=0;n<this.length;n++){var b=
d.call(this[n],this[n],e);b&&(e=e.concat(b))}return e},_getUniqueAsNodeList:function(d){for(var e=[],n=0,b;b=d[n];n++)1==b.nodeType&&-1==f.indexOf(e,b)&&e.push(b);return this._wrap(e,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(d,e){var n=this._getUniqueAsNodeList(d),n=e?l._filterResult(n,e):n;return n._stash(this)},_getRelatedUniqueNodes:function(d,e){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(e),d)},children:function(d){return this._getRelatedUniqueNodes(d,
function(d,n){return e._toArray(d.childNodes)})},closest:function(d,e){return this._getRelatedUniqueNodes(null,function(n,b){do if(l._filterResult([n],d,e).length)return n;while(n!=e&&(n=n.parentNode)&&1==n.nodeType);return null})},parent:function(d){return this._getRelatedUniqueNodes(d,function(d,e){return d.parentNode})},parents:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var b=[];d.parentNode;)d=d.parentNode,b.push(d);return b})},siblings:function(d){return this._getRelatedUniqueNodes(d,
function(d,e){for(var b=[],c=d.parentNode&&d.parentNode.childNodes,a=0;a<c.length;a++)c[a]!=d&&b.push(c[a]);return b})},next:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var b=d.nextSibling;b&&1!=b.nodeType;)b=b.nextSibling;return b})},nextAll:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var b=[],c=d;c=c.nextSibling;)1==c.nodeType&&b.push(c);return b})},prev:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var b=d.previousSibling;b&&1!=
b.nodeType;)b=b.previousSibling;return b})},prevAll:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var b=[],c=d;c=c.previousSibling;)1==c.nodeType&&b.push(c);return b})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(d,e){return 0!=e%2})},odd:function(){return this.filter(function(d,e){return 0==
e%2})}});return h})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(l,e,f,h,d,k,n,b){return l(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var c=f.map(this.geometries,function(a){return a.toJson()}),a={};a.outSR=this.outSR.wkid||h.toJson(this.outSR.toJson());a.inSR=this.geometries[0].spatialReference.wkid||
h.toJson(this.geometries[0].spatialReference.toJson());a.geometries=h.toJson({geometryType:b.getJsonType(this.geometries[0]),geometries:c});this.transformation&&(a.transformation=this.transformation.wkid||h.toJson(this.transformation));n.isDefined(this.transformForward)&&(a.transformForward=this.transformForward);return a}})})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(l,e){var f=l.clone(e);f.declaredClass="jimu.portalUrlUtils";f.getPortalUrlFromLocation=
function(){return f.getPortalServerFromLocation()+f.getDeployContextFromLocation()};f.getPortalSignInUrlFromLocation=function(){return f.getPortalUrlFromLocation()+"home/signin.html"};f.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};f.getDeployContextFromLocation=function(){var e=window.location.href.split("?")[0],d=e.indexOf("/home");0>d&&(d=e.indexOf("/apps"));e=e.substring(e.indexOf(window.location.host)+window.location.host.length+1,d);"/"!==
e&&(e="/"+e+"/");return e};f.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+f.getDeployContextFromLocation()+"sharing/rest/"};return f})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var l={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=
function(e){return this.substr(0,e.length)===e});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(e){return this.substr(this.length-e.length,e.length)===e});l.getServerByUrl=function(e){e=(e||"").trim();e=e.replace(/^(http(s?):?)\/\//gi,"");0===e.indexOf("//")&&(e=e.slice(2));return e.split("/")[0]};l.getServerWithProtocol=function(e){var f="";if(e=(e||"").trim()){var h=l.getServerByUrl(e);if(!h)return f;var d=l.getProtocol(e);d?f=d+"://"+h:0===e.indexOf("//")&&(f=
"//"+h)}return f};l.isSameServer=function(e,f){e=l.getServerByUrl(e)||"";f=l.getServerByUrl(f)||"";return e.toLowerCase()===f.toLowerCase()};l.isOnline=function(e){return 0<=l.getServerByUrl(e).toLowerCase().indexOf(".arcgis.com")};l.isArcGIScom=function(e){e=l.getServerByUrl(e).toLowerCase();return"www.arcgis.com"===e||"arcgis.com"===e};l.getStandardPortalUrl=function(e){var f=l.getServerByUrl(e);if(""===f)return"";l.isOnline(f)?(l.isArcGIScom(f)&&(f="www.arcgis.com"),e=l.addProtocol(e),e=l.getProtocol(e)+
"://"+f):(e=(e||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),e=l.addProtocol(e),e.replace(RegExp("http(s?)://"+f,"g"),"")||(e+="/arcgis"));return e};l.isSamePortalUrl=function(e,f){var h=/^http(s?):\/\//gi,d=/^\/\//gi;e=l.getStandardPortalUrl(e).toLowerCase().replace(h,"").replace(d,"");f=l.getStandardPortalUrl(f).toLowerCase().replace(h,"").replace(d,"");return e===f};l.addProtocol=function(e){if(-1>=e.toLowerCase().indexOf("http://")&&-1>=e.toLowerCase().indexOf("https://")){var f=
"";"undefined"!==typeof window&&window.location?(f=window.location.protocol,e=e.startWith("//")?f+e:e.startWith("/")?f+"//"+window.location.host+e:f+"//"+e):(f="http:",e.startWith("//")&&(e=f+e))}return e};l.getProtocol=function(e){var f="";e=e.toLowerCase();0===e.indexOf("https://")?f="https":0===e.indexOf("http://")&&(f="http");return f};l.updateUrlProtocolByOtherUrl=function(e,f){f=f.toLowerCase();0===f.indexOf("https://")?e=l.setHttpsProtocol(e):0===f.indexOf("http://")&&(e=l.setHttpProtocol(e));
return e};l.removeProtocol=function(e){return e.replace(/^http(s?):\/\//i,"//")};l.setHttpProtocol=function(e){e=l.addProtocol(e);return e.replace(/^https:\/\//,"http://")};l.setHttpsProtocol=function(e){e=l.addProtocol(e);return e.replace(/^http:\/\//,"https://")};l.setProtocol=function(e,f){return 0<=f.indexOf("https")?l.setHttpsProtocol(e):0<=f.indexOf("http")?l.setHttpProtocol(e):e};l.getSharingUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/sharing");return f};l.getOAuth2Url=function(e){var f=
"";(e=l.getStandardPortalUrl(e))&&(f=e+"/sharing/oauth2");return f};l.getAppIdUrl=function(e,f){var h="",d=l.getStandardPortalUrl(e);d&&(h=d+"/sharing/oauth2/apps/"+f);return h};l.getSignInUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/home/signin.html");return f};l.getBaseSearchUrl=function(e){var f="";e=l.getStandardPortalUrl(e);(e=e.replace(/\/*$/g,""))&&(f=e+"/sharing/rest/search");return f};l.getBaseItemUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/sharing/rest/content/items");
return f};l.getItemUrl=function(e,f){var h="",d=l.getBaseItemUrl(e);d&&f&&(h=d+"/"+f);return h};l.getItemDataUrl=function(e,f){var h="",d=l.getItemUrl(e,f);d&&(h=d+"/data");return h};l.getGenerateTokenUrl=function(e){var f="";e&&(e=l.getStandardPortalUrl(e),f=e+"/sharing/generateToken");return f};l.getItemDetailsPageUrl=function(e,f){var h="";e&&f&&(e=l.getStandardPortalUrl(e),h=e+"/home/item.html?id\x3d"+f);return h};l.getUserProfilePageUrl=function(e,f){var h="";e&&f&&(e=l.getStandardPortalUrl(e),
h=e+"/home/user.html?user\x3d"+f);return h};l.getBaseGroupUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/sharing/rest/community/groups");return f};l.getPortalSelfInfoUrl=function(e){var f="";(e=l.getStandardPortalUrl(e||""))&&(f=e+"/sharing/portals/self");return f};l.getCommunitySelfUrl=function(e){var f="";(e=l.getStandardPortalUrl(e||""))&&(f=e+"/sharing/rest/community/self");return f};l.getBaseUserUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/sharing/rest/community/users");
return f};l.getUserUrl=function(e,f){var h="",d=l.getBaseUserUrl(e);e&&f&&(h=d+"/"+f);return h};l.getUserTagsUrl=function(e,f){var h="",d=l.getUserUrl(e,f);e&&f&&(h=d+"/tags");return h};l.getUserThumbnailUrl=function(e,f,h){var d="";(e=l.getUserUrl(e,f))&&h&&(d=e+"/info/"+h);return d};l.getContentUrl=function(e){var f="";e&&(e=l.getStandardPortalUrl(e),f=e+"/sharing/rest/content");return f};l.getUserContentUrl=function(e,f,h){var d="",d="";e&&f&&(d=l.getContentUrl(e),d=h?d+"/users/"+f+"/"+h:d+"/users/"+
f);return d};l.getAddItemUrl=function(e,f,h){var d="",d="";e&&f&&(d=l.getUserContentUrl(e,f,h),d+="/addItem");return d};l.getDeleteItemUrl=function(e,f,h){var d="";(e=l.getUserItemsUrl(e,f))&&(d=e+"/"+h+"/delete");return d};l.getUserItemsUrl=function(e,f,h){var d="",d="";e&&f&&(d=l.getUserContentUrl(e,f,h),d+="/items");return d};l.getUpdateItemUrl=function(e,f,h,d){var k="",k="";e&&f&&(k=l.getUserItemsUrl(e,f,d),k=k+"/"+h+"/update");return k};l.shareItemUrl=function(e,f,h,d){var k="",k="";e&&f&&(k=
l.getUserItemsUrl(e,f,d),k=k+"/"+h+"/share");return k};l.getHomeIndexUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/home/index.html");return f};l.getHomeMapViewerUrl=function(e,f){var h="",d=l.getStandardPortalUrl(e);d&&(h=d+"/home/webmap/viewer.html",h=f?h+("?webmap\x3d"+f):h+"?useExisting\x3d1");return h};l.getHomeGalleryUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/home/gallery.html");return f};l.getHomeGroupsUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&
(f=e+"/home/groups.html");return f};l.getHomeMyContentUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/home/content.html");return f};l.getHomeMyOrganizationUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/home/organization.html");return f};l.getHomeUserUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/home/user.html");return f};l.getPortalHelpUrl=function(e,f){var h="",d=l.getStandardPortalUrl(e);d&&(h=d+"/portalhelp/"+(f||"en")+"/website/help/");return h};
l.getPortalAdminHelpUrl=function(e,f){var h="",d=l.getStandardPortalUrl(e);d&&(h=d+"/portalhelp/"+(f||"en")+"/admin/help/");return h};l.getPortalProxyUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/sharing/proxy");return f};l.getOAuth2SignOutUrl=function(e){var f="";(e=l.getStandardPortalUrl(e))&&(f=e+"/sharing/oauth2/signout");return f};l.getNewPrintUrl=function(e){var f="";if(e=l.getStandardPortalUrl(e))e=l.setHttpProtocol(e),f=e+"/sharing/tools/newPrint";return f};return l})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],
function(l){function e(d,e){function n(b,c){var a,g,m,e,s="widgetOnScreen"===b;if(d[b]){if(d[b].groups)for(a=0;a<d[b].groups.length;a++)if(m=d[b].groups[a],c(m,{index:a,isWidget:!1,groupId:m.id,isThemeWidget:!1,isOnScreen:s}),d[b].groups[a].widgets)for(g=0;g<d[b].groups[a].widgets.length;g++)e=d[b].groups[a].widgets[g],c(e,{index:g,isWidget:!0,groupId:m.id,isThemeWidget:e.uri&&-1<e.uri.indexOf("themes/"+d.theme.name),isOnScreen:s});if(d[b].widgets)for(a=0;a<d[b].widgets.length;a++)e=d[b].widgets[a],
c(d[b].widgets[a],{index:a,isWidget:!0,groupId:b,isThemeWidget:e.uri&&-1<e.uri.indexOf("themes/"+d.theme.name),isOnScreen:s})}}n("widgetOnScreen",e);n("widgetPool",e)}var f={},h="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwithched isController hasVersionManager isThemeWidget supportMultiInstance".split(" ");f.visitElement=e;f.getConfigElementById=function(d,k){var n;if("map"===k)return d.map;e(d,function(b){if(b.id===
k)return n=b,!0});return n};f.getConfigElementByLabel=function(d,k){var n;if("map"===k)return d.map;e(d,function(b){if(b.label||b.name===k)return n=b,!0});return n};f.getConfigElementsByName=function(d,k){var n=[];if("map"===k)return[d.map];e(d,function(b){b.name===k&&n.push(b)});return n};f.getWidgetNameFromUri=function(d){d=d.split("/");d.pop();return d.pop()};f.getAmdFolderFromUri=function(d){d=d.split("/");d.pop();return d.join("/")+"/"};f.widgetProperties=h;f.processWidgetProperties=function(d){"undefined"===
typeof d.properties.isController&&(d.properties.isController=!1);"undefined"===typeof d.properties.isThemeWidget&&(d.properties.isThemeWidget=!1);"undefined"===typeof d.properties.hasVersionManager&&(d.properties.hasVersionManager=!1);h.forEach(function(e){"undefined"===typeof d.properties[e]&&(d.properties[e]=!0)})};f.isHostedService=function(d){var e=l.getServerByUrl(d)+"/[^/]+/[^/]+/rest/services";return RegExp(e,"gi").test(d)};return f})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q){var t=null,u=l(n,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(k.subscribe("app/mapLoaded",e.hitch(this,this._onMapLoaded)),k.subscribe("app/mapChanged",e.hitch(this,this._onMapChanged))):(k.subscribe("mapLoaded",e.hitch(this,this._onMapLoaded)),k.subscribe("mapChanged",e.hitch(this,this._onMapChanged)));window.isBuilder?(k.subscribe("app/appConfigLoaded",e.hitch(this,this._onAppConfigLoaded)),k.subscribe("app/appConfigChanged",
e.hitch(this,this._onAppConfigChanged))):(k.subscribe("appConfigLoaded",e.hitch(this,this._onAppConfigLoaded)),k.subscribe("appConfigChanged",e.hitch(this,this._onAppConfigChanged)));k.subscribe("userSignIn",e.hitch(this,this._onUserSignIn));k.subscribe("userSignOut",e.hitch(this,this._onUserSignOut));k.subscribe("builder/actionTriggered",e.hitch(this,this._onActionTriggered));k.subscribe("/dnd/move/start",e.hitch(this,this._onMoveStart))},loadWidget:function(a){var b=new d,c;a=e.clone(a);a.folderUrl||
s.processWidgetSetting(a);(c=this.getWidgetById(a.id))?b.resolve(c):p([this.loadWidgetClass(a),this.loadWidgetManifest(a)]).then(e.hitch(this,function(a){var c=a[0],g=a[1];this.loadWidgetResources(g).then(e.hitch(this,function(a){try{var d=this.createWidget(g,c,a);console.log("widget ["+g.uri+"] created.")}catch(m){console.log("create ["+g.uri+"] error:"+m.stack),new q({message:"create widget error: "+g.uri}),b.reject(m)}setTimeout(e.hitch(this,function(){b.resolve(d);this.emit("widget-created",d);
k.publish("widgetCreated",d)}),50)}),function(a){b.reject(a)})}),function(a){b.reject(a)});return b},loadWidgetClass:function(a){var b=new d;require(s.getRequireConfig(),[a.uri],e.hitch(this,function(a){b.resolve(a)}));s.checkError(a.uri,b);return b},loadWidgetResources:function(a){var b=new d,c,g,m,r=[];m=e.clone(a);a=this.tryLoadWidgetConfig(m);c=this._tryLoadResource(m,"i18n");g=this._tryLoadResource(m,"style");m=this._tryLoadResource(m,"template");r.push(a);r.push(c);r.push(m);r.push(g);p(r).then(e.hitch(this,
function(a){var c={};c.config=a[0];c.i18n=a[1];c.template=a[2];c.style=a[3];b.resolve(c)}),function(a){b.reject(a)});return b},loadWidgetManifest:function(a){var b=new d,c=a.folderUrl+"manifest.json";if(a.manifest)return b.resolve(a),b;m(c,{handleAs:"json"}).then(e.hitch(this,function(c){c.amdFolder=a.amdFolder;c.category="widget";a.label?(this._processManifest(c),s.addManifest2WidgetJson(a,c),b.resolve(a)):s.addI18NLabel(c).then(e.hitch(this,function(){this._processManifest(c);s.addManifest2WidgetJson(a,
c);b.resolve(a)}))}),function(a){b.reject(a)});return b},getWidgetMarginBox:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return{};if(a._marginBox)return a._marginBox;a.setPosition({left:-9999,top:-9999,relativeTo:a.position.relativeTo});this.openWidget(a);a._marginBox=a.getMarginBox();this.closeWidget(a);return a._marginBox},_processManifest:function(a){s.addManifestProperies(a);s.processManifestLabel(a,window.dojoConfig.locale)},createWidget:function(a,g,d){if(this.getWidgetById(a.id))return this.getWidgetById(a.id);
d.config&&d.i18n&&(d.config=s.replacePlaceHolder(d.config,d.i18n));a.rawConfig=a.config;a.config=d.config||{};this.appConfig._appData&&this._mergeAgolConfig(a);a.nls=d.i18n||{};d.template&&(a.templateString=d.template);a["class"]="jimu-widget";a.label||(a.label=a.name);this.map&&(a.map=this.map);a.appConfig=this.appConfig;d={};for(var m in a)a.hasOwnProperty(m)&&(d[m]=a[m]);d.widgetManager=this;a=new g(d);a.clazz=g;c.after(a,"startup",e.hitch(this,this._postWidgetStartup,a));c.before(a,"destroy",
e.hitch(this,this._onDestroyWidget,a));b(a.domNode,"click",e.hitch(this,this._onClickWidget,a));this.loaded.push(a);return a},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var a=f.map(this.loaded,function(a){return a.id});f.forEach(a,function(a){this.destroyWidget(a)},this);this.loaded=[]},loadWidgetSettingPage:function(a){var b=new d;a=e.clone(a);a.id+="_setting";p([this.loadWidgetSettingClass(a)]).then(e.hitch(this,function(g){var d=g[0];this.loadWidgetSettingPageResources(a).then(e.hitch(this,
function(g){var m;g={nls:g.i18n,templateString:g.template,appConfig:this.appConfig,map:this.map,"class":"jimu-widget-setting"};for(var r in a)a.hasOwnProperty(r)&&(g[r]=a[r]);try{m=new d(g),c.before(m,"destroy",e.hitch(this,this._onDestroyWidgetSetting,m)),b.resolve(m)}catch(p){new q({message:"Create widget setting page error:"+a.uri}),b.reject(p)}}),function(a){console.log(a)})}),function(a){b.reject(a)});return b},loadWidgetSettingClass:function(a){var b=new d;require(s.getRequireConfig(),[a.folderUrl+
"setting/Setting.js"],e.hitch(this,function(a){b.resolve(a)}));s.checkError(a.folderUrl+"setting/Setting.js",b);return b},loadWidgetSettingPageResources:function(a){var b=new d,c,g,m=[];a=e.clone(a);c=this._tryLoadResource(a,"settingI18n");g=this._tryLoadResource(a,"settingTemplate");a=this._tryLoadResource(a,"settingStyle");m.push(c);m.push(g);m.push(a);p(m).then(e.hitch(this,function(a){var c={};c.i18n=a[0]||{};c.template=a[1];c.style=a[2];b.resolve(c)}),function(a){console.log(a)});return b},getWidgetById:function(a){var b;
f.some(this.loaded,function(c){if(c.id===a)return b=c,!0},this);return b},getWidgetByLabel:function(a){var b;f.some(this.loaded,function(c){if(c.label===a)return b=c,!0},this);return b},getWidgetsByName:function(a){var b=[];f.some(this.loaded,function(c){c.name===a&&b.push(c)},this);return b},changeWindowStateTo:function(a,b){"normal"===b?this.normalizeWidget(a):"minimized"===b?this.minimizeWidget(a):"maximized"===b?this.maximizeWidget(a):console.log("error state: "+b)},closeWidget:function(a){if("string"===
typeof a&&(a=this.getWidgetById(a),!a))return;if("closed"!==a.state){this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);h.setStyle(a.domNode,"display","none");a.setState("closed");try{a.onClose()}catch(b){console.log(console.error("fail to close widget "+a.name+". "+b.stack))}}},openWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if(!a.started)try{a.started=!0,a.startup()}catch(b){console.error("fail to startup widget "+
a.name+". "+b.stack)}if("closed"===a.state){h.setStyle(a.domNode,"display","");a.setState("opened");try{a.onOpen()}catch(c){console.error("fail to open widget "+a.name+". "+c.stack)}}},maximizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("maximized");try{a.onMaximize()}catch(b){console.log(console.error("fail to maximize widget "+a.name+". "+b.stack))}},minimizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),
!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("minimized");try{a.onMinimize()}catch(b){console.log(console.error("fail to minimize widget "+a.name+". "+b.stack))}},normalizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("normal");try{a.onNormalize()}catch(b){console.log(console.error("fail to normalize widget "+a.name+". "+b.stack))}},destroyWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),
!a))return;this._removeWidget(a);try{a.destroy()}catch(b){console.log(console.error("fail to destroy widget "+a.name+". "+b.stack))}},tryLoadWidgetConfig:function(a){return this._tryLoadWidgetConfig(a).then(e.hitch(this,function(b){return this._upgradeWidgetConfig(a,b).then(function(b){return a.config=b})}))},_tryLoadWidgetConfig:function(b){var c=new d;if(b.config&&e.isObject(b.config))return c.resolve(b.config),c;if(b.config){if(require.cache["url:"+b.config])return c.resolve(a.parse(require.cache["url:"+
b.config])),c;b=s.processUrlInAppConfig(b.config);b=b.split("/");b[b.length-1]=encodeURIComponent(b[b.length-1]);b=b.join("/");return m(b,{handleAs:"json"})}return this._tryLoadResource(b,"config")},_upgradeWidgetConfig:function(a,b){var c=new d,g=a.manifest.version,m=a.version,r;if(g===m)return c.resolve(b),c;if(!1===a.hasVersionManager)return a.version=g,c.resolve(b),c;require(s.getRequireConfig(),[a.amdFolder+"VersionManager"],e.hitch(this,function(d){d=new d;var q=d.getVersionIndex(m),e=d.getVersionIndex(g);
if(q>e)c.reject("Bad widget version number, "+a.name+","+m);else try{r=d.upgrade(b,m,g),a.version=g,c.resolve(r)}catch(p){console.log("Read widget ["+a.name+"] old config error,"+p.stack),c.resolve(b)}}));return c},loadWidgetStyle:function(a){var b="widget/style/"+a.uri,c=new d,b=this._replaceId(b);return h.byId(b)?(c.resolve("load"),c):s.loadStyleLink(b,a.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(a){var b="widget/style/"+a.uri+"/setting",c=new d,
b=this._replaceId(b);return h.byId(b)?(c.resolve("load"),c):s.loadStyleLink(b,a.settingStyleFile)},loadWidgetConfig:function(b){b=require(s.getRequireConfig()).toUrl(b.configFile);if(require.cache["url:"+b]){var c=new d;c.resolve(a.parse(require.cache["url:"+b]));return c}return m(b,{handleAs:"json"})},loadWidgetI18n:function(a){var b=new d;require(s.getRequireConfig(),["dojo/i18n!"+a.i18nFile],function(a){b.resolve(a)});return b},loadWidgetSettingI18n:function(a){var b=new d;require(s.getRequireConfig(),
["dojo/i18n!"+a.settingI18nFile],function(a){b.resolve(a)});return b},loadWidgetTemplate:function(a){var b=new d;require(s.getRequireConfig(),["dojo/text!"+a.templateFile],function(a){b.resolve(a)});s.checkError(a.templateFile,b);return b},loadWidgetSettingTemplate:function(a){var b=new d;require(s.getRequireConfig(),["dojo/text!"+a.settingTemplateFile],function(a){b.resolve(a)});s.checkError(a.settingTemplateFile,b);return b},removeWidgetStyle:function(a){h.destroy(this._replaceId("widget/style/"+
a.uri))},removeWidgetSettingStyle:function(a){h.destroy(this._replaceId("widget/style/"+a.uri+"/setting"))},getControllerWidgets:function(){return f.filter(this.loaded,function(a){return a.isController})},getOffPanelWidgets:function(){return f.filter(this.loaded,function(a){return!a.inPanel})},getOnScreenOffPanelWidgets:function(){return f.filter(this.loaded,function(a){return a.isOnScreen&&!a.inPanel})},closeOtherWidgetsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),
!a))return;for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a.gid&&this.loaded[b].id!==a.id&&this.closeWidget(this.loaded[b])},closeAllWidgetsInGroup:function(a){for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a&&this.closeWidget(this.loaded[b])},_mergeAgolConfig:function(a){var b=this.appConfig._appData.values,c="widgets["+a.id+"]",g;for(g in b){var d=g.replace(/\//g,"_").indexOf(c+"_config");0<=d&&s.template.setConfigValue(a,g.replace(/\//g,"_").substr(d,g.length).replace(c,"widget"),
b[g])}},_onUserSignIn:function(a){f.forEach(this.loaded,function(b){b.onSignIn(a)},this)},_onUserSignOut:function(){f.forEach(this.loaded,function(a){a.onSignOut()},this)},_activeWidget:function(a){if(this.activeWidget){if(this.activeWidget.id===a.id){this.activeWidget.moveTopOnActive&&h.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),h.setStyle(a.domNode,"zIndex","zIndex"in a.position?a.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=
a;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),this.activeWidget.moveTopOnActive&&h.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),k.publish("widgetActived",a))},_onClickWidget:function(a,b){var c=g(".jimu-widget",a.domNode);if(0<c.length)for(var d=0;d<c.length;d++)if(b.target===c[d]||h.isDescendant(b.target,c[d]))return;this._activeWidget(a)},_onMoveStart:function(a){f.forEach(this.loaded,function(b){b.domNode===a.node&&this._activeWidget(b)},
this)},_onAppConfigLoaded:function(a){this.appConfig=a=e.clone(a);r.setPortalUrl(a.portalUrl)},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a},_onAppConfigChanged:function(a,b,c,g){var d=e.clone(a);this.appConfig=d;f.forEach(this.loaded,function(a){a&&(a.onAppConfigChanged(d,b,c,g),"widgetChange"===b&&this._onConfigChanged(c.id,c.config,g))},this)},_onConfigChanged:function(a,b){var c=this.getWidgetById(a);c&&(c.onConfigChanged(b),e.mixin(c.config,b))},_onActionTriggered:function(a){if(!("map"===
a.elementId||"app"===a.elementId)){var b=this.getWidgetById(a.elementId);if(b)b.onAction(a.action,a.data);else this.missedActions.push({id:a.elementId,action:{name:a.action,data:a.data}});f.forEach(this.getControllerWidgets(),function(b){if(b.widgetIsControlled(a.elementId))b.onAction(a.action,{widgetId:a.elementId,data:a.data})},this)}},_postWidgetStartup:function(a){a.started=!0;s.setVerticalCenter(a.domNode);c.after(a,"resize",e.hitch(this,s.setVerticalCenter,a.domNode));this.openWidget(a);var b=
r.getPortalCredential(this.appConfig.portalUrl);if(b)a.onSignIn(b);else a.onSignOut();this._triggerMissedAction(a)},_triggerMissedAction:function(a){this.missedActions.forEach(function(b){if(b.id===a.id)a.onAction(b.action.name,b.action.data)})},_remove:function(a){return f.some(this.loaded,function(b,c){if(b.id===a)return this.loaded.splice(c,1),!0},this)},_tryLoadResource:function(a,b){var c,g=new d;if("config"===b)c=a.amdFolder+"config.json",a.configFile=c,c="hasConfig";else if("style"===b)c=a.amdFolder+
"css/style.css",a.styleFile=c,c="hasStyle";else if("i18n"===b)c=a.amdFolder+"nls/strings.js",a.i18nFile=a.amdFolder+"nls/strings",c="hasLocale";else if("template"===b)c=a.amdFolder+"Widget.html",a.templateFile=c,c="hasUIFile";else if("settingTemplate"===b)c=a.amdFolder+"setting/Setting.html",a.settingTemplateFile=c,c="hasSettingUIFile";else if("settingI18n"===b)c=a.amdFolder+"setting/nls/strings.js",a.settingI18nFile=a.amdFolder+"setting/nls/strings",c="hasSettingLocale";else if("settingStyle"===
b)c=a.amdFolder+"setting/css/style.css",a.settingStyleFile=c,c="hasSettingStyle";else return g;a[c]?function(){var c;if("config"===b)c=this.loadWidgetConfig(a);else if("style"===b)c=this.loadWidgetStyle(a);else if("i18n"===b)c=this.loadWidgetI18n(a);else if("template"===b)c=this.loadWidgetTemplate(a);else if("settingTemplate"===b)c=this.loadWidgetSettingTemplate(a);else if("settingStyle"===b)c=this.loadWidgetSettingStyle(a);else if("settingI18n"===b)c=this.loadWidgetSettingI18n(a);else return g;c.then(function(a){g.resolve(a)},
function(b){new q({message:"load widget resouce error: "+a.uri});g.reject(b)})}.apply(this):g.resolve(null);return g},_replaceId:function(a){return a.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(a){"closed"!==a.state&&this.closeWidget(a);this._removeWidget(a);console.log("destroy widget ["+a.uri+"].")},_onDestroyWidgetSetting:function(a){this.removeWidgetSettingStyle(a)},_removeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this.activeWidget&&this.activeWidget.id===
a.id&&(this.activeWidget=null);this._remove(a.id);0===this.getWidgetsByName(a.name).length&&this.removeWidgetStyle(a)}});u.getInstance=function(a){null===t&&(t=new u(a));return t};return u})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/request esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m,p,s){"function"!==
typeof d.getAll&&(d.getAll=function(a){var b=[];(a=d(a))&&b.push(a);return b});g={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){var a=!1;try{a=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(b){console.log(b),a=!1}return!!a},isStringStartWith:function(a,b){return a.substr(0,b.length)===b},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=
p.getStandardPortalUrl(a))&&(a+="/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(a){var g=new h,d=p.getStandardPortalUrl(a);a=d+"/sharing";var m=p.setHttpsProtocol(d+"/sharing/generateToken?f\x3djson"),e=p.setHttpsProtocol(a);b.get(m,{jsonp:"callback"}).then(l.hitch(this,function(a){a.token?(this.webTierPortalUrls.push(d),this.removeWabAuthCookie(),c.id.getCredential(e).then(l.hitch(this,function(b){b.token||(b.token=a.token);g.resolve(!0)}),l.hitch(this,
function(){g.resolve(!0)}))):g.resolve(!1)}),l.hitch(this,function(a){console.error(a);g.reject(a)}));return g},tryRegisterCredential:function(a){return!this.isValidCredential(a)?!1:!e.some(c.id.credentials,l.hitch(this,function(b){return a.token===b.token}))?(c.id.credentials.push(a),!0):!1},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&l.trim(a)},signInPortal:function(a){var b=new h;if(this._isInvalidPortalUrl(a)){a=p.getStandardPortalUrl(a);var g=p.getSharingUrl(a),d=this.getPortalCredential(a);
d?setTimeout(l.hitch(this,function(){b.resolve(d)}),0):b=c.id.getCredential(g)}else setTimeout(l.hitch(this,function(){b.reject("Invalid portalurl.")}),0);return b},_loadPortalSelfInfo:function(b){b=p.getPortalSelfInfoUrl(b);return a({url:b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(a,b){if(!a||!("string"===typeof a&&b&&"string"===typeof b))return null;var g=c.id.findOAuthInfo(a);g||(g=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+
"/oauth-callback.html",g=new m({appId:b,expiration:20160,portalUrl:a,authNamespace:"/",popup:!0,popupCallbackUrl:g}),c.id.registerOAuthInfos([g]));g.appId=b;return g},signOutAll:function(){var a=p.getStandardPortalUrl(this.portalUrl),b=!!c.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();c.id.destroyCredentials();c.id._oAuthHash=null;b&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(l.trim(a||
""))},isValidCredential:function(a){var b=!1;if(a){var b=a.token,c=a.server,g=a.scope,b=b&&"string"===typeof b&&l.trim(b),c=c&&"string"===typeof c&&l.trim(c),g="portal"===g||"server"===g,d=!0;a.expires&&(a=parseInt(a.expires,10),d=(new Date).getTime(),d=a>d);b=b&&c&&g&&d}return b},isValidPortalCredentialOfPortalUrl:function(a,b){var c=!1;if(this.isValidCredential(b))var c="portal"===b.scope,g=p.isSameServer(a,b.server),c=c&&g;return c},getPortalCredential:function(a){var b=null;a=l.trim(a||"");if(!a)return null;
a=p.getStandardPortalUrl(a);return b=this._filterPortalCredential(a,c.id.credentials)},saveAndRegisterCookieToCredential:function(a){a=l.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=!!a.isAdmin;this.saveWabCookie(a);var b=a.server+"/sharing/rest";a.server=b;c.id.registerToken(a);return c.id.findCredential(b,a.userId)},registerAuth2Hash:function(a){a=l.clone(a);var b=1E3*parseInt(a.expires_in,10),b=(new Date).getTime()+b,c=p.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,
server:c,token:a.access_token,expires:b,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");d("wab_auth",k.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,
b){var c=null;if(b&&0<b.length){var g=e.filter(b,l.hitch(this,function(b){return this.isValidPortalCredentialOfPortalUrl(a,b)}));0<g.length&&(c=g[g.length-1])}return c},_removePortalCredential:function(a){var b=l.trim(a||"");if(b){b=p.getStandardPortalUrl(b);for(a=e.filter(c.id.credentials,l.hitch(this,function(a){return this.isValidPortalCredentialOfPortalUrl(b,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);c.id.credentials=e.filter(c.id.credentials,l.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(b,
a)}))}},getUserIdByToken:function(b,g){var d=new h;if(b&&"string"===typeof b&&g&&"string"===typeof g){var m=p.getStandardPortalUrl(g),s=e.filter(c.id.credentials,l.hitch(this,function(a){var c=a.token===b&&a.userId;a=p.isSameServer(m,a.server);return c&&a}));if(0<s.length){var k=s[0];setTimeout(l.hitch(this,function(){d.resolve(k.userId)}),0);return d}s=p.getCommunitySelfUrl(m);a({url:s,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(l.hitch(this,function(a){d.resolve(a&&a.username||
"")}),l.hitch(this,function(a){console.error(a);d.reject("fail to get userId by token")}))}else setTimeout(l.hitch(this,function(){d.reject("invalid parameters")}),0);return d},xtGetCredentialFromCookie:function(a){var b=d("wab_auth"),g=null;if(b)try{g=k.parse(b)}catch(m){console.error(m)}if(!(g&&"object"===typeof g)||!p.isSameServer(a,g.server)||window.location.host!==g.referer)return null;g.expires=parseInt(g.expires,10);b=(new Date).getTime();if(!(g.expires>b))return this.removeCookie("wab_auth"),
null;a+="/sharing/rest";g.server=a;(b=c.id.findCredential(a))||c.id.registerToken(g);return b=c.id.findCredential(a)},removeCookie:function(a){var b=this.getCookiePath();s.removeCookie(a,b)},_getDomainsByServerName:function(a){var b=a.split("."),c=b.length;return e.map(b,l.hitch(this,function(a,g){var d=b.slice(g,c),m="",r=d.length-1;e.forEach(d,l.hitch(this,function(a,b){m+=a;b!==r&&(m+=".")}));return m}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{n.publish("userSignIn",
a)}catch(b){console.error(b)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{n.publish("anyUserSignIn",a)}catch(b){console.error(b)}},_publishCurrentPortalUserSignOut:function(a){try{n.publish("userSignOut",a)}catch(b){console.error(b)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(b){console.error(b)}},_bindEvents:function(){f.after(c.id,"signIn",l.hitch(this,
function(a,b){console.log(b[1]);f.after(a,"callback",l.hitch(this,function(a,b){this._signInSuccess(b[0],!1)}));return a}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var b=a.esri&&a.esri.id;b&&(c.id=b,b=window.esriConfig.defaults.io,a=a.esriConfig.defaults.io,b.corsEnabledServers=a.corsEnabledServers,b.webTierAuthServers=a.webTierAuthServers,b._processedCorsServers=a._processedCorsServers,b.corsStatus=
a.corsStatus)}}this._bindEvents();this._started=!0}}};g.startup();return g})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(l,e,f,h,d,k){return l(k,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=
f.create("div",{"class":"title"},this.domNode),this.titleLabeNode=f.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=f.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(d(this.closeBtnNode,"click",e.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:"OK",key:h.ENTER,onClick:e.hitch(this,this.close)})},_increaseZIndex:function(){f.setStyle(this.domNode,
"zIndex",501);f.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase".split(" "),function(l,e,f,h,d,k,n,b,c,a,g){var m=0;return l(g,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,
maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this.domNode.tabIndex=1;this._initDomNode();this._positioning();h.place(this.domNode,this.container);setTimeout(e.hitch(this,function(){this._moveToMiddle()}),50);this.own(k(window,"resize",e.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),
this._moveToMiddle()):this._positioning()})));this.overlayNode=h.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();d.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=h.create("div",{"class":"title"},this.domNode);this.titleLabeNode=h.create("span",
{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=h.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);this.own(k(this.closeBtnNode,"click",e.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=h.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?
(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&h.place(this.content,this.contentContainerNode));this.buttonContainer=h.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&h.setStyle(this.buttonContainer,"display","none");for(var a=this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=this.enabledButtons.length;if(0!==
a){var b=h.getContentBox(this.buttonContainer),c=h.getMarginExtents(this.enabledButtons[0]),g=h.getPadBorderExtents(this.enabledButtons[0]),d=0,g=8===n("ie")?g.l+g.r:0,d=(b.w-(c.l+c.r+g)*a)/a;0<d&&(f.forEach(this.enabledButtons,e.hitch(this,function(a){h.setStyle(a,"maxWidth",d+"px")})),f.forEach(this.disabledButtons,e.hitch(this,function(a){h.setStyle(a,"maxWidth",d+"px")})))}},_moveableNode:function(b,c){this.moveable&&(this.moveable.destroy(),this.moveable=null);var g=h.getMarginBox(this.container);
g.l=g.l-b+c;g.w+=2*(b-c);this.moveable=new a.boxConstrainedMoveable(this.domNode,{box:g,handle:this.titleNode,within:!0});this.own(k(this.moveable,"Moving",e.hitch(this,this.onMoving)));this.own(k(this.moveable,"MoveStop",e.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===c("#header").length?{t:0,l:0,w:0,h:0}:h.getMarginBox("header")},_getFooterBox:function(){return 0===c(".footer",this.container).length?{t:0,l:0,w:0,h:0}:h.getMarginBox(c(".footer",this.container)[0])},_calculatePosition:function(){var a=
h.getContentBox(this.container),b=this._getHeaderBox(),c=this._getFooterBox(),c=a.h-b.h-c.h-40,g=0;g=this._fixedHeight?this.height:this.autoHeight?c-200:this.height=c>this.maxHeight?this.maxHeight:c;c=(c-g)/2+b.h+20;c=c<b.h?b.h:c;this.width=this.width||this.maxWidth;h.setStyle(this.domNode,{left:(a.w-this.width)/2+"px",top:c+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(h.setStyle(this.domNode,"height","auto"),h.addClass(this.contentContainerNode,"content-static"),0===
this.buttons.length&&h.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(h.setStyle(this.domNode,"height",this.height+"px"),h.addClass(this.contentContainerNode,"content-absolute"),h.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&h.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var a=h.getMarginBox(this.domNode),b=h.getContentBox(this.container),c=this._getHeaderBox(),
g=this._getFooterBox(),g=b.h-c.h-g.h-40,d=0,d=a.h||g-200,a=(g-d)/2+c.h+20,a=a<c.h?c.h:a;h.setStyle(this.domNode,{left:(b.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();this._calculateHeight()},_increaseZIndex:function(){h.setStyle(this.domNode,"zIndex",m+200+1);h.setStyle(this.overlayNode,"zIndex",m+200);m++},onMoving:function(a){h.setStyle(a.node,"opacity",0.9)},onMoveStop:function(a){h.setStyle(a.node,"opacity",1)},close:function(){if(!(this.onClose&&
!1===this.onClose())){var a=this.domNode.parentNode,b=e.clone(this.domNode);h.setStyle(this.domNode,"display","none");h.destroy(this.overlayNode);this.destroy();this.moveable.destroy();h.place(b,a);d.animateProperty({node:b,properties:{opacity:0},duration:200,onEnd:function(){h.destroy(b)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(a){var c=h.create("div",{"class":"jimu-btn jimu-float-trailing jimu-leading-margin1",innerHTML:a.label},this.buttonContainer);this.enabledButtons.unshift(c);
var g=h.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-leading-margin1",innerHTML:a.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(g);g=null;g="ontouchstart"in document?b.press:"click";this.own(k(c,g,e.hitch(this,function(b){if(a.onClick)a.onClick(b);else this.close()})))},enableButton:function(a){"number"===typeof a?(h.setStyle(this.enabledButtons[a],"display","inline-block"),h.setStyle(this.disabledButtons[a],"display","none")):(f.forEach(this.enabledButtons[a],
e.hitch(this,function(a){h.setStyle(a,"display","inline-block")})),f.forEach(this.disabledButtons[a],e.hitch(this,function(a){h.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a?(h.setStyle(this.disabledButtons[a],"display","inline-block"),h.setStyle(this.enabledButtons[a],"display","none")):(f.forEach(this.disabledButtons,e.hitch(this,function(a){h.setStyle(a,"display","inline-block")})),f.forEach(this.enabledButtons,e.hitch(this,function(a){h.setStyle(a,"display","none")})))}})})},
"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(l,e,f,h,d,k){h=l("dojo.dnd.move.constrainedMoveable",k,{constraints:function(){},within:!1,constructor:function(d,b){b||(b={});this.constraints=b.constraints;this.within=b.within},onFirstMove:function(d){var b=this.constraintBox=this.constraints.call(this,d);b.r=b.l+b.w;b.b=b.t+b.h;this.within&&(d=e.getMarginSize(d.node),b.r-=d.w,b.b-=d.h)},onMove:function(d,b){var c=this.constraintBox,
a=d.node.style;this.onMoving(d,b);b.l=b.l<c.l?c.l:c.r<b.l?c.r:b.l;b.t=b.t<c.t?c.t:c.b<b.t?c.b:b.t;a.left=b.l+"px";a.top=b.t+"px";this.onMoved(d,b)}});d=l("dojo.dnd.move.boxConstrainedMoveable",h,{box:{},constructor:function(d,b){var c=b&&b.box;this.constraints=function(){return c}}});l=l("dojo.dnd.move.parentConstrainedMoveable",h,{area:"content",constructor:function(d,b){var c=b&&b.area;this.constraints=function(){var a=this.node.parentNode,b=f.getComputedStyle(a),d=e.getMarginBox(a,b);if("margin"==
c)return d;var p=e.getMarginExtents(a,b);d.l+=p.l;d.t+=p.t;d.w-=p.w;d.h-=p.h;if("border"==c)return d;p=e.getBorderExtents(a,b);d.l+=p.l;d.t+=p.t;d.w-=p.w;d.h-=p.h;if("padding"==c)return d;p=e.getPadExtents(a,b);d.l+=p.l;d.t+=p.t;d.w-=p.w;d.h-=p.h;return d}}});return{constrainedMoveable:h,boxConstrainedMoveable:d,parentConstrainedMoveable:l}})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager","./utils"],function(l,e){function f(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",
upgrader:function(e){return e},compatible:!0},{version:"1.1",description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(e){e.widgetOnScreen&&(e.widgetOnScreen.panel&&"themes/FoldableTheme/panels/TitlePanel/Panel"===e.widgetOnScreen.panel.uri)&&(e.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel");return e},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(e){var d=0;if(e.widgetOnScreen&&e.widgetOnScreen.widgets){for(var k=
!1,d=0;d<e.widgetOnScreen.widgets.length;d++)"widgets/Splash/Widget"===e.widgetOnScreen.widgets[d].uri&&(k=!0);k||e.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});k=!1;for(d=0;d<e.widgetOnScreen.widgets.length;d++)"widgets/TimeSlider/Widget"===e.widgetOnScreen.widgets[d].uri&&(k=!0);k||e.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});k=!1;for(d=0;d<e.widgetOnScreen.widgets.length;d++)"widgets/Swipe/Widget"===
e.widgetOnScreen.widgets[d].uri&&(k=!0);k||e.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return e},compatible:!0},{version:"1.3",description:"The version embedded in online3.8.",upgrader:function(f){(function(d){e.visitElement(d,function(d){d.positionRelativeTo&&(d.position?d.position.relativeTo=d.positionRelativeTo:d.position={relativeTo:d.positionRelativeTo},d.panel&&(d.panel.position?d.panel.position.relativeTo=d.panel.positionRelativeTo:
d.panel.position={relativeTo:d.panel.positionRelativeTo}))});var k=d.widgetOnScreen;k&&(k.panel&&k.panel.positionRelativeTo)&&(k.panel.position?k.panel.position.relativeTo=k.panel.positionRelativeTo:k.panel.position={relativeTo:k.panel.positionRelativeTo});if((k=d.widgetPool)&&k.panel&&k.panel.positionRelativeTo)k.panel.position?k.panel.position.relativeTo=k.panel.positionRelativeTo:k.panel.position={relativeTo:k.panel.positionRelativeTo}})(f);f.widgetOnScreen&&(f.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===
f.widgetOnScreen.panel.uri)&&(f.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");f.widgetOnScreen&&f.widgetOnScreen.widgets&&f.theme&&"FoldableTheme"===f.theme.name&&f.widgetOnScreen.widgets.splice(7,0,{position:{left:205,top:45}},{position:{left:255,top:45}});(function(){for(var d=0,e=0,n=!1,d=0;d<f.widgetOnScreen.widgets.length;d++)if("widgets/Geocoder/Widget"===f.widgetOnScreen.widgets[d].uri){n=!0;break}for(var b=!1,e=0;e<f.widgetOnScreen.widgets.length;e++)if("widgets/Search/Widget"===f.widgetOnScreen.widgets[e].uri){b=
!0;break}b||(n?(d=f.widgetOnScreen.widgets[d],d.uri="widgets/Search/Widget",d.name="Search"):f.widgetOnScreen.widgets.push({uri:"widgets/Search/Widget",position:{top:5,left:45},version:"1.3"}))})(f);(function(d){for(var e=0,e=d.widgetOnScreen.widgets.length-1;0<=e;e--){var n=d.widgetOnScreen.widgets[e];if("widgets/Swipe/Widget"===n.uri&&!n.closeable&&(d.widgetOnScreen.widgets.splice(e,1),!1!==n.visible)){n.closeable=!0;var b;a:{for(b=b=0;b<d.widgetOnScreen.widgets.length;b++)if(!d.widgetOnScreen.widgets[b].uri)break a;
b=-1}0<=b&&(n.position=d.widgetOnScreen.widgets[b].position,d.widgetOnScreen.widgets[b]=n)}"widgets/TimeSlider/Widget"===n.uri&&(!1===n.visible?d.widgetOnScreen.widgets.splice(e,1):n.closeable=!0)}})(f);f.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});return f},compatible:!0}];this.isCompatible=function(e,d){for(var k=this.getVersionIndex(e),n=this.getVersionIndex(d),k=k+1;k<=n;k++)if(!1===this.versions[k].compatible)return!1;return!0}}f.prototype=
new l;return f.prototype.constructor=f})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(l,e,f){e=this.getVersionIndex(e);f=this.getVersionIndex(f);if(e>=f)throw Error("New version should higher than old version.");for(e+=1;e<=f;e++)this.versions[e].upgrader&&(l=this.versions[e].upgrader(l));return l};this.getVersionIndex=function(l){l=this.fixVersion(l);var e,f;for(f=0;f<this.versions.length;f++)this.versions[f].version===l&&
(e=f);null===l&&(e=-1);void 0===e&&(e=-1);return e};this.fixVersion=function(l){return!l?null:l}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./portalUrlUtils esri/IdentityManager esri/config esri/urlUtils esri/geometry/Point esri/SpatialReference esri/request".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m,p,
s,r,q,t,u,w){var v=null,x;x=l(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(b,c){this._removeHash(b);this.urlParams=b||{};this.widgetManager=a.getInstance();e.mixin(this,c)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(e.hitch(this,function(a){var b=this.checkConfig(a);if(b)throw b;this.rawAppConfig=e.clone(a);a=this._upgradeAppConfig(a);this._processAfterTryLoad(a);this.appConfig=
a;if(this.urlParams.id)return this.loadWidgetsManifest(a).then(e.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(e.hitch(this,function(){this._configLoaded=!0;a.title&&(document.title=a.title);return this.getAppConfig()}));m.setPortalUrl(a.portalUrl);return this._proesssWebTierAndSignin(a).then(e.hitch(this,function(){return this.urlParams.appid?window.appInfo.isRunInPortal?this._getAppConfigFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(e.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);
return this._processInPortalAppProtocol(a)})):this._processNotInPortalAppProtocol(a).then(e.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(e.hitch(this,function(b){b.appData.appConfig&&(a=b.appData.appConfig);a._appData=b.appData;a.templateConfig=b.templateData;return a}))})):this._processNotInPortalAppProtocol(a)})).then(e.hitch(this,function(a){this._processAfterTryLoad(a);this.appConfig=a;return a.map.itemId?a:p.getDefaultWebMap(a.portalUrl).then(function(b){a.map.itemId=
b;return a})})).then(e.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(e.hitch(this,function(a){return a._appData?a._appData.values&&a._appData.values.webmap?p.getPortal(a.portalUrl).getItemById(a._appData.values.webmap).then(e.hitch(this,function(b){return c.template.mergeTemplateAppConfigToAppConfig(a,a._appData,b)})):c.template.mergeTemplateAppConfigToAppConfig(a,a._appData):a})).then(e.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(e.hitch(this,function(){this._configLoaded=
!0;a.title&&(document.title=a.title);return this.getAppConfig()}))}))},getAppConfig:function(){var a=e.clone(this.appConfig);a.getConfigElementById=function(a){return c.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return c.getConfigElementsByName(this,a)};a.visitElement=function(a){c.visitElement(this,a)};return a},checkConfig:function(a){return(a=this._getRepeatedId(a))?"repeated id:"+a:null},processProxy:function(a){q.defaults.io.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&
a.httpProxy.alwaysUseProxy;q.defaults.io.proxyUrl="";q.defaults.io.proxyRules=[];a.httpProxy&&(a.httpProxy.useProxy&&a.httpProxy.url)&&(q.defaults.io.proxyUrl=a.httpProxy.url);a.httpProxy&&(a.httpProxy.useProxy&&a.httpProxy.rules)&&f.forEach(a.httpProxy.rules,function(a){t.addProxyRule(a)})},addNeedValues:function(a){this._processNoUriWidgets(a);this._addElementId(a);this._processWidgetJsons(a)},showError:function(a){document.body.innerHTML='\x3cdiv class\x3d"jimu-error-code"\x3e\x3cspan\x3e'+this.nls.errorCode+
":\x3c/span\x3e\x3cspan\x3e"+a.response.status+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-error-message"\x3e\x3cspan\x3e'+this.nls.errorMessage+":\x3c/span\x3e\x3cspan\x3e"+a.message+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-error-detail"\x3e\x3cspan\x3e'+this.nls.errorDetail+":\x3c/span\x3e\x3cspan\x3e"+a.response.text+"\x3cspan\x3e\x3c/div\x3e"},_tryLoadConfig:function(){if(this.urlParams.config)return this.configFile=this.urlParams.config,b(this.configFile,{handleAs:"json"});if(this.urlParams.id){window.appInfo.isRunInPortal=
!0;var a=s.getPortalUrlFromLocation(),c=new k;m.setPortalUrl(a);p.getPortal(a).loadSelfInfo().then(e.hitch(this,function(b){this.portalSelf=b;b.allSSL&&"http:"===window.location.protocol?(window.location.href=s.setHttpsProtocol(window.location.href),c.reject()):this._processSignIn(a).then(e.hitch(this,function(){this._getAppConfigFromAppId(a,this.urlParams.id).then(e.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})).then(function(a){c.resolve(a)},
function(a){c.reject(a)})}))}));return c}this.configFile="config.json";return b(this.configFile,{handleAs:"json"})},_upgradeAppConfig:function(a){var b=window.wabVersion,c=a.wabVersion;if(b===c)return a;var g=this.versionManager.getVersionIndex(c),d=this.versionManager.getVersionIndex(b);if(g>d)throw Error("Bad version number, "+c);a=this.versionManager.upgrade(a,c,b);a.wabVersion=b;a.isUpgraded=!0;return a},_upgradeAllWidgetsConfig:function(a){var b=new k,c=[];if(!a.isUpgraded)return b.resolve(a),
b;delete a.isUpgraded;g.visitElement(a,e.hitch(this,function(a){a.uri&&(a.config?(a=this.widgetManager.tryLoadWidgetConfig(a),c.push(a)):a.version=a.manifest.version)}));n(c).then(e.hitch(this,function(){b.resolve(a)}),function(a){b.reject(a)});return b},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);r.tokenValidity=10080;return a},_tryUpdateAppConfigByLocationUrl:function(a){var b=
s.getPortalUrlFromLocation(),b=s.getStandardPortalUrl(b);s.isOnline(b)&&(b=s.updateUrlProtocolByOtherUrl(b,a.portalUrl),a.map.portalUrl&&s.isSamePortalUrl(a.portalUrl,a.map.portalUrl)&&(a.map.portalUrl=b),a.portalUrl=b,a.httpProxy&&a.httpProxy.url&&(a.httpProxy.url=s.getPortalProxyUrl(b)))},_processWidgetJsons:function(a){g.visitElement(a,function(a,b){b.isWidget&&a.uri&&c.processWidgetSetting(a)})},_processNoUriWidgets:function(a){var b=0;g.visitElement(a,function(a,c){c.isWidget&&!a.uri&&(b++,a.placeholderIndex=
b)})},_addElementId:function(a){var b=0,c;g.visitElement(a,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var g=a.id.lastIndexOf("_");-1<g&&(c=a.id.substr(g+1),b=Math.max(b,c))}});g.visitElement(a,function(a){a.id||(b++,a.id=a.uri?a.uri.replace(/\//g,"_")+"_"+b:"_"+b)})},_setPortalUrl:function(a){if(a.portalUrl){var b=s.getPortalUrlFromLocation(),c=s.isOnline(b);!s.isSamePortalUrl(a.portalUrl,b)&&!c&&(window.appInfo.isRunInPortal=!1)}else window.isXT&&d("wab_portalurl")?a.portalUrl=d("wab_portalurl"):
(window.appInfo.isRunInPortal=!0,a.portalUrl=s.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(a,b){a.portalUrl=s.setProtocol(a.portalUrl,b);a.map.portalUrl&&(a.map.portalUrl=s.setProtocol(a.map.portalUrl,b));a.httpProxy&&(a.httpProxy.url=s.setProtocol(a.httpProxy.url,b),a.httpProxy&&a.httpProxy.rules&&f.forEach(a.httpProxy.rules,e.hitch(this,function(a){a.proxyUrl=s.setProtocol(a.proxyUrl,b)})))},_processInPortalAppProtocol:function(a){var b=new k,c=p.getPortal(a.portalUrl),g=e.hitch(this,
function(c){if("https:"===window.location.protocol)this._changePortalUrlProtocol(a,"https");else{if(c){window.location.href=s.setHttpsProtocol(window.location.href);b.reject();return}this._changePortalUrlProtocol(a,"http")}this._checkLocale();b.resolve(a)});c.loadSelfInfo().then(e.hitch(this,function(b){"private"===b.access?(b=0===a.portalUrl.toLowerCase().indexOf("https://"),g(b)):g(b.allSSL)}),e.hitch(this,function(a){b.reject(a)}));return b},_processNotInPortalAppProtocol:function(a){var b=new k;
a.portalUrl?p.getPortal(a.portalUrl).loadSelfInfo().then(e.hitch(this,function(c){var g="https:"===window.location.protocol;(c.allSSL||g)&&this._changePortalUrlProtocol(a,"https");0===a.portalUrl.toLowerCase().indexOf("https://")&&!g&&!m.isInConfigOrPreviewWindow()?(window.location.href=s.setHttpsProtocol(window.location.href),b.reject()):b.resolve(a)}),e.hitch(this,function(a){b.reject(a)})):b.resolve(a);return b},_proesssWebTierAndSignin:function(a){var b=new k,c=!1,g=a.portalUrl;this._processWebTier(a).then(e.hitch(this,
function(a){c=a;return p.getPortal(g).loadSelfInfo()})).then(e.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(g,c)})).then(e.hitch(this,function(){b.resolve()}),function(a){b.reject(a)});return b},_processWebTier:function(a){var b=new k,c=a.portalUrl;a.isWebTier?m.isWebTierPortal(c).then(e.hitch(this,function(a){m.getPortalCredential(c).ssl&&"http:"===window.location.protocol&&!m.isInConfigOrPreviewWindow()?window.location.href=s.setHttpsProtocol(window.location.href):b.resolve(a)}),
e.hitch(this,function(a){b.reject(a)})):b.resolve(!1);return b},_processSignIn:function(a,b){var c=new k,g=p.getPortal(a),d=s.getSharingUrl(a);window.appInfo.isRunInPortal?(d=r.checkSignInStatus(d),d.promise.always(e.hitch(this,function(){c.resolve()}))):(!m.isInBuilderWindow()&&(!m.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig.appId&&!b)&&m.registerOAuthInfo(a,this.rawAppConfig.appId),d=r.checkSignInStatus(d),d.promise.always(e.hitch(this,function(){m.xtGetCredentialFromCookie(a);
g.loadSelfInfo().then(e.hitch(this,function(a){this.portalSelf=a;this._checkLocale();c.resolve()}))})));return c},_checkLocale:function(){if(!m.isInConfigOrPreviewWindow()){var a=this.portalSelf.user&&this.portalSelf.user.culture||h.locale,a=a.toLowerCase();c.isLocaleChanged(h.locale,a)&&(d("wab_app_locale",a),window.location.reload())}},_getAppConfigFromTemplateAppId:function(a,b){var c=p.getPortal(a);return this._getWabAppIdAndDataFromTemplateAppId(a,b).then(e.hitch(this,function(b){var g=b.appData;
return n([this._getAppConfigFromAppId(a,b.appId),c.getItemData(g.source)]).then(e.hitch(this,function(a){var b;g.appConfig?(b=g.appConfig,delete g.appConfig):b=a[0];b=this._upgradeAppConfig(b);a=a[1];b._appData=g;b.templateConfig=a;return b}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(a,b){var c=p.getPortal(a);return c.getItemData(b).then(function(a){return c.getItemData(a.source).then(function(b){return{appData:a,templateData:b}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,
b){var c=new k,g=p.getPortal(a);g.getItemData(b).then(e.hitch(this,function(a){g.getItemById(a.source).then(e.hitch(this,function(b){b=t.urlToObject(b.url);c.resolve({appId:b.query.id,appData:a})}))}),function(a){c.reject(a)});return c},_getAppConfigFromAppId:function(a,b){return p.getPortal(a).getItemData(b)},_removeHash:function(a){for(var b in a)a[b]&&(a[b]=a[b].replace("#",""))},loadWidgetsManifest:function(a){var b=[],d=new k;a._buildInfo&&a._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(e.hitch(this,
function(m){g.visitElement(a,e.hitch(this,function(a){!a.widgets&&a.uri&&(m[a.uri]?(this._addNeedValuesForManifest(m[a.uri]),c.addManifest2WidgetJson(a,m[a.uri])):b.push(this.widgetManager.loadWidgetManifest(a)))}));n(b).then(function(){d.resolve(a)})})):(g.visitElement(a,e.hitch(this,function(a){!a.widgets&&a.uri&&b.push(this.widgetManager.loadWidgetManifest(a))})),n(b).then(function(){d.resolve(a)}));setTimeout(function(){d.isResolved()||d.resolve(a)},jimuConfig.timeout);return d},_addNeedValuesForManifest:function(a){c.addManifestProperies(a);
c.processManifestLabel(a,h.locale)},_loadMergedWidgetManifests:function(){return b(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(a){var b=[],c;g.visitElement(a,function(a){if(0<b.indexOf(a.id))return c=a.id,!0;b.push(a.id)});return c},_processUrlParams:function(a){var b=this.urlParams.itemid||this.urlParams.webmap;b&&a.map.itemId!==b&&(a.map.mapOptions&&c.deleteMapOptions(a.map.mapOptions),a.map.itemId=b);this.urlParams.mode&&(a.mode=this.urlParams.mode);
a.map.mapOptions||(a.map.mapOptions={});this.urlParams.extent&&(b=-1<this.urlParams.extent.indexOf(";")?";":",",b=this.urlParams.extent.split(b),4===b.length?a.map.mapOptions.extent={xmin:parseFloat(b[0]),ymin:parseFloat(b[1]),xmax:parseFloat(b[2]),ymax:parseFloat(b[3])}:5===b.length&&(a.map.mapOptions.extent={xmin:parseFloat(b[0]),ymin:parseFloat(b[1]),xmax:parseFloat(b[2]),ymax:parseFloat(b[3]),spatialReference:{wkid:parseInt(b[4],10)}}));this.urlParams.center&&(b=-1<this.urlParams.center.indexOf(";")?
";":",",b=this.urlParams.center.split(b),2===b.length?a.map.mapOptions.center=b:3===b.length&&(b=new u(parseInt(b[0],10),parseInt(b[1],10),new w(parseInt(b[2],10))),a.map.mapOptions.center=b.toJson()));this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});x.getInstance=function(a,b){null===v?v=new x(a,b):(v.urlParams=a,v.options=b);return v};return x})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g){var m=l([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(b){this.portalUrl=a.getStandardPortalUrl(b);this.selfUrl=a.getPortalSelfInfoUrl(b)},loadSelfInfo:function(){var a=new d,c={url:this.selfUrl,content:{f:"json"},handleAs:"json",callbackParamName:"callback",preventCache:!0};this.isValidCredential()&&(c.content.token=this.credential.token);b(c).then(e.hitch(this,function(b){var c=b.user;delete b.user;
e.mixin(this,b);b.user=c;a.resolve(b)}),e.hitch(this,function(b){console.error(b);a.reject(b)}));return a},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||this.clearCredentialAndUser();return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=g.getPortalCredential(this.portalUrl))},signIn:function(){var a=new d;this.updateCredential();this.isValidCredential()?setTimeout(e.hitch(this,
function(){a.resolve(this.credential)}),0):a=g.signInPortal(this.portalUrl);return a},haveSignIn:function(){return g.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var a=new d;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(e.hitch(this,function(){this.user.updateCredential();a.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(e.hitch(this,
function(b){this.user=b;a.resolve(this.user)}),e.hitch(this,function(b){console.error(b);a.reject(b)})):g.getUserIdByToken(this.credential.token,this.portalUrl).then(e.hitch(this,function(b){this.credential.userId=b;this._getUser(this.credential.userId).then(e.hitch(this,function(b){this.user=b;a.resolve(this.user)}),e.hitch(this,function(b){console.error(b);a.reject(b)}))}),e.hitch(this,function(b){console.error(b);a.reject(b)})):setTimeout(e.hitch(this,function(){a.reject("credential is null.")}),
0);return a},queryItems:function(c){this.updateCredential();var g=new d,m=a.getBaseSearchUrl(this.portalUrl),q={f:"json"};c&&(q=e.mixin(q,c));this.isValidCredential()&&(q.token=this.credential.token);!q.sortField&&!q.sortOrder&&(q.sortField="title",q.sortOrder="asc");b({url:m,handleAs:"json",content:q,callbackParamName:"callback"}).then(e.hitch(this,function(a){a.results=f.map(a.results,e.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new r(a)}));
g.resolve(a)}),e.hitch(this,function(a){console.error(a);g.reject(a)}));return g},getItemData:function(c){this.updateCredential();c={url:a.getItemDataUrl(this.portalUrl,c),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(c.content.token=this.credential.token);return b(c)},getItemById:function(c){var g=new d;this.updateCredential();c={url:a.getItemUrl(this.portalUrl,c),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&
(c.content.token=this.credential.token);b(c).then(e.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new r(a);g.resolve(a)}),e.hitch(this,function(a){console.error(a);g.reject(a)}));return g},getAppById:function(c){var g=new d;this.updateCredential();this.isValidCredential()?(c=a.getAppIdUrl(this.portalUrl,c),g=b({url:c,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(e.hitch(this,function(){g.reject("token is null.")}),0);
return g},queryGroups:function(c){this.updateCredential();var g=new d,m=a.getBaseGroupUrl(this.portalUrl),q={f:"json"};c&&(q=e.mixin(q,c));this.isValidCredential()&&(q.token=this.credential.token);b({url:m,handleAs:"json",content:q,callbackParamName:"callback"}).then(e.hitch(this,function(a){a.results=f.map(a.results,e.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new s(a)}));g.resolve(a)}),e.hitch(this,function(a){console.error(a);g.reject(a)}));
return g},registerApp:function(c,g,m){var q=new d;this.updateCredential();if(this.isValidCredential())var r=this.credential&&this.credential.token,p=a.getOAuth2Url(this.portalUrl),q=b({url:p+"/registerApp",content:{itemId:c,appType:g,redirect_uris:n.stringify(m),token:r,f:"json"},handleAs:"json"},{usePost:!0});else setTimeout(e.hitch(this,function(){q.reject("token is null.")}),0);return q},createAndRegisterApp:function(a){var b=new d;this.updateCredential();this.isValidCredential()?this.getUser().then(e.hitch(this,
function(c){c.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(e.hitch(this,function(c){c.success?this.registerApp(c.id,"browser",a).then(e.hitch(this,function(a){b.resolve(a)}),e.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject("create app failed")}),e.hitch(this,function(a){console.error(a);b.reject(a)}))}),e.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(e.hitch(this,function(){b.reject("token is null.")}),
0);return b},_getUser:function(c){this.updateCredential();var g=new d;c={url:a.getUserUrl(this.portalUrl,c),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(c.content.token=this.credential&&this.credential.token);b(c).then(e.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;this.user=new p(a);g.resolve(this.user)}),e.hitch(this,function(a){console.error(a);g.reject(a)}));return g}}),p=l([],{declaredClass:"jimu.PortalUser",
portalUrl:null,credential:null,portal:null,constructor:function(a){a&&e.mixin(this,a)},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var a=[];this.groups&&(a=f.map(this.groups,e.hitch(this,function(a){a.portalUrl=
this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new s(a)})));return a},getItemsByKeywords:function(a,b){return this.portal.queryItems({start:b||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var c={url:a.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(c.content.token=this.credential.token);return b(c)},getTags:function(){this.updateCredential();
var c={url:a.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(c.content.token=this.credential.token);return b(c)},addItem:function(c,g){this.updateCredential();var m=new d;if(this.isValidCredential()){var q={f:"json",token:this.credential.token};c&&(q=e.mixin(q,c));b({url:a.getAddItemUrl(this.portalUrl,this.username,g),handleAs:"json",callbackParamName:"callback",content:q},{usePost:!0}).then(e.hitch(this,function(a){m.resolve(a)}),
e.hitch(this,function(a){console.error(a);m.reject(a)}))}else setTimeout(e.hitch(this,function(){m.reject("token is null.")}),0);return m},deleteItem:function(c){this.updateCredential();var g=new d;this.isValidCredential()?(c=a.getDeleteItemUrl(this.portalUrl,this.username,c),g=b({url:c,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(e.hitch(this,function(){g.reject("token is null.")}),0);return g},getItemById:function(c,g){this.updateCredential();var m=new d,
q={url:a.getUserItemsUrl(this.portalUrl,this.username,g)+"/"+c,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(q.content.token=this.credential.token);b(q).then(e.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new r(a);m.resolve(a)}),e.hitch(this,function(a){console.error(a);m.reject(a)}));return m},shareItem:function(c,g,m){this.updateCredential();var q=new d;this.isValidCredential()?(g={url:a.shareItemUrl(this.portalUrl,
this.username,g,m),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},c&&(g.content=e.mixin(g.content,c)),b(g,{usePost:!0}).then(e.hitch(this,function(a){q.resolve(a)}),e.hitch(this,function(a){console.error(a);q.reject(a)}))):setTimeout(e.hitch(this,function(){q.reject("token is null.")}),0);return q},updateItem:function(c,g){this.updateCredential();var m=new d;this.isValidCredential()?this.portal.getItemById(c).then(e.hitch(this,function(d){var q={f:"json",
token:this.credential.token};g&&(q=e.mixin(q,g));b({url:a.getUpdateItemUrl(this.portalUrl,this.username,c,d.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:q},{usePost:!0}).then(e.hitch(this,function(a){m.resolve(a)}),e.hitch(this,function(a){console.error(a);m.reject(a)}))}),e.hitch(this,function(a){console.error(a);m.reject(a)})):setTimeout(e.hitch(this,function(){m.reject("token is null.")}),0);return m},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===
this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role}}),s=l([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&e.mixin(this,a)},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},
updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+" AND "+a.q;return this.portal.queryItems(a)}}),r=l([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(b){b&&e.mixin(this,b);this.itemUrl=a.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&(this.thumbnail&&this.itemUrl)&&
(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=a.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=a.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)}}),q={portals:[],webMapQueryStr:" "+c.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+c.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(b){for(var c=0;c<this.portals.length;c++){var g=this.portals[c];if(a.isSamePortalUrl(b,g.portalUrl))return g.updateCredential(),
g}return null},getPortal:function(b){if(!b||!("string"===typeof b&&e.trim(b)))return null;b=a.getStandardPortalUrl(b);var c=this._findPortal(b);c||(c=new m(b),c.credential=g.getPortalCredential(c.portalUrl),c.updateCredential(),this.portals.push(c));return c},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},
getUnits:function(a){var b="english",c="",g=new d;this.getPortal(a).getUser().then(e.hitch(this,function(a){a&&a.units?b=a.units:(c=h.locale,b=c.startWith("en")?"english":"metric");g.resolve(b)}),e.hitch(this,function(d){console.warn(d);this.getPortalSelfInfo(a).then(e.hitch(this,function(a){c=a&&a.culture||h.locale}),e.hitch(this,function(a){console.warn(a);c=h.locale})).always(e.hitch(this,function(){b=c.startWith("en")?"english":"metric";g.resolve(b)}))}));return g.promise},_getPortalSelfGroup:function(a,
b){var c=new d,g=this.getPortal(a);g||setTimeout(e.hitch(this,function(){c.reject()}),0);this.getPortalSelfInfo(a).then(e.hitch(this,function(a){g.queryGroups({f:"json",q:a[b]}).then(e.hitch(this,function(a){0<a.results.length?(a=a.results[0],a.portalUrl=g.portalUrl,a.credential=g.credential,a.portal=g,a=new s(a),c.resolve(a)):c.reject("Can't find portal self group.")}),e.hitch(this,function(a){console.error(a);c.reject(a)}))}),e.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getWebMapsFromBasemapGalleryGroup:function(a){var b=
new d;this.getBasemapGalleryGroup(a).then(e.hitch(this,function(a){a?a.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(e.hitch(this,function(a){b.resolve(a)}),e.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject()}),e.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getDefaultWebScene:function(a){var b=new d,c=this.getPortal(a);c.getUser().then(e.hitch(this,function(a){c.queryItems({start:1,num:1,f:"json",q:this.webSceneQueryStr+' AND owner:"'+a.username+
'" ',sortField:"numViews",sortOrder:"desc"}).then(e.hitch(this,function(a){a=a.results;a=f.filter(a,e.hitch(this,function(a){return a.type&&"web scene"===a.type.toLowerCase()}));0<a.length?b.resolve(a[0].id):b.resolve(null)}),e.hitch(this,function(a){b.reject(a)}))}),e.hitch(this,function(){b.reject("not sign in")}));return b},getDefaultWebMap:function(a){var b=new d;this.getPortalSelfInfo(a).then(e.hitch(this,function(c){var g=c.defaultBasemap&&c.defaultBasemap.id;g?b.resolve(g):this._getDefaultWebMapByBasemapGallery(a,
c).then(e.hitch(this,function(c){c?b.resolve(c):this._getMostNumViewsWebMap(a).then(e.hitch(this,function(a){a?b.resolve(a):b.reject()}),e.hitch(this,function(a){console.error(a);b.reject(a)}))}),e.hitch(this,function(a){console.error(a);b.reject(a)}))}),e.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_getDefaultWebMapByBasemapGallery:function(a,b){var c=new d,g=this.getPortal(a),m=b.defaultBasemap&&b.defaultBasemap.title;g.queryGroups({f:"json",q:b.basemapGalleryGroupQuery}).then(e.hitch(this,
function(a){a=a.results;0<a.length?g.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+m}).then(e.hitch(this,function(a){a=a.results;a=f.filter(a,e.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?c.resolve(a[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),g.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+m}).then(e.hitch(this,function(a){a=a.results;a=f.filter(a,e.hitch(this,
function(a){return a.type&&"web map"===a.type.toLowerCase()}));if(0<a.length){var b=a[0];g.getItemData(b.id).then(e.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?c.resolve(b.id):c.resolve(null)}),e.hitch(this,function(){c.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),c.resolve(null)}),e.hitch(this,function(a){console.error(a);c.reject(a)})))}),e.hitch(this,function(a){console.error(a);c.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),
c.resolve(null))}),e.hitch(this,function(a){console.error(a);c.reject(a)}));return c},_getMostNumViewsWebMap:function(a){var b=new d;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(e.hitch(this,function(a){a=a.results;a=f.filter(a,e.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?b.resolve(a[0].id):b.reject("Can't find most-num-views web map.")}),e.hitch(this,
function(a){console.error(a);b.reject(a)}));return b}};k.subscribe("userSignOut",function(a){(a=q._findPortal(a))&&a.clearCredentialAndUser()});return q})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/dom-construct dojo/dom-geometry dojo/Deferred dojo/promise/all dojo/when require ./WidgetManager ./PanelManager ./MapManager ./utils ./OnScreenWidgetIcon ./WidgetPlaceholder ./dijit/LoadingShelter".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w,v){var x=null,B;B=l([d],{constructor:function(a,b){this.widgetManager=s.getInstance();this.panelManager=r.getInstance();this.own(k.subscribe("appConfigLoaded",e.hitch(this,this.onAppConfigLoaded)));this.own(k.subscribe("appConfigChanged",e.hitch(this,this.onAppConfigChanged)));this.own(k.subscribe("mapLoaded",e.hitch(this,this.onMapLoaded)));this.own(k.subscribe("mapChanged",e.hitch(this,this.onMapChanged)));this.own(k.subscribe("beforeMapDestory",e.hitch(this,
this.onBeforeMapDestory)));this.own(k.subscribe("builder/actionTriggered",e.hitch(this,this.onActionTriggered)));this.own(k.subscribe("openWidget",e.hitch(this,this._onOpenWidgetRequest)));this.widgetPlaceholders=[];this.preloadWidgetIcons=[];this.preloadGroupPanels=[];this.invisibleWidgetIds=[];this.own(n(window,"resize",e.hitch(this,this.resize)));this.id=b},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",hlDiv:null,animTime:500,resize:function(){f.forEach(this.widgetManager.getAllWidgets(),
function(a){!1===a.inPanel&&a.resize()},this)},onAppConfigLoaded:function(a){this.appConfig=e.clone(a);this.appConfig.theme&&this._loadTheme(this.appConfig.theme);this._loadMap()},onAppConfigChanged:function(a,b,c){a=e.clone(a);switch(b){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,c);break;case "groupChange":this._onGroupChange(a,c);break;case "widgetPoolChange":this._onWidgetPoolChange(a,
c);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,c)}this.appConfig=a},onMapLoaded:function(a){this.map=a;this.panelManager.setMap(a);this._loadPreloadWidgets(this.appConfig)},onMapChanged:function(a){this.map=a;this.panelManager.map=a;this._loadPreloadWidgets(this.appConfig)},onBeforeMapDestory:function(){this.panelManager.destroyAllPanels();this._destroyOffPanelWidgets();this._destroyWidgetPlaceholders();this._destroyPreloadWidgetIcons()},
onActionTriggered:function(a){"highLight"===a.action&&(f.forEach(this.widgetPlaceholders,function(b){b.configId===a.elementId&&this._highLight(b)},this),f.forEach(this.preloadWidgetIcons,function(b){b.configId===a.elementId&&this._highLight(b)},this),f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(b){b.configId===a.elementId&&this._highLight(b)},this),f.forEach(this.preloadGroupPanels,function(b){b.configId===a.elementId&&this._highLight(b)},this));"removeHighLight"===a.action&&
this._removeHighLight();"showLoading"===a.action&&(h.setStyle(jimuConfig.loadingId,"display","block"),h.setStyle(jimuConfig.mainPageId,"display","none"));"showApp"===a.action&&(h.setStyle(jimuConfig.loadingId,"display","none"),h.setStyle(jimuConfig.mainPageId,"display","block"))},_highLight:function(a){if(a.domNode){this.hlDiv&&this._removeHighLight(a);var g=c.getMarginBox(a.domNode);this.hlDiv=b.create("div",{style:{position:"absolute",left:g.l+"px",top:g.t+"px",width:g.w+"px",height:g.h+"px"},"class":"icon-highlight"},
a.domNode,"before")}},_removeHighLight:function(){this.hlDiv&&(b.destroy(this.hlDiv),this.hlDiv=null)},_onWidgetChange:function(a,b){b=a.getConfigElementById(b.id);b.isController?this._reloadControllerWidget(a,b.id):(f.forEach(this.widgetPlaceholders,function(c){c.configId===b.id&&(c.destroy(),this._loadPreloadWidget(b,a))},this),this._removeDestroyed(this.widgetPlaceholders),f.forEach(this.preloadWidgetIcons,function(c){if(c.configId===b.id){var g=c.state;c.destroy();this._loadPreloadWidget(b,a).then(function(a){if(b.uri&&
"opened"===g)a.onClick()})}},this),this._removeDestroyed(this.preloadWidgetIcons),f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(c){c.configId===b.id&&(c.destroy(),!1===b.visible?0>this.invisibleWidgetIds.indexOf(b.id)&&this.invisibleWidgetIds.push(b.id):this._loadPreloadWidget(b,a))},this),f.forEach(this.preloadGroupPanels,function(a){a.reloadWidget(b)},this),this._updatePlaceholder(a),f.forEach(this.invisibleWidgetIds,function(c){c===b.id&&!1!==b.visible&&(this._loadPreloadWidget(b,
a),c=this.invisibleWidgetIds.indexOf(b.id),this.invisibleWidgetIds.splice(c,1))},this),b.isOnScreen||f.forEach(this.widgetManager.getControllerWidgets(),function(c){c.widgetIsControlled(b.id)&&this._reloadControllerWidget(a,c.id)},this))},_onGroupChange:function(a,b){b=a.getConfigElementById(b.id);b.isOnScreen?(this.panelManager.destroyPanel(b.id+"_panel"),this._removeDestroyed(this.preloadGroupPanels),this._loadPreloadGroup(b)):(f.forEach(this.widgetManager.getControllerWidgets(),function(c){c.isControlled(b.id)&&
this._reloadControllerWidget(a,c.id)},this),f.forEach(this.panelManager.panels,function(a){a.config.id===b.id&&a.updateConfig(b)},this))},_updatePlaceholder:function(a){f.forEach(this.widgetPlaceholders,function(b){b.setIndex(a.getConfigElementById(b.configId).placeholderIndex)},this)},_onWidgetPoolChange:function(a,b){this._reloadControllerWidget(a,b.controllerId)},_reloadControllerWidget:function(a,b){var c=this.widgetManager.getWidgetById(b);if(c){var g=c.getOpenedIds(),d=c.windowState;f.forEach(c.getAllConfigs(),
function(a){if(a.widgets)this.panelManager.destroyPanel(a.id+"_panel"),f.forEach(a.widgets,function(a){this.panelManager.destroyPanel(a.id+"_panel")},this);else{var b=this.widgetManager.getWidgetById(a.id);b&&(a.inPanel?this.panelManager.destroyPanel(b.getPanel()):this.widgetManager.destroyWidget(b))}},this);this.widgetManager.destroyWidget(c);c=a.getConfigElementById(b);!1!==c.visible&&this._loadPreloadWidget(c,a).then(e.hitch(this,function(a){this.widgetManager.changeWindowStateTo(a,d);g&&a.setOpenedIds(g)}))}},
_removeDestroyed:function(a){var b=[];f.forEach(a,function(a){a._destroyed&&b.push(a)});f.forEach(b,function(b){b=a.indexOf(b);a.splice(b,1)})},_destroyPreloadWidgetIcons:function(){f.forEach(this.preloadWidgetIcons,function(a){a.destroy()},this);this.preloadWidgetIcons=[]},_destroyOffPanelWidgets:function(){f.forEach(this.widgetManager.getOffPanelWidgets(),function(a){this.widgetManager.destroyWidget(a)},this)},_destroyWidgetPlaceholders:function(){f.forEach(this.widgetPlaceholders,function(a){a.destroy()},
this);this.widgetPlaceholders=[]},_destroyPreloadGroupPanels:function(){f.forEach(this.preloadGroupPanels,function(a){this.panelManager.destroyPanel(a)},this);this.preloadGroupPanels=[]},_changeMapPosition:function(a){this.map&&(t.isEqual(this.mapManager.getMapPosition(),a.map.position)||this.mapManager.setMapPosition(a.map.position))},_onThemeChange:function(a){this._destroyPreloadWidgetIcons();this._destroyWidgetPlaceholders();this._destroyOffPanelWidgets();this.panelManager.destroyAllPanels();
this._updateCommonStyle(a);this._onStyleChange(a);this._changeMapPosition(a);this._loadPreloadWidgets(a)},_onResetConfig:function(a){a.map.itemId!==this.appConfig.map.itemId?(k.publish("appConfigChanged",a,"mapChange",a),this._updateCommonStyle(a),this._onStyleChange(a),this._changeMapPosition(a)):this._onThemeChange(a)},_onLoadingPageChange:function(a,b){if("backgroundColor"in b)h.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor);else if("backgroundImage"in b){var c=
a.loadingPage.backgroundImage;c.visible&&c.uri?(h.setStyle(jimuConfig.loadingImageId,"background-image","url('"+c.uri+"')"),h.setStyle(jimuConfig.loadingImageId,"width",c.width+"px"),h.setStyle(jimuConfig.loadingImageId,"height",c.height+"px")):(h.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),h.setStyle(jimuConfig.loadingImageId,"width","0px"),h.setStyle(jimuConfig.loadingImageId,"height","0px"))}else"loadingGif"in b&&(c=a.loadingPage.loadingGif,c.visible&&c.uri?(h.setStyle(jimuConfig.loadingGifId,
"background-image","url('"+c.uri+"')"),h.setStyle(jimuConfig.loadingGifId,"width",c.width+"px"),h.setStyle(jimuConfig.loadingGifId,"height",c.height+"px")):(h.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),h.setStyle(jimuConfig.loadingGifId,"width","0px"),h.setStyle(jimuConfig.loadingGifId,"height","0px")))},_updateCommonStyle:function(a){var b=this.appConfig.theme;h.removeClass(this.domNode,b.name);h.destroy(this._getThemeCommonStyleId(b));this._loadThemeCommonStyle(a.theme)},_onStyleChange:function(a){var b=
this.appConfig.theme;b.styles!==a.theme.styles&&(b.styles[0]!==a.theme.styles[0]&&h.removeClass(this.domNode,b.styles[0]),h.destroy(this._getThemeCurrentStyleId(b)),this._loadThemeCurrentStyle(a.theme))},_onLayoutChange:function(a){this._changeMapPosition(a);f.forEach(this.widgetPlaceholders,function(b){b.moveTo(a.getConfigElementById(b.configId).position)},this);f.forEach(this.preloadWidgetIcons,function(b){b.moveTo(a.getConfigElementById(b.configId).position)},this);f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),
function(b){if(!b.closeable){var c=a.getConfigElementById(b.id).position;b.setPosition(c)}},this);f.forEach(this.preloadGroupPanels,function(b){var c=a.getConfigElementById(b.config.id).panel.position;b.setPosition(c)},this)},_loadTheme:function(a){p(["themes/"+a.name+"/main"],e.hitch(this,function(){this._loadThemeCommonStyle(a);this._loadThemeCurrentStyle(a)}))},_loadThemeCommonStyle:function(a){t.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css");h.addClass(this.domNode,
a.name)},_loadThemeCurrentStyle:function(a){t.loadStyleLink(this._getThemeCurrentStyleId(a),"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css");h.addClass(this.domNode,a.styles[0])},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_loadMap:function(){h.create("div",{id:this.mapId,style:e.mixin({position:"absolute",backgroundColor:"#EEEEEE",overflow:"hidden",minWidth:"1px",minHeight:"1px"})},
this.id);this.mapManager=q.getInstance(this.appConfig,this.mapId);this.mapManager.setMapPosition(this.appConfig.map.position);this.mapManager.showMap()},_createPreloadWidgetPlaceHolder:function(a){var b;b="map"===a.position.relativeTo?this.mapId:this.id;var c=e.clone(a);c.position.width=40;c.position.height=40;var g=t.getPositionStyle(c.position);a=new w({index:c.placeholderIndex,configId:a.id});h.setStyle(a.domNode,g);h.place(a.domNode,b);this.widgetPlaceholders.push(a);return a},_createPreloadWidgetIcon:function(a){var b=
new u({panelManager:this.panelManager,widgetManager:this.widgetManager,widgetConfig:a,configId:a.id,map:this.map});"map"===a.position.relativeTo?h.place(b.domNode,this.mapId):h.place(b.domNode,this.id);h.setStyle(b.domNode,t.getPositionStyle({top:a.position.top,left:a.position.left,right:a.position.right,bottom:a.position.bottom,width:40,height:40}));b.startup();!this.openAtStartWidget&&a.openAtStart&&(b.switchToOpen(),this.openAtStartWidget=a.name);this.preloadWidgetIcons.push(b);return b},_loadPreloadWidgets:function(a){console.time("Load widgetOnScreen");
var b=new v,c=[];b.placeAt(this.id);b.startup();f.forEach(a.widgetOnScreen.widgets,function(b){!1===b.visible?this.invisibleWidgetIds.push(b.id):c.push(this._loadPreloadWidget(b,a))},this);f.forEach(a.widgetOnScreen.groups,function(a){c.push(this._loadPreloadGroup(a))},this);g(c).then(e.hitch(this,function(){b&&(b.destroy(),b=null);console.timeEnd("Load widgetOnScreen");k.publish("preloadWidgetsLoaded");this._doPostLoad()}),e.hitch(this,function(){b&&(b.destroy(),b=null);console.timeEnd("Load widgetOnScreen");
k.publish("preloadWidgetsLoaded");this._doPostLoad()}))},_doPostLoad:function(){p(["dynamic-modules/postload"])},_loadPreloadWidget:function(b,c){var g=new a;if("config"===c.mode&&!b.uri){var d=this._createPreloadWidgetPlaceHolder(b);g.resolve(d);return g}if(!b.uri)return g.resolve(null),g;b.inPanel||b.closeable?(d=this._createPreloadWidgetIcon(b),g.resolve(d)):this.widgetManager.loadWidget(b).then(e.hitch(this,function(a){try{a.setPosition(a.position),this.widgetManager.openWidget(a)}catch(c){console.log(console.error("fail to startup widget "+
a.name+". "+c.stack))}a.configId=b.id;g.resolve(a)}),function(a){g.reject(a)});return g},_loadPreloadGroup:function(a){return!this.appConfig.mode&&(!a.widgets||0===a.widgets.length)?m(null):this.panelManager.showPanel(a).then(e.hitch(this,function(b){b.configId=a.id;this.preloadGroupPanels.push(b);return b}))},_onOpenWidgetRequest:function(a){f.forEach(this.preloadWidgetIcons,function(b){b.configId===a&&b.switchToOpen()},this);f.forEach(this.widgetManager.getControllerWidgets(),function(b){b.widgetIsControlled(a)&&
b.setOpenedIds([a])},this)}});B.getInstance=function(a,b){null===x&&(x=new B(a,b));return x};return B})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m){var p,s=null;p=l(null,{constructor:function(){this.panels=[];this.widgetManager=m.getInstance();n(window,"resize",e.hitch(this,this.onWindowResize));this.activePanel=
null;b.subscribe("/dnd/move/start",e.hitch(this,this._onMoveStart));b.subscribe("widgetActived",e.hitch(this,this._onWidgetActived))},showPanel:function(b){var c=new k,d=this.getPanelById(b.id+"_panel");d?("closed"===d.state&&this.openPanel(d),c.resolve(d)):a([b.panel.uri],e.hitch(this,function(a){var d=b.id+"_panel",m=this.getPanelById(d),p={label:b.label,config:b,uri:b.panel.uri,position:b.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,id:d,gid:b.gid};e.mixin(p,b.panel.options);
try{m=new a(p),console.log("panel ["+d+"] created.")}catch(s){console.log("create panel error: "+s+", panelId: "+d);c.reject(s);return}m.setPosition(b.panel.position);g.setVerticalCenter(m.domNode);this.openPanel(m);this.panels.push(m);n(m.domNode,"click",e.hitch(this,this._onPanelClick,m));c.resolve(m)}));return c},setMap:function(a){this.map=a;n(this.map,"resize",e.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;
for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a&&this.closePanel(this.panels[b])},openPanel:function(a){var b=new k;if("string"===typeof a&&(a=this.getPanelById(a),!a))return b.reject(),b;if(!a.started)try{a.started=!0,a.startup()}catch(c){console.error("fail to startup panel "+a.id+". "+c.stack)}if("opened"===a.state)return b.resolve(a),
b;a.setState("opened");return this.playOpenPanelAnimation(a).then(e.hitch(this,function(){h.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new k;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&h.setStyle(a.domNode,
"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(b){console.log(console.error("fail to minimize panel "+a.id+". "+b.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(b){console.log(console.error("fail to maximize panel "+
a.id+". "+b.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(b){console.log(console.error("fail to noralize panel "+a.id+". "+b.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+
b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(b){console.log(console.error("fail to destroy panel "+a.id+". "+b.stack))}}},destroyAllPanels:function(){var a=f.map(this.panels,function(a){return a.id});f.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return c();var b=new k;"string"===typeof a.openAnimation?
"fadeIn"===a.openAnimation?(h.setStyle(a.domNode,{opacity:0,display:""}),d.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return c();var b=new k;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?d.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():
b.resolve());return b},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=h.getMarginBox(window.jimuConfig.layoutId),c=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?b.h>b.w?{left:0,right:0,top:"auto",
bottom:0,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:0,width:b.w/2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:
b.h>b.w?{left:0,right:0,top:c,bottom:0,width:"auto",height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,
borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&h.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),h.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=
this.widgetManager.activeWidget;b&&("active"===b.state&&b.getPanel()!==a)&&(b.setState("opened"),h.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&h.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);
-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){f.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},this)},_onWidgetActived:function(a){this.activePanel&&("active"===this.activePanel.state&&a.getPanel()!==this.activePanel)&&(this.activePanel.setState("opened"),h.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),
this.activePanel.onDeActive(),this.activePanel=null)}});p.getInstance=function(){null===s&&(s=new p);return s};return p})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/aspect dojo/keys esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/geometry/Extent esri/geometry/Point require ./utils ./dijit/LoadingShelter".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t){var u=null,w=l(null,
{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,constructor:function(a,b){this.appConfig=a;this.id=this.mapDivId=b;d.subscribe("appConfigChanged",e.hitch(this,this.onAppConfigChanged));d.subscribe("changeMapPosition",e.hitch(this,this.onChangeMapPosition));d.subscribe("syncExtent",e.hitch(this,this.onSyncExtent));k(window,"resize",e.hitch(this,this.onWindowResize))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");
this.loading=new t;this.loading.placeAt(this.mapDivId);this.loading.startup();a.map["3D"]?a.map.itemId?this._show3DWebScene(a):this._show3DLayersMap(a):a.map.itemId?this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(b){b&&(this._mapInfoWindow=
this.map.infoWindow,this._mapMobileInfoWindow&&this._mapMobileInfoWindow.destroy(),this._mapMobileInfoWindow=new a(null,h.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=
!1)},onChangeMapPosition:function(a){var b=e.clone(this.mapPosition);e.mixin(b,a);this.setMapPosition(b)},setMapPosition:function(a){this.mapPosition=a;a=q.getPositionStyle(a);h.setStyle(this.mapDivId,a);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncExtent:function(a){this.map&&(a=new p(a.extent),this.map.setExtent(a))},_visitConfigMapLayers:function(a,b){f.forEach(a.map.basemaps,function(a,c){a.isOperationalLayer=!1;b(a,c)},this);f.forEach(a.map.operationallayers,
function(a,c){a.isOperationalLayer=!0;b(a,c)},this)},_show3DLayersMap:function(a){r(["esri3d/Map"],e.hitch(this,function(b){var c;c=new b(this.mapDivId,{camera:a.map.mapOptions.camera});this._visitConfigMapLayers(a,e.hitch(this,function(a){this.createLayer(c,"3D",a)}));c.usePlugin=b.usePlugin;this._publishMapEvent(c)}))},_show3DWebScene:function(a){this._getWebsceneData(a.map.itemId).then(e.hitch(this,function(b){r(["esri3d/Map"],e.hitch(this,function(c){var g=new c(this.mapDivId,a.map.mapOptions);
f.forEach(b.itemData.operationalLayers,function(a){this.createLayer(g,"3D",a)},this);f.forEach(b.itemData.baseMap.baseMapLayers,function(a){a.type="tile";this.createLayer(g,"3D",a)},this);f.forEach(b.itemData.baseMap.elevationLayers,function(a){a.type="elevation";this.createLayer(g,"3D",a)},this);g.toc=b.itemData.toc;g.bookmarks=b.itemData.bookmarks;g.tours=b.itemData.tours}))}))},_publishMapEvent:function(a){window._viewerMap=a;this.loading&&this.loading.destroy();console.timeEnd("Load Map");this.map?
(this.map=a,this.resetInfoWindow(!0),console.log("map changed."),d.publish("mapChanged",this.map)):(this.map=a,this.resetInfoWindow(!0),d.publish("mapLoaded",this.map))},_getWebsceneData:function(a){return m({url:"http://184.169.133.166/sharing/rest/content/items/"+a+"/data",handleAs:"json"})},_show2DWebMap:function(a){a.map.mapOptions||(a.map.mapOptions={});var c=this._processMapOptions(a.map.mapOptions)||{};c.isZoomSlider=!1;q.createWebMap(a.map.portalUrl,a.map.itemId,this.mapDivId,{mapOptions:c,
bingMapsKey:a.bingMapsKey,usePopupManager:!0}).then(e.hitch(this,function(c){var g=c.map;g.hideZoomSlider();g.infoWindow.resize(270,316);g.itemId=a.map.itemId;g.itemInfo=c.itemInfo;g.webMapResponse=c;g.enableSnapping({snapKey:b.copyKey});h.setStyle(g.root,"zIndex",0);this._publishMapEvent(g)}),e.hitch(this,function(){this.loading&&this.loading.destroy();d.publish("mapCreatedFailed")}))},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=e.clone(a),
a.extent&&(a.extent=new p(a.extent)),a.center&&!e.isArrayLike(a.center)&&(a.center=new s(a.center)),a.infoWindow&&(a.infoWindow=new c(a.infoWindow,h.create("div",{},this.mapDivId))),a},createLayer:function(a,b,c){r([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer","2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer","2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer",
"2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[b+"_"+c.type]],e.hitch(this,function(b){var d,m={};d="label url type icon infoTemplate isOperationalLayer".split(" ");for(var p in c)0>
d.indexOf(p)&&(m[p]=c[p]);c.infoTemplate?(d=new g(c.infoTemplate.title,c.infoTemplate.content),m.infoTemplate=d,b=new b(c.url,m),c.infoTemplate.width&&c.infoTemplate.height&&n.after(b,"onClick",e.hitch(this,function(){a.infoWindow.resize(c.infoTemplate.width,c.infoTemplate.height)}),!0)):b=new b(c.url,m);b.isOperationalLayer=c.isOperationalLayer;b.label=c.label;b.icon=c.icon;a.addLayer(b)}))},onAppConfigChanged:function(a,b,c){this.appConfig=a;"mapChange"===b?this._recreateMap(a):"mapOptionsChange"===
b&&c.lods&&this._recreateMap(a)},_recreateMap:function(a){this.map&&(d.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(a)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});w.getInstance=function(a,b){null===u&&(u=new w(a,b));return u};return w})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w){var v=l([u,m,p,s,t],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:w,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(b){this.inherited(arguments);a.place(this.domNode,b.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[v.ANCHOR_UPPERRIGHT,v.ANCHOR_LOWERRIGHT,v.ANCHOR_LOWERLEFT,v.ANCHOR_UPPERLEFT];
if(7>k("ie")){var b="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+g.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",c=a.create("div",null,h.body());g.set(c,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:b});var m=setTimeout(function(){a.destroy(c);clearTimeout(m);m=c=null},100);d.query(".sprite",this.domNode).forEach(function(a){a.style.backgroundImage="none";a.style.filter=
b})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(a,b){if(a&&b){var c=g.set;c(this._topleft,{height:b+"px",marginLeft:a+"px"});c(this._topright,{width:a+"px",height:b+"px"});c(this._user,"width",a-8+"px");c(this._hide,"marginLeft",a-22+"px");c(this._title,"width",a-25+
"px");c(this._content,"height",b-37+"px");c(this._bottomleft,{marginLeft:a+"px",marginTop:b+"px"});c(this._bottomright,{width:a-5+"px",marginTop:b+"px"});this.width=a;this.height=b;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(a,b)}},_adjustPosition:function(a,b){var c=g.set;c(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"});b===v.ANCHOR_UPPERLEFT?c(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):b===v.ANCHOR_UPPERRIGHT?
c(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):b===v.ANCHOR_LOWERRIGHT?c(this._window,{left:"6px",right:null,top:"43px",bottom:null}):b===v.ANCHOR_LOWERLEFT&&c(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(a){var b=this.map;return b&&a?(a.y<b.height/2?"lower":"upper")+(a.x<b.width/2?"right":"left"):"upperright"},show:function(a,b,g){if(a){a.spatialReference?(this.mapCoords=a,a=this.coords=this.map.toScreen(a,!0)):(this.mapCoords=
null,this.coords=a);var d=this.map._getFrameWidth();if(-1!==d&&(a.x%=d,0>a.x&&(a.x+=d),this.map.width>d))for(var m=(this.map.width-d)/2;a.x<m;)a.x+=d;if(!b||-1===f.indexOf(this._ANCHORS,b))b=this._getAnchor(a);c.remove(this._pointer,this.anchor);b=this.anchor=this.fixedAnchor||b;this._adjustPosition(a,b);c.add(this._pointer,b);q.show(this.domNode);this.isShowing=!0;if(!g)this.onShow()}},hide:function(a,b){q.hide(this.domNode);this.isShowing=!1;if(!b)this.onHide()},showTitleBar:function(){q.show(this._titlebar);
q.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){q.hide(this._titlebar);q.hide(this._border);this.isTitleBarShowing=!1},showContent:function(){q.show(this._content);q.show(this._border);this.isContentShowing=!0},hideContent:function(){q.hide(this._content);q.hide(this._border);this.isContentShowing=!1},move:function(a,b){b?a=this.coords.offset(a.x,a.y):(this.coords=a,this.mapCoords&&(this.mapCoords=this.map.toMap(a)));g.set(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+
"px"})},setFixedAnchor:function(a){a&&-1===f.indexOf(this._ANCHORS,a)||(this.fixedAnchor=a,this.isShowing&&this.show(this.mapCoords||this.coords,a),this.onAnchorChange(a))},setTitle:function(a){this.destroyDijits(this._title);this.__setValue("_title",a);return this},setContent:function(a){this.destroyDijits(this._content);this.__setValue("_content",a);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},
onResize:function(){},onAnchorChange:function(){}});e.mixin(v,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});return v})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w,v,x,B){return e([q,t],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:l.toUrl("./images/whitex.png"),dArrowIcon:l.toUrl("./images/whitedown.png"),lArrowIcon:l.toUrl("./images/whitel.png"),rArrowIcon:l.toUrl("./images/whiter.png"),constructor:function(b,c){this.initialize();f.mixin(this,b);this.domNode=a.byId(c);this._nls=f.mixin({},
B.widgets.popup);var d=this.domNode;m.add(d,"esriPopupMobile");g.set(d,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
var e=n.query(".titlePane",d)[0];this._arrowButton=n.query(".arrow",e)[0];this._pointerTop=n.query(".top",d)[0];this._pointerBottom=n.query(".bottom",d)[0];this._title=n.query(".title",e)[0];this._footer=n.query(".footer",e)[0];this._prev=n.query(".prev",e)[0];this._next=n.query(".next",e)[0];this._spinner=n.query(".spinner",e)[0];this._eventConnections=[h.connect(n.query(".close",e)[0],"onclick",this,this.hide),h.connect(this._arrowButton,"onclick",this,this._toggleView),h.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),h.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();x.hide(d);this.isShowing=!1},setMap:function(a){this.inherited(arguments);p.place(this.domNode,a.root);this.highlight&&this.enableHighlight(a)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(a,b){this.destroyDijits(this._title);this.place(a,this._title);
this.destroyDijits(this._footer);this.place(b,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(a){this.destroyDijits(this._contentPane);this.place(a,this._contentPane);this.startupDijits(this._contentPane)},show:function(a){if(a){var b=this.map;a.spatialReference?(this.location=a,a=b.toScreen(a)):this.location=b.toMap(a);this._maximized?this.restore():this._setPosition(a);this.isShowing||(x.show(this.domNode),this.isShowing=!0,this.onShow())}else x.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(x.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);d.forEach(this._eventConnections,h.disconnect);p.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");m.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var a=this.selectedIndex;this._updateUI();0<=a&&(this.setContent(this.features[a].getContent()),this.updateHighlight(this.map,this.features[a]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var a=this.map;this._handles=[h.connect(a,"onPanStart",this,this._onPanStart),h.connect(a,"onPan",this,this._onPan),h.connect(a,"onZoomStart",this,this._onZoomStart),h.connect(a,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var a=this._handles;a&&(d.forEach(a,h.disconnect),this._handles=null)},_onPanStart:function(){var a=this.domNode.style;this._panOrigin={left:a.left,top:a.top,right:a.right,
bottom:a.bottom}},_onPan:function(a,b){var c=this._panOrigin,g=b.x,d=b.y,m=c.left,e=c.top,p=c.right,c=c.bottom;m&&(m=parseFloat(m)+g+"px");e&&(e=parseFloat(e)+d+"px");p&&(p=parseFloat(p)-g+"px");c&&(c=parseFloat(c)-d+"px");r.set(this.domNode,{left:m,top:e,right:p,bottom:c})},_onZoomStart:function(){x.hide(this.domNode)},_onExtentChange:function(a,b,c){c&&(x.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(a){var b=a.x;a=a.y;var c=
s.getContentBox(this.map.container),g=c.w,c=c.h,d=0,e=a+10,p=118,q=g-18;18<b&&b<q?(d=b-130,0>d?d=0:d>g-260&&(d=g-260)):18>=b?d=b-18:b>=q&&(d=g-260+(b-q));118<b&&b<g-130?p=118:118>=b?18<b?p=b-12:18>=b&&(p=6):b>=g-130&&(b<q?p=118+b-(g-130):b>=q&&(p=118+q-(g-130)));a<=c/2?(r.set(this.domNode,{left:d+"px",top:e+"px",bottom:null}),r.set(this._pointerTop,{left:p+"px"}),m.add(this._pointerBottom,"hidden"),m.remove(this._pointerTop,"hidden")):(r.set(this.domNode,{left:d+"px",top:e-64+"px",bottom:null}),r.set(this._pointerBottom,
{left:p+"px"}),m.add(this._pointerTop,"hidden"),m.remove(this._pointerBottom,"hidden"))},_showPointer:function(a){d.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(b){b===a?n.query(".pointer."+b,this.domNode).removeClass("hidden"):n.query(".pointer."+b,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();x.show(this.popupNavigationBar.container);x.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(a){this.popupInfoView.animateTo(0);switch(a.name){case "CloseButton":x.hide(this.popupNavigationBar.container);x.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":x.hide(this.popupNavigationBar.container);x.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var a={};a.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new w(a,p.create("div",{},k.body()));h.connect(this.popupNavigationBar,"onCreate",this,function(a){this._prevFeatureButton=a[3]._node;this._nextFeatureButton=a[4]._node});h.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);h.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();x.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new u({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},p.create("div",{},k.body()));m.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();h.connect(this.popupInfoView,"onCreate",this,function(a){this._contentPane=a[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});h.connect(this.popupInfoView,"onSwipeLeft",this,function(){});h.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var a="\x26nbsp;",b="\x26nbsp;",c=this.selectedIndex,g=this.features,d=this.deferreds,e=this._prevFeatureButton.parentNode,p=this._nextFeatureButton.parentNode,q=this._spinner,s=this._nls;g&&1<=g.length?(a=g[c].getTitle(),b=c+1+" of "+g.length,m.remove(this._arrowButton,"hidden"),0===c?(m.add(e,"hidden"),m.add(this._prev,"hidden")):(m.remove(e,"hidden"),m.remove(this._prev,"hidden")),c===g.length-1?(m.add(p,"hidden"),
m.add(this._next,"hidden")):(m.remove(p,"hidden"),m.remove(this._next,"hidden"))):(m.add(this._arrowButton,"hidden"),m.add(e,"hidden"),m.add(p,"hidden"),m.add(this._prev,"hidden"),m.add(this._next,"hidden"));this.setTitle(a,b);this.popupNavigationBar.getItems()[1]._node.innerHTML=b;d&&d.length?(m.remove(q,"hidden"),this.setTitle(s.NLS_searching+"...","\x26nbsp;")):(m.add(q,"hidden"),(!g||!g.length)&&this.setTitle("No Information","\x26nbsp;"))}})})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p){return l(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(g,d){var m;this.container=b.byId(d);this._touchBase=p(this.container,null);this._slideDiv=a.create("div",null,this.container,"first");this.events=[];this._items=g.items;g.sections&&(this._sections=g.sections);c.add(this.container,"esriMobileInfoView");if(0===this._sections.length)a.create("div",{},this._slideDiv);else for(m=0;m<this._sections.length;m++){var e=
a.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv);a.create("div",{innerHTML:this._sections[m].title},e)}for(m=0;m<this._items.length;m++){var k,e=0;this._items[m].section&&(e=this._items[m].section);switch(this._items[m].type){case "div":k=a.create("div",{"class":"esriMobileInfoViewItem",style:this._items[m].style},this._slideDiv.childNodes[e]),k=a.create("div",{innerHTML:this._items[m].text},k)}this._items[m].className&&c.add(k,this._items[m].className);k._index=m;k._item=this._items[m];
this._items[m]._node=k}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){f.forEach(this.events,h.disconnect);this._touchBase=null;d.query("img",this.container).forEach(function(b){b._index=null;b._item=null;a.destroy(b)});this._items=null;a.destroy(this._slideDiv);a.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);
this.events.push(h.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(h.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(h.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){h.disconnect(this.events.pop());h.disconnect(this.events.pop());h.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);
this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},
_onTouchMoveHandler:function(a){this._moveDirection||(Math.abs(a.curY)>Math.abs(a.curX)?this._moveDirection="vertical":this._moveDirection="horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(a.touches[0].clientY-this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===
this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return 0.2<Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var a,b;a=g.getContentBox(this.container);var c=0>this._velocity?0.0010:-0.0010;b=-(this._velocity*this._velocity)/(2*c);var d=-this._velocity/c,c=3*0.6-0,m=1-c,e=0,p=0;if(a.h>
this._slideDiv.scrollHeight)this.contentOffsetY=0,p=300;else if(0<this.contentOffsetY+b){a=0;for(b=Math.floor(d/20);a<b;a++)if(e=(m*20*a^3)+(c*20*a^2)+0*20*a+0,e=0>this._velocity?-e:e,0<this.contentOffsetY+e){p=20*a;break}0===p&&(p=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+b)+a.h>this._slideDiv.scrollHeight){this.contentOffsetY=a.h-this._slideDiv.scrollHeight;a=0;for(b=Math.floor(d/20);a<b;a++)if(e=(m*20*a^3)+(c*20*a^2)+0*20*a+0,e=0>this._velocity?-e:e,Math.abs(this.contentOffsetY+
e)>this._slideDiv.scrollHeight){p=20*a;break}}else p=d,this.contentOffsetY+=b;this._slideDiv.style.webkitTransition="-webkit-transform "+p+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=g.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration=
"0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState=
"OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))}})})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),function(l,e,f,h,d,k){return l(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(d,b){this.domNode=h.byId(d);this.events=[f.connect(this.domNode,"touchstart",this,this._touchStartHandler),
f.connect(this.domNode,"touchmove",this,this._touchMoveHandler),f.connect(this.domNode,"touchend",this,this._touchEndHandler),f.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(d){this._preventDefault=d},disableOnClick:function(){f.disconnect(this.events.pop())},_clickHandler:function(d){if(this._moved)d.preventDefault();else this.onclick(d)},_touchStartHandler:function(d){this._moved=!1;this.client_x=d.targetTouches[0].clientX;this.client_y=d.targetTouches[0].clientY;
this.down_x=d.targetTouches[0].pageX;this.down_y=d.targetTouches[0].pageY;d.downX=this.down_x;d.downY=this.down_y;this.onTouchStart(d)},_touchMoveHandler:function(d){this._preventDefault&&d.preventDefault();this._moved=!0;this.up_x=d.targetTouches[0].pageX;this.cur_x=d.targetTouches[0].pageX-this.down_x;this.cur_y=d.targetTouches[0].pageY-this.down_y;d.curX=this.cur_x;d.curY=this.cur_y;this.onTouchMove(d)},_touchEndHandler:function(d){this._moved?(d.curX=this.cur_x,d.curY=this.cur_y,this.down_x-this.up_x>
this._swipeThreshold?d.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(d.swipeDirection="right")):(d.clientX=this.client_x,d.clientY=this.client_y);this.onTouchEnd(d)},onTouchStart:function(d){},onTouchMove:function(d){},onTouchEnd:function(d){},onclick:function(d){}})})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m){return l(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(d,m){var e;this.container=b.byId(m);this._touchBase=g(this.container,null);this._slideDiv=a.create("div",{},this.container,"first");this.events=[f.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=d.items;c.add(this.container,"esriMobileNavigationBar");var q=a.create("div",{},this._slideDiv);for(e=0;e<this._items.length;e++){var k,n;switch(this._items[e].type){case "img":n=
a.create("div",{"class":"esriMobileNavigationItem"},q);k=a.create("img",{src:this._items[e].src.toString(),style:{width:"100%",height:"100%"}},n);break;case "span":n=a.create("div",{"class":"esriMobileNavigationItem"},q);k=a.create("span",{innerHTML:this._items[e].text},n);break;case "div":n=a.create("div",{"class":"esriMobileNavigationInfoPanel"},q),k=a.create("div",{innerHTML:this._items[e].text},n)}c.add(n,this._items[e].position);this._items[e].className&&c.add(k,this._items[e].className);k._index=
e;k._item=this._items[e];this._items[e]._node=k}},startup:function(){this.onCreate(this._items)},destroy:function(){h.forEach(this.events,f.disconnect);this._touchBase=null;d.query("img",this.container).forEach(function(b){b._index=null;b._item=null;a.destroy(b)});this._items=null;a.destroy(this._slideDiv);a.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(a){this._markSelected(a._node,a)},onSelect:function(a){},onUnSelect:function(a){},
onCreate:function(a){},_onClickHandler:function(a){if("img"===a.target.tagName.toLowerCase()){var b=a.target,c=b._item;d.query("img",this.container).forEach(function(a){a!==b&&a._item.toggleGroup===c.toggleGroup&&this._markUnSelected(a,a._item)},this);this._toggleNode(b,c)}},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))},_markSelected:function(a,b){b.toggleState=
"ON";b.srcAlt&&(a.src=b.srcAlt);this.onSelect(b)},_markUnSelected:function(a,b){"ON"===b.toggleState&&(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b))}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(l,e,f,h,d){return l([e,f],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:h,loadingText:null,
hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&d.setStyle(this.domNode,"display","none");d.setStyle(this.domNode,{width:"100%",height:"100%"});this.loadingImg.src=require.toUrl("jimu")+"/images/loading.gif";this.showLoading||d.setStyle(this.loadingImg,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(e){this.domNode&&this.hidden&&
("string"===typeof e&&(this.textNode.innerHTML=e),d.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(d.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/OnScreenWidgetIcon":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dijit/_WidgetBase ./utils".split(" "),function(l,e,f,h,d,k,n){return l(k,{"class":"jimu-widget-onscreen-icon",postCreate:function(){this.inherited(arguments);this.iconNode=
h.create("img",{src:this.widgetConfig.icon},this.domNode);h.setAttr(this.domNode,"title",this.widgetConfig.label);this.own(d(this.domNode,"click",e.hitch(this,function(){this.onClick()})));this.position=e.clone(this.widgetConfig.position);"map"===this.widgetConfig.position.relativeTo&&this.own(d(this.map,"resize",e.hitch(this,function(){var b=e.clone(this.position);delete b.width;delete b.height;this.panel&&this.panel.setPosition(b)})));this.state="closed"},startup:function(){this.inherited(arguments)},
onClick:function(){"closed"===this.state?this.switchToOpen():this.switchToClose()},moveTo:function(b){var c={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},c=e.mixin(c,n.getPositionStyle(b));delete c.width;delete c.height;h.setStyle(this.domNode,c);this.position=e.clone(b);this.widgetConfig&&this.widgetConfig.panel&&(this.widgetConfig.panel.position=e.clone(b),this.widgetConfig.position=e.clone(b));this.panel&&this.panel.setPosition(e.clone(b));this.widget&&this.widget.setPosition(this.getOffPanelWidgetPosition(this.widget))},
destroy:function(){this.panel?this.panelManager.destroyPanel(this.panel):this.widget&&this.widgetManager.destroyWidget(this.widget);this.inherited(arguments)},switchToOpen:function(){this.state="opened";this.panelManager.closeAllPanelsInGroup(this.widgetConfig.gid);f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(b){b.closeable&&this.widgetManager.closeWidget(b)},this);h.addClass(this.domNode,"jimu-state-selected");this._showLoading();!1===this.widgetConfig.inPanel?this.widgetManager.loadWidget(this.widgetConfig).then(e.hitch(this,
function(b){this.widget=b;b.setPosition(this.getOffPanelWidgetPosition(b));this.widgetManager.openWidget(b);this.own(d(b,"close",e.hitch(this,function(){this.switchToClose()})));this._hideLoading()})):this.panelManager.showPanel(e.clone(this.widgetConfig)).then(e.hitch(this,function(b){this.panel=b;this.own(d(b,"close",e.hitch(this,function(){this.switchToClose()})));this._hideLoading()}))},switchToClose:function(){this.state="closed";h.removeClass(this.domNode,"jimu-state-selected");!1===this.widgetConfig.inPanel?
this.widgetManager.closeWidget(this.widget):this.panelManager.closePanel(this.panel)},getOffPanelWidgetPosition:function(b){var c={relativeTo:b.position.relativeTo},a=h.getMarginBox(this.domNode);b=this.widgetManager.getWidgetMarginBox(b);var g=h.getMarginBox("map"===c.relativeTo?this.map.id:jimuConfig.layoutId),d=a.t+a.h+1;d+b.h>g.h?c.bottom=g.h-a.t+1:c.top=d;window.isRTL?c.right=0>a.l+a.w-b.w?0:a.l+a.w-b.w:a.l+b.w>g.w?c.right=0:c.left=a.l;return c},_showLoading:function(){h.setAttr(this.iconNode,
"src",require.toUrl("jimu")+"/images/loading_circle.gif")},_hideLoading:function(){h.setAttr(this.iconNode,"src",this.widgetConfig.icon)}})})},"jimu/WidgetPlaceholder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase","./utils"],function(l,e,f,h,d){return l(h,{"class":"jimu-widget-placeholder",postCreate:function(){this.inherited(arguments);this.indexNode=f.create("div",{"class":"inner",innerHTML:this.index},this.domNode);f.setAttr(this.domNode,"title",
window.jimuNls.widgetPlaceholderTooltip)},moveTo:function(k){var n={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},n=e.mixin(n,d.getPositionStyle(k));delete n.width;delete n.height;f.setStyle(this.domNode,n)},setIndex:function(d){this.index=d;this.indexNode.innerHTML=d}})})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","./WidgetManager"],function(l,e,f,h){var d=null,k;k=l(null,{constructor:function(){f.subscribe("publishData",
e.hitch(this,this.onDataPublished));f.subscribe("fetchData",e.hitch(this,this.onFetchData));f.subscribe("clearAllData",e.hitch(this,this.onClearAllData));f.subscribe("removeData",e.hitch(this,this.onRemoveData));f.subscribe("clearDataHistory",e.hitch(this,this.onClearDataHistory));this.widgetManager=h.getInstance()},_dataStore:{},onDataPublished:function(d,b,c,a){"undefined"===typeof a&&(a=!1);this._dataStore[b]?(this._dataStore[b].current=c,a&&(this._dataStore[b].history?this._dataStore[b].history.push(c):
this._dataStore[b].history=[c])):(this._dataStore[b]={current:c},a&&(this._dataStore[b].history=[c]))},onFetchData:function(d){var b;if(d)(b=this.widgetManager.getWidgetById(d))?this._dataStore[d]?f.publish("dataFetched",b.name,d,this._dataStore[d].current,this._dataStore[d].history):f.publish("noData",b.name,d):f.publish("noData",void 0,d);else for(var c in this._dataStore)(b=this.widgetManager.getWidgetById(c))&&f.publish("dataFetched",b.name,c,this._dataStore[c].current,this._dataStore[c].history)},
onClearAllData:function(){this._dataStore={};f.publish("allDataCleared")},onRemoveData:function(d){delete this._dataStore[d];f.publish("dataRemoved",d)},onClearDataHistory:function(d){this._dataStore[d]&&(this._dataStore[d].history=[]);f.publish("dataHistoryCleared",d)}});k.getInstance=function(){null===d&&(d=new k);return d};return k})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),
function(l,e,f,h,d,k,n,b,c,a){return l([n,b],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(d.subscribe("publishData",e.hitch(this,this._onReceiveData)));this.own(d.subscribe("dataFetched",e.hitch(this,
this._onReceiveData)));this.own(d.subscribe("noData",e.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(a){},onSignOut:function(){},onPositionChange:function(a){this.setPosition(a)},setPosition:function(a,b){this.position=a;var d=c.getPositionStyle(this.position);d.position="absolute";
b||(b="map"===a.relativeTo?this.map.id:window.jimuConfig.layoutId);h.place(this.domNode,b);h.setStyle(this.domNode,d);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return h.getMarginBox(this.domNode)},setMap:function(a){this.map=a},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){},onConfigChanged:function(a){},onAppConfigChanged:function(a,b,c){},onAction:function(a,b){},getPanel:function(){if(!1===
this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return a.getInstance().getPanelById(this.id+"_panel");var b=a.getInstance().getPanelById(this.gid+"_panel");return b?b:a.getInstance().getPanelById(this.id+"_panel")},publishData:function(a,b){"undefined"===typeof b&&(b=!1);d.publish("publishData",this.name,this.id,a,b)},fetchData:function(a){a?d.publish("fetchData",a):0!==this.listenWidgetIds.length?f.forEach(this.listenWidgetIds,function(a){d.publish("fetchData",a)},
this):d.publish("fetchData")},fetchDataByName:function(a){a=this.widgetManager.getWidgetsByName(a);f.forEach(a,function(a){this.fetchData(a.id)},this)},openWidgetById:function(a){var b=new k;if(this.widgetManager.getWidgetById(a))return b.resolve(this.widgetManager.getWidgetById(a)),b;var c=d.subscribe("widgetCreated",e.hitch(this,function(d){d.id===a&&(c.remove(),b.resolve(d))}));d.publish("openWidget",a);return b},_onReceiveData:function(a,b,c,d){if(b!==this.id&&!(0!==this.listenWidgetIds.length&&
0>this.listenWidgetIds.indexOf(b)))this.onReceiveData(a,b,c,d)},onReceiveData:function(a,b,c,d){},_onNoData:function(a,b){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(b)))this.onNoData(a,b)},onNoData:function(a,b){}})})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(l,e,f,h){return l([h],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);
this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&("closed"!==this.widget.state&&e.isFunction(this.widget.resize))&&this.widget.resize()},setLoading:function(d){this.loading=d;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(d){this.widget=d;this.loading&&this.loading.destroy();f.place(d.domNode,
this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(d){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+d.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(l,e,f,h,d,k,n,b,
c){return l([d,k],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var a=this.getAllWidgetConfigs(),a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];f.forEach(a,function(a){var b,c;!1!==a.visible&&(c=new n,b=this.createFrame(a),this.addChild(b),
b.setLoading(c),this.widgetManager.loadWidget(a).then(e.hitch(this,function(a){b.setWidget(a);a.startup()})))},this)},getAllWidgetConfigs:function(){var a=[];return a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(a){for(var b=this.getChildren(),c=0;c<b.length;c++)if(b[c].getWidget()&&b[c].getWidget().id===a)return b[c].getWidget()},createFrame:function(a){return new b},setPosition:function(a,b){this.position=a;var d=c.getPositionStyle(this.position);
d.position="absolute";b||(b="map"===a.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(d.display="none");h.place(this.domNode,b);h.setStyle(this.domNode,d)},getPosition:function(){return this.position},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){this.getChildren().forEach(function(a){a.resize()})},onPositionChange:function(a){this.setPosition(a)},onOpen:function(){f.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.openWidget(a.getWidget())},this)},onClose:function(){f.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.closeWidget(a.getWidget())},this)},onMaximize:function(){f.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.maximizeWidget(a.getWidget())},this)},onMinimize:function(){f.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.minimizeWidget(a.getWidget())},this)},onNormalize:function(){f.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.normalizeWidget(a.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(a){this._updateConfig(a)},reloadWidget:function(a){this.isWidgetInPanel(a)&&(this._updateConfig(a),this.getChildren().forEach(function(b){b.getWidget()&&b.getWidget().id===a.id&&(b.getWidget().destroy(),b.setLoading(new n),this.widgetManager.loadWidget(a).then(e.hitch(this,function(a){b.setWidget(a);a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},
this))},isWidgetInPanel:function(a){return f.some(this.getAllWidgetConfigs(),function(b){if(a.id===b.id)return!0})?!0:!1},_updateConfig:function(a){if(Array.isArray(this.config.widgets)){for(var b=-1,c=0;c<this.config.widgets.length;c++)this.config.widgets[c].id===a.id&&(b=c);0<b&&(this.config.widgets[b]=a)}else this.config=a},destroy:function(){this.getChildren().forEach(function(a){try{a.domNode&&a.destroy()}catch(b){console.error("destroy widget frame error."+b.stack)}});this.inherited(arguments)}})})},
"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(l,e,f,h){return l(e,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&f.set(this.domNode,{display:"none"});f.set(this.domNode,{width:"100%",height:"100%"});var d='\x3cimg class\x3d"jimu-loading" src\x3d"'+require.toUrl("jimu")+'/images/loading.gif"\x3e';
h.place(d,this.domNode)},show:function(){this.domNode&&f.set(this.domNode,"display","block")},hide:function(){this.domNode&&f.set(this.domNode,"display","none")}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(l,e,f,h,d){return l([h,d],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(f(window,"resize",e.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},
_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define(["dojo/_base/lang","dojo/_base/html","dojox/gfx","esri/symbols/jsonUtils"],function(l,e,f,h){return{cloneSymbol:function(d){if(!d)return null;var e=null;try{var f=d.toJson(),e=h.fromJson(f)}catch(b){console.error(b)}return e},getDefaultMarkerSymbol:function(){return h.fromJson({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return h.fromJson({tags:["solid"],
title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return h.fromJson({tags:["opaque"],title:"Blue",style:"esriSFSSolid",color:[79,129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return h.fromJson({color:[255,255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,
255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return h.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return h.fromJson({color:[255,255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},createSymbolNode:function(d,k){var n=32,b=32,c=e.create("div",{},document.body);e.setStyle(c,"display","inline-block");
if(k)n=k.width,b=k.height;else if(n=80,b=30,this.isSimpleMarkerSymbol(d))b=n=Math.min(d.size+12,125);else if(this.isPictureMarkerSymbol(d)){if(!d.url||"http://"===d.url||-1===d.url.indexOf("http://")&&-1===d.url.indexOf("https://")&&-1===d.url.indexOf("data:"))return;b=n=Math.min(Math.max(d.width,d.height),125)}else if(this.isSimpleLineSymbol(d)||this.isCartographicLineSymbol(d))n=190,b=20;var a=f.createSurface(c,n,b);if("vml"===f.renderer){var g=a.getEventSource();e.setStyle(g,"position","relative");
e.setStyle(g.parentNode,"position","relative")}var g=null,g=k?h.getShapeDescriptors(d):this.isSimpleLineSymbol(d)||this.isCartographicLineSymbol(d)?this._getLineShapeDesc(d):h.getShapeDescriptors(d),m;try{m=a.createShape(g.defaultShape),g.fill&&m.setFill(g.fill),g.stroke&&m.setStroke(g.stroke)}catch(p){a.clear();a.destroy();return}var a=a.getDimensions(),a={dx:a.width/2,dy:a.height/2},s=m.getBoundingBox(),g=s.width,s=s.height;if(g>n||s>b)n=((n<b?n:b)-5)/(g>s?g:s),l.mixin(a,{xx:n,yy:n});m.applyTransform(a);
return c},_getLineShapeDesc:function(d){var e=null;if(this.isSimpleLineSymbol(d)||this.isCartographicLineSymbol(d))e={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:d.getStroke()};return e},isSimpleMarkerSymbol:function(d){return d&&"esri.symbol.SimpleMarkerSymbol"===d.declaredClass},isPictureMarkerSymbol:function(d){return d&&"esri.symbol.PictureMarkerSymbol"===d.declaredClass},isSimpleLineSymbol:function(d){return d&&"esri.symbol.SimpleLineSymbol"===d.declaredClass},isCartographicLineSymbol:function(d){return d&&
"esri.symbol.CartographicLineSymbol"===d.declaredClass},isSimpleFillSymbol:function(d){return d&&"esri.symbol.SimpleFillSymbol"===d.declaredClass},isPictureFillSymbol:function(d){return d&&"esri.symbol.PictureFillSymbol"===d.declaredClass},isTextSymbol:function(d){return d&&"esri.symbol.TextSymbol"===d.declaredClass}}})},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale esri/lang dojo/data/ItemFileWriteStore jimu/utils".split(" "),function(l,
e,f,h,d,k,n){return l([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:86399E3,fieldsStore:null,isHosted:!1,constructor:function(){String.prototype.startsWith=function(b){return 0===this.indexOf(b)};String.prototype.endsWith=function(b){return this.substring(this.length-b.length)===b};String.prototype.count=function(b){return this.split(b).length-
1};String.prototype.trim||(String.prototype.trim=e.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes)},OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",
stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",
numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",
dateOperatorMonths:"dateOperatorMonths",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast"},isAskForValues:function(b){var c=!1;return c=f.some(b.parts,e.hitch(this,function(a){return a.parts?f.some(a.parts,e.hitch(this,function(a){return!!a.interactiveObj})):!!a.interactiveObj}))},setFieldsStoreByFieldInfos:function(b){b=f.filter(b,e.hitch(this,function(b){return 0<=this._supportFieldTypes.indexOf(b.type)}));b=f.map(b,function(b,a){var d;switch(b.type){case "esriFieldTypeString":d=
"string";break;case "esriFieldTypeDate":d="date";break;default:d="number"}return{id:a,label:b.name,shortType:d,alias:b.alias,editable:b.editable,name:b.name,nullable:b.nullable,type:b.type}},this);this.fieldsStore=new k({data:{identifier:"id",label:"label",items:b}});return b.length},_validatePartsObj:function(b){return b&&"object"===typeof b},_isObject:function(b){return b&&"object"===typeof b},_isString:function(b){return b&&"string"===typeof b},containsNonLatinCharacter:function(b){for(var c=0;c<
b.length;c++)if(255<b.charCodeAt(c))return!0;return!1},getExprByFilterObj:function(b){if(!f.every(b.parts,function(a){return!!a}))return null;if(!this.isPartsObjReadyToBuild(b))return b.expr="",b.expr;var c="";if(0===b.parts.length)c="1\x3d1";else if(1===b.parts.length)c=this.builtFilterString(b.parts[0]);else for(var a="",g=0;g<b.parts.length;g++){var m=this.builtFilterString(b.parts[g]);if(!d.isDefined(m))return null;c+=a+"("+m+")";a=a||" "+b.logicalOperator+" "}return b.expr=c},isPartsObjReadyToBuild:function(b){return f.every(b.parts,
e.hitch(this,function(b){return b.parts?f.every(b.parts,e.hitch(this,function(a){return this._isPartReadyToBuild(a)})):this._isPartReadyToBuild(b)}))},_isPartReadyToBuild:function(b){var c=b.fieldObj.shortType,a=b.operator,d=b.valueObj;b=d.type;var m=d.value,e=d.value1,d=d.value2;if("value"===b){if("string"===c)return a===this.OPERATORS.stringOperatorIsBlank||a===this.OPERATORS.stringOperatorIsNotBlank?!0:n.isNotEmptyString(m);if("number"===c)return a===this.OPERATORS.numberOperatorIsBlank||a===this.OPERATORS.numberOperatorIsNotBlank?
!0:a===this.OPERATORS.numberOperatorIsBetween||a===this.OPERATORS.numberOperatorIsNotBetween?n.isValidNumber(e)&&n.isValidNumber(d):n.isValidNumber(m);if("date"===c)return a===this.OPERATORS.dateOperatorIsBlank||a===this.OPERATORS.dateOperatorIsNotBlank?!0:a===this.OPERATORS.dateOperatorIsBetween||a===this.OPERATORS.dateOperatorIsNotBetween?n.isNotEmptyString(e)&&n.isNotEmptyString(d):n.isNotEmptyString(m)}else{if("field"===b)return n.isNotEmptyString(m);if("unique"===b){if("string"===c)return n.isNotEmptyString(m);
if("number"===c)return n.isValidNumber(m)}}return!1},builtFilterString:function(b){var c="";if(b.parts)for(var a="",g=0;g<b.parts.length;g++){var m=b.parts[g],e=this.builtSingleFilterString(m);m.expr=e.whereClause;if(!d.isDefined(e.whereClause))return null;c+=a+e.whereClause;a=" "+b.logicalOperator+" "}else c=this.builtSingleFilterString(b).whereClause;return b.expr=c},builtSingleFilterString:function(b,c){this.isHosted&&(b.caseSensitive=!1);if(d.isDefined(b.valueObj.isValid)&&!b.valueObj.isValid)return{whereClause:null};
var a=b.valueObj.value,g=b.valueObj.value1,m=b.valueObj.value2,e=!1;b.interactiveObj&&d.isDefined(c)&&(e=!0,d.isDefined(b.valueObj.value)&&(a="{"+c+"}"),d.isDefined(b.valueObj.value1)&&(g="{"+c+"}"),d.isDefined(b.valueObj.value2)&&(m="{"+(c+1)+"}"));var k="";if("string"===b.fieldObj.shortType)switch(g="",e&&this.isHosted?g="N":a&&"field"!==b.valueObj.type&&this.isHosted&&this.containsNonLatinCharacter(a)&&(g="N"),b.operator){case this.OPERATORS.stringOperatorIs:k="field"===b.valueObj.type?b.fieldObj.name+
" \x3d "+a:b.fieldObj.name+" \x3d "+g+"'"+a.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorIsNot:k="field"===b.valueObj.type?b.fieldObj.name+" \x3c\x3e "+a:b.fieldObj.name+" \x3c\x3e "+g+"'"+a.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorStartsWith:k=b.caseSensitive?b.fieldObj.name+" LIKE "+g+"'"+a.replace(/\'/g,"''")+"%'":"UPPER("+b.fieldObj.name+") LIKE UPPER("+g+"'"+a.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorEndsWith:k=b.caseSensitive?
b.fieldObj.name+" LIKE "+g+"'%"+a.replace(/\'/g,"''")+"'":"UPPER("+b.fieldObj.name+") LIKE UPPER("+g+"'%"+a.replace(/\'/g,"''")+"')";break;case this.OPERATORS.stringOperatorContains:k=b.caseSensitive?b.fieldObj.name+" LIKE "+g+"'%"+a.replace(/\'/g,"''")+"%'":"UPPER("+b.fieldObj.name+") LIKE UPPER("+g+"'%"+a.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorDoesNotContain:k=b.caseSensitive?b.fieldObj.name+" NOT LIKE "+g+"'%"+a.replace(/\'/g,"''")+"%'":"UPPER("+b.fieldObj.name+") NOT LIKE UPPER("+
g+"'%"+a.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorIsBlank:k=b.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:k=b.fieldObj.name+" IS NOT NULL"}else if("number"===b.fieldObj.shortType)switch(b.operator){case this.OPERATORS.numberOperatorIs:k=b.fieldObj.name+" \x3d "+a;break;case this.OPERATORS.numberOperatorIsNot:k=b.fieldObj.name+" \x3c\x3e "+a;break;case this.OPERATORS.numberOperatorIsAtLeast:k=b.fieldObj.name+" \x3e\x3d "+a;break;case this.OPERATORS.numberOperatorIsLessThan:k=
b.fieldObj.name+" \x3c "+a;break;case this.OPERATORS.numberOperatorIsAtMost:k=b.fieldObj.name+" \x3c\x3d "+a;break;case this.OPERATORS.numberOperatorIsGreaterThan:k=b.fieldObj.name+" \x3e "+a;break;case this.OPERATORS.numberOperatorIsBetween:k=b.fieldObj.name+" BETWEEN "+g+" AND "+m;break;case this.OPERATORS.numberOperatorIsNotBetween:k=b.fieldObj.name+" NOT BETWEEN "+g+" AND "+m;break;case this.OPERATORS.numberOperatorIsBlank:k=b.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:k=
b.fieldObj.name+" IS NOT NULL"}else switch(d.isDefined(a)&&("field"!==b.valueObj.type&&"string"===typeof a)&&(a=new Date(a)),"field"!==b.valueObj.type&&(a&&(a=new Date(a)),g&&(g=new Date(g)),m&&(m=new Date(m))),b.operator){case this.OPERATORS.dateOperatorIsOn:k="field"===b.valueObj.type?b.fieldObj.name+" \x3d "+a:e?b.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+c+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(c+1)+"}'":b.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+
"'"+this.formatDate(a)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(a))+"'";break;case this.OPERATORS.dateOperatorIsNotOn:k="field"===b.valueObj.type?b.fieldObj.name+" \x3c\x3e "+a:e?b.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+c+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(c+1)+"}'":b.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(a)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(a))+
"'";break;case this.OPERATORS.dateOperatorIsBefore:k="field"===b.valueObj.type?b.fieldObj.name+" \x3c "+a:b.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(a)+"'";break;case this.OPERATORS.dateOperatorIsAfter:k="field"===b.valueObj.type?b.fieldObj.name+" \x3e "+a:b.fieldObj.name+" \x3e "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(a))+"'";break;case this.OPERATORS.dateOperatorIsBetween:k=e?b.fieldObj.name+" BETWEEN '"+g+"' AND '"+m+"'":b.fieldObj.name+
" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(g)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(m))+"'";break;case this.OPERATORS.dateOperatorIsNotBetween:k=e?b.fieldObj.name+" NOT BETWEEN '"+g+"' AND '"+m+"'":b.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(g)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(m))+"'";break;case this.OPERATORS.dateOperatorIsBlank:k=b.fieldObj.name+" IS NULL";break;
case this.OPERATORS.dateOperatorIsNotBlank:k=b.fieldObj.name+" IS NOT NULL"}return{whereClause:k}},formatDate:function(b){var c=h.format(b,{datePattern:"yyyy-MM-dd",selector:"date"});b=h.format(b,{selector:"time",timePattern:"HH:mm:ss"});return c+" "+b},addDay:function(b){return new Date(b.getTime()+this.dayInMS)},getFilterObjByExpr:function(b){if(b&&this.fieldsStore){var c=this.replaceStrings(b);b=c.defExpr;var a=this.findParts(b,"AND");1===a.parts.length&&(a=this.findParts(b,"OR"),1===a.parts.length&&
(a.logicalOperator="AND"));f.forEach(a.parts,function(a){a.expr=a.expr.trim();if(a.expr.startsWith("(")&&-1<a.expr.search(/\)$/)){var b=a.expr.substring(1,a.expr.length-1),c=b.indexOf("("),d=b.indexOf(")");if(-1===c&&-1===d||c<d)a.expr=b}b=this.findParts(a.expr,"AND");1===b.parts.length&&(b=this.findParts(a.expr,"OR"));1<b.parts.length&&(a.parts=b.parts,a.logicalOperator=b.logicalOperator)},this);this.parseExpr(a);this.reReplaceStrings(c,a);a&&a.parts&&f.forEach(a.parts,e.hitch(this,function(a){a&&
(a.parts?f.forEach(a,e.hitch(this,function(a){this._handleParsedPartValue(a)})):this._handleParsedPartValue(a))}));return a}},_handleParsedPartValue:function(b){b&&(b.fieldObj&&"number"===b.fieldObj.shortType&&b.valueObj)&&(b.valueObj.hasOwnProperty("value")&&(b.valueObj.value=parseFloat(b.valueObj.value)),b.valueObj.hasOwnProperty("value1")&&(b.valueObj.value1=parseFloat(b.valueObj.value1)),b.valueObj.hasOwnProperty("value2")&&(b.valueObj.value2=parseFloat(b.valueObj.value2)))},replaceStrings:function(b){for(var c=
b,a=function(b,c,d){var g=-1,g=b.indexOf("'",d+1);return g===d+1?(g=b.indexOf("'",g+1),a(b,c,g)):d},d=[],m=b.indexOf("'");-1<m;){var e=m,m=b.indexOf("'",m+1),k=0,m=a(b,e,m);"%"===b[e+1]&&e++;"%"===b[m-1]&&(m-=1,k++);var f=b.substring(e+1,m);"N"===b[e-1]&&(b=b.substring(0,e-1)+b.substring(e),e-=1,m-=1);!this.isDateString(f)&&-1===f.indexOf("{")?(d.push(f),b=b.substring(0,e+1)+"#"+(d.length-1)+"#"+b.substring(m),m=b.indexOf("'",b.lastIndexOf("#")+2+k)):m=b.indexOf("'",m+1+k)}return{origDefExpr:c,defExpr:b,
savedStrings:d}},reReplaceStrings:function(b,c){var a=b.savedStrings;if(a.length&&a.length){var g=function(a,b){if("string"!==a.fieldObj.shortType)return!1;var c=a.valueObj.value.indexOf("#"),g=a.valueObj.value.lastIndexOf("#");return d.isDefined(a.valueObj.value)&&-1<c?(a.valueObj.value=b[parseInt(a.valueObj.value.substring(c+1,g),10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},g=e.hitch(this,g),m=!1;f.forEach(c.parts,function(b){if(b.parts){var c=!1;f.forEach(b.parts,function(b){c=
g(b,a)||c});c&&(m=c,b.expr=this.builtFilterString(b))}else(m=g(b,a)||m)&&this.builtFilterString(b)},this);m&&(c.expr=null,this.getExprByFilterObj(c))}},isDateString:function(b){return 19===b.length&&"-"===b.charAt(4)&&"-"===b.charAt(7)&&" "===b.charAt(10)&&":"===b.charAt(13)&&":"===b.charAt(16)?!0:!1},findParts:function(b,c){for(var a=b.toLowerCase(),d=" "+c.toLowerCase()+" ",m=[],e=0,k=a.indexOf(d);0<k;){var f=b.substring(e,k),q=f.toLowerCase(),n=f.count("("),h=f.count(")"),l=f.count("'");n!==h||
1===l%2?k=a.indexOf(d,k+1):-1<q.indexOf(" between ")&&-1===q.indexOf(" and ")?k=a.indexOf(d,k+1):(m.push({expr:f}),e=k+d.length,k=a.indexOf(d,e))}m.push({expr:b.substring(e)});for(a=m.length-1;0<=a;a--)!this.hasOperator(m[a].expr)&&0<a&&(m[a-1].expr+=" "+c+" "+m[a].expr,m.splice(a,1));return{expr:b,parts:m,logicalOperator:c}},hasOperator:function(b){b=b.toLowerCase();return-1<b.indexOf("{")&&-1<b.indexOf("}")||-1<b.indexOf(" \x3d ")||-1<b.indexOf(" \x3c ")||-1<b.indexOf(" \x3e ")||-1<b.indexOf(" \x3c\x3e ")||
-1<b.indexOf(" \x3c\x3d ")||-1<b.indexOf(" \x3e\x3d ")||-1<b.indexOf(" like ")||-1<b.indexOf(" between ")||-1<b.indexOf(" date")||-1<b.indexOf(" is null")||-1<b.indexOf(" is not null")?!0:!1},parseExpr:function(b){f.forEach(b.parts,function(b){b.parts?this.parseExpr(b):this.parseSingleExpr(b)},this)},_preParseSingleExpr:function(b){var c=null;try{if(c=e.clone(b),c.expr=c.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(c.expr)){var a=b="",d=c.expr.match(/^UPPER\((.*)\)\s+/i);
if(d&&2<=d.length)b=d[1];else return null;var m=c.expr.match(/UPPER\(N?'(.*)'\)$/i);if(m&&2<=m.length)a="'"+m[1]+"'";else return null;c.expr=c.expr.replace(/^UPPER\((.*)\)\s+/i,b+" ");c.expr=c.expr.replace(/UPPER\(N?'(.*)'\)$/i,a);c.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(c.expr)&&(c.caseSensitive=!0)}catch(k){return console.log(k),null}c&&this.isHosted&&(c.caseSensitive=!1);return c},parseSingleExpr:function(b){var c=this._preParseSingleExpr(b);c&&(b=e.mixin(b,c));var c=
b.expr.trim(),a=c.indexOf(" "),g=c.substring(0,a);b.fieldObj={name:g};b.valueObj={};this.getFieldItemByName({name:g},function(a){b.fieldObj.shortType=a.shortType[0];b.fieldObj.label=a.label[0]},function(){b.error={msg:"unknown field name ("+g+")",code:1}});c=c.substring(a+1).trim();a=c.toLowerCase();a.startsWith("\x3d ")?(c="date"===b.fieldObj.shortType&&!this.isHosted?c.substring(12).trim():c.substring(2).trim(),this.storeValue(c,b),b.operator="date"===b.fieldObj.shortType?this.OPERATORS.dateOperatorIsOn:
"string"===b.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):a.startsWith("\x3c ")?(c="date"===b.fieldObj.shortType&&!this.isHosted?c.substring(12).trim():c.substring(2).trim(),this.storeValue(c,b),"date"===b.fieldObj.shortType?b.operator=this.OPERATORS.dateOperatorIsBefore:"number"===b.fieldObj.shortType?b.operator=this.OPERATORS.numberOperatorIsLessThan:b.error={msg:"operator ("+a+") not supported for string",code:3}):a.startsWith("\x3e ")?(c="date"===b.fieldObj.shortType&&
!this.isHosted?c.substring(12).trim():c.substring(2).trim(),this.storeValue(c,b),"date"===b.fieldObj.shortType?b.operator=this.OPERATORS.dateOperatorIsAfter:"number"===b.fieldObj.shortType?b.operator=this.OPERATORS.numberOperatorIsGreaterThan:b.error={msg:"operator ("+a+") not supported for string",code:3}):a.startsWith("\x3c\x3e ")?(c="date"===b.fieldObj.shortType&&!this.isHosted?c.substring(13).trim():c.substring(3).trim(),this.storeValue(c,b),b.operator="date"===b.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:
"string"===b.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):a.startsWith("\x3c\x3d ")?(this.storeValue(c.substring(3).trim(),b),b.operator=this.OPERATORS.numberOperatorIsAtMost):a.startsWith("\x3e\x3d ")?(this.storeValue(c.substring(3).trim(),b),b.operator=this.OPERATORS.numberOperatorIsAtLeast):a.startsWith("like ")?(c=c.substring(5).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&c.endsWith("%'")?(this.storeValue(c.substring(2,
c.length-2),b),b.operator=this.OPERATORS.stringOperatorContains):c.startsWith("'%")&&c.endsWith("'")?(this.storeValue(c.substring(2,c.length-1),b),b.operator=this.OPERATORS.stringOperatorEndsWith):c.startsWith("'")&&c.endsWith("%'")?(this.storeValue(c.substring(1,c.length-2),b),b.operator=this.OPERATORS.stringOperatorStartsWith):b.error={msg:"value ("+a+") not supported for LIKE",code:3}):a.startsWith("not like ")?(c=c.substring(9).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&
c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-2),b),b.operator=this.OPERATORS.stringOperatorDoesNotContain):b.error={msg:"value ("+a+") not supported for NOT LIKE",code:3}):a.startsWith("between ")?(c="date"===b.fieldObj.shortType&&!this.isHosted?c.substring(18).trim():c.substring(8).trim(),a=c.toLowerCase().indexOf(" and "),-1<a?(this.storeValue1(c.substring(0,a).trim(),b),"date"===b.fieldObj.shortType&&!this.isHosted?this.storeValue2(c.substring(a+15).trim(),b):this.storeValue2(c.substring(a+
5).trim(),b)):b.error={msg:"missing AND operator for BETWEEN",code:3},"date"===b.fieldObj.shortType?"string"===typeof b.valueObj.value1?b.operator=this.OPERATORS.dateOperatorIsBetween:1E3>Math.abs(this.subtractDay(b.valueObj.value2).getTime()-b.valueObj.value1.getTime())?(b.valueObj.value=b.valueObj.value1,delete b.valueObj.value1,delete b.valueObj.value2,b.operator=this.OPERATORS.dateOperatorIsOn):b.operator=this.OPERATORS.dateOperatorIsBetween:"number"===b.fieldObj.shortType||"oid"===b.fieldObj.shortType?
b.operator=this.OPERATORS.numberOperatorIsBetween:b.error={msg:"string field not supported for BETWEEN",code:3}):a.startsWith("not between ")?(c="date"===b.fieldObj.shortType&&!this.isHosted?c.substring(22).trim():c.substring(12).trim(),a=c.toLowerCase().indexOf(" and "),-1<a?(this.storeValue1(c.substring(0,a).trim(),b),"date"===b.fieldObj.shortType&&!this.isHosted?this.storeValue2(c.substring(a+15).trim(),b):this.storeValue2(c.substring(a+5).trim(),b)):b.error={msg:"missing AND operator for NOT BETWEEN",
code:3},"date"===b.fieldObj.shortType?"string"===typeof b.valueObj.value1?b.operator=this.OPERATORS.dateOperatorIsNotBetween:1E3>Math.abs(this.subtractDay(b.valueObj.value2).getTime()-b.valueObj.value1.getTime())?(b.valueObj.value=b.valueObj.value1,delete b.valueObj.value1,delete b.valueObj.value2,b.operator=this.OPERATORS.dateOperatorIsNotOn):b.operator=this.OPERATORS.dateOperatorIsNotBetween:"number"===b.fieldObj.shortType||"oid"===b.fieldObj.shortType?b.operator=this.OPERATORS.numberOperatorIsNotBetween:
b.error={msg:"string field not supported for NOT BETWEEN",code:3}):"is null"===a?(b.valueObj.value=null,b.operator="date"===b.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===b.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===a?(b.valueObj.value=null,b.operator="date"===b.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===b.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:this.OPERATORS.numberOperatorIsNotBlank):
b.error={msg:"unknown operator ("+a+")",code:2};if(d.isDefined(b.valueObj.value)&&"string"===typeof b.valueObj.value&&b.valueObj.value.startsWith("{")&&b.valueObj.value.endsWith("}")||d.isDefined(b.valueObj.value1)&&"string"===typeof b.valueObj.value1&&b.valueObj.value1.startsWith("{")&&b.valueObj.value1.endsWith("}"))b.isInteractive=!0},getFieldItemByName:function(b,c,a){this.fieldsStore.fetch({query:b,onComplete:e.hitch(this,function(b){b&&b.length?c(b[0]):a()})})},subtractDay:function(b){return new Date(b.getTime()-
this.dayInMS)},storeValue:function(b,c){if(b.startsWith("{")&&b.endsWith("}"))c.valueObj.value=b;else if(b.startsWith("'{")&&b.endsWith("}'"))c.valueObj.value=b.substring(1,b.length-1);else if("date"===c.fieldObj.shortType)if(b.startsWith("'")&&b.endsWith("'")){var a=b.substring(1,b.length-1);c.valueObj.value=this.parseDate(a)}else c.valueObj.value=b,c.valueObj.type="field";else"string"===c.fieldObj.shortType?(b.startsWith("#")||b.startsWith("%#"))&&(b.endsWith("#")||b.endsWith("#%"))?c.valueObj.value=
b:b.startsWith("'")&&b.endsWith("'")?c.valueObj.value=b.substring(1,b.length-1).replace(/\'\'/g,"'"):(c.valueObj.value=b,c.valueObj.type="field",this.getFieldItemByName({name:b},function(a){c.valueObj.label=a.label[0]},function(){c.error={msg:"unknown field name ("+b+")",code:1}})):(c.valueObj.value=b,isNaN(b)&&(c.valueObj.type="field",this.getFieldItemByName({name:b},function(a){c.valueObj.label=a.label[0]},function(){c.error={msg:"unknown field name ("+b+")",code:1}})))},storeValue1:function(b,
c){if(b.startsWith("{")&&b.endsWith("}"))c.valueObj.value1=b;else if(b.startsWith("'{")&&b.endsWith("}'"))c.valueObj.value1=b.substring(1,b.length-1);else if("date"===c.fieldObj.shortType)if(b.startsWith("'")&&b.endsWith("'")){var a=b.substring(1,b.length-1);c.valueObj.value1=this.parseDate(a)}else c.valueObj.value1=b,c.valueObj.type="field";else c.valueObj.value1=b,isNaN(b)&&(c.valueObj.type="field")},storeValue2:function(b,c){if(b.startsWith("{")&&b.endsWith("}"))c.valueObj.value2=b;else if(b.startsWith("'{")&&
b.endsWith("}'"))c.valueObj.value2=b.substring(1,b.length-1);else if("date"===c.fieldObj.shortType)if(b.startsWith("'")&&b.endsWith("'")){var a=b.substring(1,b.length-1);c.valueObj.value2=this.parseDate(a)}else c.valueObj.value2=b,c.valueObj.type="field";else c.valueObj.value2=b,isNaN(b)&&(c.valueObj.type="field")},parseDate:function(b){var c=h.parse(b,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});c||(c=h.parse(b.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(c=h.parse(b.replace(" ",
" - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return c}})})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),function(l,e,f,h,d,k,n){return e("dojo.data.ItemFileWriteStore",k,{constructor:function(b){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||
(this._datatypeMap.Date.serialize=function(b){return n.toISOString(b,{zulu:!0})});b&&!1===b.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(b){if(!b)throw Error("assertion failed in ItemFileWriteStore");},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(b,c){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof b&&"undefined"!=typeof b)throw Error("newItem() was passed something other than an object");
var a=null,d=this._getIdentifierAttribute();if(d===Number)a=this._arrayOfAllItems.length;else{a=b[d];if("undefined"===typeof a)throw Error("newItem() was not passed an identity for the new item");if(l.isArray(a))throw Error("newItem() was not passed an single-valued identity");}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[a]);this._assert("undefined"===typeof this._pending._newItems[a]);this._assert("undefined"===typeof this._pending._deletedItems[a]);var m={};m[this._storeRefPropName]=
this;m[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[a]=m,m[d]=[a]);this._arrayOfAllItems.push(m);d=null;if(c&&c.parent&&c.attribute){var d={item:c.parent,attribute:c.attribute,oldValue:void 0},e=this.getValues(c.parent,c.attribute);if(e&&0<e.length){var k=e.slice(0,e.length);d.oldValue=1===e.length?e[0]:e.slice(0,e.length);k.push(m);this._setValueOrValues(c.parent,c.attribute,k,!1);d.newValue=this.getValues(c.parent,c.attribute)}else this._setValueOrValues(c.parent,
c.attribute,m,!1),d.newValue=m}else m[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(m);this._pending._newItems[a]=m;for(var f in b){if(f===this._storeRefPropName||f===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");a=b[f];l.isArray(a)||(a=[a]);m[f]=a;if(this.referenceIntegrity)for(e=0;e<a.length;e++)k=a[e],this.isItem(k)&&this._addReferenceToMap(k,m,f)}this.onNew(m,d);return m},_removeArrayElement:function(b,c){var a=f.indexOf(b,c);return-1!=a?(b.splice(a,
1),!0):!1},deleteItem:function(b){this._assert(!this._saveInProgress);this._assertIsItem(b);var c=b[this._itemNumPropName],a=this.getIdentity(b);if(this.referenceIntegrity){var d=this.getAttributes(b);b[this._reverseRefMap]&&(b["backup_"+this._reverseRefMap]=l.clone(b[this._reverseRefMap]));f.forEach(d,function(a){f.forEach(this.getValues(b,a),function(c){this.isItem(c)&&(b["backupRefs_"+this._reverseRefMap]||(b["backupRefs_"+this._reverseRefMap]=[]),b["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(c),
attr:a}),this._removeReferenceFromMap(c,b,a))},this)},this);if(d=b[this._reverseRefMap])for(var m in d){var e=null;if(e=this._itemsByIdentity?this._itemsByIdentity[m]:this._arrayOfAllItems[m])for(var k in d[m]){var n=this.getValues(e,k)||[],q=f.filter(n,function(b){return!(this.isItem(b)&&this.getIdentity(b)==a)},this);this._removeReferenceFromMap(b,e,k);q.length<n.length&&this._setValueOrValues(e,k,q,!0)}}}this._arrayOfAllItems[c]=null;b[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[a];
this._pending._deletedItems[a]=b;b[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,b);this.onDelete(b);return!0},setValue:function(b,c,a){return this._setValueOrValues(b,c,a,!0)},setValues:function(b,c,a){return this._setValueOrValues(b,c,a,!0)},unsetAttribute:function(b,c){return this._setValueOrValues(b,c,[],!0)},_setValueOrValues:function(b,c,a,d){this._assert(!this._saveInProgress);this._assertIsItem(b);this._assert(l.isString(c));this._assert("undefined"!==typeof a);
var m=this._getIdentifierAttribute();if(c==m)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var m=this._getValueOrValues(b,c),e=this.getIdentity(b);if(!this._pending._modifiedItems[e]){var k={},n;for(n in b)k[n]=n===this._storeRefPropName||n===this._itemNumPropName||n===this._rootItemPropName?b[n]:n===this._reverseRefMap?l.clone(b[n]):b[n].slice(0,b[n].length);this._pending._modifiedItems[e]=k}e=!1;if(l.isArray(a)&&0===a.length){if(e=delete b[c],
a=void 0,this.referenceIntegrity&&m){n=m;l.isArray(n)||(n=[n]);for(var q=0;q<n.length;q++)k=n[q],this.isItem(k)&&this._removeReferenceFromMap(k,b,c)}}else{e=l.isArray(a)?a.slice(0,a.length):[a];if(this.referenceIntegrity)if(m){n=m;l.isArray(n)||(n=[n]);var h={};f.forEach(n,function(a){this.isItem(a)&&(a=this.getIdentity(a),h[a.toString()]=!0)},this);f.forEach(e,function(a){if(this.isItem(a)){var d=this.getIdentity(a);h[d.toString()]?delete h[d.toString()]:this._addReferenceToMap(a,b,c)}},this);for(q in h)this._removeReferenceFromMap(this._itemsByIdentity?
this._itemsByIdentity[q]:this._arrayOfAllItems[q],b,c)}else for(q=0;q<e.length;q++)k=e[q],this.isItem(k)&&this._addReferenceToMap(k,b,c);b[c]=e;e=!0}if(d)this.onSet(b,c,m,a);return e},_addReferenceToMap:function(b,c,a){c=this.getIdentity(c);var d=b[this._reverseRefMap];d||(d=b[this._reverseRefMap]={});(b=d[c])||(b=d[c]={});b[a]=!0},_removeReferenceFromMap:function(b,c,a){c=this.getIdentity(c);var d=b[this._reverseRefMap],m;if(d){for(m in d)m==c&&(delete d[m][a],this._isEmpty(d[m])&&delete d[m]);this._isEmpty(d)&&
delete b[this._reverseRefMap]}},_dumpReferenceMap:function(){var b;for(b=0;b<this._arrayOfAllItems.length;b++){var c=this._arrayOfAllItems[b];c&&c[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(c)+"] is referenced by: "+h.toJson(c[this._reverseRefMap]))}},_getValueOrValues:function(b,c){var a=void 0;this.hasAttribute(b,c)&&(a=this.getValues(b,c),a=1==a.length?a[0]:a);return a},_flatten:function(b){if(this.isItem(b))return{_reference:this.getIdentity(b)};if("object"===typeof b)for(var c in this._datatypeMap){var a=
this._datatypeMap[c];if(l.isObject(a)&&!l.isFunction(a)){if(b instanceof a.type){if(!a.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+c+"]");return{_type:c,_value:a.serialize(b)}}}else if(b instanceof a)return{_type:c,_value:b.toString()}}return b},_getNewFileContentString:function(){var b={},c=this._getIdentifierAttribute();c!==Number&&(b.identifier=c);this._labelAttr&&(b.label=this._labelAttr);b.items=[];for(c=0;c<this._arrayOfAllItems.length;++c){var a=this._arrayOfAllItems[c];
if(null!==a){var d={},m;for(m in a)if(m!==this._storeRefPropName&&m!==this._itemNumPropName&&m!==this._reverseRefMap&&m!==this._rootItemPropName){var e=this.getValues(a,m);if(1==e.length)d[m]=this._flatten(e[0]);else for(var k=[],f=0;f<e.length;++f)k.push(this._flatten(e[f])),d[m]=k}b.items.push(d)}}return h.toJson(b,!0)},_isEmpty:function(b){var c=!0;if(l.isObject(b))for(var a in b){c=!1;break}else l.isArray(b)&&0<b.length&&(c=!1);return c},save:function(b){this._assert(!this._saveInProgress);this._saveInProgress=
!0;var c=this,a=function(){c._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};c._saveInProgress=!1;b&&b.onComplete&&b.onComplete.call(b.scope||d.global)},g=function(a){c._saveInProgress=!1;b&&b.onError&&b.onError.call(b.scope||d.global,a)};if(this._saveEverything){var m=this._getNewFileContentString();this._saveEverything(a,g,m)}this._saveCustom&&this._saveCustom(a,g);!this._saveEverything&&!this._saveCustom&&a()},revert:function(){this._assert(!this._saveInProgress);for(var b in this._pending._modifiedItems){var c=
this._pending._modifiedItems[b],a=null,a=this._itemsByIdentity?this._itemsByIdentity[b]:this._arrayOfAllItems[b];c[this._storeRefPropName]=this;for(var d in a)delete a[d];l.mixin(a,c)}var m;for(b in this._pending._deletedItems)m=this._pending._deletedItems[b],m[this._storeRefPropName]=this,c=m[this._itemNumPropName],m["backup_"+this._reverseRefMap]&&(m[this._reverseRefMap]=m["backup_"+this._reverseRefMap],delete m["backup_"+this._reverseRefMap]),this._arrayOfAllItems[c]=m,this._itemsByIdentity&&(this._itemsByIdentity[b]=
m),m[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(m);for(b in this._pending._deletedItems)m=this._pending._deletedItems[b],m["backupRefs_"+this._reverseRefMap]&&(f.forEach(m["backupRefs_"+this._reverseRefMap],function(a){this._addReferenceToMap(this._itemsByIdentity?this._itemsByIdentity[a.id]:this._arrayOfAllItems[a.id],m,a.attr)},this),delete m["backupRefs_"+this._reverseRefMap]);for(b in this._pending._newItems)c=this._pending._newItems[b],c[this._storeRefPropName]=null,this._arrayOfAllItems[c[this._itemNumPropName]]=
null,c[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,c),this._itemsByIdentity&&delete this._itemsByIdentity[b];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(b){return b?(b=this.getIdentity(b),(new Boolean(this._pending._newItems[b]||this._pending._modifiedItems[b]||this._pending._deletedItems[b])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},
onSet:function(b,c,a,d){},onNew:function(b,c){},onDelete:function(b){},close:function(b){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),
function(l,e,f,h,d,k,n,b,c){f=f("dojo.data.ItemFileReadStore",[k],{constructor:function(a){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=a.url;this._jsonData=a.data;this.data=null;this._datatypeMap=a.typeMap||{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(a){return c.fromISOString(a)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName=
"_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==a.urlPreventCache&&(this.urlPreventCache=a.urlPreventCache?!0:!1);void 0!==a.hierarchical&&(this.hierarchical=a.hierarchical?!0:!1);a.clearOnClose&&(this.clearOnClose=!0);"failOk"in a&&(this.failOk=a.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(a){if(!this.isItem(a))throw Error(this.declaredClass+
": Invalid item argument.");},_assertIsAttribute:function(a){if("string"!==typeof a)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(a,b,c){a=this.getValues(a,b);return 0<a.length?a[0]:c},getValues:function(a,b){this._assertIsItem(a);this._assertIsAttribute(b);return(a[b]||[]).slice(0)},getAttributes:function(a){this._assertIsItem(a);var b=[],c;for(c in a)c!==this._storeRefPropName&&(c!==this._itemNumPropName&&c!==this._rootItemPropName&&c!==this._reverseRefMap)&&
b.push(c);return b},hasAttribute:function(a,b){this._assertIsItem(a);this._assertIsAttribute(b);return b in a},containsValue:function(a,b,c){var d=void 0;"string"===typeof c&&(d=n.patternToRegExp(c,!1));return this._containsValue(a,b,c,d)},_containsValue:function(a,b,c,d){return h.some(this.getValues(a,b),function(a){if(null!==a&&!e.isObject(a)&&d){if(a.toString().match(d))return!0}else if(c===a)return!0})},isItem:function(a){return a&&a[this._storeRefPropName]===this&&this._arrayOfAllItems[a[this._itemNumPropName]]===
a?!0:!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(a){this._assertIsItem(a.item)},getFeatures:function(){return this._features},getLabel:function(a){if(this._labelAttr&&this.isItem(a))return this.getValue(a,this._labelAttr)},getLabelAttributes:function(a){return this._labelAttr?[this._labelAttr]:null},filter:function(a,b,c){var d=[],e,k;if(a.query){var q;e=a.queryOptions?a.queryOptions.ignoreCase:!1;var f={};for(k in a.query)q=a.query[k],"string"===typeof q?f[k]=n.patternToRegExp(q,
e):q instanceof RegExp&&(f[k]=q);for(e=0;e<b.length;++e){var h=!0,l=b[e];if(null===l)h=!1;else for(k in a.query)q=a.query[k],this._containsValue(l,k,q,f[k])||(h=!1);h&&d.push(l)}}else for(e=0;e<b.length;++e)k=b[e],null!==k&&d.push(k);c(d,a)},_fetchItems:function(a,b,c){var k=this;if(this._loadFinished)this.filter(a,this._getItemsArray(a.queryOptions),b);else if(this._jsonFileUrl!==this._ccUrl?(l.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),
this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:a,filter:e.hitch(k,"filter"),findCallback:e.hitch(k,b)});else{this._loadInProgress=!0;var f=d.get({url:k._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});f.addCallback(function(d){try{k._getItemsFromLoadedData(d),
k._loadFinished=!0,k._loadInProgress=!1,k.filter(a,k._getItemsArray(a.queryOptions),b),k._handleQueuedFetches()}catch(e){k._loadFinished=!0,k._loadInProgress=!1,c(e,a)}});f.addErrback(function(b){k._loadInProgress=!1;c(b,a)});var n=null;a.abort&&(n=a.abort);a.abort=function(){f&&-1===f.fired&&f.cancel();n&&n.call(a)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,k.filter(a,this._getItemsArray(a.queryOptions),b)}catch(q){c(q,a)}else c(Error(this.declaredClass+
": No JSON source data was provided as either URL or a nested Javascript object."),a)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var a=0;a<this._queuedFetches.length;a++){var b=this._queuedFetches[a],c=b.args,d=b.filter,b=b.findCallback;d?d(c,this._getItemsArray(c.queryOptions),b):this.fetchItemByIdentity(c)}this._queuedFetches=[]}},_getItemsArray:function(a){return a&&a.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(a){this.clearOnClose&&(this._loadFinished&&
!this._loadInProgress)&&((""==this._jsonFileUrl||null==this._jsonFileUrl)&&(""==this.url||null==this.url)&&null==this.data&&console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(a){function b(a){return null!==
a&&"object"===typeof a&&(!e.isArray(a)||d)&&!e.isFunction(a)&&(a.constructor==Object||e.isArray(a))&&"undefined"===typeof a._reference&&"undefined"===typeof a._type&&"undefined"===typeof a._value&&k.hierarchical}function c(a){k._arrayOfAllItems.push(a);for(var d in a){var q=a[d];if(q)if(e.isArray(q))for(var f=0;f<q.length;++f){var p=q[f];b(p)&&c(p)}else b(q)&&c(q)}}var d=!1,k=this;this._labelAttr=a.label;var f,q;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=a.items;for(f=0;f<this._arrayOfTopLevelItems.length;++f)q=
this._arrayOfTopLevelItems[f],e.isArray(q)&&(d=!0),c(q),q[this._rootItemPropName]=!0;var n={},h;for(f=0;f<this._arrayOfAllItems.length;++f)for(h in q=this._arrayOfAllItems[f],q){if(h!==this._rootItemPropName){var l=q[h];null!==l?e.isArray(l)||(q[h]=[l]):q[h]=[null]}n[h]=h}for(;n[this._storeRefPropName];)this._storeRefPropName+="_";for(;n[this._itemNumPropName];)this._itemNumPropName+="_";for(;n[this._reverseRefMap];)this._reverseRefMap+="_";if(n=a.identifier){this._itemsByIdentity={};this._features["dojo.data.api.Identity"]=
n;for(f=0;f<this._arrayOfAllItems.length;++f)if(q=this._arrayOfAllItems[f],a=q[n],a=a[0],Object.hasOwnProperty.call(this._itemsByIdentity,a)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+n+"].  Value collided: ["+a+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+
n+"].  Value collided: ["+a+"]");}else this._itemsByIdentity[a]=q}else this._features["dojo.data.api.Identity"]=Number;for(f=0;f<this._arrayOfAllItems.length;++f)q=this._arrayOfAllItems[f],q[this._storeRefPropName]=this,q[this._itemNumPropName]=f;for(f=0;f<this._arrayOfAllItems.length;++f)for(h in q=this._arrayOfAllItems[f],q){a=q[h];for(n=0;n<a.length;++n)if(l=a[n],null!==l&&"object"==typeof l){if("_type"in l&&"_value"in l){var v=l._type,x=this._datatypeMap[v];if(x)if(e.isFunction(x))a[n]=new x(l._value);
else if(e.isFunction(x.deserialize))a[n]=x.deserialize(l._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+v+"'");}if(l._reference){l=l._reference;if(e.isObject(l))for(v=0;v<this._arrayOfAllItems.length;++v){var x=this._arrayOfAllItems[v],B=!0,D;for(D in l)x[D]!=l[D]&&
(B=!1);B&&(a[n]=x)}else a[n]=this._getItemByIdentity(l);this.referenceIntegrity&&(l=a[n],this.isItem(l)&&this._addReferenceToMap(l,q,h))}else this.isItem(l)&&this.referenceIntegrity&&this._addReferenceToMap(l,q,h)}}},_addReferenceToMap:function(a,b,c){},getIdentity:function(a){var b=this._features["dojo.data.api.Identity"];return b===Number?a[this._itemNumPropName]:(a=a[b])?a[0]:null},fetchItemByIdentity:function(a){var b,c;if(this._loadFinished)b=this._getItemByIdentity(a.identity),a.onItem&&(c=
a.scope?a.scope:l.global,a.onItem.call(c,b));else{var e=this;this._jsonFileUrl!==this._ccUrl?(l.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:a}):
(this._loadInProgress=!0,c=d.get({url:e._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),c.addCallback(function(c){var d=a.scope?a.scope:l.global;try{e._getItemsFromLoadedData(c),e._loadFinished=!0,e._loadInProgress=!1,b=e._getItemByIdentity(a.identity),a.onItem&&a.onItem.call(d,b),e._handleQueuedFetches()}catch(m){e._loadInProgress=!1,a.onError&&a.onError.call(d,m)}}),c.addErrback(function(b){e._loadInProgress=!1;a.onError&&a.onError.call(a.scope?
a.scope:l.global,b)})):this._jsonData&&(e._getItemsFromLoadedData(e._jsonData),e._jsonData=null,e._loadFinished=!0,b=e._getItemByIdentity(a.identity),a.onItem&&(c=a.scope?a.scope:l.global,a.onItem.call(c,b)))}},_getItemByIdentity:function(a){var b=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,a)&&(b=this._itemsByIdentity[a]):Object.hasOwnProperty.call(this._arrayOfAllItems,a)&&(b=this._arrayOfAllItems[a]);void 0===b&&(b=null);return b},getIdentityAttributes:function(a){a=
this._features["dojo.data.api.Identity"];return a===Number?null:[a]},_forceLoad:function(){var a=this;this._jsonFileUrl!==this._ccUrl?(l.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var b=d.get({url:this._jsonFileUrl,
handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});b.addCallback(function(b){try{if(!0!==a._loadInProgress&&!a._loadFinished)a._getItemsFromLoadedData(b),a._loadFinished=!0;else if(a._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(c){throw console.log(c),c;}});b.addErrback(function(a){throw a;})}else this._jsonData&&(a._getItemsFromLoadedData(a._jsonData),a._jsonData=null,a._loadFinished=
!0)}});e.extend(f,b);return f})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(l){var e={};l.setObject("dojo.data.util.filter",e);e.patternToRegExp=function(e,h){for(var d="^",k=null,n=0;n<e.length;n++)switch(k=e.charAt(n),k){case "\\":d+=k;n++;d+=e.charAt(n);break;case "*":d+=".*";break;case "?":d+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":d+="\\";default:d+=k}d+="$";return h?RegExp(d,"mi"):RegExp(d,
"m")};return e})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(l,e,f){var h={};l.setObject("dojo.data.util.simpleFetch",h);h.errorHandler=function(d,k){k.onError&&k.onError.call(k.scope||e.global,d,k)};h.fetchHandler=function(d,k){var n=k.abort||null,b=!1,c=k.start?k.start:0,a=k.count&&Infinity!==k.count?c+k.count:d.length;k.abort=function(){b=!0;n&&n.call(k)};var g=k.scope||e.global;k.store||(k.store=this);k.onBegin&&k.onBegin.call(g,
d.length,k);k.sort&&d.sort(f.createSortFunction(k.sort,this));if(k.onItem)for(var m=c;m<d.length&&m<a;++m){var p=d[m];b||k.onItem.call(g,p,k)}k.onComplete&&!b&&(m=null,k.onItem||(m=d.slice(c,a)),k.onComplete.call(g,m,k))};h.fetch=function(d){d=d||{};d.store||(d.store=this);this._fetchItems(d,l.hitch(this,"fetchHandler"),l.hitch(this,"errorHandler"));return d};return h})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(l){var e={};l.setObject("dojo.data.util.sorter",e);e.basicComparator=
function(e,h){var d=-1;null===e&&(e=void 0);null===h&&(h=void 0);if(e==h)d=0;else if(e>h||null==e)d=1;return d};e.createSortFunction=function(f,h){function d(a,b,c,d){return function(g,e){var m=d.getValue(g,a),k=d.getValue(e,a);return b*c(m,k)}}for(var k=[],n,b=h.comparatorMap,c=e.basicComparator,a=0;a<f.length;a++){n=f[a];var g=n.attribute;if(g){n=n.descending?-1:1;var m=c;b&&("string"!==typeof g&&"toString"in g&&(g=g.toString()),m=b[g]||c);k.push(d(g,n,m,h))}}return function(a,b){for(var c=0;c<
k.length;){var d=k[c++](a,b);if(0!==d)return d}return 0}};return e})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(l,e,f){return l(null,{constructor:function(){this.panelManager=f.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(e){},getConfigById:function(e){for(var d=this.getAllConfigs(),
k=0;k<d.length;k++)if(d[k].id===e)return d[k]},getAllConfigs:function(){var f=[],f=f.concat(this.getWidgetConfigs(),this.getGroupConfigs()),f=e.filter(f,function(d){return d.visible});return f.sort(function(d,e){return d.index-e.index})},isControlled:function(f){return e.some(this.getAllConfigs(),function(d){return d.id===f})},widgetIsControlled:function(f){return e.some(this.getAllConfigs(),function(d){return d.id===f?!0:e.some(d.widgets,function(d){return d.id===f})})},getGroupConfigs:function(){var f=
[];if(!this.appConfig.widgetPool)return f;this.appConfig.widgetPool.groups&&e.forEach(this.appConfig.widgetPool.groups,function(d){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(d.id)&&f.push(d):"all"===this.controlledGroups&&f.push(d))},this);return f},getWidgetConfigs:function(){var f=[];if(!this.appConfig.widgetPool)return f;this.appConfig.widgetPool.widgets&&e.forEach(this.appConfig.widgetPool.widgets,function(d){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?
-1<this.controlledWidgets.indexOf(d.id)&&f.push(d):"all"===this.controlledWidgets&&f.push(d))},this);return f}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),function(l,e,f,h,d,k,n,b){var c=null,a=null,g=!1;l=l(null,function(){});var m=require.toUrl("jimu"),p=k(m+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),s=k(m+"/SpatialReference/transform.json",
{handleAs:"json"});l.loadResource=function(){var b=new h;if(c&&a)return b.resolve(),b;d([p,s]).then(function(d){c=d[0];a=d[1];g=!0;b.resolve()},function(a){console.error(a);g=!1;b.reject(a)});return b};l.getAllCSUnits=function(){if(g){var a=[];f.forEach(c.wkids,e.hitch(this,function(b){b=this.getCSUnit(b);-1===f.indexOf(a,b)&&a.push(b)}));return a}};l.convertUnit=function(a,c,d){if(g)return b.convertUnit(a,c,d)};l.getUnitRate=function(a,c){if(g)return b.getUnitRate(a,c)};l.isProjectUnit=function(a){if(g)return b.isProjectUnit(a)};
l.isGeographicUnit=function(a){if(g)return b.isGeographicUnit(a)};l.getGeographicUnits=function(){if(g)return b.getGeographicUnits()};l.getProjectUnits=function(){if(g)return b.getProjectUnits()};l.getCSUnit=function(a){if(g){a=this.getCSStr(a);var b=0,c=0,b=a.lastIndexOf("UNIT"),c=a.indexOf(",",b);return a.slice(b+6,c-1)}};l.isSameSR=function(a,b){if(g){var d=this.indexOfWkid(a),e=this.indexOfWkid(b);return c.labels[d]===c.labels[e]}};l.isValidWkid=function(a){if(g)return-1<this.indexOfWkid(a)};
l.getSRLabel=function(a){if(g&&this.isValidWkid(a))return a=this.indexOfWkid(a),c.labels[a]};l.indexOfWkid=function(a){if(g)return f.indexOf(c.wkids,a)};l.isWebMercator=function(a){return n.prototype._isWebMercator?n.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new n(parseInt(a,10))).isWebMercator()};l.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};l.isValidTfWkid=function(a){if(g)return-1<this.indexOfTfWkid(a)};l.getTransformationLabel=function(b){if(g)return this.isValidTfWkid(b)?
(b=this.indexOfTfWkid(b),a.labels[b]):""};l.indexOfTfWkid=function(b){if(g)return f.indexOf(a.tfWkids,b)};l.isGeographicCS=function(a){if(g)return this.isValidWkid(a)?c.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};l.isProjectedCS=function(a){if(g)return this.isValidWkid(a)?c.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};l.getGeoCSByProj=function(a){if(g&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=f.indexOf(c.details,a),c.wkids[a]};l.getSpheroidStr=function(a){if(g){if(this.isGeographicCS(a))return c.details[this.indexOfWkid(a)];
if(this.isProjectedCS(a)){a=c.details[this.indexOfWkid(a)];var b=a.indexOf("GEOGCS"),d=a.indexOf("PROJECTION")-1;return a.slice(b,d)}return null}};l.getCSStr=function(a){if(g)return c.details[this.indexOfWkid(a)]};l.isSameSpheroid=function(a,b){if(g){var c=this.getSpheroidStr(a),d=this.getSpheroidStr(b);return c&&d&&c===d?!0:!1}};return l})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(l,e){var f="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
h="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),d={INCHES:0.0254,FOOT:0.3048,FOOT_US:0.3048006096012192,YARDS:0.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:0.0010,CENTIMETERS:0.01,METER:1,KILOMETERS:1E3,DECIMETERS:0.1,LINK_CLARKE:0.2011661949,FOOT_GOLD_COAST:0.3047997101815088,FOOT_CLARKE:0.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:0.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:0.9143984146160287,CHAIN_SEARS:20.11676512155263,
FOOT_SEARS:0.3047994715386762,YARD_INDIAN_1937:0.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:0.0174532925199433,DECIMAL_DEGREES:0.0174532925199433,MGRS:0.0174532925199433,USNG:0.0174532925199433,DEGREE_MINUTE_SECONDS:0.0174532925199433,GRAD:0.01570796326794897},k=l(null,function(){});k.convertUnit=function(e,b,c){return d[e.toUpperCase()]/d[b.toUpperCase()]*c};k.getUnitRate=function(e,b){return d[e.toUpperCase()]/d[b.toUpperCase()]};k.isProjectUnit=function(d){return-1<e.indexOf(f,d.toUpperCase())};
k.isGeographicUnit=function(d){return-1<e.indexOf(h,d.toUpperCase())};k.getGeographicUnits=function(){return h};k.getProjectUnits=function(){return f};return k})},"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/_base/unload dojo/Evented dojo/promise/all ./LayerInfoFactory".split(" "),function(l,e,f,h,d,k,n,b,c,a){var g=l([b],{map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,_tableInfos:null,_finalTableInfos:null,
_basemapLayers:null,constructor:function(a,b){this._basemapLayers=b.baseMap.baseMapLayers;this._operLayers=b.operationalLayers;this.tables=b.tables;this.map=a;this._initLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();this._clearAddedFlag(this._layerinfos);this._initFinalTableInfos();this._initFinalLayerInfos(this._layerinfos);this._markFirstOrLastNode()},getLayerInfoArray:function(){return this._finalLayerInfos},getTableInfoArray:function(){return this._finalTableInfos},
addFeatureCollection:function(b,c){var d=this._getUniqueTopLayerInfoId(c),g={layers:[]};e.forEach(b,function(a,b){a.id=d+"_"+b;g.layers.push({id:a.id,layerObject:a})},this);this.map.addLayers(b);var m;try{m=a.getInstance().create({featureCollection:g,title:c||d,id:d},this.map),m.init()}catch(k){console.warn(k.message),m=null}m&&(this._layerinfos.push(m),this.update(),this._onUpdated())},addTable:function(a){var b=[];a=this._addTable(a,this._finalTableInfos);this._tableInfos.push(a);b.push(a);this._onTableChange(b,
"added")},_addTable:function(b,c){var d;try{b.empty=!0,d=a.getInstance().create({layerObject:b,title:b.title,id:this._getUniqueTableId(b.id),selfType:"table"}),d.init()}catch(g){console.warn(g.message),d=null}d&&c&&c.push(d);return d},_getUniqueTableId:function(a){var b=this._tableInfos.concat(this._finalTableInfos||[]);return this._getUniqueLayerOrTableId(a,b)},_getUniqueTopLayerInfoId:function(a){return this._getUniqueLayerOrTableId(a,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(a,
b){var c=1,d;a||(a="table");for(d=a;;){for(var g=0;g<b.length&&b[g].id!==d;g++);if(g===b.length)return d;d=a+"_"+c.toString();c++}},removeTable:function(){},traversal:function(a){for(var b=this.getLayerInfoArray(),c=0;c<b.length;c++)if(b[c].traversal(a))return!0},getLayerInfoById:function(a){return this._findLayerInfoById(a)},moveUpLayer:function(a){var b=null,c;a=this._getTopLayerInfoIndexById(a);0<a&&(b=this._finalLayerInfos[a-1].obtainLayerIndexesInMap().length,this._finalLayerInfos[a].moveRightOfIndex(this._finalLayerInfos[a-
1].obtainLayerIndexesInMap()[b-1].index),b=this._finalLayerInfos[a-1].id,c=this._finalLayerInfos[a],this._finalLayerInfos.splice(a,1),this._finalLayerInfos.splice(a-1,0,c),this._markFirstOrLastNode());return b},moveDownLayer:function(a){var b=null,c=this._getTopLayerInfoIndexById(a);c<this._finalLayerInfos.length-1&&(this._finalLayerInfos[c].moveLeftOfIndex(this._finalLayerInfos[c+1].obtainLayerIndexesInMap()[0].index),b=this._finalLayerInfos[c+1].id,a=this._finalLayerInfos[c+1],this._finalLayerInfos.splice(c+
1,1),this._finalLayerInfos.splice(c,0,a),this._markFirstOrLastNode());return b},getBasemapLayers:function(){var a=[];e.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);("basemap"===b._basemapGalleryLayerType||"reference"===b._basemapGalleryLayerType)&&a.push(b)},this);0===a.length&&(a=this._basemapLayers);return a},getMapNotesLayerInfoArray:function(){return e.filter(this.getLayerInfoArray(),function(a){return a.originOperLayer.featureCollection&&0===a.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===
a.originOperLayer.layerType&&!this.map.getLayer(a.id)},this)},_initLayerInfos:function(){var b;this._layerinfos=[];e.forEach(this._operLayers,function(c){try{b=a.getInstance().create(c),b.init()}catch(d){console.warn(d.message),b=null}b&&this._layerinfos.push(b)},this)},_extraSetLayerInfos:function(){e.forEach(this._layerinfos,function(b,c){var d;if("esri.layers.GeoRSSLayer"===b.layerObject.declaredClass||"esri.layers.KMLLayer"===b.layerObject.declaredClass){try{d=a.getInstance().create(b.originOperLayer),
d.init()}catch(g){console.warn(g.message),d=null}d&&(this._layerinfos[c]=d)}else if(b.originOperLayer.featureCollection){var m=[];e.forEach(b.getSubLayers(),function(a){m.push(a.id)});e.forEach(m,function(a){this.map.getLayer(a)||b.removeSubLayerById(a)},this);1===b.getSubLayers().length&&(d=b.getSubLayers()[0],this.map.getLayer(d.id).title=b.title,b.removeSubLayerById(d.id))}},this)},_initFinalLayerInfos:function(a){var b,c;this._finalLayerInfos=[];for(b=this.map.graphicsLayerIds.length-1;0<=b;b--)c=
this.map.graphicsLayerIds[b],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,a),c,!0);for(b=this.map.layerIds.length-1;0<=b;b--)c=this.map.layerIds[b],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,a),c,!1)},_isBasemap:function(a){for(var b=!1,c=this.getBasemapLayers(),d=0;d<c.length;d++)c[d].id===a&&(b=!0);return b},_addToFinalLayerInfos:function(b,c,d){var g;if(b)!b._addedFlag&&b.isGraphicLayer()===d&&(this._finalLayerInfos.push(b),
b._addedFlag=!0);else{b=this.map.getLayer(c);if("esri.layers.GraphicsLayer"!==b.declaredClass&&"labels"!==b.id){try{g=a.getInstance().create({layerObject:b,title:this._getLayerTitle(b),id:b.id||" "},this.map),g.init()}catch(m){console.warn(m.message),g=null}g&&this._finalLayerInfos.push(g)}("esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===b.declaredClass)&&g&&g._getLayerDefinition().then(f.hitch(this,function(a){var b=[];e.forEach(a.tables,function(a){a.url=
g.getUrl()+"/"+a.id;a.id=g.id+"_"+a.id;a.title=this._getLayerTitle(a);(a=this._addTable(a,this._finalTableInfos))&&b.push(a)},this);this._onTableChange(b,"added")}))}},_getLayerTitle:function(a){var b=a.label||a.title||a.name||"";if(a.url){var c;c=a.url.indexOf("rest/services/");-1<c&&(c=a.url.substring(c+14).split("/")[0],b=b?c+" - "+b:c)}return b||a.id},_findLayerInfoByIdAndReturnTopLayer:function(a,b){var c,d=null;b||(b=this._finalLayerInfos);for(c=0;c<b.length;c++)if(d=b[c].findLayerInfoById(a)){d=
b[c];break}return d},_findLayerInfoById:function(a,b){var c,d=null;b||(b=this._finalLayerInfos);for(c=0;c<b.length&&!(d=b[c].findLayerInfoById(a));c++);return d},_findTopLayerInfoById:function(a){var b,c=null,d=this._finalLayerInfos;for(b=0;b<d.length;b++)if(d[b].id===a){c=d[b];break}return c},_getTopLayerInfoIndexById:function(a){var b,c=-1;for(b=0;b<this._finalLayerInfos.length;b++)if(this._finalLayerInfos[b].id===a){c=b;break}return c},_clearAddedFlag:function(a){e.forEach(a,function(a){a._addedFlag=
!1})},_markFirstOrLastNode:function(){var a;if(this._finalLayerInfos.length){for(a=0;a<this._finalLayerInfos.length;a++)this._finalLayerInfos[a].isFirst=!1,this._finalLayerInfos[a].isLast=!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(a=0;a<this._finalLayerInfos.length;a++)if(!this._finalLayerInfos[a].isGraphicLayer()){a&&(this._finalLayerInfos[a-1].isLast=!0);this._finalLayerInfos[a].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(a,
b,c){"BasemapGallery"===a&&(this._basemapLayers.length=0,e.forEach(c,f.hitch(this,function(a){this._basemapLayers.push({layerObject:a,id:a.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(a){var b;for(b=this._basemapLayers.length=0;b<a.layers.length;b++)this._basemapLayers.push({layerObject:a.layer[b],id:a.layers[b].id})},_bindEvents:function(){var a,b,c,g;a=d(this.map,"layer-add-result",f.hitch(this,this._onLayersChange,"added"));b=d(this.map,"layer-remove",f.hitch(this,
this._onLayersChange,"removed"));g=k.subscribe("layerInfos/layerInfo/isShowInMapChanged",f.hitch(this,this._onShowInMapChanged));c=d(this.map,"before-unload",f.hitch(this,function(){a.remove();b.remove();g.remove()}));n.addOnUnload(function(){a.remove();b.remove();c.remove();g.remove()})},_onLayersChange:function(a,b){var c=null,d;!b.error&&("esri.layers.GraphicsLayer"!==b.layer.declaredClass&&!b.layer._basemapGalleryLayerType)&&("added"===a?(this.update(),c=this._findTopLayerInfoById(b.layer.id),
d=this._findLayerInfoById(b.layer.id)):(c=this._findTopLayerInfoById(b.layer.id),d=this._findLayerInfoById(b.layer.id),this.update()),this.emit("layerInfosChanged",c,a,d))},_onShowInMapChanged:function(a){this.emit("layerInfosIsShowInMapChanged",a)},_initTablesInfos:function(){this._tableInfos=[];e.forEach(this.tables,function(a){this._addTable(a,this._tableInfos)},this)},_initFinalTableInfos:function(){this._finalTableInfos=[];e.forEach(this._tableInfos,function(a){this._finalTableInfos.push(a)},
this)},_onTableChange:function(a,b){this.emit("tableInfosChanged",a,b)},_onUpdated:function(){this.emit("updated")}});g.getLayerInfoArrayByType=function(a,b){var d=new h,m=[],k=[];g.getInstance(a,a.iteminfo).then(function(a){a.traversal(function(a){var b=a.getLayerType();b.layerInfo=a;m.push(b)});c(m).then(function(a){e.forEach(a,function(a,c){b===a&&k.push(m[c].layerInfo)});d.resolve(k)})});return d};var m=!0,p=null,s=null,r=new h;g.getInstance=function(b,c){p&&p!==b&&(m=!0,s=p=null,r=new h);s?r.resolve(s):
m&&(m=!1,a.getInstance(b).init().then(f.hitch(this,function(){var a=new g(b,c.itemData);p=b;s=a;r.resolve(a)})));return r};return g})},"jimu/LayerInfos/LayerInfoFactory":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred"],function(l,e,f){var h=null,d=l(null,{constructor:function(){},init:function(){var d=new f;require("jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForGroup jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream".split(" "),
e.hitch(this,function(e,b,c,a,g,m,f,h,r,q,l,u,w){this.LayerInfoForCollection=e;this.LayerInfoForMapService=b;this.LayerInfoForKML=c;this.LayerInfoForGeoRSS=a;this.LayerInfoForDefault=g;this.LayerInfoForWMS=m;this.LayerInfoForGroup=f;this.LayerInfoForDefaultDynamic=h;this.LayerInfoForDefaultTile=r;this.LayerInfoForDefaultWMS=q;this.LayerInfoForDefaultTable=l;this.LayerInfoForDefaultImage=u;this.LayerInfoForDefaultStream=w;d.resolve()}));return d},create:function(d){if(d.featureCollection)return new this.LayerInfoForCollection(d,
this.map);if("esri.layers.KMLLayer"===d.layerObject.declaredClass)return new this.LayerInfoForKML(d,this.map);if("esri.layers.GeoRSSLayer"===d.layerObject.declaredClass)return new this.LayerInfoForGeoRSS(d,this.map);if("esri.layers.WMSLayer"===d.layerObject.declaredClass&&!d.selfType)return new this.LayerInfoForWMS(d,this.map);if("esri.layers.ArcGISDynamicMapServiceLayer"===d.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===d.layerObject.declaredClass)return new this.LayerInfoForMapService(d,
this.map);if("esri.layers.ArcGISImageServiceLayer"===d.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===d.layerObject.declaredClass)return new this.LayerInfoForDefaultImage(d,this.map);if("esri.layers.StreamLayer"===d.layerObject.declaredClass)return new this.LayerInfoForDefaultStream(d,this.map);"Table"===d.layerObject.type&&(d.selfType="table");switch(d.selfType){case "mapservice_dynamic_group":return new this.LayerInfoForGroup(d,this.map);case "mapservice_tiled_group":return new this.LayerInfoForGroup(d,
this.map,!0);case "mapservice_dynamic":return new this.LayerInfoForDefaultDynamic(d,this.map);case "mapservice_tiled":return new this.LayerInfoForDefaultTile(d,this.map);case "wms":return new this.LayerInfoForDefaultWMS(d,this.map);case "table":return new this.LayerInfoForDefaultTable(d,this.map);default:return new this.LayerInfoForDefault(d,this.map)}}});d.getInstance=function(e){null===h&&(h=new d);e&&(h.map=e);return h};return d})},"jimu/dijit-all":function(){define([],1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),
function(l,e,f,h,d,k,n,b){return l(e,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){n.create("div",{"class":"jimu-radio-inner"},this.domNode);this.checked&&k.add(this.domNode,"jimu-radio-checked");this.own(d(this.domNode,"click",f.hitch(this,function(){this.checked||this.check()})))},check:function(b){void 0===b&&(b=!0);this.checked=!0;k.add(this.domNode,"jimu-radio-checked");b&&this._changeOthersState(!1);this.onStateChange()},
uncheck:function(b){void 0===b&&(b=!0);this.checked=!1;k.remove(this.domNode,"jimu-radio-checked");b&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(c){null!==this.group&&h.forEach(b.toArray(),function(a){a.id!==this.id&&(a["class"]===this["class"]&&a.group===this.group)&&(c?a.check(!1):a.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/Evented".split(" "),
function(l,e,f,h,d,k){return l([e,k],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,status:!0,postCreate:function(){this.checkNode=h.create("div",{"class":"checkbox jimu-float-leading"},this.domNode);this.label&&(this.labelNode=h.create("div",{"class":"label jimu-float-leading",innerHTML:this.label},this.domNode));this.checked&&h.addClass(this.checkNode,"checked");this.own(d(this.checkNode,"click",f.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})));
this.label&&this.own(d(this.labelNode,"click",f.hitch(this,function(){this.checked&&this.status?this.uncheck():this.status&&this.check()})))},setValue:function(d){this.status&&(!0===d?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(d){d=!!d;var b=this.status!==d;this.status=d;b&&this.emit("status-change",d);this.labelNode&&(this.status?h.setStyle(this.labelNode,"color","#000000"):h.setStyle(this.labelNode,"color","#818181"))},check:function(){this.status&&
(this.checked=!0,h.addClass(this.checkNode,"checked"),this.onStateChange())},uncheck:function(d){if(this.status&&(this.checked=!1,h.removeClass(this.checkNode,"checked"),!d))this.onStateChange()},onStateChange:function(){if(this.onChange&&f.isFunction(this.onChange))this.onChange(this.checked)}})})},"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr jimu/utils jimu/symbolUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font dijit/form/Select dijit/form/NumberSpinner jimu/dijit/ColorPicker jimu/dijit/_Transparency".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w,v,x){return l([e,f,h,k],{templateString:d,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,symbol:null,type:null,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser},postCreate:function(){this.inherited(arguments);this.own(a(document.body,"click",n.hitch(this,this._onBodyClicked)));(this._isIE8=
8===g("ie"))&&b.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(a){this.reset();var b=a&&a.declaredClass;b&&("string"===typeof b&&0<=b.indexOf("esri.symbol"))&&(this.symbol=this._cloneSymbol(a),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?
(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(a){this.reset();if("marker"===a||"line"===a||"fill"===a||"text"===a)this.type=a,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===this.type&&this._initTextSection()},getSymbol:function(){var a=
null;"marker"===this.type?a=this._getPointSymbolBySetting():"line"===this.type?a=this._getLineSymbolBySetting():"fill"===this.type?a=this._getFillSymbolBySetting():"text"===this.type&&(a=this._getTextSymbolBySetting());var b=null;a&&(b=this._cloneSymbol(a));return b},_onBodyClicked:function(a){a=a.target||a.srcElement;this._tryHideDropDownOfSelectDijit(a,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(a,this.lineStylesSelect)},_tryHideDropDownOfSelectDijit:function(a,c){var d=c.domNode,
g=c.dropDown.domNode,d=a===d||b.isDescendant(a,d),g=a===g||b.isDescendant(a,g);if(!d&&!g)c.dropDown.onCancel()},_onChange:function(a){a=this._cloneSymbol(a);this.emit("change",a)},_hideAllSections:function(){m(".symbol-section",this.domNode).style("display","none")},_showSection:function(a){this._hideAllSections();m("."+a+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(a,b,c){return s.getAncestorDom(a,b,c)},_getAbsoluteUrl:function(a){return window.location.protocol+
"//"+window.location.host+require.toUrl(a)},_cloneSymbol:function(a){if(!a)return null;var b=a;try{var c=a.toJson(),b=q.fromJson(c)}catch(d){console.error(d)}return b},_createSymbolIconTable:function(a,d,g){var e=this.type+"-icon-table";a=b.toDom('\x3ctable class\x3d"'+("icon-table "+e+" "+(e+"-"+a))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');for(var e=m("tbody",a)[0],k=Math.ceil(d.length/8),f=0;f<k;f++)b.create("tr",{},e);var p=m("tr",a);c.forEach(d,n.hitch(this,function(a,c){var d=n.clone(a),
e=q.fromJson(a),m=b.create("td",{},p[Math.floor(c/8)]);b.addClass(m,"symbol-td-item");e=this._createSymbolNode(e);b.addClass(e,"symbol-div-item");var k=e.firstChild;b.addClass(k,"svg-node");if(this._isIE8&&"point"===g)if(window.isRTL){if("Cross"===a.name||"X"===a.name)b.setStyle(k,"right","-20px"),b.setStyle(e,"marginTop","20px")}else("Cross"===a.name||"X"===a.name)&&b.setStyle(e,"marginTop","20px");e.symbol=d;b.place(e,m)}));return a},_updatePreview:function(a){var c=this._cloneSymbol(this.symbol);
b.empty(a);(c=r.createSymbolNode(c))||(c=b.create("div"));b.place(c,a)},_createSymbolNode:function(a){(a=r.createSymbolNode(a,{width:36,height:36}))||(a=b.create("div"));b.setStyle(a,{width:"36px",height:"36px"});return a},_getLineShapeDesc:function(a){var b=null;if(this.isSimpleLineSymbol(a)||this.isCartographicLineSymbol(a))b={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:a.getStroke()};return b},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||
(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new t({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(a(this.pointIconTables,
".symbol-div-item:click",n.hitch(this,this._onPointSymIconItemClick)));this.own(a(this.pointSymClassSelect,"Change",n.hitch(this,this._onPointSymClassSelectChange)));this.own(a(this.pointSize,"change",n.hitch(this,this._onPointSymbolChange)));this.own(a(this.pointColor,"change",n.hitch(this,this._onPointSymbolChange)));this.own(a(this.pointAlpha,"change",n.hitch(this,this._onPointSymbolChange)));this.own(a(this.pointOutlineColor,"change",n.hitch(this,this._onPointSymbolChange)));this.own(a(this.pointOutlineWidth,
"change",n.hitch(this,this._onPointSymbolChange)))},_onPointSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(),this._onChange(this.symbol))},_initPointSettings:function(a){if(a){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(a)){if(this.pointSize.set("value",a.size),this.pointColor.setColor(a.color),this.pointAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a=a.outline)this.pointOutlineColor.setColor(a.color),this.pointOutlineWidth.set("value",parseFloat(a.width.toFixed(0)))}else this.isPictureMarkerSymbol(a)&&
this.pointSize.set("value",a.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(a){return a&&"esri.symbol.SimpleMarkerSymbol"===a.declaredClass},isPictureMarkerSymbol:function(a){return a&&"esri.symbol.PictureMarkerSymbol"===a.declaredClass},_onPointSymClassSelectChange:function(){this._showSelectedPointSymIconTable();var a=this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+a]||this._requestPointSymJson(a)},_showSelectedPointSymIconTable:function(){var a=this.pointSymClassSelect.get("value");
m(".marker-icon-table",this.pointIconTables).style("display","none");a=m(".marker-icon-table-"+a,this.pointIconTables);0<a.length&&a.style("display","table")},_requestPointSymJson:function(a){var c="def"+a,d=this.pointSymClassSelect[c];d||(d=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+a+".json"),d=p(d,{handleAs:"json"}),this.pointSymClassSelect[c]=d,d.then(n.hitch(this,function(c){c=this._createSymbolIconTable(a,c,"point");b.place(c,this.pointIconTables);this._showSelectedPointSymIconTable()}),
n.hitch(this,function(a){console.error("get point symbol failed",a)})))},_onPointSymIconItemClick:function(a){if(a=this._getAncestor(a.target||a.srcElement,function(a){return b.hasClass(a,"symbol-div-item")},5))if(m(".selected-symbol-div-item",a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),b.addClass(a,"selected-symbol-div-item"),a=a.symbol){this.symbol=q.fromJson(a);a=b.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():
this._showPictureMarkerSymSettings();this._onPointSymbolChange();var c=b.getStyle(this.pointColorTr,"display");a!==c&&this.emit("resize")}},_showSimpleMarkerSymSettings:function(){b.setStyle(this.pointColorTr,"display","");b.setStyle(this.pointOpacityTr,"display","");b.setStyle(this.pointOutlineColorTr,"display","");b.setStyle(this.pointOulineWidthTr,"display","")},_showPictureMarkerSymSettings:function(){b.setStyle(this.pointColorTr,"display","none");b.setStyle(this.pointOpacityTr,"display","none");
b.setStyle(this.pointOutlineColorTr,"display","none");b.setStyle(this.pointOulineWidthTr,"display","none")},_getPointSymbolBySetting:function(){if(!this.symbol)return null;var a=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){this.symbol.setSize(a);var a=this.pointColor.getColor(),b=this.pointAlpha.getAlpha();a.a=b;this.symbol.setColor(a);var a=this.pointOutlineColor.getColor(),b=parseFloat(this.pointOutlineWidth.get("value")),c=new u;c.setStyle(u.STYLE_SOLID);c.setColor(a);
c.setWidth(b);this.symbol.setOutline(c)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(a),this.symbol.setHeight(a));this._updatePreview(this.pointSymPreview);return this.symbol},_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(a(this.lineIconTables,".symbol-div-item:click",
n.hitch(this,this._onLineSymIconItemClick)));this.own(a(this.lineColor,"change",n.hitch(this,this._onLineSymbolChange)));this.own(a(this.lineStylesSelect,"change",n.hitch(this,this._onLineSymbolChange)));this.own(a(this.lineAlpha,"change",n.hitch(this,this._onLineSymbolChange)));this.own(a(this.lineWidth,"change",n.hitch(this,this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(a){a&&
(this._invokeSymbolChangeEvent=!1,this.lineColor.setColor(a.color),this.lineAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(a.width.toFixed(0))),this.lineStylesSelect.set("value",a.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(a){return a&&"esri.symbol.SimpleLineSymbol"===a.declaredClass},isCartographicLineSymbol:function(a){return a&&"esri.symbol.CartographicLineSymbol"===a.declaredClass},_requestLineSymJson:function(a){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+
a+".json");p(c,{handleAs:"json"}).then(n.hitch(this,function(c){c=this._createSymbolIconTable(a,c,"line");b.place(c,this.lineIconTables)}),n.hitch(this,function(a){console.error("get line symbol failed",a)}))},_onLineSymIconItemClick:function(a){if(a=this._getAncestor(a.target||a.srcElement,function(a){return b.hasClass(a,"symbol-div-item")},5))if(m(".selected-symbol-div-item",a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),b.addClass(a,"selected-symbol-div-item"),a=a.symbol)a=
q.fromJson(a),this._initLineSettings(a),this._onLineSymbolChange()},_getLineSymbolBySetting:function(){this.symbol=new u;var a=this.lineColor.getColor(),b=this.lineStylesSelect.get("value");a.a=this.lineAlpha.getAlpha();var c=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(b);this.symbol.setColor(a);this.symbol.setWidth(c);this._updatePreview(this.lineSymPreview);return this.symbol},_initFillSection:function(){this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,
this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(a(this.fillIconTables,".symbol-div-item:click",n.hitch(this,this._onFillSymIconItemClick)));this.own(a(this.fillColor,"change",n.hitch(this,this._onFillSymbolChange)));this.own(a(this.fillAlpha,"change",n.hitch(this,this._onFillSymbolChange)));this.own(a(this.fillOutlineColor,"change",n.hitch(this,this._onFillSymbolChange)));this.own(a(this.fillOutlineWidth,
"change",n.hitch(this,this._onFillSymbolChange)))},_onFillSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(),this._onChange(this.symbol))},_initFillSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(a.color),this.fillAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a.outline&&(this.fillOutlineColor.setColor(a.outline.color),this.fillOutlineWidth.set("value",parseInt(a.outline.width,10))),this._invokeSymbolChangeEvent=!0)},_isSimpleFillSymbol:function(a){return a&&
"esri.symbol.SimpleFillSymbol"===a.declaredClass},_requestFillSymJson:function(a){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+a+".json");p(c,{handleAs:"json"}).then(n.hitch(this,function(c){c=this._createSymbolIconTable(a,c,"fill");b.place(c,this.fillIconTables)}),n.hitch(this,function(a){console.error("get fill symbol failed",a)}))},_onFillSymIconItemClick:function(a){if(a=this._getAncestor(a.target||a.srcElement,function(a){return b.hasClass(a,"symbol-div-item")},5))if(m(".selected-symbol-div-item",
a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),b.addClass(a,"selected-symbol-div-item"),a=a.symbol)a=q.fromJson(a),this._initFillSettings(a),this._onFillSymbolChange()},_getFillSymbolBySetting:function(){this.symbol=new w;var a=this.fillColor.getColor();a.a=this.fillAlpha.getAlpha();var b=this.fillOutlineColor.getColor(),c=parseInt(this.fillOutlineWidth.get("value"),10);this.symbol.setColor(a);this.symbol.setStyle(w.STYLE_SOLID);a=new u;a.setStyle(u.STYLE_SOLID);a.setColor(b);
a.setWidth(c);this.symbol.setOutline(a);this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(a(this.inputText,"change",n.hitch(this,this._onTextSymbolChange)));this.own(a(this.textColor,"change",n.hitch(this,this._onTextSymbolChange)));this.own(a(this.textFontSize,"change",
n.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.inputText.value=a.text,this.textColor.setColor(a.color),a=parseInt(a.font.size,10),this.textFontSize.set("value",a),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(a){return a&&"esri.symbol.TextSymbol"===a.declaredClass},_updateTextPreview:function(){var a=
this.textColor.getColor().toHex(),c=parseInt(this.textFontSize.get("value"),10)+"px";b.setStyle(this.textPreview,{color:a,fontSize:c});this.textPreview.innerHTML=this.inputText.value},_getTextSymbolBySetting:function(){this.symbol=new v;var a=this.inputText.value,b=this.textColor.getColor(),c=parseInt(this.textFontSize.get("value"),10),d=new x;d.setSize(c);this.symbol.setText(a);this.symbol.setColor(b);this.symbol.setFont(d);this._updateTextPreview();return this.symbol}})})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w){function v(a){return function(c){this._isLoaded?this.inherited(a,arguments):this.loadDropDown(b.hitch(this,a,c))}}var x=e("dijit.form._SelectMenu",p,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(c(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,c=this.parentWidget.value;
b.isArray(c)&&(c=c[c.length-1]);c&&l.forEach(this.parentWidget._getChildren(),function(b){b.option&&c===b.option.value&&(a=!0,this.focusChild(b,!1))},this);a||this.inherited(arguments)}});d=e("dijit.form.Select"+(a("dojo-bidi")?"_NoBidi":""),[g,m,t],{baseClass:"dijitSelect dijitValidationTextBox",templateString:w,_buttonInputDisabled:a("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=a?a:0].value)}this.dropDown=new x({id:this.id+"_menu",parentWidget:this});h.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(a){if(!a.value&&!a.label)return new r({ownerDocument:this.ownerDocument});var c=b.hitch(this,"_setValueAttr",a);a=new s({option:a,label:("text"===this.labelType?(a.label||"").toString().replace(/&/g,
"\x26amp;").replace(/</g,"\x26lt;"):a.label)||this.emptyLabel,onClick:c,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:a.disabled||!1});a.focusNode.setAttribute("role","option");return a},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return!this.dropDown?[]:this.dropDown.getChildren()},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(a){}},focusChild:function(a){a&&
this.set("value",a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=u.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{l.forEach(this._getChildren(),
function(a){a.destroyRecursive()});var b=new s({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);f.set(this.valueNode,"value",this.get("value"));this._refreshState()},
_setNameAttr:"valueNode",_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?q.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):q.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);q.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=k.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(c(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[n.LEFT_ARROW];delete a[n.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);
h.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);q.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){q.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
a("dojo-bidi")&&(d=e("dijit.form.Select",d,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));d._Menu=x;d.prototype._onContainerKeydown=v("_onContainerKeydown");d.prototype._onContainerKeypress=v("_onContainerKeypress");return d})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p){return d("dijit.form._FormSelectWidget",p,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(c.isArray(a))return l.map(a,"return this.getOptions(item);",this);c.isString(a)&&(a={value:a});c.isObject(a)&&(l.some(b,function(b,c){for(var d in a)if(!(d in b)||b[d]!=a[d])return!1;a=c;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){l.forEach(c.isArray(a)?a:[a],function(a){a&&c.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(c.isArray(a)?
a:[a]);l.forEach(a,function(a){a&&(this.options=l.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){l.forEach(c.isArray(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),c;if(b)for(c in a)b[c]=a[c]},this);this._loadChildren()},setStore:function(a,c,d){b.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,c,d)},_deprecatedSetStore:function(a,b,d){var k=this.store;d=d||{};if(k!==a){for(var p;p=this._notifyConnections.pop();)p.remove();a.get||(c.mixin(a,{_oldAPI:!0,get:function(a){var b=new e;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,b){var d=new e(function(){g.abort&&g.abort()});d.total=new e;var g=this.fetch(c.mixin({query:a,onBegin:function(a){d.total.resolve(a)},
onComplete:function(a){d.resolve(a)},onError:function(a){d.reject(a)}},b));return new m(d)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[f.after(a,"onNew",c.hitch(this,"_onNewItem"),!0),f.after(a,"onDelete",c.hitch(this,"_onDeleteItem"),!0),f.after(a,"onSet",c.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);d.query&&this._set("query",d.query);d.queryOptions&&this._set("queryOptions",d.queryOptions);a&&a.query&&(this._loadingStore=!0,this.onLoadDeferred=new e,this._queryRes=a.query(this.query,this.queryOptions),g(this._queryRes,c.hitch(this,function(g){if(this.sortByLabel&&!d.sort&&g.length)if(a.getValue)g.sort(h.createSortFunction([{attribute:a.getLabelAttributes(g[0])[0]}],a));else{var e=this.labelAttr;g.sort(function(a,b){return a[e]>b[e]?1:b[e]>
a[e]?-1:0})}d.onFetch&&(g=d.onFetch.call(this,g,d));l.forEach(g,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(c.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:b);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(g):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)}));return k},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=c.isArray(a)?l.map(a,function(a){return c.isObject(a)?a:{value:a}}):c.isObject(a)?[a]:[{value:a}];a=l.filter(this.getOptions(a),function(a){return a&&a.value});var d=this.getOptions()||[];if(!this.multiple&&(!a[0]||!a[0].value)&&d.length)a[0]=d[0];l.forEach(d,
function(b){b.selected=l.some(a,function(a){return a.value===b.value})});d=l.map(a,function(a){return a.value});if(!("undefined"==typeof d||"undefined"==typeof d[0])){var g=l.map(a,function(a){return a.label});this._setDisplay(this.multiple?g:g[0]);this.inherited(arguments,[this.multiple?d:d[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=l.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?a:a[0]},
_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(l.forEach(this._getChildren(),function(a){a.destroyRecursive()}),l.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;l.forEach(this._getChildren(),function(c){var d=l.some(a,function(a){return c.option&&
a===c.option.value});d&&!b.multiple&&(b.focusedChild=c);n.toggle(c.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),d);c.domNode.setAttribute("aria-selected",d?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=l.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?l.map(l.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){(!b||!b.parent)&&this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,c=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:c?b.getIdentity(a):null,label:c,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);k.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?a("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+b._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);f.after(this,"onChange",c.hitch(this,"_updateSelection"));var a=this.store;if(a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"]))this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions});this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(l,e,f){var h=function(d){function k(b){d[b]=function(){var c=arguments,a=f(d,function(a){Array.prototype.unshift.call(c,a);return h(l[b].apply(l,c))});if("forEach"!==b||n)return a}}if(!d)return d;var n=!!d.then;n&&(d=e.delegate(d));k("forEach");k("filter");
k("map");null==d.total&&(d.total=f(d,function(b){return b.length}));return d};e.setObject("dojo.store.util.QueryResults",h);return h})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(l,e,f,h){return l("dijit.DropDownMenu",h,{templateString:f,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(d){this._moveToPopup(d);d.stopPropagation();d.preventDefault()},
_onLeftArrow:function(d){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else d.stopPropagation(),d.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r){return e("dijit._MenuBase",[m,
r,s,p],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){d.toggle(this.domNode,"dijitMenuActive",a);d.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var b=g.byNode(a);return a.parentNode==this.containerNode&&
b&&b.focus},postCreate:function(){var c=this,d="string"==typeof this.childSelector?this.childSelector:k.hitch(this,"childSelector");this.own(b(this.containerNode,b.selector(d,n.enter),function(){c.onItemHover(g.byNode(this))}),b(this.containerNode,b.selector(d,n.leave),function(){c.onItemUnhover(g.byNode(this))}),b(this.containerNode,b.selector(d,a),function(a){c.onItemClick(g.byNode(this),a);a.stopPropagation()}),b(this.containerNode,b.selector(d,"focusin"),function(){c._onItemFocus(g.byNode(this))}));
this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},
_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),a.popup&&(!a.disabled&&!this.hover_timer)&&(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=
a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&
(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var c=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY;this._openItemPopup(a,
c)}else this.onExecute(),a._onClick?a._onClick(b):a.onClick(b)},_openItemPopup:function(a,c){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var d=a.popup;d.parentMenu=this;this.own(this._mouseoverHandle=b.once(d.domNode,"mouseover",k.hitch(this,"_onPopupHover")));var g=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){c&&g.focusChild(a);g._cleanUp()},onExecute:k.hitch(this,
"_cleanUp",!0),onClose:function(){g._mouseoverHandle&&(g._mouseoverHandle.remove(),delete g._mouseoverHandle)}},c);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(h.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),
this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(l,e,f,h,d,k,n,b,c,a){return e("dijit._KeyNavContainer",[c,a,b],{connectKeyNavHandlers:function(a,b){var c=this._keyNavCodes={},e=k.hitch(this,"focusPrev"),f=k.hitch(this,"focusNext");l.forEach(a,function(a){c[a]=e});l.forEach(b,function(a){c[a]=f});c[d.HOME]=k.hitch(this,"focusFirstChild");c[d.END]=k.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){h.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);l.forEach(this.getChildren(),
k.hitch(this,"_startupChild"))},addChild:function(a,b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=
n.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(l,e,f,h,d,k,n,b){return e("dijit._KeyNavMixin",b,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);f.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var b=this._keyNavCodes={};b[h.HOME]=d.hitch(this,"focusFirstChild");b[h.END]=d.hitch(this,
"focusLastChild");b[this.isLeftToRight()?h.LEFT_ARROW:h.RIGHT_ARROW]=d.hitch(this,"_onLeftArrow");b[this.isLeftToRight()?h.RIGHT_ARROW:h.LEFT_ARROW]=d.hitch(this,"_onRightArrow");b[h.UP_ARROW]=d.hitch(this,"_onUpArrow");b[h.DOWN_ARROW]=d.hitch(this,"_onDownArrow")}var a=this,b="string"==typeof this.childSelector?this.childSelector:d.hitch(this,"childSelector");this.own(k(this.domNode,"keypress",d.hitch(this,"_onContainerKeypress")),k(this.domNode,"keydown",d.hitch(this,"_onContainerKeydown")),k(this.domNode,
"focus",d.hitch(this,"_onContainerFocus")),k(this.containerNode,k.selector(b,"focusin"),function(b){a._onChildFocus(n.getEnclosingWidget(this),b)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(b,a){b&&(this.focusedChild&&b!==this.focusedChild&&this._onChildBlur(this.focusedChild),b.set("tabIndex",this.tabIndex),b.focus(a?"end":"start"))},_onContainerFocus:function(b){b.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){f.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(b){f.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(b){b&&b!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),b.set("tabIndex",this.tabIndex),this.lastFocused=b,this._set("focusedChild",b))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(b,a,d,e){b&&this.focusChild(b)},_keyboardSearchCompare:function(b,a){var d=b.domNode,d=(b.label||(d.focusNode?
d.focusNode.label:"")||d.innerText||d.textContent||"").replace(/^\s+/,"").substr(0,a.length).toLowerCase();return a.length&&d==a?-1:0},_isFormElement:function(b){return"INPUT"===b.tagName||"TEXTAREA"===b.tagName||"SELECT"===b.tagName||"BUTTON"===b.tagName},_onContainerKeydown:function(b){if(!this._isFormElement(document.activeElement)){var a=this._keyNavCodes[b.keyCode];a?(a(b,this.focusedChild),b.stopPropagation(),b.preventDefault(),this._searchString=""):b.keyCode==h.SPACE&&(this._searchTimer&&
!b.ctrlKey&&!b.altKey&&!b.metaKey)&&(b.stopImmediatePropagation(),b.preventDefault(),this._keyboardSearch(b," "))}},_onContainerKeypress:function(b){if(!this._isFormElement(document.activeElement)&&!(b.charCode<=h.SPACE||b.ctrlKey||b.altKey||b.metaKey))b.preventDefault(),b.stopPropagation(),this._keyboardSearch(b,String.fromCharCode(b.charCode).toLowerCase())},_keyboardSearch:function(b,a){var g=null,e,k=0;d.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=a;
var b=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;e=this._searchString.substr(0,b);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var c=this.focusedChild||null;if(1==b||!c)if(c=this._getNextFocusableChild(c,1),!c)return;b=c;do{var d=this._keyboardSearchCompare(c,e);d&&0==k++&&(g=c);if(-1==d){k=-1;break}c=this._getNextFocusableChild(c,1)}while(c!=b)})();this.onKeyboardSearch(g,b,e,k)},_onChildBlur:function(){},
_getNextFocusableChild:function(b,a){var d=b;do{if(b)b=this._getNext(b,a);else if(b=this[0<a?"_getFirst":"_getLast"](),!b)break;if(null!=b&&b!=d&&b.isFocusable())return b}while(b!=d);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(b,a){if(b)for(b=b.domNode;b;)if((b=b[0>a?"previousSibling":"nextSibling"])&&"getAttribute"in b){var d=n.byNode(b);if(d)return d}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m){n=l("dijit.MenuItem"+(k("dojo-bidi")?"_NoBidi":""),[b,c,a,g],{templateString:m,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),d=a.substr(0,c);a=a.substr(c+3);c=d+b+a;a=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){a&&!("label"in this.params)&&this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);f.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&f.set(this.accelKeyNode,"id",this.id+"_accel");e.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==k("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_setSelected:function(a){h.toggle(this.domNode,
"dijitMenuItemSelected",a)},setLabel:function(a){d.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){d.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=
a?"":"none",this.accelKeyNode.innerHTML=a,f.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});k("dojo-bidi")&&(n=l("dijit.MenuItem",n,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return n})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(l,e){return l("dijit._Contained",null,{_getSibling:function(f){var h=this.domNode;do h=h[f+"Sibling"];while(h&&1!=h.nodeType);return h&&
e.byNode(h)},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var e=this.getParent();return!e||!e.getIndexOfChild?-1:e.getIndexOfChild(this)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(l,e,f,h,d,k){return l("dijit.MenuSeparator",[f,h,d],{templateString:k,buildRendering:function(){this.inherited(arguments);
e.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(l,e,f,h){return l("dijit.form.NumberSpinner",[f,h.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(d,e){var f=this.constraints,b=isNaN(d),c=!isNaN(f.max),a=!isNaN(f.min);b&&0!=e&&(d=0<e?a?f.min:c?f.max:0:c?this.constraints.max:a?f.min:0);var g=d+e;if(b||isNaN(g))return d;c&&g>
f.max&&(g=f.max);a&&g<f.min&&(g=f.min);return g},_onKeyDown:function(d){if(!this.disabled&&!this.readOnly&&(d.keyCode==e.HOME||d.keyCode==e.END)&&!d.ctrlKey&&(!d.altKey&&!d.metaKey)&&"undefined"!=typeof this.get("value")){var k=this.constraints[d.keyCode==e.HOME?"min":"max"];"number"==typeof k&&this._setValueAttr(k,!1);d.stopPropagation();d.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(l,e,f,h,d,k,n,b,c,a){return l("dijit.form._Spinner",b,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:0.9,smallDelta:1,largeDelta:10,templateString:c,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(a){return a},_arrowPressed:function(b,c,d){!this.disabled&&!this.readOnly&&(this._setValueAttr(this.adjust(this.get("value"),c*d),!1),a.selectInputText(this.textbox,this.textbox.value.length))},
_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(a,b,c){var d=this.smallDelta;b==this.textbox&&(b=c.keyCode,d=b==e.PAGE_UP||b==e.PAGE_DOWN?this.largeDelta:this.smallDelta,b=b==e.UP_ARROW||b==e.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==a?this._arrowReleased(b):this._arrowPressed(b,b==this.upArrowNode?1:-1,d)},_wheelTimer:null,_mouseWheeled:function(a){a.stopPropagation();a.preventDefault();var b=a.wheelDelta/120;Math.floor(b)!=b&&(b=0<a.wheelDelta?1:-1);a=a.detail?
-1*a.detail:b;if(0!==a){var c=this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(c,a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(c)},50)}},_setConstraintsAttr:function(a){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",
this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,b){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(k(this.domNode,d.wheel,f.hitch(this,"_mouseWheeled")),n.addListener(this.upArrowNode,this.textbox,{keyCode:e.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),n.addListener(this.downArrowNode,
this.textbox,{keyCode:e.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),n.addListener(this.upArrowNode,this.textbox,{keyCode:e.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),n.addListener(this.downArrowNode,this.textbox,{keyCode:e.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",
this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(l,e,f){return l("dijit.form.RangeBoundTextBox",f,{rangeMessage:"",rangeCheck:function(e,d){return("min"in d?0<=this.compare(e,d.min):!0)&&("max"in d?0>=this.compare(e,d.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var e=
this.get("value");if(null==e)return!1;var d=!1;"min"in this.constraints&&(d=this.constraints.min,d=0>this.compare(e,"number"==typeof d&&0<=d&&0!=e?0:d));!d&&"max"in this.constraints&&(d=this.constraints.max,d=0<this.compare(e,"number"!=typeof d||0<d?d:0));return d},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(e){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(e))},getErrorMessage:function(e){var d=
this.get("value");return null!=d&&""!==d&&("number"!=typeof d||!isNaN(d))&&!this.isInRange(e)?this.rangeMessage:this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=e.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(l,e,f,h){return l("dijit.form.MappedTextBox",
h,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(d){return d.toString?d.toString():""},toString:function(){var d=this.filter(this.get("value"));return null!=d?"string"==typeof d?d:this.serialize(d,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=f.place("\x3cinput type\x3d'hidden'"+(this.name&&
!e("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(l,e,f,h,d,k){var n=function(b){b=b||{};var a=f.getLocalization("dojo.cldr","number",f.normalizeLocale(b.locale)),d=b.pattern?b.pattern:a[(b.type||"decimal")+"Format"];b="number"==
typeof b.places?b.places:"string"===typeof b.places&&0<b.places.length?b.places.replace(/.*,/,""):-1!=d.indexOf(".")?d.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:a.decimal,places:b}},b=l("dijit.form.NumberTextBoxMixin",null,{pattern:function(b){return"("+(this.focused&&this.editOptions?this._regExpGenerator(e.delegate(b,this.editOptions))+"|":"")+this._regExpGenerator(b)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:d.format,_regExpGenerator:d.regexp,_decimalInfo:n(),postMixInProperties:function(){this.inherited(arguments);
this._set("type","text")},_setConstraintsAttr:function(b){var a="number"==typeof b.places?b.places:0;a&&a++;"number"!=typeof b.max&&(b.max=9*Math.pow(10,15-a));"number"!=typeof b.min&&(b.min=-9*Math.pow(10,15-a));this.inherited(arguments,[b]);this.focusNode&&(this.focusNode.value&&!isNaN(this.value))&&this.set("value",this.value);this._decimalInfo=n(b)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var b=this.get("value");"number"==typeof b&&!isNaN(b)&&(b=this.format(b,this.constraints),
void 0!==b&&(this.textbox.value=b));this.inherited(arguments)}},format:function(b,a){var d=String(b);if("number"!=typeof b)return d;if(isNaN(b))return"";if(!("rangeCheck"in this&&this.rangeCheck(b,a))&&!1!==a.exponent&&/\de[-+]?\d/i.test(d))return d;this.editOptions&&this.focused&&(a=e.mixin({},a,this.editOptions));return this._formatter(b,a)},_parser:d.parse,parse:function(b,a){var d=this._parser(b,e.mixin({},a,this.editOptions&&this.focused?this.editOptions:{}));this.editOptions&&(this.focused&&
isNaN(d))&&(d=this._parser(b,a));return d},_getDisplayedValueAttr:function(){var b=this.inherited(arguments);return isNaN(b)?this.textbox.value:b},filter:function(b){if(null==b||"string"==typeof b&&""==b)return NaN;"number"==typeof b&&(!isNaN(b)&&0!=b)&&(b=d.round(b,this._decimalInfo.places));return this.inherited(arguments,[b])},serialize:function(b,a){return"number"!=typeof b||isNaN(b)?"":this.inherited(arguments)},_setBlurValue:function(){var b=e.hitch(e.delegate(this,{focused:!0}),"get")("value");
this._setValueAttr(b,!0)},_setValueAttr:function(b,a,d){if(void 0!==b&&void 0===d)if(d=String(b),"number"==typeof b)if(isNaN(b))d="";else{if("rangeCheck"in this&&this.rangeCheck(b,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(d))d=void 0}else b?b=void 0:(d="",b=NaN);this.inherited(arguments,[b,a,d])},_getValueAttr:function(){var b=this.inherited(arguments);if(isNaN(b)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&RegExp("^"+
d._realNumberRegexp(e.delegate(this.constraints))+"$").test(this.textbox.value))return b=Number(this.textbox.value),isNaN(b)?void 0:b}else return b},isValid:function(b){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var a=this.get("value");return!isNaN(a)&&this.rangeCheck(a,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var b="number"==typeof this.constraints.min,
a="number"==typeof this.constraints.max,d=this.get("value");if(isNaN(d)||!b&&!a)return this.inherited(arguments);var e=d|0,k=0>d,f=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),n=(this.maxLength||20)-this.textbox.value.length,q=f?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",e=f?e+"."+q:e+"",n=h.rep("9",n),f=d;k?f=Number(e+n):d=Number(e+n);return!(b&&d<this.constraints.min||a&&f>this.constraints.max)}});l=l("dijit.form.NumberTextBox",[k,b],{baseClass:"dijitTextBox dijitNumberTextBox"});
l.Mixin=b;return l})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup dojox/widget/ColorPicker".split(" "),function(l,e,f,h,d,k,n,b,c,a){return l([e,f],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,postCreate:function(){this.inherited(arguments);
this.color?this.color instanceof n||(this.color=new n(this.color)):this.color=new n("#ccc");d.setStyle(this.domNode,"backgroundColor",this.color.toHex());this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){c.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(a){var b=this.tooltipDialog.domNode;return a===b||d.isDescendant(a,b)},_showTooltipDialog:function(){c.open({parent:this.getParent(),
popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=!0},_hideTooltipDialog:function(){c.close(this.tooltipDialog);this._isTooltipDialogOpened=!1},_createTooltipDialog:function(){var c=d.create("div");this.tooltipDialog=new b({style:"width: 350px;",content:c});var e=new a({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:h.hitch(this,function(a){a=new n(a);this.setColor(a)})});e.placeAt(c);e.startup();this.own(k(this.domNode,"click",
h.hitch(this,function(a){a.stopPropagation();a.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(k(document.body,"click",h.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=e},setColor:function(a){if(a instanceof n){var b=this.color,c="";b&&(c=b.toHex());b=a.toHex();this.color=a;d.setStyle(this.domNode,"backgroundColor",b);if(c!==b)this.onChange(new n(b))}},getColor:function(){return this.color},
onChange:function(a){}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),function(l,
e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w,v,x,B,D){l.experimental("dojox.widget.ColorPicker");return e("dojox.widget.ColorPicker",t,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:D,postMixInProperties:function(){g.contains(b.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=r.getUniqueId(this.id);f.mixin(this,v.getLocalization("dojox.widget","ColorPicker"));f.mixin(this,v.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>n("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new s.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new s.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(k.subscribe("/dnd/move/stop",f.hitch(this,"_clearTimer"))),this._subs.push(k.subscribe("/dnd/move/start",
f.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(u.addKeyListener(this.hueCursorNode,{charOrCode:m.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(u.addKeyListener(this.hueCursorNode,{charOrCode:m.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:m.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:m.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:m.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:m.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(a,b){this._started&&this.setColor(a,b)},setColor:function(a,b){a=w.fromString(a);this._updatePickerLocations(a);this._updateColorInputs(a);this._updateValue(a,b)},_setTimer:function(b){b.node!=this.cursorNode&&b.node!=this.hueCursorNode||(q.focus(b.node),a.setSelectable(this.domNode,!1),this._timer=setInterval(f.hitch(this,"_updateColor"),45))},_clearTimer:function(b){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),a.setSelectable(this.domNode,!0))},_setHue:function(a){d.style(this.colorUnderlay,"backgroundColor",w.fromHsv(a,100,100).toHex())},_updateHueCursorNode:function(a,b,c){if(-1!==a){a=d.style(this.hueCursorNode,"top");b=this.PICKER_HUE_SELECTOR_H/2;a+=b;var g=!1;c.charOrCode==m.UP_ARROW?0<a&&(a-=1,g=!0):c.charOrCode==m.DOWN_ARROW&&a<this.PICKER_HUE_H&&(a+=1,g=!0);g&&d.style(this.hueCursorNode,"top",a-b+"px")}else this._updateColor(!0)},_updateCursorNode:function(a,
b,c){b=this.PICKER_SAT_SELECTOR_H/2;var g=this.PICKER_SAT_SELECTOR_W/2;if(-1!==a){a=d.style(this.cursorNode,"top");var e=d.style(this.cursorNode,"left");a+=b;var e=e+g,k=!1;c.charOrCode==m.UP_ARROW?0<a&&(a-=1,k=!0):c.charOrCode==m.DOWN_ARROW?a<this.PICKER_SAT_VAL_H&&(a+=1,k=!0):c.charOrCode==m.LEFT_ARROW?0<e&&(e-=1,k=!0):c.charOrCode==m.RIGHT_ARROW&&e<this.PICKER_SAT_VAL_W&&(e+=1,k=!0);k&&(e-=g,d.style(this.cursorNode,"top",a-b+"px"),d.style(this.cursorNode,"left",e+"px"))}else this._updateColor(!0)},
_updateColor:function(a){var b=this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,g=this.PICKER_SAT_SELECTOR_W/2,b=d.style(this.hueCursorNode,"top")+b,c=d.style(this.cursorNode,"top")+c,g=d.style(this.cursorNode,"left")+g,b=Math.round(360-360*(b/this.PICKER_HUE_H)),g=w.fromHsv(b,100*(g/this.PICKER_SAT_VAL_W),100-100*(c/this.PICKER_SAT_VAL_H));this._updateColorInputs(g);this._updateValue(g,a);b!=this._hue&&this._setHue(b)},_colorInputChange:function(a){var b,c=!1;switch(a.target){case this.hexCode:b=
w.fromString(a.target.value);c=!0;break;case this.Rval:case this.Gval:case this.Bval:b=w.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);c=!0;break;case this.Hval:case this.Sval:case this.Vval:b=w.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),c=!0}c&&(this._updatePickerLocations(b),this._updateColorInputs(b),this._updateValue(b,!0))},_updateValue:function(a,b){var c=a.toHex();this.value=this.valueNode.value=c;if(b&&(!this._timer||this.liveUpdate))this.onChange(c)},_updatePickerLocations:function(a){var b=
this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,g=this.PICKER_SAT_SELECTOR_W/2;a=a.toHsv();b=Math.round(this.PICKER_HUE_H-a.h/360*this.PICKER_HUE_H)-b;g=Math.round(a.s/100*this.PICKER_SAT_VAL_W)-g;c=Math.round(this.PICKER_SAT_VAL_H-a.v/100*this.PICKER_SAT_VAL_H)-c;this.animatePoint?(p.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:b,left:0}).play(),p.slideTo({node:this.cursorNode,duration:this.slideDuration,top:c,left:g}).play()):(d.style(this.hueCursorNode,"top",b+"px"),
d.style(this.cursorNode,{left:g+"px",top:c+"px"}));a.h!=this._hue&&this._setHue(a.h)},_updateColorInputs:function(a){var b=a.toHex();this.showRgb&&(this.Rval.value=a.r,this.Gval.value=a.g,this.Bval.value=a.b);this.showHsv&&(a=a.toHsv(),this.Hval.value=Math.round(a.h),this.Sval.value=Math.round(a.s),this.Vval.value=Math.round(a.v));this.showHex&&(this.hexCode.value=b);this.previewNode.style.backgroundColor=b;this.webSafe&&(this.safePreviewNode.style.backgroundColor=b)},_setHuePoint:function(a){a=a.layerY-
this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?p.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:a,left:0,onEnd:f.hitch(this,function(){this._updateColor(!1);q.focus(this.hueCursorNode)})}).play():(d.style(this.hueCursorNode,"top",a+"px"),this._updateColor(!1))},_setPoint:function(a){var b=a.layerY-this.PICKER_SAT_SELECTOR_H/2,c=a.layerX-this.PICKER_SAT_SELECTOR_W/2;a&&q.focus(a.target);this.animatePoint?p.slideTo({node:this.cursorNode,duration:this.slideDuration,top:b,left:c,onEnd:f.hitch(this,
function(){this._updateColor(!0);q.focus(this.cursorNode)})}).play():(d.style(this.cursorNode,{left:c+"px",top:b+"px"}),this._updateColor(!1))},_handleKey:function(a){},focus:function(){this.focused||q.focus(this.focusNode)},_stopDrag:function(a){c.stop(a)},destroy:function(){this.inherited(arguments);h.forEach(this._subs,function(a){k.unsubscribe(a)});delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(l){return l})},"dojox/color/_base":function(){define(["../main",
"dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(l,e,f,h){l=e.getObject("color",!0,l);l.Color=f;l.blend=f.blendColors;l.fromRgb=f.fromRgb;l.fromHex=f.fromHex;l.fromArray=f.fromArray;l.fromString=f.fromString;l.greyscale=h.makeGrey;e.mixin(l,{fromCmy:function(d,k,n){e.isArray(d)?(k=d[1],n=d[2],d=d[0]):e.isObject(d)&&(k=d.m,n=d.y,d=d.c);k=1-k/100;n=1-n/100;return new f({r:Math.round(255*(1-d/100)),g:Math.round(255*k),b:Math.round(255*n)})},fromCmyk:function(d,k,n,b){e.isArray(d)?(k=d[1],
n=d[2],b=d[3],d=d[0]):e.isObject(d)&&(k=d.m,n=d.y,b=d.b,d=d.c);k/=100;n/=100;b/=100;d=1-Math.min(1,d/100*(1-b)+b);k=1-Math.min(1,k*(1-b)+b);n=1-Math.min(1,n*(1-b)+b);return new f({r:Math.round(255*d),g:Math.round(255*k),b:Math.round(255*n)})},fromHsl:function(d,k,n){e.isArray(d)?(k=d[1],n=d[2],d=d[0]):e.isObject(d)&&(k=d.s,n=d.l,d=d.h);k/=100;for(n/=100;0>d;)d+=360;for(;360<=d;)d-=360;var b,c;120>d?(b=(120-d)/60,c=d/60,d=0):240>d?(b=0,c=(240-d)/60,d=(d-120)/60):(b=(d-240)/60,c=0,d=(360-d)/60);b=2*
k*Math.min(b,1)+(1-k);c=2*k*Math.min(c,1)+(1-k);d=2*k*Math.min(d,1)+(1-k);0.5>n?(b*=n,c*=n,d*=n):(b=(1-n)*b+2*n-1,c=(1-n)*c+2*n-1,d=(1-n)*d+2*n-1);return new f({r:Math.round(255*b),g:Math.round(255*c),b:Math.round(255*d)})}});l.fromHsv=function(d,k,n){e.isArray(d)?(k=d[1],n=d[2],d=d[0]):e.isObject(d)&&(k=d.s,n=d.v,d=d.h);360==d&&(d=0);k/=100;n/=100;var b,c,a;if(0==k)c=a=b=n;else{var g=d/60;d=Math.floor(g);var m=g-d,g=n*(1-k),p=n*(1-k*m);k=n*(1-k*(1-m));switch(d){case 0:b=n;c=k;a=g;break;case 1:b=
p;c=n;a=g;break;case 2:b=g;c=n;a=k;break;case 3:b=g;c=p;a=n;break;case 4:b=k;c=g;a=n;break;case 5:b=n,c=g,a=p}}return new f({r:Math.round(255*b),g:Math.round(255*c),b:Math.round(255*a)})};e.extend(f,{toCmy:function(){var d=1-this.g/255,e=1-this.b/255;return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*d),y:Math.round(100*e)}},toCmyk:function(){var d,e,f,b=this.r/255;d=this.g/255;e=this.b/255;f=Math.min(1-b,1-d,1-e);d=(1-d-f)/(1-f);e=(1-e-f)/(1-f);return{c:Math.round(100*((1-b-f)/(1-f))),m:Math.round(100*
d),y:Math.round(100*e),b:Math.round(100*f)}},toHsl:function(){var d=this.r/255,e=this.g/255,f=this.b/255,b=Math.min(d,f,e),c=Math.max(d,e,f),a=c-b,g=0,m=0,b=(b+c)/2;0<b&&1>b&&(m=a/(0.5>b?2*b:2-2*b));0<a&&(c==d&&c!=e&&(g+=(e-f)/a),c==e&&c!=f&&(g+=2+(f-d)/a),c==f&&c!=d&&(g+=4+(d-e)/a),g*=60);return{h:g,s:Math.round(100*m),l:Math.round(100*b)}},toHsv:function(){var d=this.r/255,e=this.g/255,f=this.b/255,b=Math.min(d,f,e),c=Math.max(d,e,f),b=c-b,a=null,g=0==c?0:b/c;0==g?a=0:(a=d==c?60*(e-f)/b:e==c?120+
60*(f-d)/b:240+60*(d-e)/b,0>a&&(a+=360));return{h:a,s:Math.round(100*g),v:Math.round(100*c)}}});return l})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(l,e,f,h){var d={};e.setObject("dojo.colors",d);var k=function(b,c,a){0>a&&++a;1<a&&--a;var d=6*a;return 1>d?b+(c-b)*d:1>2*a?c:2>3*a?b+6*(c-b)*(2/3-a):b};l.colorFromRgb=f.fromRgb=function(b,c){var a=b.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(a){var d=a[2].split(/\s*,\s*/),
e=d.length,a=a[1];if("rgb"==a&&3==e||"rgba"==a&&4==e)return a=d[0],"%"==a.charAt(a.length-1)?(a=h.map(d,function(a){return 2.56*parseFloat(a)}),4==e&&(a[3]=d[3]),f.fromArray(a,c)):f.fromArray(d,c);if("hsl"==a&&3==e||"hsla"==a&&4==e){var a=(parseFloat(d[0])%360+360)%360/360,n=parseFloat(d[1])/100,s=parseFloat(d[2])/100,n=0.5>=s?s*(n+1):s+n-s*n,s=2*s-n,a=[256*k(s,n,a+1/3),256*k(s,n,a),256*k(s,n,a-1/3),1];4==e&&(a[3]=d[3]);return f.fromArray(a,c)}}return null};var n=function(b,c,a){b=Number(b);return isNaN(b)?
a:b<c?c:b>a?a:b};f.prototype.sanitize=function(){this.r=Math.round(n(this.r,0,255));this.g=Math.round(n(this.g,0,255));this.b=Math.round(n(this.b,0,255));this.a=n(this.a,0,1);return this};d.makeGrey=f.makeGrey=function(b,c){return f.fromArray([b,b,b,c])};e.mixin(f.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],
cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],
darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,
92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,
153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,
245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,
82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return f})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m){return l([e,f,h,d],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:k,nls:null,alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency},postCreate:function(){this.inherited(arguments);"number"===typeof this.alpha&&this.setAlpha(this.alpha)},setAlpha:function(a){a=Math.round(100-100*a);this.opacitySlider.set("value",a)},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var a=
this.getAlpha();this.emit("change",a)}})})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w,v,x){var B=e("dijit.form._SliderMover",
g,{onMouseMove:function(a){var c=this.widget,g=c._abspos;g||(g=c._abspos=d.position(c.sliderBarContainer,!0),c._setPixelValue_=b.hitch(c,"_setPixelValue"),c._isReversed_=c._isReversed());a=a[c._mousePixelCoord]-g[c._startingPixelCoord];c._setPixelValue_(c._isReversed_?g[c._pixelCount]-a:a,g[c._pixelCount],!1)},destroy:function(a){g.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,!0)}});f=e("dijit.form.HorizontalSlider",[w,v],{templateString:x,value:0,
showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:r.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",_onKeyUp:function(a){!this.disabled&&(!this.readOnly&&!a.altKey&&
!a.ctrlKey&&!a.metaKey)&&this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!this.disabled&&!this.readOnly&&!a.altKey&&!a.ctrlKey&&!a.metaKey){switch(a.keyCode){case n.HOME:this._setValueAttr(this.minimum,!1);break;case n.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?n.RIGHT_ARROW:n.LEFT_ARROW:case !1===this._descending?n.DOWN_ARROW:n.UP_ARROW:case !1===this._descending?n.PAGE_DOWN:n.PAGE_UP:this.increment(a);break;case this._descending||this.isLeftToRight()?
n.LEFT_ARROW:n.RIGHT_ARROW:case !1===this._descending?n.UP_ARROW:n.DOWN_ARROW:case !1===this._descending?n.PAGE_UP:n.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){!this.disabled&&!this.readOnly&&(c("ie")||q.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&this.clickSelect){q.focus(this.sliderHandle);a.stopPropagation();
a.preventDefault();var b=d.position(this.sliderBarContainer,!0),c=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-c:c,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;a=Math.round(a/(b/d));this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*a/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,
b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,d=!1===this._descending?this.remainingBar:this.progressBar,g=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&d.style[this._progressPixelSize]){var e=this,m={},k=parseFloat(d.style[this._progressPixelSize]),
f=this.slideDuration*(c-k/100);0!=f&&(0>f&&(f=0-f),m[this._progressPixelSize]={start:k,end:100*c,units:"%"},this._inProgressAnim=h.animateProperty({node:d,duration:f,onAnimate:function(a){g.style[e._progressPixelSize]=100-parseFloat(a[e._progressPixelSize])+"%"},onEnd:function(){delete e._inProgressAnim},properties:m}),this._inProgressAnim.play())}else d.style[this._progressPixelSize]=100*c+"%",g.style[this._progressPixelSize]=100*(1-c)+"%"},_bumpValue:function(a,b){if(!this.disabled&&!(this.readOnly||
this.maximum<=this.minimum)){var c=k.getComputedStyle(this.sliderBarContainer),g=d.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=g[this._pixelCount];c--;g=(this.value-this.minimum)*c/(this.maximum-this.minimum)+a;0>g&&(g=0);g>c&&(g=c);g=g*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(g,b)}},_onClkBumper:function(a){!this.disabled&&(!this.readOnly&&this.clickSelect)&&this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===
this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==n.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==n.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){a.stopPropagation();a.preventDefault();this._bumpValue(0>a.wheelDelta?-1:1,!0)},startup:function(){this._started||(l.forEach(this.getChildren(),function(a){this[a.container]!=
this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display="");var a=m('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+
"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(t.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),t.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(s(this.domNode,p.wheel,b.hitch(this,"_mouseWheeled")));var c=e(B,{widget:this});this._movable=
new a(this.sliderHandle,{mover:c});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});f._Mover=B;return f})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(l,e,f,h,d,k){l=l("dijit.form.HorizontalRuleLabels",k,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',
labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(d){return d},_genHTML:function(d,b){var c=this.labels[b];return this._positionPrefix+this._calcPosition(d)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(c)+this._labelPrefix+
c+this._suffix},_genDirectionHTML:function(d){return""},getLabels:function(){var d=this.labels;!d.length&&this.srcNodeRef&&(d=h("\x3e li",this.srcNodeRef).map(function(a){return String(a.innerHTML)}));if(!d.length&&1<this.count)for(var b=this.minimum,c=(this.maximum-b)/(this.count-1),a=0;a<this.count;a++)d.push(a<this.numericMargin||a>=this.count-this.numericMargin?"":f.format(b,this.constraints)),b+=c;return d},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();
this.count=this.labels.length}});e("dojo-bidi")&&l.extend({_setTextDirAttr:function(e){this.textDir!=e&&(this._set("textDir",e),h(".dijitRuleLabelContainer",this.domNode).forEach(d.hitch(this,function(b){b.style.direction=this.getTextDir(b.innerText||b.textContent||"")})))},_genDirectionHTML:function(d){return this.textDir?"direction:"+this.getTextDir(d)+";":""}});return l})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(l,e,f){return l("dijit.form.HorizontalRule",
[e,f],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(e){return this._positionPrefix+e+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var e;if(1==this.count)e=this._genHTML(50,0);else{var d,
k=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){e=this._genHTML(0,0);for(d=1;d<this.count-1;d++)e+=this._genHTML(k*d,d);e+=this._genHTML(100,this.count-1)}else{e=this._genHTML(100,0);for(d=1;d<this.count-1;d++)e+=this._genHTML(100-k*d,d);e+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=e}})})},"jimu/dijit/Search":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/string","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(l,e,f,h,d){return l([h,d],{baseClass:"jimu-search",
declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',placeholder:"",
onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&e.setAttr(this.inputSearch,"placeholder",this.placeholder)},doSearch:function(){if(this.onSearch)this.onSearch(f.trim(this.inputSearch.value))},_onKeyDown:function(d){13===(void 0!==d.keyCode?d.keyCode:d.which)&&this.doSearch();d.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()}})})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),
function(l,e,f,h,d,k,n,b){return l([b],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,postCreate:function(){this.inherited(arguments);this._validatingNode=e.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=e.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=e.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},this.domNode);
e.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(h(this,"Change",f.hitch(this,"_onServiceUrlChange")))},setProcessFunction:function(b,a){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof b&&(this._fetchHandle=k.after(this,"onFetch",b),this.own(this._fetchHandle));"function"===typeof a&&(this._fetchErrHandle=k.after(this,"onFetchError",a),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&this._fetchHandle.remove&&
(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),this._fetchErrHandle=null)},onFetch:function(b){return b},onFetchError:function(b){},_onServiceUrlChange:function(b){var a=new d;a.then(f.hitch(this,function(){this._valid()}),f.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();n({url:f.trim(b||""),handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(f.hitch(this,function(b){this.onFetch({url:this.getValue(),
data:b})?a.resolve("success"):a.reject("error")}),f.hitch(this,function(b){a.reject(b)}))},_hideStatus:function(){e.setStyle(this._validNode,{display:"none"});e.setStyle(this._inValidNode,{display:"none"});e.setStyle(this._validatingNode,{display:"none"})},_validating:function(){e.setStyle(this._validNode,{display:"none"});e.setStyle(this._inValidNode,{display:"none"});e.setStyle(this._validatingNode,{display:"inline-block"});e.removeClass(this.domNode,"jimu-serviceurl-input-invalid")},_valid:function(){e.setStyle(this._validNode,
{display:"inline-block"});e.setStyle(this._inValidNode,{display:"none"});e.setStyle(this._validatingNode,{display:"none"});e.removeClass(this.domNode,"jimu-serviceurl-input-invalid")},_inValid:function(){e.setStyle(this._validNode,{display:"none"});e.setStyle(this._inValidNode,{display:"inline-block"});e.setStyle(this._validatingNode,{display:"none"});e.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query jimu/utils".split(" "),
function(l,e,f,h,d,k,n,b,c,a){return l([e,f,h],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"tableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;"\x3e\x3ccolgroup\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"\x3e\x3c/thead\x3e\x3ctbody class\x3d"simple-table-tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",autoHeight:!0,selectable:!1,fields:null,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);this._initSelf()},
startup:function(){this.inherited(arguments);this._updateUI()},_initSelf:function(){this._initAttachPoints();this.own(a.bindClickAndDblclickEvents(this.table,d.hitch(this,function(b){if(b=a.getAncestorDom(b.target||b.srcElement,function(a){return k.hasClass(a,"simple-table-row")&&k.hasClass(a,"not-empty")},this.tbody))this.selectRow(b),this._onClickRow(b)}),d.hitch(this,function(b){if(b=a.getAncestorDom(b.target||b.srcElement,function(a){return k.hasClass(a,"simple-table-row")&&k.hasClass(a,"not-empty")},
this.tbody))this.selectRow(b),this._onDblClickRow(b)})));var b=Math.random().toString();this._name="jimu_table_"+b.slice(2,b.length);this.thead=c("thead",this.domNode)[0];this.tbody=c("tbody",this.domNode)[0];if(this.fields&&0<this.fields.length){var e=k.create("tr",{},this.thead);n.forEach(this.fields,d.hitch(this,function(a){var b="auto";"actions"===a.type&&(a.name="actions");a.hidden?b=1:void 0!==a.width&&null!==a.width?b=a.width:"actions"===a.type&&!a.name&&(a.width=this._calculateActionsWidth(a)+
20,b=a.width);k.create("col",{width:b},this.colgroup);b=k.create("th",{innerHTML:a.title,title:a.title},e);k.addClass(b,"simple-table-field");a.hidden&&k.addClass(b,"hidden-column");a["class"]&&k.addClass(b,a["class"]);k.addClass(b,a.name)}));k.empty(this.headDiv);b=d.clone(this.tableDiv);k.place(b,this.headDiv)}else this.fields=null},_initAttachPoints:function(){this.table=c("table",this.bodyDiv)[0];this.colgroup=c("colgroup",this.bodyDiv)[0];this.head=c("thead",this.bodyDiv)[0];this.tbody=c("tbody",
this.bodyDiv)[0]},clear:function(){var a=this._getNotEmptyRows();k.empty(this.tbody);n.forEach(a,d.hitch(this,function(a){this._onDeleteRow(a)}));this._updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var b=[];this.fields&&(a&&0<a.length)&&n.forEach(a,d.hitch(this,function(a){b.push(this.addRow(a,!0))}));this._updateUI();return b},addRow:function(a,b){this._rowIndex++;var c={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof a)return c;
var e=n.filter(this.fields,d.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),e=n.filter(e,d.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,a[b.name]).length}));if(0<e.length)return c.errorCode=this.REPEATING_ERROR,c.errorMessage="repeating data",c.repeatFields=e,c;var f=k.create("tr",{"class":"simple-table-row not-empty"},this.tbody);k.setAttr(f,"rowId","row"+this._rowIndex);n.forEach(this.fields,d.hitch(this,function(b){var c=a[b.name],d=b.type,e=null;"actions"===
d?this._createActionsTd(f,b):("text"===d?e=this._createTextTd(f,b,c):"radio"===d?e=this._createRadioTd(f,b,c):"checkbox"===d?e=this._createCheckboxTd(f,b,c):"empty"===d?e=this._createEmptyTd(f,b):"extension"===d&&(e=this._createExtensionTd(f,b,c)),b.hidden&&k.addClass(e,"hidden-column"))}));b||this._updateUI();c.success=!0;c.tr=f;c.errorMessage=null;this._onAddRow(f);return c},deleteRow:function(a){a&&(k.destroy(a),this._updateUI(),this._onDeleteRow(a))},selectRow:function(a){this.selectable&&(c(".simple-table-row",
this.tbody).removeClass("jimu-state-active"),k.addClass(a,"jimu-state-active"),this._onSelectRow(a))},_updateUI:function(){this._updateRowClassName();this._updateHeight()},_updateHeight:function(){if(this.autoHeight){var a=this.getRows();k.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*(0<a.length?a.length:1)+1+"px")}},_updateRowClassName:function(){var a=c("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&(a=c("."+this._classRowUpDiv,a)[0])&&k.removeClass(a,this._classJimuStateDisabled);
if(a=c("."+this._classLastSimpleTableRow,this.tbody)[0])(a=c("."+this._classRowDownDiv,a)[0])&&k.removeClass(a,this._classJimuStateDisabled);a=c("."+this._classSimpleTableRow,this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);n.forEach(a,d.hitch(this,function(a,b){0===b%2?k.addClass(a,"odd"):k.addClass(a,"even")}));if(0<a.length){var b=a[0];k.addClass(b,this._classFirstSimpleTableRow);(b=c("."+this._classRowUpDiv,
b)[0])&&k.addClass(b,this._classJimuStateDisabled);a=a[a.length-1];k.addClass(a,this._classLastSimpleTableRow);(a=c("."+this._classRowDownDiv,a)[0])&&k.addClass(a,this._classJimuStateDisabled)}},_createTextTd:function(a,b,c){var d=null;return d=b.editable?this._createEditableTextTd(a,b,c):this._createNormalTextTd(a,b,c)},_createNormalTextTd:function(a,b,d){var e=k.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');k.addClass(e,
b.name);var f=c("div",e)[0];f.innerHTML=d||"";f.title=d||"";b["class"]&&k.addClass(e,b["class"]);k.place(e,a);return e},_createEditableTextTd:function(a,e,f){var n=k.toDom('\x3ctd class\x3d"editable-text-td '+e.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');k.addClass(n,"simple-table-cell");k.place(n,a);e["class"]&&k.addClass(n,e["class"]);var h=c("div",n)[0],q=c("input",n)[0];h.innerHTML=f||
"";""!==h.innerHTML&&(h.title=h.innerHTML);q.value=h.innerHTML;this.own(b(h,"dblclick",d.hitch(this,function(a){a.stopPropagation();q.value=h.innerHTML;k.setStyle(h,"display","none");k.setStyle(q,"display","inline");q.focus()})));this.own(b(q,"blur",d.hitch(this,function(){q.value=d.trim(q.value);var b=h.innerHTML,c=q.value;""!==c?e.unique?0<this.getRowDataArrayByFieldValue(e.name,c,a).length?q.value=b:h.innerHTML=c:h.innerHTML=c:q.value=b;k.setStyle(q,"display","none");k.setStyle(h,"display","block")})));
return n},_createRadioTd:function(a,b,d){var e=k.toDom('\x3ctd class\x3d"radio-td '+b.name+'"\x3e\x3cinput type\x3d"radio" /\x3e\x3c/td\x3e');k.addClass(e,"simple-table-cell");k.place(e,a);b["class"]&&k.addClass(e,b["class"]);a=c("input",e)[0];a.name=b.radio&&"row"===b.radio?this._name+this._rowIndex:this._name+b.name;a.checked=!0===d;return e},_createCheckboxTd:function(a,b,d){var e=k.toDom('\x3ctd class\x3d"checkbox-td '+b.name+'"\x3e\x3cinput type\x3d"checkbox" /\x3e\x3c/td\x3e');k.addClass(e,
"simple-table-cell");k.place(e,a);b["class"]&&k.addClass(e,b["class"]);c("input",e)[0].checked=!0===d;return e},_createActionsTd:function(a,e){var f=k.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');k.addClass(f,"simple-table-cell");var h=c(".action-item-parent",f)[0];k.place(f,a);e["class"]&&k.addClass(f,e["class"]);n.forEach(e.actions,d.hitch(this,function(e){"up"===e?(e=k.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},
h),e.title=this.nls.moveUp,this.own(b(e,"click",d.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowUp(a)){b=c(".simple-table-row",this.tbody);var d=n.indexOf(b,a);if(0<d&&(b=b[d-1]))k.place(a,b,"before"),this._updateUI(),this.emit("row-up",a)}})))):"down"===e?(e=k.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},h),e.title=this.nls.moveDown,this.own(b(e,"click",d.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowDown(a)){b=c(".simple-table-row",
this.tbody);var d=n.indexOf(b,a);if(d<b.length-1&&(b=b[d+1]))k.place(a,b,"after"),this._updateUI(),this.emit("row-down",a)}})))):"edit"===e?(e=k.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},h),e.title=this.nls.edit,this.own(b(e,"click",d.hitch(this,function(b){b.stopPropagation();this.onBeforeRowEdit(a)&&this._onActionsEdit(a)})))):"delete"===e&&(e=k.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},h),
e.title=this.nls.deleteRow,this.own(b(e,"click",d.hitch(this,function(b){b.stopPropagation();this.onBeforeRowDelete(a)&&this.deleteRow(a)}))))}));var l=this._calculateActionsWidth(e)+"px";k.setStyle(h,"width",l);return f},_calculateActionsWidth:function(a){return 20*n.map(a.actions,function(a){return"up"===a||"down"===a||"edit"===a||"delete"===a}).length},_createEmptyTd:function(a,b){var c=k.create("td",{"class":b.name},a);k.addClass(c,"simple-table-cell");k.addClass(c,"empty-text-td");b["class"]&&
k.addClass(c,b["class"]);return c},_createExtensionTd:function(a,b,c){a=k.create("td",{"class":b.name},a);k.addClass(a,"simple-table-cell");k.addClass(a,"extension-td");b["class"]&&k.addClass(a,b["class"]);b.create&&"function"===typeof b.create&&b.create(a);b.setValue&&"function"===typeof b.setValue&&b.setValue(a,c);return a},editRow:function(a,b){var e={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof b||!k.isDescendant(a,this.tbody))return e;
var f=d.mixin([],this.fields),f=n.filter(f,d.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),f=n.filter(f,d.hitch(this,function(c){return 0<this.getRowDataArrayByFieldValue(c.name,b[c.name],a).length}));if(0<f.length)return e.errorCode=this.REPEATING_ERROR,e.errorMessage="repeating data",e.repeatFields=f,e;var h=c(".simple-table-cell",a);n.forEach(this.fields,d.hitch(this,function(a,c){if(b.hasOwnProperty(a.name)){var d=h[c],e=b[a.name],g=a.type;"text"===g?a.editable?this._editEditableText(d,
a,e):this._editNormalText(d,a,e):"radio"===g?this._editRadio(d,a,e):"checkbox"===g?this._editCheckbox(d,a,e):"extension"===g&&this._editExtension(d,a,e)}}));e.success=!0;e.tr=a;e.errorMessage=null;this._onEditRow(a);return e},_editNormalText:function(a,b,d){a=c("div",a)[0];a.innerHTML=d||"";a.title=a.innerHTML},_editEditableText:function(a,b,d){b=c("div",a)[0];b.innerHTML=d||"";c("input",a)[0].value=b.innerHTML},_editRadio:function(a,b,d){c("input",a)[0].checked=!0===d},_editCheckbox:function(a,b,
d){c("input",a)[0].checked=!0===d},_editExtension:function(a,b,c){b.setValue&&"function"===typeof b.setValue&&b.setValue(a,c)},_getAllRows:function(){return c(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var a=this._getAllRows();return n.filter(a,d.hitch(this,function(a){return!k.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return n.filter(a,d.hitch(this,function(a){return k.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=
null,b=c(".simple-table-row",this.tbody),b=n.filter(b,d.hitch(this,function(a){return!k.hasClass(a,"empty")&&k.hasClass(a,"jimu-state-active")}));0<b.length&&(a=b[0]);return a},getSelectedRowData:function(){var a=null,b=this.getSelectedRow();b&&(a=this._getRowDataByTr(b));return a},getData:function(a){var b=this._getNotEmptyRows();a&&(b=n.filter(b,d.hitch(this,function(b){return b!==a})));return n.map(b,d.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},
_getRowDataByTr:function(a){var b=null;if(a)b={};else return null;n.forEach(this.fields,d.hitch(this,function(d){var e=d.type;if("actions"!==e){var f=d.name;b[f]=null;var k=c("."+f,a)[0];k&&("text"===e?(d=c("div",k)[0],b[f]=d.innerHTML):"radio"===e?(d=c("input",k)[0],b[f]=d.checked):"checkbox"===e?(d=c("input",k)[0],b[f]=d.checked):"extension"===e&&d.getValue&&"function"===typeof d.getValue&&(b[f]=d.getValue(k,d)))}}));return b},getRowDataArrayByFieldValue:function(a,b,c){var e=[];if(!this.fields||
!n.some(this.fields,d.hitch(this,function(b){return b.name===a})))return[];c=this.getData(c);return e=n.filter(c,d.hitch(this,function(c){return c[a]==b}))},_onClickRow:function(a){this.emit("row-click",a)},_onDblClickRow:function(a){this.emit("row-dblclick",a)},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a){this.emit("row-delete",a)},_onEnterRow:function(a){this.emit("row-enter",
a)},_onClearRows:function(a){this.emit("rows-clear",a)},_onActionsEdit:function(a){this.emit("actions-edit",a)},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},onBeforeRowDelete:function(a){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(l,e,f,h,d,k,n,b,
c,a){return l([n,b,k],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new c(null,this.containerNode);var a=100*(1/this.tabs.length);this.isNested&&h.addClass(this.domNode,
"nested");f.forEach(this.tabs,function(b){this._createTab(b,a)},this)}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);a.setVerticalCenter(this.domNode)},_createTab:function(a,b){var c;c=h.create("div",{innerHTML:a.title,"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":b+"%"},label:a.title},this.controlNode);this.viewStack.viewType=a.content.domNode?"dijit":"dom";a.content.label=a.title;this.viewStack.addView(a.content);
this.own(d(c,"click",e.hitch(this,this.onSelect,a.title)));c.label=a.title;this.controlNodes.push(c)},onSelect:function(a){this.selectTab(a)},selectTab:function(a){this._selectControl(a);this.viewStack.switchView(a);this.emit("tabChanged",a)},_selectControl:function(a){f.forEach(this.controlNodes,function(b){h.removeClass(b,"jimu-state-selected");b.label===a&&h.addClass(b,"jimu-state-selected")})}})})},"jimu/dijit/ViewStack":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html",
"dojo/_base/array","dijit/_WidgetBase"],function(l,e,f,h,d){return l(d,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);h.forEach(this.views,e.hitch(this,function(d){1===d.nodeType?(f.place(d,this.domNode),f.addClass(d,"view"),f.setStyle(d,"display","none")):d.domNode&&(f.place(d.domNode,this.domNode),f.addClass(d.domNode,"view"),f.setStyle(d.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);
0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var d="",e=this.getSelectedView();e&&(d=e.label);return d},getViewByLabel:function(d){for(var e=0;e<this.views.length;e++)if(d===this.views[e].label)return this.views[e];return null},addView:function(d){this.views.push(d);1===d.nodeType?(f.place(d,this.domNode),f.addClass(d,"view")):d.domNode&&(f.place(d.domNode,this.domNode),f.addClass(d.domNode,"view"))},removeView:function(d){var e=
this.views.length;this.views=h.filter(this.views,function(b){return d!==b});e!==this.views.length&&(1===d.nodeType?f.destroy(d):d.domNode&&d.destroyRecursive())},switchView:function(d){var n,b;n="number"===typeof d?this.views[d]:"string"===typeof d?this.getViewByLabel(d):d;this.views.forEach(e.hitch(this,function(c){c&&(1===c.nodeType?b=c:c.domNode&&(b=c.domNode),c===n?(f.setStyle(b,"display","block"),c.domNode&&!c._started&&(c.startup(),c._started=!0)):f.setStyle(b,"display","none"))}));this._currentView=
n;this.onViewSwitch(n)},onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack".split(" "),function(l,e,f,h,d,k,n,b,c,a,g){return l([b,c,k],{templateString:a,selected:"",tabs:null,average:!1,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,postCreate:function(){this.inherited(arguments);
this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(a){var b=n("td",this.tabTr);f.forEach(b,e.hitch(this,function(b,c){h.removeClass(b,"jimu-state-active");b.label===a&&(h.addClass(b,"jimu-state-active"),this._currentIndex=c)}));this.controlNode.removeChild(this.controlTable);h.place(this.controlTable,this.controlNode);this.viewStack.switchView(a);this.emit("tabChanged",a)},addTab:function(a){if(!this.average){var b=
n("td:last-child",this.tabTr);0<b.length&&h.destroy(b[0])}0<f.filter(this.tabs,function(b){return b.title===a.title}).length?console.error("tab title conflict: "+a.title):(this.tabs.push(a),this._createTab(a),this.average||(b=h.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e'),h.place(b,this.tabTr)))},removeTab:function(a){var b=-1;if(f.some(this.tabs,function(c,d){if(c.title===a)return b=d,!0})){var c=
this.tabs.splice(b,1)[0],d=n("td",this.tabTr),e;f.some(d,function(b){if(b.label===a)return e=b,!0})&&h.destroy(e);this.viewStack.removeView(c.content)}},showShelter:function(){h.setStyle(this.shelter,"display","block")},hideShelter:function(){h.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},_initSelf:function(){this.viewStack=new g(null,this.containerNode);f.forEach(this.tabs,function(a){this._createTab(a)},
this);if(this.average)this.controlTable.style.tableLayout="fixed";else{var a=h.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');h.place(a,this.tabTr)}},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(a){var b=h.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');b.label=a.title||"";h.place(b,this.tabTr);var c=
n(".tab-item-div",b)[0];c.innerHTML=b.label;c.label=b.label;a.content.label=b.label;this.viewStack.addView(a.content);this.own(d(b,"click",e.hitch(this,this._onSelect,a.title)))},_onSelect:function(a){this.selectTab(a)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(l,e,f,h){return l([h],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",constructor:function(){this.items=[];
this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(e.hitch(this,function(d){this._placeItem(d)}));this.resize()},_placeItem:function(d){d.domNode?f.place(d.domNode,this.domNode):f.place(d,this.domNode)},addItem:function(d){this.items.push(d);this._placeItem(d);this.resize()},addItems:function(d){this.items=this.items.concat(d);this.items.forEach(e.hitch(this,function(d){this._placeItem(d)}));this.resize()},removeItem:function(d){var e;for(e=0;e<this.items.length;e++)if(this.items[e].label===
d){this.items[e].domNode?this.items[e].destroy():f.destroy(this.items[e]);this.items.splice(e,1);this.resize();break}},empty:function(){var d;for(d=0;d<this.items.length;d++)this.items[d].domNode?this.items[d].destroy():f.destroy(this.items[d]);this.items=[]},resize:function(){var d,k,n;d=f.getMarginBox(this.domNode);k=this.getItemSize(d);n=Math.floor((d.w+this.hmargin)/(k.width+this.hmargin));this.items.forEach(e.hitch(this,function(b,c){this.setItemPosition(b,c,k,n)}))},getItemSize:function(d){var e=
{},f;if("fixWidth"===this.strategy)e.width=this.itemSize.width,e.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(f=0;f<this.itemSize.length;f++){if(d.w<=this.itemSize[f].screenWidth){e.width=this.itemSize[f].width;e.height=this.itemSize[f].height;break}}else"fixCols"===this.strategy&&(e.width=(d.w-this.hmargin*(this.maxCols-1))/this.maxCols,e.height="number"===typeof this.itemSize.height?this.itemSize.height:e.width*parseFloat(this.itemSize.height.substring(0,this.itemSize.height.length-
1))/100);return e},setItemPosition:function(d,e,n,b){e++;var c=e%b;e=Math.ceil(e/b);0===c&&(c=b);b={position:"absolute",top:(this.vmargin+n.height)*(e-1)+"px"};b[window.isRTL?"right":"left"]=(this.hmargin+n.width)*(c-1)+"px";0<=n.width&&(b.width=n.width+"px");0<=n.height&&(b.height=n.height+"px");f.setStyle(d.domNode?d.domNode:d,b)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/Evented esri/layers/GraphicsLayer esri/graphic esri/toolbars/draw esri/symbols/jsonUtils".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r){return l([e,f,h,g],{templateString:d,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);var b={};this.drawLayerId&&(b.id=
this.drawLayerId);this.drawLayer=new m(b);this._initDefaultSymbols();this._initTypes();b=a(".draw-item",this.domNode);this.own(b.on("click",k.hitch(this,this._onItemClick)));this.own(c(this.btnClear,"click",k.hitch(this,this.clear)));this.map&&this.setMap(this.map);n.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none")},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.drawToolBar&&
this.drawToolBar.deactivate();this.drawLayer&&this.map&&this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;this.inherited(arguments)},setMap:function(a){a&&(this.map=a,this.map.addLayer(this.drawLayer),this.drawToolBar=new s(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(c(this.drawToolBar,"draw-end",k.hitch(this,this._onDrawEnd))))},setPointSymbol:function(a){this.pointSymbol=
a;this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(a){this.polylineSymbol=a;this.drawToolBar.setLineSymbol(a)},setPolygonSymbol:function(a){this.polygonSymbol=a;this.drawToolBar.setFillSymbol(a)},setTextSymbol:function(a){this.textSymbol=a},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();this.drawToolBar&&this.drawToolBar.deactivate();a(".draw-item",this.domNode).removeClass("jimu-state-active")},activate:function(b){var c=
null,d=a(".draw-item",this.domNode);"TEXT"===b?(b="POINT",c=this.textIcon):(d=d.filter(function(a){return a.getAttribute("data-geotype")===b}),0<d.length&&(c=d[0]));c&&this._activate(c)},onIconSelected:function(a,b,c){this.emit("icon-selected",a,b,c)},onDrawEnd:function(a,b,c){this.emit("draw-end",a,b,c)},onClear:function(){this.emit("clear")},addGraphic:function(a){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(a)},removeGraphic:function(a){this.drawLayer.remove(a)},_initDefaultSymbols:function(){var a=
{style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},b={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},c={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=r.fromJson(a));this.polylineSymbol||(this.polylineSymbol=r.fromJson(b));this.polygonSymbol||(this.polygonSymbol=r.fromJson(c))},
_initTypes:function(){this.types instanceof Array||(this.types=["point","polyline","polygon"]);var c=a(".draw-item",this.domNode);c.style("display","none");b.forEach(c,k.hitch(this,function(a){var c=a.getAttribute("data-commontype"),c=0<=b.indexOf(this.types,c);if(null!==this.geoTypes)var d=a.getAttribute("data-geotype"),c=c&&0<=b.indexOf(this.geoTypes,d);n.setStyle(a,"display",c?"block":"none")}))},_onItemClick:function(a){a=a.target||a.srcElement;n.hasClass(a,"jimu-state-active")?this.deactivate():
this._activate(a)},_activate:function(b){a(".draw-item",this.domNode).removeClass("jimu-state-active");n.addClass(b,"jimu-state-active");var c=b.getAttribute("data-geotype"),d=b.getAttribute("data-commontype"),e=s[c];this.disableWebMapPopup();this.drawToolBar.activate(e);this.onIconSelected(b,c,d)},_onDrawEnd:function(b){var c=a(".draw-item.jimu-state-active",this.domNode)[0],d=c.getAttribute("data-geotype"),c=c.getAttribute("data-commontype");b=b.geometry;var e=b.type,g=null,g="point"===e||"multipoint"===
e?n.hasClass(this.textIcon,"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===e||"polyline"===e?this.polylineSymbol:this.polygonSymbol;b=new p(b,g,null,null);this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(b);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(b,d,c)}})})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w,v,x,B,D,C,F,z){var A=l(r,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(a,c){this.markerSymbol=new q(q.STYLE_SOLID,10,new t(t.STYLE_SOLID,new d([255,0,0]),2),new d([0,0,0,0.25]));this.lineSymbol=new t(t.STYLE_SOLID,new d([255,0,0]),2);this.fillSymbol=new u(u.STYLE_SOLID,new t(t.STYLE_SOLID,new d([255,0,0]),2),new d([0,0,0,0.25]));this._points=[];this._mouse=!n("esri-touch")&&!n("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=e.mixin(e.mixin({},this._defaultOptions),c||{});if(b("ios")||b("android"))this._options.showTooltips=!1;this._onKeyDownHandler=e.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=e.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=e.hitch(this,this._onMouseUpHandler);this._onClickHandler=e.hitch(this,this._onClickHandler);this._onMouseMoveHandler=e.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=e.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=e.hitch(this,this._onDblClickHandler);this._updateTooltip=e.hitch(this,this._updateTooltip);this._hideTooltip=e.hitch(this,this._hideTooltip);this._redrawGraphic=e.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(a){this.respectDrawingVertexOrder=a},setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},
setFillSymbol:function(a){this.fillSymbol=a},activate:function(a,b){this._geometryType&&this.deactivate();var c=this.map,d=h.connect,g=A;this._options=e.mixin(e.mixin({},this._options),b||{});c.navigationManager.setImmediateClick(!1);switch(a){case g.ARROW:case g.LEFT_ARROW:case g.RIGHT_ARROW:case g.UP_ARROW:case g.DOWN_ARROW:case g.TRIANGLE:case g.CIRCLE:case g.ELLIPSE:case g.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));n("esri-touch")&&!n("esri-pointer")&&
(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case g.POINT:this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);break;case g.LINE:case g.EXTENT:case g.FREEHAND_POLYLINE:case g.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),
this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));n("esri-touch")&&!n("esri-pointer")&&(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),
this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case g.POLYLINE:case g.POLYGON:case g.MULTI_POINT:c.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._onDblClickHandler_connect=d(c,"onDblClick",this._onDblClickHandler);this._dblClickZoom=c.isDoubleClickZoom;c.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+
a);return}this._onKeyDown_connect=d(c,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=d(c,"onExtentChange",this._redrawGraphic);this._geometryType=a;this._toggleTooltip(!0);c.snappingManager&&("freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType)&&(c.snappingManager._startSelectionLayerQuery(),c.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var a=this.map;this._clear();var b=h.disconnect;b(this._onMouseMoveHandler_connect);
b(this._onMouseDownHandler_connect);b(this._onMouseDragHandler_connect);b(this._onMouseUpHandler_connect);b(this._onMouseDownHandler2_connect);b(this._onMouseDragHandler2_connect);b(this._onMouseUpHandler2_connect);b(this._onClickHandler_connect);b(this._onDblClickHandler_connect);b(this._onKeyDown_connect);b(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=
this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;a.snappingManager&&(a.snappingManager._stopSelectionLayerQuery(),a.snappingManager._killOffSnapping());switch(this._geometryType){case A.CIRCLE:case A.ELLIPSE:case A.TRIANGLE:case A.ARROW:case A.LEFT_ARROW:case A.RIGHT_ARROW:case A.UP_ARROW:case A.DOWN_ARROW:case A.RECTANGLE:case A.LINE:case A.EXTENT:case A.FREEHAND_POLYLINE:case A.FREEHAND_POLYGON:this._activateMapTools(!0,
!1,!1,!0);break;case A.POLYLINE:case A.POLYGON:case A.MULTI_POINT:this._dblClickZoom&&a.enableDoubleClickZoom()}b=this._geometryType;this._geometryType=null;a.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(b)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._tGraphic&&this.map.graphics.remove(this._tGraphic,!0);this._graphic=this._tGraphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},
finishDrawing:function(){var a,b=this._points,c=this.map.spatialReference,d=A,b=b.slice(0,b.length);switch(this._geometryType){case d.POLYLINE:if(!this._graphic||2>b.length)return;a=new B(c);a.addPath([].concat(b));break;case d.POLYGON:if(!this._graphic||3>b.length)return;a=new D(c);b=[].concat(b,[b[0].offset(0,0)]);!D.prototype.isClockwise(b)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),b.reverse());
a.addRing(b);break;case d.MULTI_POINT:a=new C(c),f.forEach(b,function(b){a.addPoint(b)})}h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_drawEnd:function(a){if(a){var b=this.map.spatialReference,c;this.onDrawEnd(a);b&&(b.isWebMercator()?c=x.webMercatorToGeographic(a,!0):4326===b.wkid&&(c=v.fromJson(a.toJson())));this.onDrawComplete({geometry:a,geographicGeometry:c})}},_normalizeRect:function(a,b,c){var d=a.x;a=a.y;var e=b.x;b=b.y;var g=Math.abs(d-
e),m=Math.abs(a-b);return{x:Math.min(d,e),y:Math.max(a,b),width:g,height:m,spatialReference:c}},_onMouseDownHandler:function(a){this._dragged=!1;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=b||a.mapPoint,d=A;b=this.map;var e=b.spatialReference;this._points.push(c.offset(0,0));switch(this._geometryType){case d.LINE:this._graphic=b.graphics.add(new w(new B({paths:[[[c.x,c.y],[c.x,c.y]]],spatialReference:e}),this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);
break;case d.FREEHAND_POLYLINE:this._oldPoint=a.screenPoint;c=new B(e);c.addPath(this._points);this._graphic=b.graphics.add(new w(c,this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case d.CIRCLE:case d.ELLIPSE:case d.TRIANGLE:case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.RECTANGLE:case d.FREEHAND_POLYGON:this._oldPoint=a.screenPoint,c=new D(e),c.addRing(this._points),this._graphic=b.graphics.add(new w(c,this.fillSymbol),
!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)}n("esri-touch")&&a.preventDefault()},_onMouseMoveHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[this._points.length-1];a=b||a.mapPoint;b=this._tGraphic;var d=b.geometry;switch(this._geometryType){case A.POLYLINE:case A.POLYGON:d.setPoint(0,0,{x:c.x,y:c.y}),d.setPoint(0,1,{x:a.x,y:a.y}),b.setGeometry(d)}},_onMouseDragHandler:function(a){if(this._graphic||this._points.length)if(n("esri-touch")&&
!this._points.length)a.preventDefault();else{this._dragged=!0;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0],d=b||a.mapPoint,g=this.map,m=g.spatialReference;b=this._graphic;var f=A,k=g.toScreen(c),h=g.toScreen(d),p=[],p=h.x-k.x,h=h.y-k.y,l=Math.sqrt(p*p+h*h);switch(this._geometryType){case f.CIRCLE:this._hideTooltip();b.geometry=D.createCircle({center:k,r:l,numberOfPoints:60,map:g});b.setGeometry(b.geometry);break;case f.ELLIPSE:this._hideTooltip();
b.geometry=D.createEllipse({center:k,longAxis:p,shortAxis:h,numberOfPoints:60,map:g});b.setGeometry(b.geometry);break;case f.TRIANGLE:this._hideTooltip();p=[[0,-l],[0.8660254037844386*l,0.5*l],[-0.8660254037844386*l,0.5*l],[0,-l]];b.geometry=this._toPolygon(p,k.x,k.y);b.setGeometry(b.geometry);break;case f.ARROW:this._hideTooltip();c=h/l;g=p/l;d=0.25*g*l;m=0.25*l/(h/p);l*=0.25*c;p=[[p,h],[p-d*(1+24/m),h+24*g-l],[p-d*(1+12/m),h+12*g-l],[-12*c,12*g],[12*c,-12*g],[p-d*(1-12/m),h-12*g-l],[p-d*(1-24/m),
h-24*g-l],[p,h]];b.geometry=this._toPolygon(p,k.x,k.y);b.setGeometry(b.geometry);break;case f.LEFT_ARROW:this._hideTooltip();p=0>=p?[[p,0],[0.75*p,h],[0.75*p,0.5*h],[0,0.5*h],[0,-0.5*h],[0.75*p,-0.5*h],[0.75*p,-h],[p,0]]:[[0,0],[0.25*p,h],[0.25*p,0.5*h],[p,0.5*h],[p,-0.5*h],[0.25*p,-0.5*h],[0.25*p,-h],[0,0]];b.geometry=this._toPolygon(p,k.x,k.y);b.setGeometry(b.geometry);break;case f.RIGHT_ARROW:this._hideTooltip();p=0<=p?[[p,0],[0.75*p,h],[0.75*p,0.5*h],[0,0.5*h],[0,-0.5*h],[0.75*p,-0.5*h],[0.75*
p,-h],[p,0]]:[[0,0],[0.25*p,h],[0.25*p,0.5*h],[p,0.5*h],[p,-0.5*h],[0.25*p,-0.5*h],[0.25*p,-h],[0,0]];b.geometry=this._toPolygon(p,k.x,k.y);b.setGeometry(b.geometry);break;case f.UP_ARROW:this._hideTooltip();p=0>=h?[[0,h],[-p,0.75*h],[-0.5*p,0.75*h],[-0.5*p,0],[0.5*p,0],[0.5*p,0.75*h],[p,0.75*h],[0,h]]:[[0,0],[-p,0.25*h],[-0.5*p,0.25*h],[-0.5*p,h],[0.5*p,h],[0.5*p,0.25*h],[p,0.25*h],[0,0]];b.geometry=this._toPolygon(p,k.x,k.y);b.setGeometry(b.geometry);break;case f.DOWN_ARROW:this._hideTooltip();
p=0<=h?[[0,h],[-p,0.75*h],[-0.5*p,0.75*h],[-0.5*p,0],[0.5*p,0],[0.5*p,0.75*h],[p,0.75*h],[0,h]]:[[0,0],[-p,0.25*h],[-0.5*p,0.25*h],[-0.5*p,h],[0.5*p,h],[0.5*p,0.25*h],[p,0.25*h],[0,0]];b.geometry=this._toPolygon(p,k.x,k.y);b.setGeometry(b.geometry);break;case f.RECTANGLE:this._hideTooltip();p=[[0,0],[p,0],[p,h],[0,h],[0,0]];b.geometry=this._toPolygon(p,k.x,k.y);b.setGeometry(b.geometry);break;case f.LINE:b.setGeometry(e.mixin(b.geometry,{paths:[[[c.x,c.y],[d.x,d.y]]]}));break;case f.EXTENT:b&&g.graphics.remove(b,
!0);b=new F(this._normalizeRect(c,d,m));b._originOnly=!0;this._graphic=g.graphics.add(new w(b,this.fillSymbol),!0);g.snappingManager&&g.snappingManager._setGraphic(this._graphic);break;case f.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){n("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry);break;case f.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){n("esri-touch")&&
a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry)}n("esri-touch")&&a.preventDefault()}},_canDrawFreehandPoint:function(a){if(!this._oldPoint)return!1;var b=this._oldPoint.x-a.screenPoint.x,c=this._oldPoint.y-a.screenPoint.y,d=this._options.tolerance;if((0>b?-1*b:b)<d&&(0>c?-1*c:c)<d)return!1;b=new Date;if(b-this._startTime<this._options.drawTime)return!1;this._startTime=b;this._oldPoint=a.screenPoint;return!0},
_onMouseUpHandler:function(a){if(!this._dragged||!this._graphic)this._clear();else{0===this._points.length&&this._points.push(a.mapPoint.offset(0,0));var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0];b=b||a.mapPoint;var d=this.map.spatialReference,e=A,g;switch(this._geometryType){case e.CIRCLE:case e.ELLIPSE:case e.TRIANGLE:case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.RECTANGLE:g=this._graphic.geometry;break;
case e.LINE:g=new B({paths:[[[c.x,c.y],[b.x,b.y]]],spatialReference:d});break;case e.EXTENT:g=(new F(this._normalizeRect(c,b,d))).getExtent();break;case e.FREEHAND_POLYLINE:g=new B(d);g.addPath([].concat(this._points,[b.offset(0,0)]));break;case e.FREEHAND_POLYGON:g=new D(d),c=[].concat(this._points,[b.offset(0,0),this._points[0].offset(0,0)]),!D.prototype.isClockwise(c)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),
c.reverse()),g.addRing(c)}n("esri-touch")&&a.preventDefault();this._clear();this._drawEnd(g)}},_onClickHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);a=b||a.mapPoint;b=this.map;var c=b.toScreen(a),d=A;this._points.push(a.offset(0,0));switch(this._geometryType){case d.POINT:this._drawEnd(a.offset(0,0));this._setTooltipMessage(0);break;case d.POLYLINE:1===this._points.length?(c=new B(b.spatialReference),c.addPath(this._points),this._graphic=b.graphics.add(new w(c,
this.lineSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=h.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new w(new B({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.lineSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,
1,a.offset(0,0)),b.setGeometry(c));break;case d.POLYGON:1===this._points.length?(c=new D(b.spatialReference),c.addRing(this._points),this._graphic=b.graphics.add(new w(c,this.fillSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=h.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new w(new B({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.fillSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,
0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,1,a.offset(0,0)),b.setGeometry(c));break;case d.MULTI_POINT:a=this._points;1===a.length?(c=new C(b.spatialReference),c.addPoint(a[a.length-1]),this._graphic=b.graphics.add(new w(c,this.markerSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)):(this._graphic.geometry.addPoint(a[a.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));
break;case d.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],c.x,c.y);break;case d.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],c.x,c.y);break;case d.DOWN_ARROW:this._addShape([[0,
0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],c.x,c.y);break;case d.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],c.x,c.y);break;case d.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],c.x-48,c.y+48);break;case d.CIRCLE:this._clear();this._drawEnd(D.createCircle({center:c,r:48,numberOfPoints:60,map:b}));break;case d.ELLIPSE:this._clear(),this._drawEnd(D.createEllipse({center:c,longAxis:48,shortAxis:24,numberOfPoints:60,
map:b}))}this._setTooltipMessage(this._points.length)},_addShape:function(a,b,c){this._setTooltipMessage(0);this._clear();this._drawEnd(this._toPolygon(a,b,c))},_toPolygon:function(a,b,c){var d=this.map,e=new D(d.spatialReference);e.addRing(f.map(a,function(a){return d.toMap({x:a[0]+b,y:a[1]+c})}));return e},_onDblClickHandler:function(a){var b,c=this._points,d=this.map.spatialReference,e=A;n("esri-touch")&&c.push(a.mapPoint);var g=c[c.length-1],m=c[c.length-2],c=g&&m&&g.x===m.x&&g.y===m.y?c.slice(0,
c.length-1):c.slice(0,c.length);switch(this._geometryType){case e.POLYLINE:if(!this._graphic||2>c.length){h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new B(d);b.addPath([].concat(c));break;case e.POLYGON:if(!this._graphic||2>c.length){h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new D(d);a=[].concat(c,[c[0].offset(0,0)]);!D.prototype.isClockwise(a)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+
" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),a.reverse());b.addRing(a);break;case e.MULTI_POINT:b=new C(d),f.forEach(c,function(a){b.addPoint(a)})}h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(b)},_onKeyDownHandler:function(a){a.keyCode===c.ESCAPE&&(h.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(b){this._options.showTooltips&&(b?this._tooltip||
(this._tooltip=a.create("div",{"class":"tooltip"},this.map.container),m.isBodyLtr()||g.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=h.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=h.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=h.connect(this.map,"onMouseMove",this._updateTooltip)):
this._tooltip&&(h.disconnect(this._onTooltipMouseEnterHandler_connect),h.disconnect(this._onTooltipMouseLeaveHandler_connect),h.disconnect(this._onTooltipMouseMoveHandler_connect),a.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var a=this._tooltip;a&&(a.style.display="none")},_setTooltipMessage:function(a){var b=this._tooltip;if(b){var c="";switch(this._geometryType){case A.POINT:c=z.toolbars.draw.addPoint;break;case A.ARROW:case A.LEFT_ARROW:case A.RIGHT_ARROW:case A.UP_ARROW:case A.DOWN_ARROW:case A.TRIANGLE:case A.RECTANGLE:case A.CIRCLE:case A.ELLIPSE:c=
z.toolbars.draw.addShape;break;case A.LINE:case A.EXTENT:case A.FREEHAND_POLYLINE:case A.FREEHAND_POLYGON:c=z.toolbars.draw.freehand;break;case A.POLYLINE:case A.POLYGON:c=z.toolbars.draw.start;1===a?c=z.toolbars.draw.resume:2<=a&&(c=z.toolbars.draw.complete);break;case A.MULTI_POINT:c=z.toolbars.draw.addMultipoint,1<=a&&(c=z.toolbars.draw.finish)}b.innerHTML=c}},_updateTooltip:function(a){var b=this._tooltip;if(b){var c;a.clientX||a.pageY?(c=a.clientX,a=a.clientY):(c=a.clientX+k.body().scrollLeft-
k.body().clientLeft,a=a.clientY+k.body().scrollTop-k.body().clientTop);b.style.display="none";g.set(b,{left:c+this._options.tooltipOffset+"px",top:a+"px"});b.style.display=""}},_redrawGraphic:function(a,b,c,d){if(c||this.map.wrapAround180)(a=this._graphic)&&a.setGeometry(a.geometry),(a=this._tGraphic)&&a.setGeometry(a.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawEnd:function(){}});e.mixin(A,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",
POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});return A})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(l,e,f,h,d){return l([d],{declaredClass:"esri.toolbars._Toolbar",constructor:function(d){this.map=
d},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(d,e,b,c){var a=this.map;d&&(this._mapNavState={isDoubleClickZoom:a.isDoubleClickZoom,isClickRecenter:a.isClickRecenter,isPan:a.isPan,isRubberBandZoom:a.isRubberBandZoom,isKeyboardNavigation:a.isKeyboardNavigation,isScrollWheelZoom:a.isScrollWheelZoom},a.disableDoubleClickZoom(),
a.disableClickRecenter(),a.disablePan(),a.disableRubberBandZoom(),a.disableKeyboardNavigation());e&&a.hideZoomSlider();b&&a.hidePanArrows();c&&a.graphics.disableMouseEvents()},_activateMapTools:function(d,e,b,c){var a=this.map,g=this._mapNavState;d&&g&&(g.isDoubleClickZoom&&a.enableDoubleClickZoom(),g.isClickRecenter&&a.enableClickRecenter(),g.isPan&&a.enablePan(),g.isRubberBandZoom&&a.enableRubberBandZoom(),g.isKeyboardNavigation&&a.enableKeyboardNavigation(),g.isScrollWheelZoom&&a.enableScrollWheelZoom());
e&&a.showZoomSlider();b&&a.showPanArrows();c&&a.graphics.enableMouseEvents()}})})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(l,e,f,h){return l([f],{required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,declaredClass:"jimu.dijit.URLInput",postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:
"Invalid Url"},postCreate:function(){this.inherited(arguments);e.addClass(this.domNode,"jimu-url-input")},validator:function(d){if(isFinite(d))return!1;var e="^"+h.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),e=RegExp(e,"g").test(d);return this.rest?(d=/\/rest\/services/gi.test(d),e&&d):e}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(l,e,f){var h=l.getObject("validate.regexp",!0,f);return h=f.validate.regexp={ipAddress:function(d){d=
"object"==typeof d?d:{};"boolean"!=typeof d.allowDottedDecimal&&(d.allowDottedDecimal=!0);"boolean"!=typeof d.allowDottedHex&&(d.allowDottedHex=!0);"boolean"!=typeof d.allowDottedOctal&&(d.allowDottedOctal=!0);"boolean"!=typeof d.allowDecimal&&(d.allowDecimal=!0);"boolean"!=typeof d.allowHex&&(d.allowHex=!0);"boolean"!=typeof d.allowIPv6&&(d.allowIPv6=!0);"boolean"!=typeof d.allowHybrid&&(d.allowHybrid=!0);var e=[];d.allowDottedDecimal&&e.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
d.allowDottedHex&&e.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");d.allowDottedOctal&&e.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");d.allowDecimal&&e.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");d.allowHex&&e.push("0[xX]0*[\\da-fA-F]{1,8}");d.allowIPv6&&e.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");d.allowHybrid&&e.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
d="";0<e.length&&(d="("+e.join("|")+")");return d},host:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowIP&&(d.allowIP=!0);"boolean"!=typeof d.allowLocal&&(d.allowLocal=!1);"boolean"!=typeof d.allowPort&&(d.allowPort=!0);"boolean"!=typeof d.allowNamed&&(d.allowNamed=!1);var e=d.allowPort?"(\\:\\d+)?":"",f="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)";d.allowIP&&(f+="|"+h.ipAddress(d));d.allowLocal&&(f+="|localhost");d.allowNamed&&
(f+="|^[^-][a-zA-Z0-9_-]*");return"("+f+")"+e},url:function(d){d="object"==typeof d?d:{};"scheme"in d||(d.scheme=[!0,!1]);return e.buildGroupRE(d.scheme,function(d){return d?"(https?|ftps?)\\://":""})+h.host(d)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},emailAddress:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowCruft&&(d.allowCruft=!1);d.allowPort=!1;var e="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+h.host(d);d.allowCruft&&
(e="\x3c?(mailto\\:)?"+e+"\x3e?");return e},emailAddressList:function(d){d="object"==typeof d?d:{};"string"!=typeof d.listSeparator&&(d.listSeparator="\\s;,");var e=h.emailAddress(d);return"("+e+"\\s*["+d.listSeparator+"]\\s*)*"+e+"\\s*["+d.listSeparator+"]?\\s*"},numberFormat:function(d){d="object"==typeof d?d:{};"undefined"==typeof d.format&&(d.format="###-###-####");return e.buildGroupRE(d.format,function(d){return e.escapeString(d,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},
province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowTerritories&&(d.allowTerritories=!0);"boolean"!=typeof d.allowMilitary&&(d.allowMilitary=!0);var e="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";d.allowTerritories&&(e+="|AS|FM|GU|MH|MP|PW|PR|VI");d.allowMilitary&&(e+="|AA|AE|AP");return"("+e+")"}}}})},
"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(l,e,f,h,d,k,n,b,c){return l([n,k],{baseClass:"jimu-panel jimu-on-screen-widget-panel",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(a){a.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(a){a.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(f.removeClass(this.foldableNode,"fold-up"),f.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(f.removeClass(this.foldableNode,"fold-down"),f.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(a){this.panelManager.closePanel(this);a.stopPropagation()},_normalizePositionObj:function(a){var b=this._getLayoutBox();a.left=
isFinite(a.left)?a.left:b.w-a.right;a.top=isFinite(a.top)?a.top:b.h-a.bottom;delete a.right;delete a.bottom;this.position=e.mixin(e.clone(this.position),a)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new c({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(a,b){this.disableMoveable();var c=f.getMarginBox(jimuConfig.layoutId);c.l=c.l-a+b;c.w+=2*(a-b);this.moveable=new d.boxConstrainedMoveable(this.domNode,{box:c,handle:this.titleNode,within:!0});this.own(h(this.moveable,
"Moving",e.hitch(this,this.onMoving)));this.own(h(this.moveable,"MoveStop",e.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){f.removeClass(this.titleNode,"title-normal");f.addClass(this.titleNode,"title-full");f.setStyle(this.foldableNode,"display",
"block");f.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(f.removeClass(this.foldableNode,"fold-up"),f.addClass(this.foldableNode,"fold-down")):(f.removeClass(this.foldableNode,"fold-down"),f.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){f.removeClass(this.titleNode,"title-full");f.addClass(this.titleNode,"title-normal");f.setStyle(this.foldableNode,"display","none");f.setStyle(this.maxNode,"display","none")},resize:function(a){var b=this._getPositionInfo(),
c={left:b.position.left,top:b.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};a&&(a.t=this.domNode.offsetTop,c.left=isFinite(a.l)?a.l:c.left,c.top=isFinite(a.t)?a.t:c.top,c.width=isFinite(a.w)?a.w:c.width,c.height=isFinite(a.h)?a.h:c.height,this._normalizePositionObj(e.clone(c)),this.makePositionInfoBox(),c.width=this._positionInfoBox.w,c.height=this._positionInfoBox.h);b.position=c;this._onResponsible(b);this.inherited(arguments)},_onResponsible:function(a){a.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(a.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(a){this._normalizePositionObj(a);this.makePositionInfoBox();a=this._getPositionInfo();this._onResponsible(a)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var a=jimuConfig.layoutId,
a="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return f.getMarginBox(a)},_getPositionInfo:function(){var a={isRunInMobile:!1,position:{left:0,top:5}},b=this._getLayoutBox(),c=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return a.isRunInMobile=!0,a;a.position.left=window.isRTL?b.w-c:c;var c=this._positionInfoBox.t,d=b.h-c;c>=d?c>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):d>=this._positionInfoBox.h&&(a.position.top=
this._positionInfoBox.t+40+3);!a.isRunInMobile&&a.position.left+this._positionInfoBox.w>b.w&&(a.position.left-=this._positionInfoBox.w);return a},_setMobilePosition:function(){f.place(this.domNode,jimuConfig.layoutId);var a=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(a.zIndex=this.position.zIndex);var c=b.getPositionStyle(a);e.mixin(c,a.borderRadiusStyle);f.setStyle(this.domNode,c)},_setDesktopPosition:function(a){f.place(this.domNode,jimuConfig.mapId);f.setStyle(this.domNode,
{left:a.left+"px",right:"auto",top:a.top+"px",width:(a.width||this.position.width||this._originalBox.w)+"px",height:(a.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(a){f.setStyle(a.node,"opacity",0.9)},onMoveStop:function(a){f.setStyle(a.node,"opacity",1);a=f.getMarginBox(a.node);this._normalizePositionObj(e.clone({left:a.l,top:a.t,width:a.w,height:a.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t){l.experimental("dojox.layout.ResizeHandle");var u=p("dojox.layout._ResizeHelper",q,{show:function(){m.set(this.domNode,"display","")},hide:function(){m.set(this.domNode,"display","none")},resize:function(a){g.setMarginBox(this.domNode,a)}});return p("dojox.layout.ResizeHandle",[q,t],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,s.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=r.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new u({id:"dojoxGlobalResizeHelper"})).placeAt(n.body()),
a.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var b=e.partial(a.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;b("dojoxResizeNW");break;case "x":this._resizeX=!0;b("dojoxResizeW");break;case "y":this._resizeY=!0,b("dojoxResizeN")}},_beginSizing:function(a){if(!this._isSizing&&
(f.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=r.byId(this.targetId))?this.targetWidget.domNode:c.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var b=g.position(this.targetDomNode,!0);this._resizeHelper.resize({l:b.x,t:b.y,w:b.w,h:b.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:b.x,t:b.y})}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};
var b=m.getComputedStyle(this.targetDomNode),e="border-model"===g.boxModel?{w:0,h:0}:g.getPadBorderExtents(this.targetDomNode,b),k=g.getMarginExtents(this.targetDomNode,b);this.startSize={w:m.get(this.targetDomNode,"width",b),h:m.get(this.targetDomNode,"height",b),pbw:e.w,pbh:e.h,mw:k.w,mh:k.h};!this.isLeftToRight()&&"absolute"==m.get(this.targetDomNode,"position")&&(b=g.position(this.targetDomNode,!0),this.startPosition={l:b.x,t:b.y});this._pconnects=[f.connect(n.doc,s.move,this,"_updateSizing"),
f.connect(n.doc,s.release,this,"_endSizing")];d.stop(a)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(d){return!1}this._activeResizeLastEvent=a;var e=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),g=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
e:0);g=this._checkConstraints(a,this.startSize.h-(this._resizeY?g:0));if((c=c||this.startPosition)&&this._resizeX)g.l=c.l+e,g.w!=a&&(g.l+=a-g.w),g.t=c.t;switch(b){case "margin":g.w+=this.startSize.mw,g.h+=this.startSize.mh;case "border":g.w+=this.startSize.pbw,g.h+=this.startSize.pbh}return g},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
d=this.startSize.h,e=c*b-d*a;0>e?a=b*c/d:0<e&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(a){var c=this.targetWidget&&e.isFunction(this.targetWidget.resize),d=this._getNewCoords(a,c&&"margin");if(!1!==d&&(c?this.targetWidget.resize(d):this.animateSizing?b[this.animateMethod]([k.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:d.w}},duration:this.animateDuration}),k.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:d.h}},
duration:this.animateDuration})]).play():m.set(this.targetDomNode,{width:d.w+"px",height:d.h+"px"}),this.intermediateChanges))this.onResize(a)},_endSizing:function(a){h.forEach(this._pconnects,f.disconnect);var b=e.partial(f.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"jimu/LayerInfos/LayerInfoForCollection":function(){define(["dojo/_base/declare",
"dojo/_base/array","esri/graphicsUtils","./LayerInfo","./LayerInfoFactory"],function(l,e,f,h,d){return l(h,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection"}},getExtent:function(){var d=[],h;e.forEach(this.originOperLayer.featureCollection.layers,function(b){d=d.concat(b.layerObject.graphics)});0===d.length?h=null:(h=1===d.length?d[0].getLayer().fullExtent:f.graphicsExtent(d),h=this._convertGeometryToMapSpatialRef(h));return h},initVisible:function(){var d=
!1,e;if(this.newSubLayers.length)for(e=0;e<this.newSubLayers.length;e++)d=d||this.newSubLayers[e].layerObject.visible;else d=!1;this._visible=d},_setTopLayerVisible:function(d){this._visible=d?!0:!1;e.forEach(this.newSubLayers,function(d){d.setLayerVisiblefromTopLayer()},this)},obtainNewSubLayers:function(){var f=[];e.forEach(this.originOperLayer.featureCollection.layers,function(e){this._getLayerIndexesInMapByLayerId(e.layerObject.id)&&(e=d.getInstance().create({layerObject:e.layerObject,title:e.layerObject.label||
e.layerObject.title||e.layerObject.name||e.layerObject.id||" ",id:e.id||" ",collection:{layerInfo:this},selfType:"collection",parentLayerInfo:this}),f.push(e),e.init())},this);f.reverse();return f},_obtainLayerIndexesInMap:function(){var d=[],e,b;for(b=0;b<this.newSubLayers.length;b++)(e=this._getLayerIndexesInMapByLayerId(this.newSubLayers[b].layerObject.id))&&d.push(e);return d},moveLeftOfIndex:function(d){var e;for(e=this.newSubLayers.length-1;0<=e;e--)this.map.reorderLayer(this.newSubLayers[e].layerObject,
d)},moveRightOfIndex:function(d){var e;for(e=0;e<this.newSubLayers.length;e++)this.map.reorderLayer(this.newSubLayers[e].layerObject,d)}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic esri/config esri/tasks/ProjectParameters esri/SpatialReference esri/geometry/webMercatorUtils".split(" "),function(l,e,f,h,d,k,n,b,c,a,g){return l(null,{originOperLayer:null,layerObject:null,map:null,
title:null,id:null,newSubLayers:null,parentLayerInfo:null,constructor:function(a,b){this.originOperLayer=a;this.layerObject=a.layerObject;this.map=b;this.title=this.originOperLayer.title;this.id=this.originOperLayer.id;this.parentLayerInfo=a.parentLayerInfo?a.parentLayerInfo:null;this.nls=window.jimuNls.layerInfosMenu;this._bindEvent()},init:function(){this.newSubLayers=this.obtainNewSubLayers();this.initVisible();this.originOperLayer.popupInfo&&(this.popupVisible=!0)},isGraphicLayer:function(){var a=
this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},getExtent:function(){},getOpacity:function(){var a,b=0;for(a=0;a<this.newSubLayers.length;a++)if(this.newSubLayers[a].layerObject.opacity)b=this.newSubLayers[a].layerObject.opacity>b?this.newSubLayers[a].layerObject.opacity:b;else return 1;return b},setOpacity:function(a){e.forEach(this.newSubLayers,function(b){b.layerObject.setOpacity&&b.layerObject.setOpacity(a)})},
moveLeftOfIndex:function(a){this.map.reorderLayer(this.layerObject,a)},moveRightOfIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var b=this.getSubLayers(),c=0;c<b.length;c++)if(b[c].traversal(a))return!0},findLayerInfoById:function(a){var b=null,c=0;if(this.id&&this.id===a)return this;for(c=0;c<this.newSubLayers.length&&!(b=this.newSubLayers[c].findLayerInfoById(a));c++);return b},setTopLayerVisible:function(a){var b=this.isShowInMap();this._setTopLayerVisible(a);
this._isShowInMapChanged(b)},_setTopLayerVisible:function(a){},setSubLayerVisible:function(a,b){},setLayerVisiblefromTopLayer:function(){},initVisible:function(){},isVisible:function(){return this._visible},_obtainLayerIndexesInMap:function(){var a=[],b;(b=this._getLayerIndexesInMapByLayerId(this.id))&&a.push(b);return a},_getLayerIndexesInMapByLayerId:function(a){var b;for(b=0;b<this.map.graphicsLayerIds.length;b++)if(this.map.graphicsLayerIds[b]===a)return{isGraphicLayer:!0,index:b};for(b=0;b<this.map.layerIds.length;b++)if(this.map.layerIds[b]===
a)return{isGraphicLayer:!1,index:b};return null},_convertGeometryToMapSpatialRef:function(d){var e=new h;if(this.map.spatialReference.equals(d.spatialReference))return e.resolve([d]),e;if(this.map.spatialReference.isWebMercator()&&d.spatialReference.equals(new a(4326)))return e.resolve([g.geographicToWebMercator(d)]),e;if(this.map.spatialReference.equals(new a(4326))&&d.spatialReference.isWebMercator())return e.resolve([g.webMercatorToGeographic(d)]),e;e=new c;e.geometries=[d];e.outSR=this.map.spatialReference;
return b.defaults.geometryService.project(e)},_isShowInMapChanged:function(a){var b=this.isShowInMap();if(a!==b){!1===b&&this.map.infoWindow.hide();var c=[];this.traversal(function(a){c.push(a)});n.publish("layerInfos/layerInfo/isShowInMapChanged",c)}},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return k.create("div",{"class":"legends-div"})},drawLegends:function(a,b){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},
_isItemLayer:function(){return this.originOperLayer.itemId||this.layerObject._itemId},getLayerObject:function(){var a=new h;this.layerObject?a.resolve(this.layerObject):a.reject("layerObject is null");return a},getSubLayers:function(){return this.newSubLayers},isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},isShowInMap:function(){for(var a=!0,b=this;b;)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},getLayerType:function(){var a=
[null],b=new h;this.layerObject.declaredClass&&(a=this.layerObject.declaredClass.split("."));b.resolve(a[a.length-1]);return b},getPopupInfo:function(){return this.originOperLayer.popupInfo},loadInfoTemplate:function(){var a=new h;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?this.originOperLayer.layerDefinition.definitionExpression:null},getUrl:function(){return this.layerObject.url},hasLayerTypes:function(a){},
getSupportTableInfo:function(){var a=new h,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},c=this.getLayerType(),e=this.getLayerObject();d({type:c,layerObject:e}).then(f.hitch(this,function(c){var d=c.type;c=c.layerObject;b.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(b.isSupportedLayer=!0);if(c){if(!c.url||c.capabilities&&0<=c.capabilities.indexOf("Query"))b.isSupportQuery=!0}else b.isSupportQuery=!1;a.resolve(b)}),function(){a.resolve(b)});return a},removeSubLayerById:function(a){var b=
[];e.forEach(this.newSubLayers,function(c){c.id!==a&&b.push(c)});this.newSubLayers=b},_bindEvent:function(){if(this.layerObject&&!this.layerObject.empty)this.layerObject.on("visibility-change",f.hitch(this,this._onVisibilityChanged))},_onVisibilityChanged:function(){}})})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect ./LayerInfo esri/request ./LayerInfoFactory".split(" "),function(l,e,f,h,d,k,n,
b,c){return l(n,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,constructor:function(a,b){this.initSubLayerVisible();this._sublayerIdent={definitions:[],empty:!0,defLoad:new h};this._sublayerIdent.definitions[this.layerObject.layerInfos.length-1]=null;this._initControlPopup()},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:f.clone(this.layerObject.infoTemplates)};this.layerObject._infoTemplates=f.clone(this.layerObject.infoTemplates);k.after(this.layerObject,
"setInfoTemplates",f.hitch(this,function(){this.layerObject._infoTemplates=f.clone(this.layerObject.infoTemplates);this.controlPopupInfo.infoTemplates=f.clone(this.layerObject.infoTemplates);this.traversal(function(a){a._afterSetInfoTemplates&&a._afterSetInfoTemplates()})}))},initSubLayerVisible:function(){this.subLayerVisible=[];for(var a=this.subLayerVisible[this.layerObject.layerInfos.length-1]=0;a<this.subLayerVisible.length;a++)this.subLayerVisible[a]=0;this.originOperLayer.visibleLayers?e.forEach(this.originOperLayer.visibleLayers,
function(a){this.subLayerVisible[a]++},this):e.forEach(this.layerObject.layerInfos,function(a,b){a.defaultVisibility&&this.subLayerVisible[b]++},this)},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent)},initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(a){this.originOperLayer.layerObject.setVisibility(a);this._visible=a},setSubLayerVisible:function(a,
b){var c=[],d;null!==a&&(b?(c=f.clone(this.originOperLayer.layerObject.visibleLayers),d=e.indexOf(c,a),0>d&&(c.push(a),this.originOperLayer.layerObject.setVisibleLayers(c))):(c=f.clone(this.originOperLayer.layerObject.visibleLayers),d=e.indexOf(c,a),0<=d&&c.splice(d,1),0===c.length&&c.push(-1),this.originOperLayer.layerObject.setVisibleLayers(c)))},obtainNewSubLayers:function(){var a=[],b=this.originOperLayer.layerObject,d=null,d="esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass?"dynamic":
"tiled";e.forEach(b.layerInfos,function(c){var e=null,e=b.url+"/"+c.id,f=b.id+"_"+c.id;c.subLayerIds&&0<c.subLayerIds.length?(e={url:e,empty:!0},this._addNewSubLayer(a,e,f,c,d+"_group")):(e={url:e,empty:!0},this._addNewSubLayer(a,e,f,c,d))},this);var f=[];e.forEach(b.layerInfos,function(b,c){var d=b.parentLayerId;-1!==d&&a[d].subLayers.push(a[c])});e.forEach(b.layerInfos,function(b,d){var e;-1===b.parentLayerId&&(e=c.getInstance().create(a[d]),f.push(e),e.init())},this);return f},_addNewSubLayer:function(a,
b,c,d,e){a.push({layerObject:b,title:d.name||d.id||" ",id:c||" ",subLayers:[],mapService:{layerInfo:this,subId:d.id},selfType:"mapservice_"+e,parentLayerInfo:this})},_handleErrorSubLayer:function(a,b,c,d,e,f){a[b]={layerObject:null,title:f.name||f.id||" ",id:c||" ",subLayers:[],mapService:{layerInfo:this,subId:d}}},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},getLegendInfo:function(a){var b=
new h;this._legendInfo?b.resolve(this._legendInfo):this._legendRequest(a).then(f.hitch(this,function(a){this._legendInfo=a.layers;b.resolve(this._legendInfo)}),function(){b.reject()});return b},_legendRequest:function(a){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(a)},_legendRequestServer:function(){var a=this.layerObject.url+"/legend",c={f:"json"};this.layerObject._params.dynamicLayers&&(c.dynamicLayers=d.stringify(this._createDynamicLayers(this.layerObject)),
"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));return b({url:a,content:c,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(a){return b({url:a+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(a){var b=[],c;e.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[d.id]&&(e=a.layerDefinitions[d.id]);
e&&(c.definitionExpression=e);var f;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(f=a.layerDrawingOptions[d.id]);f&&(c.drawingInfo=f.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getLayerDefinition:function(){var a=new h;this._request(this.layerObject.url).then(f.hitch(this,function(b){a.resolve(b)}),function(b){console.error(b.message||b);a.resolve(null)});return a},_getSublayerDefinition:function(a){var b;this._sublayerIdent.definitions[a]?(b=new h,b.resolve(this._sublayerIdent.definitions[a])):
b=this._layerAndTableRequest(a);return b},_layerAndTableRequest:function(a){return 10.11<=this.layerObject.version?this._allLayerAndTableServer(a):this._allLayerAndTable(a)},_allLayerAndTableServer:function(a){var b=new h,c=this.layerObject.url+"/layers";this._sublayerIdent.empty?(this._sublayerIdent.empty=!1,this._request(c).then(f.hitch(this,function(c){this._sublayerIdent.definitions=c.layers;this._sublayerIdent.defLoad.resolve();b.resolve(this._sublayerIdent.definitions[a])}),f.hitch(this,function(a){console.error(a.message||
a);this._sublayerIdent.defLoad.reject();this._sublayerIdent.defLoad=new h;this._sublayerIdent.empty=!0;b.resolve(null)}))):this._sublayerIdent.defLoad.then(f.hitch(this,function(){b.resolve(this._sublayerIdent.definitions[a])}),function(a){console.error(a.message||a);b.resolve(null)});return b},_allLayerAndTable:function(a){var b=new h;this._request(this.layerObject.url+"/"+a).then(f.hitch(this,function(c){this._sublayerIdent.definitions[a]=c;b.resolve(c)}),function(a){console.error(a.message||a);
b.resolve(null)});return b},_request:function(a){return b({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefault dojo/Deferred".split(" "),function(l,e,f,h,d,k,n,b){return l(k,{constructor:function(b,a){},getExtent:function(){var b=this.originOperLayer.layerObject.getLayers(),a=null,d;e.forEach(b,function(b){d=
this._convertGeometryToMapSpatialRef(b.initialExtent);a=a?a.union(d):d},this);return a},initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(b){b?this.originOperLayer.layerObject.show():this.originOperLayer.layerObject.hide();this._visible=b},obtainNewSubLayers:function(){var b=[],a=this.originOperLayer.layerObject.getLayers();e.forEach(a,function(a){this._getLayerIndexesInMapByLayerId(a.id)&&(a=new n({layerObject:a,title:a.label||a.title||a.name||
a.id||" ",id:a.id||" ",selfType:"kml",parentLayerInfo:this},this.map),b.push(a),a.init())},this);return b}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred ./LayerInfo dojox/gfx dojo/dom-construct dojo/dom-attr dojo/aspect esri/symbols/jsonUtils esri/dijit/PopupTemplate esri/dijit/Legend".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m){var p=l(d,{_legendsNode:null,controlPopupInfo:null,constructor:function(){this._initControlPopup()},
getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.fullExtent)||this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.initialExtent)},initVisible:function(){var a=!1;this._visible=a=this.originOperLayer.layerObject.visible},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;c.after(this.layerObject,
"setInfoTemplate",f.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||(this.layerObject.infoTemplate=null)}))},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?a?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),
this._visible=!1):(a?this.layerObject.show():this.layerObject.hide(),this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&this.layerObject.show():this.layerObject.hide()},createLegendsNode:function(){var a=n.create("div",{"class":"legends-div jimu-leading-margin1"},document.body);n.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+"/images/loading.gif"},a);return a},drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},
_initLegendsNodeByLegendDijit:function(a){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded)n.empty(a),(new m({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:m.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},a)).startup()},_initLegendsNode:function(c){var d=[],g=this.layerObject;if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length))n.empty(c),
g.renderer&&(g.renderer.infos?d=f.clone(g.renderer.infos):d.push({label:g.renderer.label,symbol:g.renderer.symbol}),g.renderer&&(g.renderer.defaultSymbol&&0<d.length)&&d.push({label:g.renderer.defaultLabel||"others",symbol:g.renderer.defaultSymbol}),e.forEach(d,function(d){d.legendDiv=n.create("div",{"class":"legend-div"},c);d.symbolDiv=n.create("div",{"class":"legend-symbol jimu-float-leading"},d.legendDiv);d.labelDiv=n.create("div",{"class":"legend-label jimu-float-leading",innerHTML:d.label||" "},
d.legendDiv);if("textsymbol"===d.symbol.type)b.set(d.symbolDiv,"innerHTML",d.symbol.text);else{var e=k.createSurface(d.symbolDiv,50,50);d=a.getShapeDescriptors(d.symbol);e.createShape(d.defaultShape).setFill(d.fill).setStroke(d.stroke).setTransform(k.matrix.translate(25,25))}},this))},obtainNewSubLayers:function(){var a=[];this.originOperLayer.subLayers&&0!==this.originOperLayer.subLayers.length&&e.forEach(this.originOperLayer.subLayers,function(b){b=new p(b,this.map);a.push(b);b.init()},this);return a},
getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},_getDefaultPopupTemplate:function(a){var b=null;if(a&&a.fields){var c={title:a.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]};e.forEach(a.fields,function(b){b.name!==a.objectIdField&&c.fieldInfos.push({fieldName:b.name,visible:!0,label:b.alias,isEditable:!1})});b=new g(c)}return b},enablePopup:function(){this.controlPopupInfo.enablePopup=
!0;this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=null},loadInfoTemplate:function(){var a=new h;this.controlPopupInfo.infoTemplate||(this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject));a.resolve(this.controlPopupInfo.infoTemplate);return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate}});return p})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/has dojo/sniff dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w,v,x,B,D,C,F,z,A,E,H,K,O,G,J,y,L){var M=e([y,r],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,defaultText:"Aa",gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(a,b){f.mixin(this,L.widgets.legend);this._i18n=L.widgets.legend;a=a||
{};a.map?b?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===a.respectVisibility?!1:!0,this.arrangement=a.arrangement===M.ALIGN_RIGHT?M.ALIGN_RIGHT:M.ALIGN_LEFT,this.arrangement===M.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={}):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},
postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],l.locale&&-1!==l.locale.indexOf(c)&&(-1!==l.locale.indexOf("-")?-1!==l.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},
startup:function(){this.inherited(arguments);this._initialize();9>b("ie")&&(this._repaintItems=f.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],h.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?
!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)p.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",
_initialize:function(){this.layerInfos&&(this.layers=[],h.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=
!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],b=[];h.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);var d;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==c.declaredClass&&(d=c.getLayers(),h.forEach(d,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==c.declaredClass&&(d=c.getFeatureLayers(),h.forEach(d,function(a){b.push(a.id)},this))},this);h.forEach(this.map.graphicsLayerIds,
function(c){var d=this.map.getLayer(c);-1==h.indexOf(a,c)&&-1==h.indexOf(b,c)&&(this._isSupportedLayerType(d)&&d._params&&d._params.drawMode)&&(d.arcgisProps&&d.arcgisProps.title&&(d._titleForLegend=d.arcgisProps.title),this.layers.push(d))},this)}this._createLegend()},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=d.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=d.connect(this.map,"onLayerAdd",
this,"_updateAllMapLayers"),this._olrConnect=d.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=d.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),h.forEach(this.layers,function(a){a.ovcConnect=d.connect(a,"onVisibilityChange",this,"_refreshLayers");a.oscConnect=d.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(a.odcConnect=d.connect(a,"_onDynamicLayersChange",
f.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(a.oirConnect=d.connect(a,"onRenderingChange",f.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.oivrConnect=d.connect(a,"onRendererChange",f.hitch(this,"_refreshLayers")))},this))},_deactivate:function(){this._ozeConnect&&d.disconnect(this._ozeConnect);this._olaConnect&&d.disconnect(this._olaConnect);this._olroConnect&&d.disconnect(this._olroConnect);
this._olrConnect&&d.disconnect(this._olrConnect);h.forEach(this.layers,function(a){a.ovcConnect&&d.disconnect(a.ovcConnect);a.oscConnect&&d.disconnect(a.oscConnect);a.odcConnect&&d.disconnect(a.odcConnect);a.oirConnect&&d.disconnect(a.oirConnect);a.oivrConnect&&d.disconnect(a.oivrConnect)},this)},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},
_updateAllMapLayers:function(){this.layers=[];h.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);h.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&(a._params&&a._params.drawMode)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var b=!1;s.set(this.domNode,"position","relative");p.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+
"..."},this.domNode);var c=[];h.forEach(this.layers,function(a){if("esri.layers.KMLLayer"==a.declaredClass||"esri.layers.GeoRSSLayer"==a.declaredClass){var e;a.loaded?("esri.layers.KMLLayer"==a.declaredClass?e=a.getLayers():"esri.layers.GeoRSSLayer"==a.declaredClass&&(e=a.getFeatureLayers(),this.hideLayersInLegend[a.id]&&(e=h.filter(e,function(b){return-1==h.indexOf(this.hideLayersInLegend[a.id],b.id)},this))),h.forEach(e,function(b){"esri.layers.FeatureLayer"==b.declaredClass&&a._titleForLegend&&
(b._titleForLegend=a._titleForLegend+" - ","esriGeometryPoint"==b.geometryType?b._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==b.geometryType?b._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==b.geometryType&&(b._titleForLegend+=this.NLS_polygons),c.push(b))},this)):d.connect(a,"onLoad",f.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===a.declaredClass)if(a.loaded){if((!this._respectVisibility||this._respectVisibility&&a.visible)&&0<a.layerInfos.length&&
h.some(a.layerInfos,function(a){return a.legendURL})){var g=!1;h.forEach(a.layerInfos,function(c){c.legendURL&&-1<h.indexOf(a.visibleLayers,c.name)&&(g||(p.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(a._titleForLegend||a.name||a.id)+"\x3c/span\x3e"},this.domNode),g=!0),p.create("div",{innerHTML:"\x3cimg src\x3d'"+c.legendURL+"'/\x3e"},this.domNode),b=!0)},this)}}else d.connect(a,"onLoad",f.hitch(this,function(){this.refresh(this.layerInfos)}));else c.push(a)},this);var e=
[];h.forEach(c,function(a){if(a.loaded){if((!this._respectVisibility||this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var b=p.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});p.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},p.create("td",{align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%"},b)))));p.place(b,this.id,"first");
a.legendResponse||a.renderer?this._createLegendForLayer(a):e.push(this._legendRequest(a))}}else var c=d.connect(a,"onLoad",this,function(a){d.disconnect(c);c=null;this.refresh()})},this);0===e.length&&!b?(m.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):(new a(e)).addCallback(f.hitch(this,function(a){b?m.byId(this.id+"_msg").innerHTML="":m.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()}))},_createLegendForLayer:function(a){if(a.legendResponse||a.renderer){var b=
!1;if(a.legendResponse){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?h.forEach(c,function(c,d){if(!this.hideLayersInLegend[a.id]||-1==h.indexOf(this.hideLayersInLegend[a.id],c.id)){var e=this._buildLegendItems(a,c,d);b=b||e}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,
{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(s.set(m.byId(this.id+"_"+a.id),"display","block"),s.set(m.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);d.connect(a,"onLoad",f.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";(c=a._getToken())&&(b+="?token\x3d"+c);var d=
f.hitch(this,"_processLegendResponse"),c={f:"json"};a._params.dynamicLayers&&(c.dynamicLayers=g.stringify(this._createDynamicLayers(a)),"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));a._params.bandIds&&(c.bandIds=a._params.bandIds);a._params.renderingRule&&(c.renderingRule=a._params.renderingRule);return x({url:b,content:c,callbackParamName:"callback",load:function(b,c){d(a,b,c)},error:v.defaults.io.errorHandler})},_legendRequestTools:function(a){var c=a.url.toLowerCase().indexOf("/rest/"),c=a.url.substring(0,
c)+a.url.substring(c+5,a.url.length),c=this._legendUrl+"?soapUrl\x3d"+window.escape(c);if(!b("ie")||8<b("ie"))c+="\x26returnbytes\x3dtrue";var d=f.hitch(this,"_processLegendResponse");return x({url:c,content:{f:"json"},callbackParamName:"callback",load:function(b,c){d(a,b,c)},error:v.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,m.byId(this.id+"_"+a.id)&&p.empty(m.byId(this.id+"_"+a.id)),p.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},
p.create("td",{align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%"},m.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+k.toJson(b))},_buildLegendItems:function(a,b,c){var d=!1,e=m.byId(this.id+"_"+a.id),g=b.parentLayerId;if(b.subLayerIds)a=p.create("div",{id:this.id+"_"+a.id+"_"+b.id+"_group",style:{display:"none"},"class":-1==g?0<c?"esriLegendGroupLayer":"":this._legendAlign},-1==g?e:m.byId(this.id+
"_"+a.id+"_"+g+"_group")),p.create("td",{innerHTML:u.encode(b.name),align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(a.visibleLayers&&-1==(","+a.visibleLayers+",").indexOf(","+b.id+","))return d;c=p.create("div",{id:this.id+"_"+a.id+"_"+b.id,style:{display:"none"},"class":-1<g?this._legendAlign:""},-1==g?e:m.byId(this.id+"_"+a.id+"_"+g+"_group"));p.create("td",{innerHTML:u.encode(b.name)||"",align:this._align},p.create("tr",
{},p.create("tbody",{},p.create("table",{width:"95%","class":"esriLegendLayerLabel"},c))));a.legendResponse?d=d||this._buildLegendItems_Tools(a,b,c):a.renderer&&(d=d||this._buildLegendItems_Renderer(a,b,c))}return d},_buildLegendItems_Tools:function(a,b,c){var d=b.parentLayerId,e=this.map.getScale(),g=!1,f=function(a,b){var c,d;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(d=0;d<b.dynamicLayerInfos[d].length;d++){if(b.dynamicLayerInfos[d].mapLayerId==a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];
return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,b,e)){var k=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var n=this._getEffectiveScale(a,b);if(n.minScale&&n.minScale<e||n.maxScale&&n.maxScale>e)k=!1}if(k){var e=f(a.legendResponse.layers,b),l=e.legendType,q=e.legend;if(q){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,
e,b);c=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);var r=p.create("tbody",{},c);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(c,a,b);h.forEach(q,function(c){if(!(10.1<=a.version&&!c.values&&1<q.length&&(a._hideDefaultSymbol||"\x3call other values\x3e"===c.label||!c.label&&!("esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version))))if(c.url&&0===c.url.indexOf("http")||c.imageData&&0<c.imageData.length)g=!0,this._buildRow_Tools(c,
r,a,b.id,l)},this)}}}g&&(s.set(m.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<d&&(s.set(m.byId(this.id+"_"+a.id+"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,a,d)));return g},_sanitizeLegendResponse:function(a,b,c){var d=b.legend;if(10.1<=a.version&&1<d.length&&!b._sanitized){a=f.getObject("layerDefinition.drawingInfo.renderer",!1,c);var e,g;a||(a=f.getObject("drawingInfo.renderer",!1,c));h.some(d,function(a,b){a.values||(g=b,e=a);return!!e});a?"uniqueValue"===a.type?e&&(d.splice(g,
1),d.push(e)):"classBreaks"===a.type&&(e&&d.splice(g,1),d.reverse(),e&&d.push(e)):e&&(d.splice(g,1),d.push(e));b._sanitized=!0}},_buildRow_Tools:function(a,c,d,e,g){var f=p.create("tr",{},c),m;this.alignRight?(c=p.create("td",{align:this._isRightToLeft?"left":"right"},f),m=p.create("td",{align:this._isRightToLeft?"left":"right",width:35},f)):(m=p.create("td",{width:35,align:"center"},f),c=p.create("td",{},f));f=a.url;(!b("ie")||9<=b("ie")||9>b("ie")&&"esri.layers.ArcGISImageServiceLayer"===d.declaredClass)&&
a.imageData&&0<a.imageData.length?f="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(f=d.url+"/"+e+"/images/"+a.url,(e=d._getToken())&&(f+="?token\x3d"+e));e=p.create("img",{src:f,border:0,style:"opacity:"+d.opacity},m);a=p.create("td",{innerHTML:u.encode(a.label),align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%",dir:"ltr"},c))));g&&("Stretched"===g&&10.3<=d.version&&"esri.layers.ArcGISImageServiceLayer"===d.declaredClass)&&(a.style.verticalAlign=
"top",a.style.lineHeight="1",e.style.marginBottom="-1px",e.style.display="block",c.style.verticalAlign="top");9>b("ie")&&(e.style.filter="alpha(opacity\x3d"+100*d.opacity+")")},_getVariable:function(a,b,c){var d;a&&(d=(a=a.getVisualVariablesForType(b,c))&&a[0]);return d},_getFieldAlias:function(a,b){var c=b.infoTemplate,c=c&&c.getFieldInfo&&c.getFieldInfo(a),d=f.isFunction(a)?null:b.getField(a),e=c||d,g="";e&&(g=c&&c.label||d&&d.alias||e.name||e.fieldName);return g},_getDefaultHoverLabel:function(a,
b){var c;if(a){var d=this._getVariable(a,"colorInfo",!1),e=this._getVariable(a,"opacityInfo",!1),g=this._getVariable(a,"sizeInfo",!1),d=d||g||e,f,m,k,h,n;a instanceof O?f=a.field:a instanceof F&&!a.attributeField2&&!a.attributeField3?(f=a.attributeField,d&&(k=d.field,h=d.normalizationField)):a instanceof z?d?(f=d.field,m=d.normalizationField):(f=a.attributeField,m=a.normalizationField,n="percent-of-total"===a.normalizationType):a instanceof C&&d&&(f=d.field,m=d.normalizationField);(n=h&&"showOpNormField"||
k&&"showOpField"||m&&"showNormField"||(n?"showNormPct":null)||f&&"showField"||null)&&(c=B.substitute({field:f&&this._getFieldAlias(f,b),normField:m&&this._getFieldAlias(m,b),opField:k&&this._getFieldAlias(k,b),opNormField:h&&this._getFieldAlias(h,b)},this._i18n[n]))}return c},_buildLegendItems_Renderer:function(a,b,c){var d=b.parentLayerId,e=this.map,g=e.getScale(),k=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,b,g)){var n,l,q="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?
a.renderer.renderer:a.renderer,r,t,v,x,D,w;if(q instanceof A&&(q=(e="zoom"===q.rangeType?q.getRendererInfoByZoom(e.getZoom()):q.getRendererInfoByScale(g))&&e.renderer,!q))return!1;var e=this._getVariable(q,"colorInfo",!1),g=this._getVariable(q,"opacityInfo",!1),B=this._getVariable(q,"sizeInfo",!1),G=this._getDefaultHoverLabel(q,a);e?(r=this._getMedianColor(q,e),e.field&&(v=f.isFunction(e.field)?null:a.getField(e.field))):g&&(D=f.isFunction(g.field)?null:a.getField(g.field),w=g.normalizationField);
B&&B.field&&(x=f.isFunction(B.field)?null:a.getField(B.field));if(q instanceof O)k=!0,this._showHeatRamp(a,b,q,c,G);else if(q instanceof E)k=!0,this._showDotDensityLegend(a,b,q,c);else if(q instanceof H)k=!0,l=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),n=p.create("tbody",{},l),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(l,a,b),q.latestObservationRenderer&&q.latestObservationRenderer instanceof C&&this._buildRow_Renderer(a,q.latestObservationRenderer.symbol,
r,u.encode(q.latestObservationRenderer.label)||this.NLS_currentObservations,null,n),q.observationRenderer&&q.observationRenderer instanceof C&&this._buildRow_Renderer(a,q.observationRenderer.symbol,r,u.encode(q.observationRenderer.label)||this.NLS_previousObservations,null,n);else if(q instanceof F){if(q.infos&&0<q.infos.length){k=!0;l=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);n=p.create("tbody",{},l);(a._hoverLabel||a._hoverLabels||G)&&this._createHoverAction(l,
a,b,G);var y=[];h.forEach(q.infos,function(b){var c=null;a._editable&&a.types&&(c=this._getTemplateFromTypes(a.types,b.value));var d=b.label;null==d&&(d=b.value);-1===h.indexOf(y,d)&&(y.push(d),this._buildRow_Renderer(a,b.symbol,r,u.encode(d),c,n))},this)}}else if(q instanceof z){if(q.infos&&0<q.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass){k=!0;w=v||x||D;if(!w||!this._isSmartRenderer(q,w.name))l=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},
c),n=p.create("tbody",{},l),w=(q.normalizationField||"percent-of-total"===q.normalizationType)&&G?G:this._getFieldAlias(q.attributeField,a),this._buildRow_Renderer(a,null,r,u.encode(w),null,n);l=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);n=p.create("tbody",{},l);(a._hoverLabel||a._hoverLabels||G)&&this._createHoverAction(l,a,b,G);w=q.infos.slice(0).reverse();h.forEach(w,function(b){var c=b.label;null==c&&(c=(c=v||x||D)&&this._isSmartRenderer(q,c.name)?
q.normalizationField&&G?G:this._getFieldAlias(c.name,a):b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,r,u.encode(c),null,n)},this);if("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.renderer.style===K.STYLE_SCALAR||a.renderer.style===K.STYLE_SINGLE_ARROW))this._buildRow_Renderer(a,q.defaultSymbol,null,"",null,n),a._hideDefaultSymbol=!0}}else q instanceof C&&(k=!0,l=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),n=p.create("tbody",
{},l),(a._hoverLabel||a._hoverLabels||G)&&this._createHoverAction(l,a,b,G),t=null,a._editable&&(a.templates&&0<a.templates.length)&&(t=a.templates[0]),l=(v||D)&&x?null:v||D||x,this._buildRow_Renderer(a,q.symbol,r,u.encode(w&&G?G:l?this._getFieldAlias(l.name,a):q.label),t,n),t=q.symbol&&q.symbol.color,l&&(v=D=x=null));k&&(e&&e.field?(v&&this._isSmartRenderer(q,v.name)&&(v=null),this._showColorRamp(a,b,q,null,c,e,v,G)):g&&t&&this._showColorRamp(a,b,q,t,c,g,D,G),B&&B.field&&(x&&this._isSmartRenderer(q,
x.name)&&(x=null),this._showSizeLegend(a,b,q,B,r,c,x,G)));!a._hideDefaultSymbol&&q.defaultSymbol&&(k=!0,l=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),n=p.create("tbody",{},l),this._buildRow_Renderer(a,q.defaultSymbol,null,u.encode(q.defaultLabel)||"others",null,n))}k&&(s.set(m.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<d&&(s.set(m.byId(this.id+"_"+a.id+"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,d)));return k},_isSmartRenderer:function(a,
b){return a instanceof z&&a.infos&&1===a.infos.length&&a.attributeField===b},_showColorRamp:function(a,b,c,d,e,g,f,m){var k;k=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);e=p.create("tbody",{},k);(a._hoverLabel||a._hoverLabels||m)&&this._createHoverAction(k,a,b,m);f&&this._addSubHeader(e,this._getFieldAlias(f.name,a));b=this._getRampStops(c,g,d);b.length&&this._drawColorRamp(e,b,!0,a,this._getRampBorderColor(c))},_getMedianColor:function(a,b){var c,d;b.colors?
(c=b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c){var d,e,g,f,m=!1;b.colors||b.opacityValues?(e=b.maxDataValue-b.minDataValue,d=h.map([0,0.25,0.5,0.75,1],function(a){g=b.minDataValue+a*e;return Number(g.toFixed(6))}),this._checkPrecision(0,4,d)):b.stops&&(d=h.map(b.stops,function(a){return a.value}),(m=h.some(b.stops,function(a){return!!a.label}))&&(f=h.map(b.stops,function(a){return a.label})));
var k=d[0],p,l,q;e=d[d.length-1]-k;return h.map(d,function(g,h){c?(p=new n(c.toRgba()),l=a.getOpacity(g,{opacityInfo:b}),null!=l&&(p.a=l)):p=a.getColor(g,{colorInfo:b});q="";0===h?q=this._specialChars.lt+" ":h===d.length-1&&(q=this._specialChars.gt+" ");return{value:g,color:p,offset:1-(g-k)/e,label:m?f[h]:q+D.format(g)}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,e=c[a],g=c[d],f=c[b],m=Math.floor(e),k=Math.floor(g),h=Math.floor(f);m===e&&(h===f&&k!==g&&m!==k&&h!==k)&&(c[d]=k);
a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;if(a instanceof C)b=a.symbol;else if(a instanceof F||a instanceof z)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawColorRamp:function(a,c,d,e,g){var f=p.create("tr",{},a),m,k,l,r,t,v=c.length-1,x;r=0;this.alignRight?(a=p.create("td",{align:this._isRightToLeft?"left":"right"},f),m=p.create("td",{align:this._isRightToLeft?"left":"right",
width:this.gradientWidth},f)):(m=p.create("td",{width:this.gradientWidth,align:"center"},f),a=p.create("td",{},f));var D=g&&0<g.a&&!(240<=g.r&&240<=g.g&&240<=g.b);k=p.create("div",{"class":D?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},m);f=p.create("div",{"class":"esriLegendColorRamp"},k);m=s.get(f,"width");D&&(g=9>b("ie")?g.toHex():"rgba("+g.toRgba().join(",")+")",s.set(f,"border",this.colorRampBorder+" "+g));d?(g=this.gradientHeight*v,s.set(f,
"height",g+"px")):g=s.get(f,"height");s.set(k,"height",g+"px");f=q.createSurface(f,m,g);9>b("ie")&&(r=f.getEventSource(),s.set(r,"position","relative"),s.set(r.parentNode,"position","relative"),r=1);try{d&&h.forEach(c,function(a,b){a.offset=b/v}),t=f.createRect({x:-r,y:-r,width:m+r,height:g+r}),t.setFill({type:"linear",x1:0,y1:0,x2:0,y2:g,colors:c}).setStroke(null),f.createRect({width:m,height:g}).setFill(new n([255,255,255,1-e.opacity])).setStroke(null),this._surfaceItems.push(f)}catch(C){f.clear(),
f.destroy()}h.forEach(c,function(a,b){if(a.label){x="top:"+100*a.offset+"%;";var d="";0===b&&(d+=" esriLegendColorRampTickFirst");b===c.length-1&&(d+=" esriLegendColorRampTickLast");p.create("div",{"class":"esriLegendColorRampTick"+d,innerHTML:"\x26nbsp;",style:x},k)}});l=p.create("div",{"class":"esriLegendColorRampLabels",style:{height:g+this.gradientHeight+"px"}},a);d?h.forEach(c,function(a){p.create("div",{"class":"esriLegendColorRampLabel",innerHTML:u.encode(a.label)||"\x26nbsp;"},l)}):(p.create("div",
{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},l),p.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(g+this.gradientHeight-2*this.gradientHeight)+"px;"},l))},_showHeatRamp:function(a,b,c,d,e){var g,f=c.field;g=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);d=p.create("tbody",{},g);(a._hoverLabel||a._hoverLabels||e)&&this._createHoverAction(g,a,b,e);(f=f&&a.getField(f))&&this._addSubHeader(d,this._getFieldAlias(f.name,
a));b=this._getHeatmapStops(c);b.length&&this._drawColorRamp(d,b,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var c,d,e,g;if(b&&b[0])if(c=b.length-1,a=b[0]&&null!=b[0].ratio){if((a=b[c])&&1!==a.ratio)b=b.slice(0),b.push({ratio:1,color:a.color}),c++}else d=b[0].value,e=b[c].value-d,b=h.map(b,function(a){return{color:a.color,ratio:(a.value-d)/e}});else a&&a[0]&&(c=a.length-1,g=1/(a.length-1),b=h.map(a,function(a,b){return{color:a,ratio:b*g}}));b=h.map(b,function(a,b){var d="";0===
b?d="Low":b===c&&(d="High");return{color:a.color,label:d,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,b,c,d){var e=c.legendOptions,g,m,k,n,l,q,r,s=this.dotDensitySwatchSize,t=Math.round(s/2);e&&(m=e.backgroundColor,k=e.outline,n=e.valueUnit,l=e.dotCoverage);l=(l||this.dotCoverage)/100;r=Math.round(s*s/Math.pow(c.dotSize,2)*l);d=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);q=p.create("tbody",{},d);(a._hoverLabel||a._hoverLabels)&&
this._createHoverAction(d,a,b);this._addSubHeader(q,B.substitute({value:c.dotValue,unit:n||""},this.NLS_dotValue));h.forEach(c.fields,function(b){b=f.mixin({},b);b.numPoints=r;g=new G(c._generateImageSrc(s,s,[b],{x:0,y:0},{x:s,y:s},m),k||c.outline,s,s);b=a.getField(b.name)||b;this._buildRow_Renderer(a,g,null,u.encode(this._getFieldAlias(b.name,a)),null,q,{type:"path",path:"M "+-t+","+-t+" L "+t+","+-t+" L "+t+","+t+" L "+-t+","+t+" L "+-t+","+-t+" E"})},this)},_showSizeLegend:function(a,b,c,d,e,g,
f,m){var k=d.legendOptions,k=k&&k.customValues,n,l,q=this._getSizeSymbol(c,e);"unknown"!==d.valueUnit||(!q||!k&&(null==d.minSize||null==d.maxSize))||(e=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),n=p.create("tbody",{},e),(a._hoverLabel||a._hoverLabels||m)&&this._createHoverAction(e,a,b,m),f&&this._addSubHeader(n,this._getFieldAlias(f.name,a)),l=k||this._getDataValues(c,q,d),l.reverse(),h.forEach(l,function(b,e){q=J.fromJson(q.toJson());this._applySize(q,
c,d,b);b=D.format(b);var g="";0===e?g=this._specialChars.gt+" ":e===l.length-1&&(g=this._specialChars.lt+" ");g="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+u.encode(g+b)+"\x3c/span\x3e";this._buildRow_Renderer(a,q,null,g,null,n)},this))},_getSizeSymbol:function(a,b){var c;if(a instanceof C)c=a.symbol;else if(a instanceof K)c=a.defaultSymbol;else if(a instanceof F||a instanceof z)c=a.infos[0].symbol;if(c=-1!==c.type.indexOf("fillsymbol")?null:c)c=J.fromJson(c.toJson()),b&&c.setColor(new n(b.toRgba()));
return c},_getDataValues:function(a,b,c,d,e){d=null==d?5:d;e=null==e?20:e;var g=a.getSizeRangeAtScale(c,this.map.getScale());d=this._interpolateSizeRange(g,d);var f=h.map(d,function(a){return this._getDataValueFromSize(a,c,g)},this),m,k,f=D.round(f);for(m=1;m<f.length-1;m++)if(k=this._roundDataValue(a,b,c,f[m],f[m-1],e))f[m]=k[0],d[m]=k[1];return f},_interpolateSizeRange:function(a,b){var c=a.minSize,d=(a.maxSize-c)/(b-1),e,g=[];for(e=0;e<b;e++)g.push(c+d*e);return g},_getDataValueFromSize:function(a,
b,c){var d=c.minSize;c=c.maxSize;var e=b.minDataValue;b=b.maxDataValue;return a=a<=d?e:a>=c?b:(a-d)/(c-d)*(b-e)+e},_roundDataValue:function(a,b,c,d,e,g){var f=this._getSize(b,a,c,d);e=this._getSize(b,a,c,e);var m,k=D.getDigits(d),h=k.integer,k=k.fractional,n,p,l,q,r,s,t,v,u,x,C;0<d&&1>d&&(m=Math.pow(10,k),d*=m,h=D.getDigits(d).integer);for(h-=1;0<=h&&!(n=Math.pow(10,h),k=Math.floor(d/n)*n,n*=Math.ceil(d/n),null!=m&&(k/=m,n/=m),p=(k+n)/2,p=D.round([k,p,n],{indexes:[1]})[1],l=this._getSize(b,a,c,k),
q=this._getSize(b,a,c,n),r=this._getSize(b,a,c,p),s=D.getPctChange(f,l,e,null),t=D.getPctChange(f,q,e,null),v=D.getPctChange(f,r,e,null),u=s.prev<=g,x=t.prev<=g,u&&x&&(s.prev<=t.prev?(u=!0,x=!1):(x=!0,u=!1)),u?C=[k,l]:x?C=[n,q]:v.prev<=g&&(C=[p,r]),C);h--);return C},_applySize:function(a,b,c,d){var e=a.type;b=this._getSize(a,b,c,d);switch(e){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":e=a.width;c=a.height;a.setHeight(b);a.setWidth(b*(e/c));break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);
break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,d){return b.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,b,c,d,e,g,f){var m=p.create("tr",{},g),k;this.alignRight?(g=p.create("td",{align:this._isRightToLeft?"left":"right"},m),b&&(k=p.create("td",{align:this._isRightToLeft?"left":"right",width:35},m))):(b&&(k=p.create("td",{width:35,align:"center"},m)),g=p.create("td",{},m));var h=
m=30;if(b){if("simplemarkersymbol"==b.type)m=Math.min(Math.max(m,b.size+12),125),h=Math.min(Math.max(h,b.size+12),125);else if("picturemarkersymbol"==b.type)m=Math.min(Math.max(m,b.width),125),h=Math.min(b.height||h,125);else if("textsymbol"==b.type){var n,l;b.text||(n=b.text,l=!0,b.setText(this.defaultText));m=Math.min(Math.max(m,b.getWidth()+12),125);h=Math.min(Math.max(h,b.getHeight()+12),125);l&&b.setText(n)}var q=p.create("div",{style:"width:"+m+"px;height:"+h+"px;"},k)}B.isDefined(d)&&"number"===
typeof d&&(d=""+d);p.create("td",{innerHTML:d||"",align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%"},g))));b&&(a=this._drawSymbol(q,b,c,m,h,e,a,f),this._surfaceItems.push(a))},_addSubHeader:function(a,b){var c=p.create("tr",{},a),c=p.create("td",{align:this._align,colspan:2},c);p.create("td",{innerHTML:u.encode(b)||"",align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%"},c))))},_drawSymbol:function(a,c,d,e,g,m,k,h){c=J.fromJson(c.toJson());
var p=k.opacity;d&&c.setColor(new n(d.toRgba()));if("simplelinesymbol"===c.type||"cartographiclinesymbol"===c.type||"textsymbol"===c.type){if(!c.color)return;d=c.color.toRgba();d[3]*=p;c.color.setColor(d)}else"simplemarkersymbol"===c.type||"simplefillsymbol"===c.type?(c.color&&(d=c.color.toRgba(),d[3]*=p,c.color.setColor(d)),c.outline&&c.outline.color&&(d=c.outline.color.toRgba(),d[3]*=p,c.outline.color.setColor(d))):"picturemarkersymbol"===c.type&&(a.style.opacity=p,a.style.filter="alpha(opacity\x3d("+
100*p+"))");a=q.createSurface(a,e,g);9>b("ie")&&(d=a.getEventSource(),s.set(d,"position","relative"),s.set(d.parentNode,"position","relative"));m=this._getDrawingToolShape(c,m)||J.getShapeDescriptors(c);var l,p=(d=m.defaultShape)&&"text"===d.type;try{p&&!d.text&&(d.text=this.defaultText),l=a.createShape(h||d).setFill(m.fill).setStroke(m.stroke),p&&l.setFont(m.font)}catch(r){a.clear();a.destroy();return}var v=l.getBoundingBox();h=v.width;m=v.height;var p=-(v.x+h/2),u=-(v.y+m/2);d=a.getDimensions();
p={dx:p+d.width/2,dy:u+d.height/2};if("simplemarkersymbol"===c.type&&"path"===c.style)e=k._getScaleMatrix(v,c.size),l.applyTransform(t.scaleAt(e.xx,e.yy,{x:d.width/2,y:d.height/2}));else if(h>e||m>g)k=h/e>m/g,e=((k?e:g)-5)/(k?h:m),f.mixin(p,{xx:e,yy:e});l.applyTransform(p);return a},_getDrawingToolShape:function(a,b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolTriangle":c=
{type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){h.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},
_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&f.isArray(a.children)&&h.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,c,e){if(e=b._hoverLabel||b._hoverLabels&&b._hoverLabels[c.id]||e)e=u.encode(e),b.mouseMoveHandler=b.mouseMoveHandler||{},b.mouseMoveHandler[c.id]=d.connect(a,"onmousemove",f.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&
(this.hoverLabelShowing=!1,s.set(m.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(f.hitch(this,function(a,b,c){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,m.byId(this.id+"_hoverLabel")){var d=m.byId(this.id+"_hoverLabel");d.innerHTML="\x3cspan\x3e"+c+"\x3c/span\x3e";s.set(d,"top",b+"px");s.set(d,"left",a+15+"px");s.set(d,"display","")}else p.create("div",{innerHTML:"\x3cspan\x3e"+c+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",
style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},e)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[c.id]=d.connect(a,"onmouseout",f.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,s.set(m.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;h.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)d.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)d.disconnect(b.mouseOutHandler[a])})},
_createDynamicLayers:function(a){var b=[],c;h.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[d.id]&&(e=a.layerDefinitions[d.id]);e&&(c.definitionExpression=e);var g;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(g=a.layerDrawingOptions[d.id]);g&&(c.drawingInfo=g.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<
a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,e=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<e.length;d++)if(c==e[d].id){-1<e[d].parentLayerId&&(s.set(m.byId(this.id+"_"+a+"_"+e[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,e[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,d){var e=a.layer.dynamicLayerInfos||a.layer.layerInfos,g,f;for(g=0;g<e.length;g++)if(e[g].id===
c&&e[g].subLayerIds)for(f=0;f<e[g].subLayerIds.length;f++){var m=e[g].subLayerIds[f];-1===h.indexOf(d,m)&&(d.push(m),b(m,d))}}a.layer.layerInfos&&h.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,e=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var g=a.legendResponse.layers[d];if(b.id==g.layerId){var f,m;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?
(0==g.minScale&&a.tileInfo&&(f=a.tileInfo.lods[0].scale),0==g.maxScale&&a.tileInfo&&(m=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(f=Math.min(a.minScale,g.minScale)||a.minScale||g.minScale,m=Math.max(a.maxScale,g.maxScale));if(0<f&&f<c||m>c)e=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)e=!1;return e},_getServiceTitle:function(a){var b=a._titleForLegend;b||((b=a.url)?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),
b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+
a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],B.isDefined(a)&&(b+=" ("+a+")"));return u.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(B.isDefined(b.parentLayerId)){var e=a.layerInfos,g=b.parentLayerId,f;for(f=e.length-1;0<=f;f--)if(e[f].id==g)if(0==c&&0<e[f].minScale?c=e[f].minScale:0<c&&0==e[f].minScale||0<c&&0<e[f].minScale&&(c=Math.min(c,e[f].minScale)),d=Math.max(d||0,e[f].maxScale||0),-1<e[f].parentLayerId)g=e[f].parentLayerId;
else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===
a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1}});f.mixin(M,{ALIGN_LEFT:0,ALIGN_RIGHT:1});return M})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(l,e,f,h){var d=function(d,b){return d-b},k={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(d){var b=String(d),c=b.match(k._reNumber);d={integer:0,fractional:0};c&&c[1]?(d.integer=c[1].split("").length,d.fractional=c[3]?
c[3].split("").length:0):-1<b.toLowerCase().indexOf("e")&&(c=b.split("e"),b=c[0],c=c[1],b&&c&&(b=Number(b),c=Number(c),(d=0<c)||(c=Math.abs(c)),b=k.getDigits(b),d?(b.integer+=c,b.fractional=c>b.fractional?0:b.fractional-c):(b.fractional+=c,b.integer=c>b.integer?1:b.integer-c),d=b));return d},getFixedNumbers:function(d,b){var c,a;c=Number(d.toFixed(b));a=c<d?c+1/Math.pow(10,b):c-1/Math.pow(10,b);return[c,a]},getPctChange:function(d,b,c,a){var e={prev:null,next:null},f;null!=c&&(f=d-c,c=b-c-f,e.prev=
Math.floor(Math.abs(100*c/f)));null!=a&&(f=a-d,c=a-b-f,e.next=Math.floor(Math.abs(100*c/f)));return e},round:function(e,b){var c=e.slice(0),a,g,f,h,l,r,q,t,u,w=!b||null==b.tolerance?2:b.tolerance,v=b&&b.indexes;if(v)v.sort(d);else{v=[];for(r=0;r<c.length;r++)v.push(r)}for(r=0;r<v.length;r++)if(u=v[r],a=c[u],g=0===u?null:c[u-1],f=u===c.length-1?null:c[u+1],h=k.getDigits(a),h=h.fractional){q=0;for(t=!1;q<=h&&!t;)l=k.getFixedNumbers(a,q),l=l[0],t=k.hasMinimalChange(a,l,g,f,w),q++;t&&(c[u]=l)}return c},
hasMinimalChange:function(d,b,c,a,e){d=k.getPctChange(d,b,c,a);b=null==d.prev||d.prev<=e;c=null==d.next||d.next<=e;return b&&c||d.prev+d.next<=2*e},_reAllZeros:RegExp("\\"+f.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(d,b){b=b||{places:20,round:-1};var c=e.format(d,b);c&&(c=c.replace(k._reSomeZeros,"$1").replace(k._reAllZeros,""));return c}};return k})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define(["dojo/_base/declare","dojo/_base/array","esri/graphicsUtils","./LayerInfo",
"./LayerInfoFactory"],function(l,e,f,h,d){return l(h,{constructor:function(){},getExtent:function(){var d=this.layerObject.items;if(0===d.length)return null;d=f.graphicsExtent(d);return this._convertGeometryToMapSpatialRef(d)},initVisible:function(){var d=!1,e;if(this.newSubLayers.length)for(e=0;e<this.newSubLayers.length;e++)d=d||this.newSubLayers[e].layerObject.visible;else d=!1;this._visible=d},_setTopLayerVisible:function(d){this._visible=d?!0:!1;e.forEach(this.newSubLayers,function(d){d.setLayerVisiblefromTopLayer()},
this)},obtainNewSubLayers:function(){var f=[],h=this.layerObject.getFeatureLayers();e.forEach(h,function(b){b=d.getInstance().create({layerObject:b,title:b.label||b.title||b.name||b.id||" ",id:b.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});f.push(b);b.init()},this);return f},_obtainLayerIndexesInMap:function(){var d=[],e,b;for(b=0;b<this.newSubLayers.length;b++)(e=this._getLayerIndexesInMapByLayerId(this.newSubLayers[b].layerObject.id))&&d.push(e);return d},moveLeftOfIndex:function(d){var e;
for(e=this.newSubLayers.length-1;0<=e;e--)this.map.reorderLayer(this.newSubLayers[e].layerObject,d)},moveRightOfIndex:function(d){var e;for(e=0;e<this.newSubLayers.length;e++)this.map.reorderLayer(this.newSubLayers[e].layerObject,d)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS ./LayerInfoFactory esri/layers/FeatureLayer".split(" "),function(l,e,f,h,d,
k,n,b,c,a){return l(n,{constructor:function(a,b){this.layerObject=a.layerObject},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.extent)},initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(a){a?this.layerObject.setVisibility(!0):this.layerObject.setVisibility(!1);this._visible=a;e.forEach(this.newSubLayers,function(a){a.setLayerVisiblefromTopLayer()},this)},obtainNewSubLayers:function(){var a=[];e.forEach(this.layerObject.layerInfos,
function(b){b=c.getInstance().create({layerObject:this.layerObject,title:b.label||b.title||b.name||" ",id:b.name||" ",wms:{layerInfo:this,subId:b.name,wmsLayerInfo:b},selfType:"wms",parentLayerInfo:this});a.push(b);b.init()},this);return a}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),function(l,e,f,h,d,k,n){return l(n,{constructor:function(b,c){this.layerObject=
b.layerObject},getExtent:function(){},initVisible:function(){var b=[],b=!1,b=f.clone(this.originOperLayer.layerObject.visibleLayers);this._visible=b=0<=e.indexOf(b,this.originOperLayer.id)?!0:!1},_setTopLayerVisible:function(b){this.originOperLayer.layerObject.visible?b?(this._show(),this._visible=!0):(this._hide(),this._visible=!1):b?(this._hide(),this._visible=!0):(this._hide(),this._visible=!1)},_show:function(){var b=[],b=f.clone(this.originOperLayer.layerObject.visibleLayers);0>e.indexOf(b,this.id)&&
(b.push(this.id),this.originOperLayer.layerObject.setVisibleLayers(b))},_hide:function(){var b=[],c,b=f.clone(this.originOperLayer.layerObject.visibleLayers);c=e.indexOf(b,this.id);0<=c&&b.splice(c,1);this.originOperLayer.layerObject.setVisibleLayers(b)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.layerObject.visible?this._visible&&this._show():this._hide()},drawLegends:function(b){this._initLegendsNode(b)},_initLegendsNode:function(b){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var c=
d.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});k(c,"load",function(){d.empty(b);var a=d.create("div",{"class":"legend-div"},b);h.place(c,a)})}else d.empty(b)},obtainNewSubLayers:function(){return[]},getOpacity:function(){},setOpacity:function(b){}})})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo ./LayerInfoFactory".split(" "),function(l,e,f,h,d,k,
n){return l(k,{constructor:function(b,c,a){this.noLegend=a},getExtent:function(){},initVisible:function(){var b=!1,c=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<c.layerInfo.subLayerVisible[c.subId]&&(b=!0);this._visible=b},_setTopLayerVisible:function(b){var c;this.originOperLayer.mapService&&(c=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length&&(b?c.layerInfo.subLayerVisible[c.subId]++:c.layerInfo.subLayerVisible[c.subId]--,this._visible=b,this.traversal(function(a){0===
a.getSubLayers().length&&a.visbleOrInvisilbe()})))},setLayerVisiblefromTopLayer:function(){},obtainNewSubLayers:function(){var b=[];e.forEach(this.originOperLayer.subLayers,function(c){c.parentLayerInfo=this;c=n.getInstance().create(c);b.push(c);c.init()},this);return b},getOpacity:function(){},setOpacity:function(b){},getLayerObject:function(){var b=new h;this.layerObject.empty?d({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(f.hitch(this,
function(c){var a=this.layerObject.url;this.layerObject=c;this.layerObject.url=a;b.resolve(this.layerObject)}),function(c){b.reject(c)}):b.resolve(this.layerObject);return b},getLayerType:function(){var b=new h;b.resolve("GroupLayer");return b}})})},"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(l,e){return l(e,{constructor:function(e,h){},initVisible:function(){var e=!1,h=this.originOperLayer.mapService;this.originOperLayer.mapService&&
0<h.layerInfo.subLayerVisible[h.subId]&&(e=!0);this._visible=e},_setTopLayerVisible:function(e){var h;this.originOperLayer.mapService&&(h=this.originOperLayer.mapService,e?h.layerInfo.subLayerVisible[h.subId]++:h.layerInfo.subLayerVisible[h.subId]--,this._visible=e,this.visbleOrInvisilbe())},visbleOrInvisilbe:function(){var e=this.originOperLayer.mapService;e.layerInfo.setSubLayerVisible(e.subId,this.isVisbleOrInvisilbe())},isVisbleOrInvisilbe:function(){for(var e=this.originOperLayer.mapService,
h=-1,d=e.subId,k=0,n=e.layerInfo.layerObject.layerInfos;;){h++;k+=e.layerInfo.subLayerVisible[d];if(-1===n[d].parentLayerId)return k>h?!0:!1;d=n[d].parentLayerId}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/dom-construct ./LayerInfoForDefault esri/layers/FeatureLayer esri/layers/RasterLayer".split(" "),function(l,e,f,h,d,k,n,b){return l(k,{_legendsNode:null,_loadLegends:function(b){var a=new h;this.originOperLayer.mapService.layerInfo.getLegendInfo(b).then(f.hitch(this,
function(b){a.resolve(b)}));return a},drawLegends:function(b,a){this._loadLegends(a).then(f.hitch(this,function(a){this._initLegendsNode(a,b)}))},_initLegendsNode:function(b,a){var g=this.originOperLayer.mapService;if(b){d.empty(a);for(var f=null,k=0;k<b.length;k++)if(b[k].layerId===g.subId){f=b[k];break}if(f){var h=d.create("table",{"class":"legend-table",style:"font-size: 12px"},a);e.forEach(f.legend,function(a){if("\x3call other values\x3e"!==a.label){var b=d.create("tr",{"class":"legend-tr",style:"border: 1px solid"},
h),c=d.create("td",{"class":"legend-symbol-td",style:""},b),e=null,e=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;d.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",src:e},c);d.create("td",{"class":"legend-label-td",innerHTML:a.label||" ",style:"padding-left: 5px"},b)}},this)}}},_initControlPopup:function(){var b=this.originOperLayer.mapService.layerInfo.layerObject,a=this.originOperLayer.mapService.subId;this.controlPopupInfo=
{enablePopup:b.infoTemplates&&b.infoTemplates[a]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var b=this.originOperLayer.mapService.layerInfo.layerObject,a=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&b.infoTemplates&&delete b.infoTemplates[a]},getLayerObject:function(){var c=new h;this.layerObject.empty?this.getLayerType().then(f.hitch(this,function(a){this.layerObject="RasterLayer"===a?new b(this.layerObject.url):new n(this.layerObject.url);this.layerObject.on("load",
f.hitch(this,function(){c.resolve(this.layerObject)}));this.layerObject.on("error",f.hitch(this,function(){c.resolve(null)}))}),f.hitch(this,function(){c.resolve(null)})):this.layerObject.loaded?c.resolve(this.layerObject):(this.layerObject.on("load",f.hitch(this,function(){c.resolve(this.layerObject)})),this.layerObject.on("error",f.hitch(this,function(){c.resolve(null)})));return c},getPopupInfo:function(){var b=null,a=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(a)for(var d=
0;d<a.length;d++)if(a[d].id===this.originOperLayer.mapService.subId){b=a[d].popupInfo;break}return b},getFilterOfWebmap:function(){var b=null,a=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(a)for(var d=0;d<a.length;d++)if(a[d].id===this.originOperLayer.mapService.subId){b=a[d].layerDefinition?a[d].layerDefinition.definitionExpression:null;break}return b},getLayerType:function(){var b=new h,a=this.originOperLayer.mapService;a.layerInfo._getSublayerDefinition(a.subId).then(f.hitch(this,
function(a){a?b.resolve(a.type.replace(/\ /g,"")):b.resolve(null)}),function(){b.resolve(null)});return b},getSupportTableInfo:function(){var b=new h,a={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(f.hitch(this,function(d){a.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(a.isSupportedLayer=!0);d=this.originOperLayer.mapService;d.layerInfo._getSublayerDefinition(d.subId).then(f.hitch(this,function(d){d&&0<=d.capabilities.indexOf("Data")&&(a.isSupportQuery=
!0);b.resolve(a)}),function(){b.resolve(a)})}),function(){b.resolve(a)});return b},enablePopup:function(){var b=this.originOperLayer.mapService.layerInfo,a=b.layerObject,d=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!0;b.controlPopupInfo.infoTemplates&&(a.infoTemplates||(a.infoTemplates={}),a.infoTemplates[d]=b.controlPopupInfo.infoTemplates[d])},disablePopup:function(){var b=this.originOperLayer.mapService.layerInfo.layerObject,a=this.originOperLayer.mapService.subId;
this.controlPopupInfo.enablePopup=!1;b.infoTemplates&&delete b.infoTemplates[a]},loadInfoTemplate:function(){var b=new h,a=this.originOperLayer.mapService.layerInfo,d=this.originOperLayer.mapService.subId;a.controlPopupInfo.infoTemplates&&a.controlPopupInfo.infoTemplates[d]?b.resolve(a.controlPopupInfo.infoTemplates[d]):(a.controlPopupInfo.infoTemplates||(a.controlPopupInfo.infoTemplates={}),a._getSublayerDefinition(d).then(f.hitch(this,function(e){e=this._getDefaultPopupTemplate(e);a.controlPopupInfo.infoTemplates[d]=
{infoTemplate:e,layerUrl:null};b.resolve(e)}),f.hitch(this,function(){b.resolve(null)})));return b},getInfoTemplate:function(){var b=this.originOperLayer.mapService.layerInfo,a=this.originOperLayer.mapService.subId;return b.controlPopupInfo.infoTemplates&&b.controlPopupInfo.infoTemplates[a]&&b.controlPopupInfo.infoTemplates[a].infoTemplate?b.controlPopupInfo.infoTemplates[a].infoTemplate:null}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../lang ../domUtils ./layer ./ImageServiceLayerMixin ../SpatialReference ../geometry/Point".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s){return l([g,m],{declaredClass:"esri.layers.RasterLayer",managedSuspension:!0,constructor:function(a,b){this.drawMode=b&&void 0!==b.drawMode?b.drawMode:!0;this.drawType=b&&b.drawType?b.drawType:"2d";this._initialize(a,b);(null===this.format||void 0===this.format)&&this.setImageFormat("LERC",!0)},opacity:1,setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){if(this.opacity!=a)this.onOpacityChange(this.opacity=a)},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||
10>d("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();this._displayTimer=this._displayTimer||setTimeout(e.hitch(this,function(){this._extentChangeHandler(this._map.extent,
null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},_setMap:function(a,b){this.inherited(arguments);var d=this._canvas=k.create("canvas",{id:"canvas",width:a.width+"px",height:a.height+"px",style:"position: absolute; left: 0px; top: 0px;"},b);c.isDefined(this.opacity)&&n.set(d,"opacity",this.opacity);(this._context=d.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");
this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(f.connect(a,"onPan",this,this._panHandler));this._connects.push(f.connect(a,"onPanEnd",this,this._panEndHandler));this._connects.push(f.connect(a,"onZoom",this,this._onZoomHandler));this._connects.push(f.connect(a,"onZoomEnd",this,this._onZoomEndHandler));this._connects.push(f.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(f.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(f.connect(this,
"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(f.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};this.evaluateSuspension();if(this.suspended&&!a.loaded)var e=f.connect(a,"onLoad",this,function(){f.disconnect(e);e=null;this.evaluateSuspension()});return d},_unsetMap:function(a,b){h.forEach(this._connects,f.disconnect,this);this._canvas&&b.removeChild(this._canvas);this._map=this._canvas=this._context=
this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return this._map&&this._canvas&&this._context?!0:!1},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){n.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};if(this._canDraw&&this.drawMode)if(this._useBrowserDecoding())this._fireUpdateEnd();
else if(this.drawMode)if(!this.pixelData||!this.pixelData.pixelBlock)this.clear();else{var a=this.pixelData.pixelBlock,b=this._context,c=b.createImageData(a.width,a.height);c.data.set(a.getAsRGBA());b.putImageData(c,0,0);this._fireUpdateEnd()}},_panHandler:function(a,b){n.set(this._canvas,{left:this._startRect.left+b.x+"px",top:this._startRect.top+b.y+"px"})},_panEndHandler:function(a,b){b&&(this._startRect.left+=b.x,this._startRect.top+=b.y)},_onZoomHandler:function(a,b,c){var d=this._startRect;
a=d.width*b;b*=d.height;var e=d.left-(a-d.width)*(c.x-d.left)/d.width;c=d.top-(b-d.height)*(c.y-d.top)/d.height;n.set(this._canvas,{left:e+"px",top:c+"px",width:a+"px",height:b+"px"});this._endRect={left:e,top:c,width:a,height:b}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,b,c){n.set(this._canvas,{width:b+"px",height:c+"px"});this._startRect.width=this._canvas.width=b;this._startRect.height=this._canvas.height=c},_extentChangeHandler:function(a,
b,c,d){this.suspended||(this._fireUpdateStart(),a=this._map,this._requestData(a.extent,a.width,a.height))},_visibilityChangeHandler:function(b){b?a.show(this._canvas):a.hide(this._canvas)},_opacityChangeHandler:function(a){n.set(this._canvas,"opacity",a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w,v,x,B,D,C,F,z,A,E,H,K){return l(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(a,b){this.useMapTime=b&&b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0},_initialize:function(a,b){this._url=r.urlToObject(a);this.raster=new B(a);this.infoTemplate=b&&b.infoTemplate;var c=b&&b.imageServiceParameters;this.format=c&&c.format;this.compressionTolerance=c&&c.compressionTolerance?
c.compressionTolerance:0.01;this.interpolation=c?c.interpolation:null;this.compressionQuality=c?c.compressionQuality:null;this.bandIds=c?c.bandIds:null;this.mosaicRule=c?c.mosaicRule:null;this.renderingRule=c?c.renderingRule:null;this.useMapDimensionValue=b&&b.hasOwnProperty("useMapDimensionValue")?!!b.useMapDimensionValue:!0;this.activeMapDimensions=b&&b.activeMapDimensions;this._params=e.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,
bandIds:this.bandIds?this.bandIds.join(","):null},c?c.toJson():{});this.pixelFilter=b&&b.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=e.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=e.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=e.hitch(this,this._initLayer);this._queryVisibleRastersHandler=e.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=
[];this._rasterAttributeTableFeatures=[];this._loadCallback=b&&b.loadCallback;(c=b&&b.resourceInfo)?this._initLayer(c):p({url:this._url.path,content:e.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,b){if(!(null===a||void 0===a)){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var c=this.minScale,d=this.maxScale;e.mixin(this,
a);this.minScale=c;this.maxScale=d;this.initialExtent=this.fullExtent=this.extent=new q(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var g=this.minValues,f=this.maxValues,k=this.meanValues,h=this.stdvValues,n=this.bands=[],c=0,d=this.bandCount;c<d;c++)n[c]={min:g[c],max:f[c],mean:k[c],stddev:h[c]};this.timeInfo=(c=this.timeInfo)&&c.timeExtent?new z(c):null;d=this.fields=[];if(g=a.fields)for(c=
0;c<g.length;c++)d.push(new A(g[c]));this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);m.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);m.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);c={};a.defaultMosaicMethod?(c.method=a.defaultMosaicMethod,c.operation=a.mosaicOperator,c.sortField=a.sortField,c.sortValue=a.sortValue):c.method=w.METHOD_NONE;this.defaultMosaicRule=new w(c);this.defaultMosaicRule.ascending=
!0;this._setDefaultRenderingRule(!0);this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(e.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=e.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=e.clone(a.fields))}));this._isVectorData()&&
!m.isDefined(this.pixelFilter)&&(this.vectorFieldPixelFilter=new C,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===this.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(e.hitch(this,this._setFlowRepresentation)));this.loaded=!0;this.onLoad(this);if(c=this._loadCallback)delete this._loadCallback,c(this)}},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new f(s._dfdCanceller);10<this.version?
(b._pendingDfd=p({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=k.isDebug,b.errback(a));return b},getRasterAttributeTable:function(){var a=this._url.path+"/rasterAttributeTable",b=new f(s._dfdCanceller);10<this.version&&this.hasRasterAttributeTable?(b._pendingDfd=p({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},
function(a){b.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=k.isDebug,b.errback(a));return b},_getRasterAttributeTableFeatures:function(){var a=new f;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(e.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=
e.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},getCustomRasterFields:function(a){var b=a?a.rasterAttributeTableFieldPrefix:"",c={name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};a=this.fields?e.clone(this.fields):[];var d=a.length;a[d]={name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||
this.fields&&0<this.fields.length)a[d+1]=c;if(m.isDefined(this.pixelFilter)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType))a[d+2]={name:"Raster.Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},a[d+3]={name:"Raster.Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"};this._rasterAttributeTableFields&&0<this._rasterAttributeTableFields.length&&(c=h.filter(this._rasterAttributeTableFields,
function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),c=h.map(c,function(a){var c=e.clone(a);c.name=b+a.name;return c}),a=a.concat(c));return a},_prepareGetImageParameters:function(a,b,c,g){g=m.isDefined(g)?g:this._params;var f=a.spatialReference.wkid||d.toJson(a.spatialReference.toJson(!1));delete g._ts;e.mixin(g,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:f,bboxSR:f,size:b+","+c},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete g.compressionTolerance;
g.format&&"LERC"===g.format.toUpperCase()&&(g.compressionTolerance=this.compressionTolerance);g.token=this._getToken()},getImageUrl:function(a,b,d,f,k){k=m.isDefined(k)?k:this._params;this._prepareGetImageParameters(a,b,d,k);a=e.clone(k);this._cleanupRequestParams(a);b=this._url.path+"/exportImage?";d=r.addProxy(b+c.objectToQuery(e.mixin(a,{f:"image"})));var h=a.token;d.length>g.defaults.io.postLength||this.useMapImage?this._jsonRequest=p({url:b,content:e.mixin(a,{f:"json"}),callbackParamName:"callback",
load:function(a,b){var c=a.href;h&&(c+=-1===c.indexOf("?")?"?token\x3d"+h:"\x26token\x3d"+h);f(r.addProxy(c))},error:this._errorHandler}):f(d)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setCompressionTolerance:function(a,b){this.compressionTolerance=a;b||this.refresh(!0)},
setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=d.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},
setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?d.toJson(a.toJson()):null;if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=
w.METHOD_NONE);c.where=a;c=new w(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a},getPixelData:function(a){return a?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},
queryVisibleRasters:function(a,b,c,d){var e=this._map,g=s._fixDfd(new f(s._dfdCanceller));this._visibleRasters=[];var m,k,h=!0,n;if(this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&0<this.infoTemplate.info.fieldInfos.length){h=!1;n=this.infoTemplate.info;for(m=0;m<n.fieldInfos.length;m++)if((k=n.fieldInfos[m])&&"raster.servicepixelvalue"!==k.fieldName.toLowerCase()&&(k.visible||n.title&&-1<n.title.toLowerCase().indexOf(k.fieldName.toLowerCase()))){h=!0;break}}m=new K;
m.geometry=a.geometry;m.returnGeometry=this._map.spatialReference.equals(this.spatialReference);m.returnCatalogItems=h;m.timeExtent=a.timeExtent;m.mosaicRule=this.mosaicRule?this.mosaicRule:null;m.renderingRule=this.renderingRule?this.renderingRule:null;e&&(a=new t((e.extent.xmax-e.extent.xmin)/(2*e.width),(e.extent.ymax-e.extent.ymin)/(2*e.height),e.extent.spatialReference),m.pixelSize=a);var p=this;a=new H(this.url);(g._pendingDfd=a.execute(m)).addCallbacks(function(a){p._queryVisibleRastersHandler(a,
b,c,d,g)},function(a){p._resolve([a],null,d,g,!0)});return g},_queryVisibleRastersHandler:function(a,b,c,g,f){function k(){var a=this.getCustomRasterFields(b),d=this._getDomainFields(a),g=b?b.returnDomainValues:!1,p=b&&b.rasterAttributeTableFieldPrefix,s,t,v,u,x,C,w,B,A;this._getRasterAttributeTableFeatures().then(e.hitch(this,function(a){for(s=0;s<r.length;s++){F=r[s];F.setInfoTemplate(this.infoTemplate);F._layer=this;if(n){t=n;l&&l.length>=s&&(v=l[s],t=v.replace(/ /gi,", "));F.attributes["Raster.ItemPixelValue"]=
t;F.attributes["Raster.ServicePixelValue"]=n;if(this.pixelFilter){A=t.replace(" ","").split(",");var b=new D({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});h.forEach(A,function(a){b.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:b,extent:new q(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)F.attributes["Raster.Magnitude"]=
b.pixels[0][0],F.attributes["Raster.Direction"]=b.pixels[1][0]}if(a&&0<a.length&&(u=h.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==t:a.attributes.VALUE==t}),0<u.length&&(x=e.clone(u[0]),p&&x))){B={};for(C in x.attributes)x.attributes.hasOwnProperty(C)&&(w=p+C,B[w]=x.attributes[C]);x.attributes=B;F.attributes=e.mixin(F.attributes,x.attributes)}}g&&(d&&0<d.length)&&h.forEach(d,function(a){if(a){var b=F.attributes[a.name];m.isDefined(b)&&(b=
this._getDomainValue(a.domain,b),m.isDefined(b)&&(F.attributes[a.name]=b))}},this);z.push(F);this._visibleRasters.push(F)}this._resolve([z,null,!0],null,c,f)}))}var n=a.value,l,r,s=0,t=0,v=this,x=this.objectIdField,C;if(a.catalogItems){g=0;var w,B,A=a.catalogItems.features.length;w=0;r=Array(A);l=Array(A);C=Array(A);for(s=0;s<A;s++)-1<a.properties.Values[s].toLowerCase().indexOf("nodata")&&w++;w=A-w;for(s=0;s<A;s++)B=-1<a.properties.Values[s].toLowerCase().indexOf("nodata")?w++:g++,r[B]=a.catalogItems.features[s],
l[B]=a.properties.Values[s],C[B]=r[B].attributes[x]}this._visibleRasters=[];var F;a=-1<n.toLowerCase().indexOf("nodata");n&&(!r&&!a)&&(x="ObjectId",r=[],F=new E(new q(this.fullExtent),null,{ObjectId:0}),r.push(F));var z=[];r?!this._map.spatialReference.equals(this.spatialReference)&&C&&0<C.length?p({url:this._url.path+"/query",content:{f:"json",objectIds:C.join(","),returnGeometry:!0,outSR:d.toJson(v._map.spatialReference.toJson()),outFields:x},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===
a.features.length)v._resolve([z,null,null],null,c,f);else{for(s=0;s<a.features.length;s++)for(t=0;t<r.length;t++)r[t].attributes[x]==a.features[s].attributes[x]&&(r[t].geometry=new u(a.features[s].geometry),r[t].geometry.setSpatialReference(v._map.spatialReference));k.call(v)}},error:function(a){v._resolve([z,null,null],null,c,f)}}):k.call(this):this._resolve([z,null,null],null,c,f)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},
_getDomainFields:function(a){if(a){var b=[];h.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;h.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_requestData:function(a,b,c){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=e.clone(a);var d=a._normalize(!0);this._prepareGetImageParameters(d,b,c);b=e.clone(this._params);this._cleanupRequestParams(b);b.extent=
a;c=null;this._useBrowserDecoding()&&(c=new F({ctx:this._context}));b={imageServiceParameters:b,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:c?e.hitch(c,"decode"):null};this._rasterReadPromise=this.raster.read(b,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a)},_setPixelData:function(a){a=this._clonePixelData(a);
this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this._drawPixelData(),this._rasterReadPromise=null},_drawPixelData:function(){},_requestDataErrorHandler:function(a){},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=e.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=a.clone();return b},_getPixelBlockFromCanvas:function(a,b,c){a=a.getImageData(0,0,b,c).data;
for(var d=b*c,e=0,g=0,f=new Uint8Array(d),m=new Uint8Array(d),k=new Uint8Array(d),h=new Uint8Array(d),n=Infinity,p=Infinity,l=Infinity,q=-Infinity,s=-Infinity,r=-Infinity,t,v,u,e=0;e<d;e++)t=a[g++],v=a[g++],u=a[g++],n=n<t?n:t,q=q>t?q:t,p=p<v?p:v,s=s>v?s:v,l=l<u?l:u,r=r>u?r:u,f[e]=t,m[e]=v,k[e]=u,h[e]=a[g++]&1;return new D({width:b,height:c,pixels:[f,m,k],pixelType:"U8",mask:h,statistics:[{minValue:n,maxValue:q},{minValue:p,maxValue:s},{minValue:l,maxValue:r}]})},_useBrowserDecoding:function(){return(void 0===
this.pixelFilter||null===this.pixelFilter)&&("jpeg"==this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=this._url.path+"/multiDimensionalInfo",b=new f(s._dfdCanceller);if(this._multidimensionalInfo)return b.resolve(this._multidimensionalInfo),b;10.3<=this.version&&this.hasMultidimensions?(b._pendingDfd=p({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(e.hitch(this,function(a){this._multidimensionalInfo=
a.multidimensionalInfo;b.callback(a.multidimensionalInfo)}),function(a){b.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=k.isDebug,b.errback(a));return b},getDefaultMultidimensionalDefinition:function(){var a,b,c,d,g=[],m=new f(s._dfdCanceller);if(this._defaultMultidimensionalDefinition)return m.resolve(this._defaultMultidimensionalDefinition),m;m._pendingDfd=this.getMultidimensionalInfo();m._pendingDfd.then(e.hitch(this,function(e){a=e;b=a.variables[0].name;c=a.variables[0].dimensions;
for(d in c)c.hasOwnProperty(d)&&(c[d].hasRanges&&!0==c[d].hasRanges?g.push(new x({variableName:b,dimensionName:c[d].name,isSlice:!1,values:[c[d].values[0]]})):g.push(new x({variableName:b,dimensionName:c[d].name,isSlice:!0,values:[c[d].extent[0]]})));this._defaultMultidimensionalDefinition=g;m.callback(g)}),function(a){m.errback(a)});return m},_setDefaultMultidimensionalDefinition:function(a){var b,c={};this.getDefaultMultidimensionalDefinition().then(e.hitch(this,function(d){b=d;0<b.length&&(this.mosaicRule?
(c=e.clone(this.mosaicRule),c.multidimensionalDefinition=b):this.defaultMosaicRule?(c=e.clone(this.defaultMosaicRule),c.multidimensionalDefinition=b):c=new w({multidimensionalDefinition:b}),this.setMosaicRule(c,a))}))},_setDefaultRenderingRule:function(a){var b={};if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"None"!=this.rasterFunctionInfos[0].name)b.rasterFunction=this.rasterFunctionInfos[0].name;
else if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"==this.declaredClass&&10.3<this.version){var c="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;b.rasterFunction="Resample";b.rasterFunctionArguments={ResamplingType:c,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}}}b.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new v(b),this.setRenderingRule(this.defaultRenderingRule,a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var b=
new w(d.fromJson(a.mosaicRule));if(b&&b.multidimensionalDefinition&&0<b.multidimensionalDefinition.length){var c=h.filter(b.multidimensionalDefinition,function(a){return"StdTime"!==a.dimensionName});b.multidimensionalDefinition=c;a.mosaicRule=d.toJson(b.toJson())}}var b="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent".split(" "),e;for(e in b)a.hasOwnProperty(b[e])&&delete a[b[e]];return a},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===
this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific "===this.serviceDataType},_isVectorData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType},_createPixelData:function(a){a=new D({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var b=this.fullExtent.getCenter(),b=new q(b.x,b.y,b.x+this.pixelSizeX,b.y+this.pixelSizeY,this.spatialReference);
return{pixelBlock:a,extent:b}},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&s._resDfd(d,a,e)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=n.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(n.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,b){this.useMapTime=a;this._toggleTime();!b&&
this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))}})})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(l,e,f,h,d,k){var n=l(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,
viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(b){e.isObject(b)&&(e.mixin(this,b),b.mosaicMethod&&(this.method=b.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),b.mosaicOperation&&(this.operation=b.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),b.fids&&(this.objectIds=b.fids),b.viewpoint&&
(this.viewpoint=new k(b.viewpoint)))},toJson:function(){var b=null,c=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(c)for(var b=[],a=0;a<c;a++)b.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[a].declaredClass?this.multidimensionalDefinition[a].toJson():this.multidimensionalDefinition[a]);b={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?
this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:b};return d.filter(b,function(a){if(null!==a)return!0})},_getMethodEnum:function(b){if(b){var c=n.METHOD_NONE;switch(b.toLowerCase()){case "byattribute":c=n.METHOD_ATTRIBUTE;break;case "center":c=n.METHOD_CENTER;break;case "lockraster":c=n.METHOD_LOCKRASTER;break;case "nadir":c=n.METHOD_NADIR;break;case "northwest":c=n.METHOD_NORTHWEST;break;case "seamline":c=n.METHOD_SEAMLINE;break;case "viewpoint":c=
n.METHOD_VIEWPOINT}return c}},_getOperatorEnum:function(b){if(b)switch(b.toLowerCase()){case "first":return n.OPERATION_FIRST;case "last":return n.OPERATION_LAST;case "max":return n.OPERATION_MAX;case "min":return n.OPERATION_MIN;case "blend":return n.OPERATION_BLEND;case "mean":return n.OPERATION_MEAN;case "sum":return n.OPERATION_SUM}}});e.mixin(n,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",
METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});return n})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(l,e,f,h,d){var k=l(null,{declaredClass:"esri.layers.RasterFunction",
functionName:null,arguments:null,functionArguments:null,variableName:null,outputPixelType:null,constructor:function(d){if(e.isObject(d)){var b=0;this.functionName=d.rasterFunction;this.functionArguments=e.clone(d.rasterFunctionArguments||d.arguments);e.mixin(this,d);if(d=this.functionArguments)if(d.Raster=this._toRasterFunction(d.Raster),d.Raster2=this._toRasterFunction(d.Raster2),d.DEM=this._toRasterFunction(d.DEM),d.FillRaster=this._toRasterFunction(d.FillRaster),d.Rasters&&d.Rasters.length)for(b=
0;b<d.Rasters.length;b++)d.Rasters[b]=this._toRasterFunction(d.Rasters[b])}},_toRasterFunction:function(d){return d&&(d.rasterFunction||d.functionName)?new k(d):d},_rfToJson:function(d){d&&"esri.layers.RasterFunction"===d.declaredClass&&(d=d.toJson());return d},toJson:function(){var f=e.clone(this.functionArguments||this.arguments);if(f&&(f.Raster=this._rfToJson(f.Raster),f.Raster2=this._rfToJson(f.Raster2),f.DEM=this._rfToJson(f.DEM),f.FillRaster=this._rfToJson(f.FillRaster),f.Rasters&&f.Rasters.length)){var b,
c=[];for(b=0;b<f.Rasters.length;b++)c.push(this._rfToJson(f.Rasters[b]));f.Rasters=c}return d.filter({rasterFunction:this.functionName,rasterFunctionArguments:f,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(a){if(null!==a&&void 0!==a)return!0})}});return k})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(l,e,f,h,d){return l(null,{declaredClass:"esri.layers.DimensionalDefinition",
variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(d){e.isObject(d)&&e.mixin(this,d)},toJson:function(){return d.filter({variableName:this.variableName,dimensionName:this.dimensionName,values:this.values,isSlice:this.isSlice},function(d){return null!==d})}})})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q){var t,u,w,v=null,x=null,B=function(a){"U1"===a||"U2"===a||"U4"===a||"U8"===a?(a="U8",x=Math.pow(2,8)-1,v=Uint8Array):"U16"===a?(x=x||Math.pow(2,16)-1,v=Uint16Array):"U32"===a?(x=x||Math.pow(2,32)-1,v=Uint32Array):"S8"===a?(x=x||0-Math.pow(2,7),v=Int8Array):"S16"===a?(x=x||0-Math.pow(2,15),v=Int16Array):"S32"===a?(x=x||0-Math.pow(2,31),v=Int32Array):v=Float32Array;return a};return e(a,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),
validFormats:"lerc jpeg jpgpng png png8 png24 png32 bip bsq".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){if(!a)throw"Image Service URL is not defined";this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(a,c,e){var m=this,n=new h(s._dfdCanceller);if(10>b("ie"))throw"This browser is not supported.";if(!a.imageServiceParameters)throw"Insufficient parameters to read data";var p=f.clone(a.imageServiceParameters),
l=a.pixelType;d.some(this.validPixelTypes,function(a){return a===l})||(p.pixelType="F32");d.some(this.validFormats,function(a){return a.toLowerCase()===p.format.toLowerCase()})||(p.format="lerc");var q=a.decodeFunc,r;this._prepareGetImageParameters(p);n._pendingDfd=g({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",content:f.mixin(p,{f:"image"}),load:function(a){var b=p.format.toUpperCase();"BSQ"!==b&&"BIP"!==b&&(b=m._getFormat(a));if("ERROR"===b)a=Error(String.fromCharCode.apply(null,
new Uint8Array(a))),a.log=k.isDebug,m._resolve([a],null,e,n,!0);else{if(void 0===q||null===q)q=m._getFormatDecoderDfd(b);q?q(a,{width:p.width,height:p.height,planes:null,pixelType:l,noDataValue:p.noData}).then(function(a){r={pixelBlock:a,extent:p.extent};m._resolve([r,p],"onRasterReadComplete",c,n)},function(a){m._resolve([a],null,e,n,!0)}):(a=Error("Format '"+p.format+"' is not supported."),a.log=k.isDebug,m._resolve([a],null,e,n,!0))}},error:function(a){m._resolve([a],null,e,n,!0)}});return n.promise},
onRasterReadComplete:function(){},_prepareGetImageParameters:function(a){if(a.size&&a.bbox){var b=a.size.split(",");a.width=parseFloat(b[0]);a.height=parseFloat(b[1]);a.extent||(b=a.bbox.split(","),a.extent=new m(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]),new p(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";
var b=a.extent,c=b.spatialReference.wkid||n.toJson(b.spatialReference.toJson());delete a._ts;f.mixin(a,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:c,bboxSR:c,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,c){var d=a.ymax-a.ymin,e=a.xmax-a.xmin;c>=b?a.ymax=a.ymin+e*b/c:(e=d*c/b,a.xmax=a.xmin+e);return a},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&s._resDfd(d,a,e)},_getFormatDecoderDfd:function(a){var b=
null;switch(a){case "LERC":b=this._decodeLerc;break;case "JPEG":b=this._decodeJpeg;break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip}b=f.hitch(this,b);return function(a,c){var d=new h;try{var e=b(a,c);d.resolve(e)}catch(g){d.reject(g)}return d}},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="JPEG":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?b="PNG":67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===
a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?b="LERC":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(b="ERROR");return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,b){if(!t)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(b);var c=(new t).decode(a);if(c.height!==b.height||c.width!==b.width)throw"The decoded image dimensions are incorrect.";
var d=[],e,g;for(e=0;e<c.pixels.length;e++)g=c.pixels[e],d.push(this._calculateBandStatistics(g));return new r({width:c.width,height:c.height,pixels:c.pixels,pixelType:"U8",mask:c.mask,statistics:d})},_decodePng:function(a,b){if(!u)throw"The png decoder module is not loaded.";this._validateDecodeParams(b);var c=new Uint8Array(a),d=new u(c),c=new Uint8Array(4*b.width*b.height);d.copyToImageData(c,d.decodePixels());for(var e=d=0,g,e=new Uint8Array(b.width*b.height),d=0;d<b.width*b.height;d++)e[d]=c[4*
d+3];for(var f=new r({width:b.width,height:b.height,pixels:[],pixelType:"U8",mask:e,statistics:[]}),d=0;3>d;d++){g=new Uint8Array(b.width*b.height);for(e=0;e<b.width*b.height;e++)g[e]=c[4*e+d];f.addData({pixels:g,statistics:this._calculateBandStatistics(g)})}return f},_decodeBsq:function(a,b){if(!w)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(b);x=b.noDataValue;b.pixelType=B(b.pixelType);var c=w.decodeBSQ(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:v,noDataValue:x}),
d=[],e,g=null;for(e=0;e<c.pixels.length;e++)g=c.pixels[e],d.push(this._calculateBandStatistics(g));return new r({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,statistics:d})},_decodeBip:function(a,b){this._validateDecodeParams(b);x=b.noDataValue;b.pixelType=B(b.pixelType);var c=w.decodeBIP(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:v,noDataValue:x}),d=[],e,g=null;for(e=0;e<c.pixels.length;e++)g=c.pixels[e],d.push(this._calculateBandStatistics(g));
return new r({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,statistics:d})},_decodeLerc:function(a,b){this._validateDecodeParams(b);x=b.noDataValue;b.pixelType=B(b.pixelType);for(var c=0,d,e=0,g,f=a.byteLength-10;e<f;){var m=q.decode(a,{inputOffset:e,encodedMaskData:d,returnMask:0===c?!0:!1,returnEncodedMask:0===c?!0:!1,returnFileInfo:!0,pixelType:v,noDataValue:x}),e=m.fileInfo.eofOffset;0===c&&(d=m.encodedMaskData,g=new r({width:b.width,height:b.height,pixels:[],
pixelType:b.pixelType,mask:m.maskData,statistics:[]}));c++;if(m.height!==b.height||m.width!==b.width)throw"The decoded image dimensions are incorrect";g.addData({pixels:m.pixelData,statistics:{minValue:m.minValue,maxValue:m.maxValue,noDataValue:m.noDataValue}})}return g},_calculateBandStatistics:function(a){var b=Infinity,c=-Infinity,d=a.length,e,g=0;for(e=0;e<d;e++)g=a[e],b=g<b?g:b,c=g>c?g:c;return{minValue:b,maxValue:c}},_loadRasterFormatModules:function(){10>b("ie")||l(["./rasterFormats/JpgPlus",
"./rasterFormats/Png","./rasterFormats/Raw"],function(a,b,c){t=a;u=b;w=c})}})})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(l,e,f,h){return l([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],constructor:function(d){if(d){if(!d.width||Math.floor(d.width)!==d.width)throw"PixelBlock: incorrect width";if(!d.height||Math.floor(d.height)!==d.height)throw"PixelBlock: incorrect height";
if(!d.pixels||!d.statistics)throw"PixelBlock: pixel data or statistics not present";this.width=d.width;this.height=d.height;this.pixels=d.pixels;this.pixelType=d.pixelType||null;this.statistics=d.statistics;this.mask=d.mask||null}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(d){if(!d.pixels||!d.statistics)throw"Pixel data or statistics are not present";if(d.pixels.length!==
this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(d.statistics);this.pixels.push(d.pixels)},getAsRGBA:function(){var d=new ArrayBuffer(4*this.width*this.height);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(d);break;default:this._fillFrom8Bit(d)}return new Uint8ClampedArray(d)},getAsRGBAFloat:function(){var d=new Float32Array(4*this.width*this.height);this._fillFrom32Bit(d);return d},clone:function(){var d=
new this.constructor;d.width=this.width;d.height=this.height;d.pixelType=this.pixelType;this.mask&&(d.mask=new Uint8Array(this.mask));var f,h;if(this.pixels){d.pixels=[];h=this.pixels.length;for(f=0;f<h;f++)d.pixels[f]=new Float32Array(this.pixels[f])}if(this.statistics){d.statistics=[];h=this.statistics.length;for(f=0;f<h;f++)d.statistics[f]=e.clone(this.statistics[f])}return d},_fillFrom8Bit:function(d){var e=this.pixels,f=this.mask;if(!d||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var b,c,a;b=c=a=e[0];3<=e.length&&(c=e[1],a=e[2]);var e=new Uint32Array(d),g=this.width*this.height;if(b.length!==g)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(f&&f.length===g)for(d=0;d<g;d++)f[d]&&(e[d]=-16777216|a[d]<<16|c[d]<<8|b[d]);else for(d=0;d<g;d++)e[d]=-16777216|a[d]<<16|c[d]<<8|b[d]},_fillFromNon8Bit:function(d){var e=this.pixels,f=this.mask,b=this.statistics;if(!d||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var c=1,a=0;b&&0<b.length?(a=b[0].minValue,c=255/(b[0].maxValue-b[0].minValue)):(c=255,"S8"===this.pixelType?(a=-128,c=127):"U16"===this.pixelType?c=65535:"S16"===this.pixelType?(a=-32768,c=32767):"U32"===this.pixelType?c=4294967295:"S32"===this.pixelType?(a=-2147483648,c=2147483647):"F32"===this.pixelType?(a=-3.4*1E39,c=3.4*1E39):"F64"===this.pixelType&&(a=-Number.MAX_VALUE,c=Number.MAX_VALUE),c=255/(c-a));d=new Uint32Array(d);var b=this.width*this.height,g,m,h;g=e[0];if(g.length!==b)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
if(3<=e.length)if(m=e[1],h=e[2],f&&f.length===b)for(e=0;e<b;e++)f[e]&&(d[e]=-16777216|(h[e]-a)*c<<16|(m[e]-a)*c<<8|(g[e]-a)*c);else for(e=0;e<b;e++)d[e]=-16777216|(h[e]-a)*c<<16|(m[e]-a)*c<<8|(g[e]-a)*c;else if(f&&f.length===b)for(e=0;e<b;e++)m=(g[e]-a)*c,f[e]&&(d[e]=-16777216|m<<16|m<<8|m);else for(e=0;e<b;e++)m=(g[e]-a)*c,d[e]=-16777216|m<<16|m<<8|m},_fillFrom32Bit:function(d){var e=this.pixels,f=this.mask;if(!d||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var b,c,a;b=c=a=e[0];3<=e.length&&(c=e[1],a=e[2]);var g=this.width*this.height;if(b.length!==g)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var m=0;if(f&&f.length===g)for(e=0;e<g;e++)d[m++]=b[e],d[m++]=c[e],d[m++]=a[e],d[m++]=f[e];else for(e=0;e<g;e++)d[m++]=b[e],d[m++]=c[e],d[m++]=a[e],d[m++]=255}})})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var l={defaultNoDataValue:-3.4027999387901484E38,decode:function(f,h){var d;h=h||{};var k=h.inputOffset||
0,n=h.encodedMaskData||null===h.encodedMaskData,b={},c=new Uint8Array(f,k,10);b.fileIdentifierString=String.fromCharCode.apply(null,c);if("CntZImage"!=b.fileIdentifierString.trim())throw"Unexpected file identifier string: "+b.fileIdentifierString;var k=k+10,a=new DataView(f,k,24);b.fileVersion=a.getInt32(0,!0);b.imageType=a.getInt32(4,!0);b.height=a.getUint32(8,!0);b.width=a.getUint32(12,!0);b.maxZError=a.getFloat64(16,!0);k+=24;if(!n)if(a=new DataView(f,k,16),b.mask={},b.mask.numBlocksY=a.getUint32(0,
!0),b.mask.numBlocksX=a.getUint32(4,!0),b.mask.numBytes=a.getUint32(8,!0),b.mask.maxValue=a.getFloat32(12,!0),k+=16,0<b.mask.numBytes){var n=new Uint8Array(Math.ceil(b.width*b.height/8)),a=new DataView(f,k,b.mask.numBytes),c=a.getInt16(0,!0),g=2,m=0;do{if(0<c)for(;c--;)n[m++]=a.getUint8(g++);else for(var p=a.getUint8(g++),c=-c;c--;)n[m++]=p;c=a.getInt16(g,!0);g+=2}while(g<b.mask.numBytes);if(-32768!==c||m<n.length)throw"Unexpected end of mask RLE encoding";b.mask.bitset=n;k+=b.mask.numBytes}else 0==
(b.mask.numBytes|b.mask.numBlocksY|b.mask.maxValue)&&(n=new Uint8Array(Math.ceil(b.width*b.height/8)),b.mask.bitset=n);a=new DataView(f,k,16);b.pixels={};b.pixels.numBlocksY=a.getUint32(0,!0);b.pixels.numBlocksX=a.getUint32(4,!0);b.pixels.numBytes=a.getUint32(8,!0);b.pixels.maxValue=a.getFloat32(12,!0);k+=16;n=b.pixels.numBlocksX;c=b.pixels.numBlocksY;n+=0<b.width%n?1:0;c+=0<b.height%c?1:0;b.pixels.blocks=Array(n*c);g=1E9;for(p=m=0;p<c;p++)for(var s=0;s<n;s++){var r=0,a=new DataView(f,k,Math.min(10,
f.byteLength-k)),q={};b.pixels.blocks[m++]=q;var t=a.getUint8(0);r++;q.encoding=t&63;if(3<q.encoding)throw"Invalid block encoding ("+q.encoding+")";if(2===q.encoding)k++,g=Math.min(g,0);else{if(0!==t&&2!==t){t>>=6;q.offsetType=t;if(2===t)q.offset=a.getInt8(1),r++;else if(1===t)q.offset=a.getInt16(1,!0),r+=2;else if(0===t)q.offset=a.getFloat32(1,!0),r+=4;else throw"Invalid block offset type";g=Math.min(q.offset,g);if(1===q.encoding)if(t=a.getUint8(r),r++,q.bitsPerPixel=t&63,t>>=6,q.numValidPixelsType=
t,2===t)q.numValidPixels=a.getUint8(r),r++;else if(1===t)q.numValidPixels=a.getUint16(r,!0),r+=2;else if(0===t)q.numValidPixels=a.getUint32(r,!0),r+=4;else throw"Invalid valid pixel count type";}k+=r;if(3!=q.encoding)if(0===q.encoding){a=(b.pixels.numBytes-1)/4;if(a!==Math.floor(a))throw"uncompressed block has invalid length";r=new ArrayBuffer(4*a);t=new Uint8Array(r);t.set(new Uint8Array(f,k,4*a));r=new Float32Array(r);for(t=0;t<r.length;t++)g=Math.min(g,r[t]);q.rawData=r;k+=4*a}else 1===q.encoding&&
(a=Math.ceil(q.numValidPixels*q.bitsPerPixel/8),r=Math.ceil(a/4),r=new ArrayBuffer(4*r),t=new Uint8Array(r),t.set(new Uint8Array(f,k,a)),q.stuffedData=new Uint32Array(r),k+=a)}}b.pixels.minValue=g;b.eofOffset=k;var k=null!=h.noDataValue?h.noDataValue:l.defaultNoDataValue,c=h.encodedMaskData,r=h.returnMask,g=0,m=b.pixels.numBlocksX,p=b.pixels.numBlocksY,s=Math.floor(b.width/m),q=Math.floor(b.height/p),a=2*b.maxZError,c=c||(b.mask?b.mask.bitset:null),u,n=new (h.pixelType||Float32Array)(b.width*b.height);
r&&c&&(u=new Uint8Array(b.width*b.height));for(var r=new Float32Array(s*q),w,v,t=0;t<=p;t++){var x=t!==p?q:b.height%p;if(0!==x)for(var B=0;B<=m;B++){var D=B!==m?s:b.width%m;if(0!==D){var C=t*b.width*q+B*s,F=b.width-D,z=b.pixels.blocks[g],A,E;if(2>z.encoding){if(0===z.encoding)A=z.rawData;else{A=z.stuffedData;E=z.bitsPerPixel;w=z.numValidPixels;v=z.offset;var H=a,K=r,O=b.pixels.maxValue,G=(1<<E)-1,J=0,y=void 0,L=0,M=void 0,Q=void 0,P=Math.ceil((O-v)/H),y=4*A.length-Math.ceil(E*w/8);A[A.length-1]<<=
8*y;for(y=0;y<w;y++)0===L&&(Q=A[J++],L=32),L>=E?(M=Q>>>L-E&G,L-=E):(L=E-L,M=(Q&G)<<L&G,Q=A[J++],L=32-L,M+=Q>>>L),K[y]=M<P?v+M*H:O;A=r}E=0}else d=2===z.encoding?0:z.offset;var N;if(c)for(v=0;v<x;v++){C&7&&(N=c[C>>3],N<<=C&7);for(w=0;w<D;w++)C&7||(N=c[C>>3]),N&128?(u&&(u[C]=1),n[C++]=2>z.encoding?A[E++]:d):(u&&(u[C]=0),n[C++]=k),N<<=1;C+=F}else if(2>z.encoding)for(v=0;v<x;v++){for(w=0;w<D;w++)n[C++]=A[E++];C+=F}else for(v=0;v<x;v++){for(w=0;w<D;w++)n[C++]=d;C+=F}if(1===z.encoding&&E!==z.numValidPixels)throw"Block and Mask do not match";
g++}}}d=u;u={width:b.width,height:b.height,pixelData:n,minValue:b.pixels.minValue,maxValue:b.pixels.maxValue,noDataValue:k};d&&(u.maskData=d);h.returnEncodedMask&&b.mask&&(u.encodedMaskData=b.mask.bitset?b.mask.bitset:null);if(h.returnFileInfo&&(u.fileInfo=e(b),h.computeUsedBitDepths)){d=u.fileInfo;N=b.pixels.numBlocksX*b.pixels.numBlocksY;A={};for(E=0;E<N;E++)k=b.pixels.blocks[E],0===k.encoding?A.float32=!0:1===k.encoding?A[k.bitsPerPixel]=!0:A[0]=!0;b=Object.keys(A);d.bitDepths=b}return u}},e=function(e){return{fileIdentifierString:e.fileIdentifierString,
fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,minValue:e.pixels.minValue,noDataValue:this.noDataValue}}};return l})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),
function(l,e,f,h,d,k){return l(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(d){e.mixin(this,d);this.isDataUV=d&&d.isDataUV?d.isDataUV:!1;this.computeMagnitudeAndDirection=e.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(d,b){this.inputUnit=d;this.outputUnit=b;this.unitConversionFactor=
1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var d=k.indexOf(this.speedUnits,this.inputUnit),b=k.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=d&&0<=b){var c=[1,0.277778,0.514444,0.3048,0.44704,0];this.unitConversionFactor=c[d]/c[b]}},computeMagnitudeAndDirection:function(e){if(!d.isDefined(e))throw"Could not compute magnitude and direction. No pixel data is available.";var b=e.pixelBlock;if(!d.isDefined(b)||2!==b.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var c=e.extent,a=(c.xmax-c.xmin)/b.width,g=(c.ymax-c.ymin)/b.height,f=c.xmin+a/2,c=c.ymax-g/2;b.statistics[0].minValue=0;b.statistics[0].maxValue=0;var h=180/Math.PI,k=[],l=0,q=0,t=0,u=!d.isDefined(b.mask),w,v,x,B,D,C,F,z;D=F=Infinity;C=z=-Infinity;for(l=0;l<b.height;l++)for(q=0;q<b.width;q++,t++)if(k.push([f+a*q,c-g*l]),u||b.mask[t])x=w=b.pixels[0][t]*this.unitConversionFactor,B=v=b.pixels[1][t],this.isDataUV&&(x=Math.sqrt(w*w+v*v),B=90-h*Math.atan2(v,w),b.pixels[0][t]=x*this.unitConversionFactor,
b.pixels[1][t]=B),x>C&&(C=x),x<D&&(D=x),B>z&&(z=B),B<F&&(F=B);b.statistics[0].maxValue=C;b.statistics[0].minValue=D;b.statistics[1].maxValue=z;b.statistics[1].minValue=F;e.locations=k;return e}})})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(l,e,f,h){var d;return e(null,{constructor:function(d){this.ctx=d.ctx;this._loadRasterFormatModule()},decode:function(d,e){if(!e.width||!e.height)throw"Native decoding requires the image format, width and height";
var b=new f,c,a=new Uint8Array(d),g=this._getFormat(d);if("error"===g)throw"invalid format";"jpeg"===g&&(c=this._getMask(a,e));var m="",h,l;for(h=0;h<a.length;h+=65535)l=a.subarray(h,h+65535>a.length-1?a.length-1:h+65535),m+=String.fromCharCode.apply(null,l);var a="data:image/"+g+";base64,"+window.btoa(m),r=new Image,q;r.src=a;var t=this;r.onload=function(){t.ctx.clearRect(0,0,e.width,e.height);t.ctx.drawImage(r,0,0);var a=t.ctx.getImageData(0,0,r.width,r.height);q=a.data;if(c)for(h=0;h<c.length;h++)q[4*
h+3]=c[h]?255:0;t.ctx.putImageData(a,0,0);b.resolve(null)};r.onerror=function(){b.reject("cannot load image")};return b},_getFormat:function(d){d=new Uint8Array(d,0,10);var e="error";255===d[0]&&216===d[1]?e="jpeg":137===d[0]&&(80===d[1]&&78===d[2]&&71===d[3])&&(e="png");return e},_getMask:function(e,f){var b;try{if(!d)throw"The zlib decoder module is not loaded.";var c=0,a=0,g=Math.round(e.length/2);1===g%2&&(g+=1);for(var m=e.length-2,c=g;c<m&&!(255===e[c]&&217===e[c+1]);c++);g=c+=2;if(g<e.length-
1){var h=(new d(e.subarray(g))).getBytes();b=new Uint8Array(f.width*f.height);for(c=g=0;c<h.length;c++)for(a=7;0<=a;a--)b[g++]=h[c]>>a&1}}catch(l){}return b},_loadRasterFormatModule:function(){10>h("ie")||l(["./Zlib"],function(e){d=e})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(l,e,f,h,d,k,n,b){l=l(n,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",
constructor:function(b){this._url.path+="/identify";this._handler=e.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(c,a,d,e,f){try{var h=new b(c);this._successHandler([h],"onComplete",d,f)}catch(k){this._errorHandler(k,e,f)}},execute:function(b,a,g,f){var h=f.assembly;b=this._encode(e.mixin({},this._url.query,{f:"json"},b.toJson(h&&h[0])));var k=this._handler,n=this._errorHandler;return d({url:this._url.path,content:b,callbackParamName:"callback",
load:function(b,c){k(b,c,a,g,f.dfd)},error:function(a){n(a,g,f.dfd)}})},onComplete:function(){}});k._createWrappers(l);return l})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(l,e,f,h,d,k){return l(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(e){e.catalogItems&&(this.catalogItems=new k(e.catalogItems));e.location&&(this.location=d.fromJson(e.location));
this.catalogItemVisibilities=e.catalogItemVisibilities;this.name=e.name;this.objectId=e.objectId;this.value=e.value;this.properties=e.properties}})})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(l,e,f,h,d,k,n){return l(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,pixelSizeX:null,pixelSizeY:null,
pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(b){var c=b&&b.geometry||this.geometry;b={geometry:c,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?f.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?f.toJson(this.renderingRule.toJson()):null};c&&(b.geometryType=n.getJsonType(c));c=this.timeExtent;b.time=c?c.toJson().join(","):null;k.isDefined(this.pixelSizeX)&&k.isDefined(this.pixelSizeY)?
b.pixelSize=f.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(b.pixelSize=this.pixelSize?f.toJson(this.pixelSize.toJson()):null);return b}})})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(l,e){return l(e,{constructor:function(e,h){this.noLegend=!0},getExtent:function(){},initVisible:function(){},_setTopLayerVisible:function(e){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},
setOpacity:function(e){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred ./LayerInfoForDefault esri/layers/FeatureLayer".split(" "),function(l,e,f,h,d,k){return l(d,{isTable:null,constructor:function(){this.newSubLayers=[];this.isTable=!0},init:function(){},getLayerObject:function(){var d=new h;this.layerObject.empty?this.layerObject.url?
(this.layerObject=new k(this.layerObject.url,this.layerObject.options||{}),this.layerObject.on("load",e.hitch(this,function(){d.resolve(this.layerObject)})),this.layerObject.on("error",e.hitch(this,function(){d.resolve(null)}))):this.layerObject.featureCollectionData?(this.layerObject=new k(this.layerObject.featureCollectionData,this.layerObject.options||{}),this.layerObject.on("load",e.hitch(this,function(){d.resolve(this.layerObject)})),this.layerObject.on("error",e.hitch(this,function(){d.resolve(null)}))):
d.resolve(null):d.resolve(this.layerObject);return d},getLayerType:function(){var d=new h;d.resolve("Table");return d},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return f.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplate:void 0}}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all esri/request ./LayerInfoForDefault".split(" "),
function(l,e,f,h,d,k,n,b){return l(b,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=this.layerObject.serviceDataType&&("esriImageServiceDataTypeVector-UV"===this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.layerObject.serviceDataType)?"ArcGISImageServiceVectorLayer":"ArcGISImageServiceLayer"},_initLegendsNode:function(b){10.2<=this.layerObject.version?this._legendRequestServer().then(h.hitch(this,
function(a){e.empty(b);f.forEach(a.layers,function(a){f.forEach(a.legend,function(a){if("\x3call other values\x3e"!==a.label){var d=e.create("div",{"class":"legend-div"},b),g=e.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},d),f=null,f=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;e.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:f},g);e.create("div",
{"class":"legend-label jimu-float-leading",innerHTML:a.label||" "},d)}},this)},this)}),h.hitch(this,function(){e.empty(b)})):e.empty(b)},_legendRequestServer:function(){var b=this.layerObject.url+"/legend",a={f:"json"};this.layerObject._params.bandIds&&(a.bandIds=this.layerObject._params.bandIds);this.layerObject._params.renderingRule&&(a.renderingRule=this.layerObject._params.renderingRule);return n({url:b,content:a,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var b=
new d,a={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},e=this.getLayerType(),f=this.getLayerObject();k({type:e,layerObject:f}).then(h.hitch(this,function(d){var e=d.type;d=d.layerObject;a.layerType=e;0<=this._getLayerTypesOfSupportTable().indexOf(e)&&(a.isSupportedLayer=!0);d.capabilities&&0<=d.capabilities.indexOf("Catalog")?a.isSupportQuery=!0:a.isSupportedLayer=!1;b.resolve(a)}),function(){b.resolve(a)});return b}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(l,e,f,h,d){return l(d,{getSupportTableInfo:function(){var d=new f,n={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,otherReasonCanNotSupport:!0},b=this.getLayerType(),c=this.getLayerObject();h({type:b,layerObject:c}).then(e.hitch(this,function(a){var b=a.type;a=a.layerObject;n.layerType=b;0<=this._getLayerTypesOfSupportTable().indexOf(b)&&(n.isSupportedLayer=!0);if((b=a.getLatestObservations())&&0<b.length)n.otherReasonCanNotSupport=
!1;d.resolve(n)}),function(){d.resolve(n)});return d}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(l,e,f,h,d,k,n,b,c){return k("dijit.layout._LayoutWidget",[e,f,h],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);n.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);
var a=this.getParent&&this.getParent();if(!a||!a.isLayoutContainer)this.resize(),this.own(d.on("resize",l.hitch(this,"resize")))}},resize:function(a,d){var e=this.domNode;a&&b.setMarginBox(e,a);var f=d||{};l.mixin(f,a||{});if(!("h"in f)||!("w"in f))f=l.mixin(b.getMarginBox(e),f);var h=c.getComputedStyle(e),k=b.getMarginExtents(e,h),n=b.getBorderExtents(e,h),f=this._borderBox={w:f.w-(k.w+n.w),h:f.h-(k.h+n.h)},k=b.getPadExtents(e,h);this._contentBox={l:c.toPixelValue(e,h.paddingLeft),t:c.toPixelValue(e,
h.paddingTop),w:f.w-k.w,h:f.h-k.h};this.layout()},layout:function(){},_setupChild:function(a){n.add(a.domNode,this.baseClass+"-child "+(a.baseClass?this.baseClass+"-"+a.baseClass:""))},addChild:function(a,b){this.inherited(arguments);this._started&&this._setupChild(a)},removeChild:function(a){n.remove(a.domNode,this.baseClass+"-child"+(a.baseClass?" "+this.baseClass+"-"+a.baseClass:""));this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q){g("dijit-legacy-requires")&&q(0,function(){l(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return f("dijit.Menu",r,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):e.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return p.get(this._iframeContentDocument(a))||
this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(e){e=h.byId(e,this.ownerDocument);var g;if("iframe"==e.tagName.toLowerCase()){var f=e;g=this._iframeContentWindow(f);g=m.body(g.document)}else g=e==m.body(this.ownerDocument)?this.ownerDocument.documentElement:e;var k={node:e,
iframe:f};d.set(e,"_dijitMenu"+this.id,this._bindings.push(k));var n=c.hitch(this,function(c){var d=this.selector,e=d?function(b){return a.selector(d,b)}:function(a){return a},g=this;return[a(c,e(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<this._lastKeyDown+500||g._scheduleOpen(this,f,{x:a.pageX,y:a.pageY},a.target)}),a(c,e("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==b.F10||this.leftClickToOpen&&a.keyCode==
b.SPACE)a.stopPropagation(),a.preventDefault(),g._scheduleOpen(this,f,null,a.target),this._lastKeyDown=(new Date).getTime()})]});k.connects=g?n(g):[];f&&(k.onloadHandler=c.hitch(this,function(){var a=this._iframeContentWindow(f),a=m.body(a.document);k.connects=n(a)}),f.addEventListener?f.addEventListener("load",k.onloadHandler,!1):f.attachEvent("onload",k.onloadHandler))},unBindDomNode:function(a){var b;try{b=h.byId(a,this.ownerDocument)}catch(c){return}a="_dijitMenu"+this.id;if(b&&d.has(b,a)){for(var e=
d.get(b,a)-1,g=this._bindings[e],f;f=g.connects.pop();)f.remove();(f=g.iframe)&&(f.removeEventListener?f.removeEventListener("load",g.onloadHandler,!1):f.detachEvent("onload",g.onloadHandler));d.remove(b,a);delete this._bindings[e]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(a){function b(){q.refocus&&r&&r.focus();s.close(q)}var c=a.target,
d=a.iframe,e=a.coords,f=!e;this.currentTarget=a.delegatedTarget;if(e){if(d){a=k.position(d,!0);var c=this._iframeContentWindow(d),c=k.docScroll(c.document),m=n.getComputedStyle(d),l=n.toPixelValue,p=(g("ie")&&g("quirks")?0:l(d,m.paddingLeft))+(g("ie")&&g("quirks")?l(d,m.borderLeftWidth):0),d=(g("ie")&&g("quirks")?0:l(d,m.paddingTop))+(g("ie")&&g("quirks")?l(d,m.borderTopWidth):0);e.x+=a.x+p-c.x;e.y+=a.y+d-c.y}}else e=k.position(c,!0),e.x+=10,e.y+=10;var q=this,d=this._focusManager.get("prevNode");
a=this._focusManager.get("curNode");var r=!a||h.isDescendant(a,this.domNode)?d:a;s.open({popup:this,x:e.x,y:e.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});this.focus();f||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);s.close(this)}},destroy:function(){e.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare",
"./Grid","./OnDemandList"],function(l,e,f){return l("dgrid.OnDemandGrid",[e,f],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(l,e,f,h,d,k,n){function b(a,b){b&&b.nodeType&&a.appendChild(b)}function c(a,b,c,d){if(this.formatter){d=this.formatter;var e=this.grid.formatterScope;c.innerHTML="string"===typeof d&&e?e[d](b,a):this.formatter(b,a)}else null!=b&&c.appendChild(document.createTextNode(b))}
var a=8>h("ie")&&!h("quirks");e=e("dgrid.Grid",k,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!=typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,b){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&(a=a.target);var c;if(a.nodeType){do{if(this._rowIdToObject[a.id])break;var d=a.columnId;if(d){b=d;c=a;break}a=a.parentNode}while(a&&a!=this.domNode)}if(!c&&"undefined"!=typeof b){var e=this.row(a);if(d=e&&e.element)for(var d=
d.getElementsByTagName("td"),f=0;f<d.length;f++)if(d[f].columnId==b){c=d[f];break}}if(null!=a)return{row:e||this.row(a),column:b&&this.column(b),element:c}},createRowCells:function(b,c,e,f){var k=d("table.dgrid-row-table[role\x3dpresentation]"),l=9>h("ie")||h("quirks")?d(k,"tbody"):k,t,u,w,v,x,B,D,C,F,z;e=e||this.subRows;u=0;for(w=e.length;u<w;u++){B=e[u];t=d(l,"tr");B.className&&d(t,"."+B.className);v=0;for(x=B.length;v<x;v++){D=B[v];C=D.id;F=D.field?".field-"+n.escapeCssIdentifier(D.field,"-"):
"";(z="function"===typeof D.className?D.className(f):D.className)&&(F+="."+z);F=d(b+(".dgrid-cell.dgrid-cell-padding"+(C?".dgrid-column-"+n.escapeCssIdentifier(C,"-"):"")+F.replace(/ +/g,"."))+"[role\x3d"+("th"===b?"columnheader":"gridcell")+"]");F.columnId=C;a?(C=d(F,"!dgrid-cell-padding div.dgrid-cell-padding"),F.contents=C):C=F;if(z=D.colSpan)F.colSpan=z;if(z=D.rowSpan)F.rowSpan=z;c(C,D);t.appendChild(F)}}return k},left:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,-(b||
1),"dgrid-cell"))},right:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,b||1,"dgrid-cell"))},renderRow:function(a,e){var f=this.createRowCells("td",function(d,f){var h=a;f.get?h=f.get(a):"field"in f&&"_item"!=f.field&&(h=h[f.field]);f.renderCell?b(d,f.renderCell(a,h,d,e)):c.call(f,a,h,d,e)},e&&e.subRows,a);return d("div[role\x3drow]\x3e",f)},renderHeader:function(){var c=this,e=this.headerNode,k=e.childNodes.length;for(e.setAttribute("role","row");k--;)d(e.childNodes[k],"!");
k=this.createRowCells("th",function(c,d){var e=d.headerNode=c;a&&(c=c.parentNode);var g=d.field;g&&(c.field=g);if(d.renderHeaderCell)b(e,d.renderHeaderCell(e));else if("label"in d||d.field)e.appendChild(document.createTextNode("label"in d?d.label:d.field));!1!==d.sortable&&(g&&"_item"!=g)&&(c.sortable=!0,c.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[k.id=this.id+"-header"]=this.columns;e.appendChild(k);this._sortListener&&this._sortListener.remove();this._sortListener=
f(k,"click,keydown",function(a){if("click"==a.type||32==a.keyCode||!h("opera")&&13==a.keyCode){var b=a.target,d,k,n;do if(b.sortable){n=[{attribute:d=b.field||b.columnId,descending:(k=c._sort[0])&&k.attribute==d&&!k.descending}];d={bubbles:!0,cancelable:!0,grid:c,parentType:a.type,sort:n};f.emit(a.target,"dgrid-sort",d)&&(c._sortNode=b,c.set("sort",n));break}while((b=b.parentNode)&&b!=e)}})},resize:function(){var a=this.headerNode.firstChild,b=this.contentNode,c;this.inherited(arguments);if(!h("ie")||
7<h("ie")&&!h("quirks"))if(b.style.width="",b&&a&&(c=a.offsetWidth)!=b.offsetWidth)b.style.width=c+"px"},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(a,b){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(a){var b=this.columns,c;for(c in b){var d=b[c];if(d.field==a)return d.headerNode}},updateSortArrow:function(a,b){this._lastSortedArrow&&(d(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),
d(this._lastSortedArrow,"!"),delete this._lastSortedArrow);b&&(this._sort=a);if(a[0]){var c=a[0].attribute,e=a[0].descending,c=this._sortNode||this._findSortArrowParent(c),f;delete this._sortNode;c&&(c=c.contents||c,f=this._lastSortedArrow=d("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),f.innerHTML="\x26nbsp;",c.insertBefore(f,c.firstChild),d(c,e?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(a,b){return this.addCssRule("#"+n.escapeCssIdentifier(this.domNode.id)+
" .dgrid-column-"+n.escapeCssIdentifier(a,"-"),b)},_configColumns:function(a,b){var c=[],d=b instanceof Array;n.each(b,function(e,f){"string"==typeof e&&(b[f]=e={label:e});!d&&!e.field&&(e.field=f);f=e.id=e.id||(isNaN(f)?f:a+f);this._configColumn&&(this._configColumn(e,f,b,a),f=e.id);d&&(this.columns[f]=e);e.grid=this;"function"===typeof e.init&&e.init();c.push(e)},this);return d?b:c},_destroyColumns:function(){var a=this.subRows,b=a&&a.length,c,d,e,f;this.cleanup();for(c=0;c<b;c++){d=0;for(f=a[c].length;d<
f;d++)e=a[c][d],"function"===typeof e.destroy&&e.destroy()}},configStructure:function(){var a=this.subRows,b=this._columns=this.columns;this.columns=!b||b instanceof Array?{}:b;if(a)for(b=0;b<a.length;b++)a[b]=this._configColumns(b+"-",a[b]);else this.subRows=[this._configColumns("",b)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns();this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this._destroyColumns();this.subRows=
a;this._updateColumns()},setColumns:function(a){l.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",a)},setSubRows:function(a){l.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",a)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});
e.appendIfNode=b;e.defaultRenderCell=c;return e})},"put-selector/put":function(){(function(l){var e,f=/[-+,> ]/;l([],e=function(h,d){function k(d){function e(){t&&(q&&t!=q)&&(q==d&&(l||(l=f.test(x)&&h.createDocumentFragment()))?l:q).insertBefore(t,r||null)}for(var l,s,r,q,t,u=arguments,w=u[0],v=0;v<u.length;v++){var x=u[v];if("object"==typeof x){s=!1;if(x instanceof Array){t=h.createDocumentFragment();for(var B=0;B<x.length;B++)t.appendChild(k(x[B]));x=t}if(x.nodeType)t=x,e(),q=x,r=0;else for(B in x)t[B]=
x[B]}else if(s)s=!1,t.appendChild(h.createTextNode(x));else{1>v&&(d=null);s=!0;if(w=x.replace(n,function(f,n,l,p,s,w){n&&(e(),"-"==n||"+"==n?(q=(r=t||q).parentNode,t=null,"+"==n&&(r=r.nextSibling)):("\x3c"==n?q=t=(t||q).parentNode:(","==n?q=d:t&&(q=t),t=null),r=0),t&&(q=t));if((f=!l&&p)||!t&&(l||s))"$"==f?(f=u[++v],q.appendChild(h.createTextNode(f))):(f=f||k.defaultTag,(n=a&&u[v+1]&&u[v+1].name)&&(f="\x3c"+f+' name\x3d"'+n+'"\x3e'),t=c&&~(b=f.indexOf("|"))?h.createElementNS(c[f.slice(0,b)],f.slice(b+
1)):h.createElement(f));if(l)if("$"==p&&(p=u[++v]),"#"==l)t.id=p;else if(n=(f=t.className)&&(" "+f+" ").replace(" "+p+" "," "),"."==l)t.className=f?(n+p).substring(1):p;else if("!"==x){var B;a?k("div",t,"\x3c").innerHTML="":(B=t.parentNode)&&B.removeChild(t)}else n=n.substring(1,n.length-1),n!=f&&(t.className=n);s&&("$"==w&&(w=u[++v]),"style"==s?t.style.cssText=w:(l="!"==s.charAt(0)?(s=s.substring(1))&&"removeAttribute":"setAttribute",w=""===w?s:w,c&&~(b=s.indexOf("|"))?t[l+"NS"](c[s.slice(0,b)],
s.slice(b+1),w):t[l](s,w)));return""}))throw new SyntaxError("Unexpected char "+w+" in "+x);e();q=w=t||q}}d&&l&&d.appendChild(l);return w}f=d||f;var n=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,b,c=!1;h=h||document;var a="object"==typeof h.createElement;k.addNamespace=function(a,b){h.createElementNS?(c||(c={}))[a]=b:h.namespaces.add(a,b)};k.defaultTag="div";k.forDocument=e;return k})})(function(l,e,f){f=f||e;"function"===typeof define?define([],
function(){return f()}):"undefined"==typeof window?require("./node-html")(module,f):put=f()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),function(l,e,f,h,d,k,n,b,c){function a(a,b){c(document.body,a,".dgrid-scrollbar-measure");var d=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return d}function g(a){var b=
a?"."+a.replace(u,"."):"";this._class&&(b="!"+this._class.replace(u,"!")+b);c(this.domNode,b);this._class=a}function m(){return this._class}function p(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function s(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)}b("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var r,q;d.add("dom-scrollbar-width",function(b,c,d){return a(d,"Width")});d.add("dom-scrollbar-height",
function(b,c,d){return a(d,"Height")});d.add("dom-rtl-scrollbar-left",function(a,b,e){a=c("div");c(document.body,e,".dgrid-scrollbar-measure[dir\x3drtl]");c(e,a);b=!!d("ie")||!!d("trident")||a.offsetLeft>=d("dom-scrollbar-width");e.className="";document.body.removeChild(e);c(a,"!");e.removeAttribute("dir");return b});var t=0,u=/ +/g,w=7>d("ie")&&!d("quirks")?function(){var a,b,c;if(this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,c=this._prevWinDims||[],c[0]!==b||c[1]!==
a))this.resize(),this._prevWinDims=[b,a]}:function(){this._started&&this.resize()};return e("dgrid.List",d("touch")?n:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:
document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){var f=this.domNode=b||c("div"),h;a?(this.params=a,e.safeMixin(this,a),h=a["class"]||a.className||f.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=f.id=f.id||this.id||"dgrid_"+t++;null===this.useTouchScroll&&(this.useTouchScroll=!d("dom-scrollbar-width"));this.buildRendering();
h&&g.call(this,h);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,e=this,g,f,m,n;n=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";c(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(b?".ui-widget":""));g=this.headerNode=c(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));
(d("quirks")||8>d("ie"))&&c(a,"div.dgrid-spacer");f=this.bodyNode=c(a,"div.dgrid-scroller");d("ff")&&(f.tabIndex=-1);this.headerScrollNode=c(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));m=this.footerNode=c("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));c(a,m);n&&(a.className+=" dgrid-rtl"+(d("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));h(f,"scroll",function(b){e.showHeader&&(g.scrollLeft=b.scrollLeft||f.scrollLeft);b.stopPropagation();
h.emit(a,"scroll",{scrollTarget:f})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=c(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=h(window,"resize",k.throttleDelayed(w,this)))},postCreate:d("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},
resize:function(){var a=this.bodyNode,b=this.headerNode,c=this.footerNode,e=b.offsetHeight,g=this.showFooter?c.offsetHeight:0,f=d("quirks")||7>d("ie");this.headerScrollNode.style.height=a.style.marginTop=e+"px";a.style.marginBottom=g+"px";f&&(a.style.height="",a.style.height=Math.max(this.domNode.offsetHeight-e-g,0)+"px",g&&(c.style.bottom="1px",setTimeout(function(){c.style.bottom=""},0)));r||(r=d("dom-scrollbar-width"),q=d("dom-scrollbar-height"),d("ie")&&(r++,q++),k.addCssRule(".dgrid-scrollbar-width",
"width: "+r+"px"),k.addCssRule(".dgrid-scrollbar-height","height: "+q+"px"),17!=r&&!f&&(k.addCssRule(".dgrid-header-row","right: "+r+"px"),k.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+r+"px")));f&&(b.style.width=a.clientWidth+"px",setTimeout(function(){b.scrollLeft=a.scrollLeft},0))},addCssRule:function(a,b){var c=k.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(c);return c},on:function(a,b){var c=h(this.domNode,a,b);d("dom-addeventlistener")||this._listeners.push(c);return c},
cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=this.columns){var c=document.getElementById(b);c&&this.removeRow(c,!0)}for(b=0;b<a.length;b++)(c=a[b])&&c.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();delete this._listeners}this._started=!1;this.cleanup();c(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();
this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},newRow:function(a,b,d,e,g){if(b){var f=this.insertRow(a,b,d,e,g);c(f,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){c(f,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return f}},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&c(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+
"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,c){function d(){var b=arguments;if(-1<q)for(var g=0;g<b.length;g++){var f=b[g],h=l[f?0:l.length-1];if(h=h&&e(h)){var k=h[f?"previousSibling":"nextSibling"];k&&(k=m.row(k));k&&k.element!=h&&(f=f?"unshift":"push",a[f](k.data),l[f](k.element),c.count++)}}}function e(a){return!f.isDescendant(a,m.domNode)&&document.getElementById(a.id)?m.row(a.id.slice(m.id.length+5)).element:
a}function g(a){t=m.insertRow(a,r,null,k++,c);t.observerIndex=q;return t}function h(a){u=a.slice(0);(p=b?b.parentNode:m.contentNode)&&p.parentNode&&(p!==m.contentNode||a.length)?(p.insertBefore(r,b||null),(t=a[a.length-1])&&m.adjustRowIndices(t)):n[q]&&m.cleanEmptyObservers&&"undefined"!==typeof q&&(n[q].cancel(),n[q]=0,m._numObservers--);l=a;s&&(s.rows=l)}c=c||{};var m=this,k=c.start||0,n=this.observers,l,p,q;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){m._numObservers++;var s=
a.observe(function(g,f,h){var k,n,s;-1<f&&l[f]&&(k=l.splice(f,1)[0],k.parentNode==p&&((n=k.nextSibling)&&f!=h&&n.rowIndex--,m.removeRow(k)),c.count--,m._processScroll&&m._processScroll());if(-1<h){if(l.length)if(0===h)s=(s=l[h])&&e(s);else{if(s=l[h-1])s=e(s),s=(s.connected||s).nextSibling}else s=m._getFirstRowSibling&&m._getFirstRowSibling(p);k&&(s&&k.id===s.id)&&(s=(s.connected||s).nextSibling);s&&!s.parentNode&&(s=document.getElementById(s.id));k=b&&b.parentNode||s&&s.parentNode||m.contentNode;
if(k=m.newRow(g,k,s,c.start+h,c))if(k.observerIndex=q,l.splice(h,0,k),!n||h<f)n=k.previousSibling,n=!n||n.rowIndex+1==k.rowIndex||0==k.rowIndex?k:n;c.count++}0===f?d(1,1):f===a.length-(-1===h?0:1)&&d(0,0);f!=h&&n&&m.adjustRowIndices(n);m._onNotification(l,g,f,h)},!0);q=n.push(s)-1}var r=document.createDocumentFragment(),t,u;if(a.map){if(l=a.map(g,console.error),l.then)return a.then(function(b){a=b;return l.then(function(a){h(a);d(1,1,0,0);return u})})}else{l=[];for(var w=0,P=a.length;w<P;w++)l[w]=
g(a[w])}h(l);d(1,1,0,0);return u},_onNotification:function(a,b,c,d){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,c,d,e){var g=e.parentId,g=this.id+"-row-"+(g?g+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),f=document.getElementById(g),h=f&&f.previousSibling;f&&(f===c&&(c=(c.connected||c).nextSibling),this.removeRow(f));f=this.renderRow(a,e);f.className=(f.className||"")+" dgrid-row "+(1==d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?
" ui-state-default":"");this._rowIdToObject[f.id=g]=a;b.insertBefore(f,c||null);h&&this.adjustRowIndices(h);f.rowIndex=d;return f},renderRow:function(a,b){return c("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||c(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!=
this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,g;g=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){g=e;b+=0>b?1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||
e===this.headerNode)break;while(b);return g},up:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:d("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):s.call(this,a)}:s,getScrollPosition:d("touch")?function(){return this.useTouchScroll?this.inherited(arguments):p.call(this)}:p,get:function(a){var b="_get"+a.charAt(0).toUpperCase()+
a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:m,_setClass:g,_getClassName:m,_setClassName:g,_setSort:function(a,b){this._sort="string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();this._lastCollection&&(a.length&&
("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(c,d){var e=c[a],g=d[a];void 0===e&&(e="");void 0===g&&(g="");return e==g?0:e>g==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){l.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;c(b,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();
a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){l.deprecated("setShowHeader(...)",'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;c(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(l,e){l.add("dom-contains",function(b,a,d){return!!d.contains});var f=[],h,d,k,n=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,b={defaultDelay:15,
throttle:function(c,a,d){var e=!1;d=d||b.defaultDelay;return function(){e||(e=!0,c.apply(a,arguments),setTimeout(function(){e=!1},d))}},throttleDelayed:function(c,a,d){var e=!1;d=d||b.defaultDelay;return function(){if(!e){e=!0;var b=arguments;setTimeout(function(){e=!1;c.apply(a,b)},d)}}},debounce:function(c,a,d){var e;d=d||b.defaultDelay;return function(){e&&(clearTimeout(e),e=null);var b=arguments;e=setTimeout(function(){c.apply(a,b)},d)}},each:function(b,a,d){var e,f;if(b)if("number"===typeof b.length){e=
0;for(f=b.length;e<f;e++)a.call(d,b[e],e,b)}else for(e in b)a.call(d,b[e],e,b)},contains:function(b,a){return l("dom-contains")?b.contains(a):b.compareDocumentPosition(a)&8},addCssRule:function(b,a){h||(h=e(document.getElementsByTagName("head")[0],"style"),h=h.sheet||h.styleSheet,d=h.deleteRule?"deleteRule":"removeRule",k=h.cssRules?"cssRules":"rules");var g=f.length;f[g]=(h.cssRules||h.rules).length;h.addRule?h.addRule(b,a):h.insertRule(b+"{"+a+"}",f[g]);return{get:function(a){return h[k][f[g]].style[a]},
set:function(a,b){"undefined"!==typeof f[g]&&(h[k][f[g]].style[a]=b)},remove:function(){var a=f[g],b,c;if(void 0!==a){h[d](a);f[g]=void 0;b=g+1;for(c=f.length;b<c;b++)f[b]>a&&f[b]--}}}},escapeCssIdentifier:function(b,a){return"string"===typeof b?b.replace(n,a||"\\$1"):b}};return b})},"xstyle/has-class":function(){define(["dojo/has"],function(l){var e={};return function(){for(var f,h=arguments,d=0;d<h.length;d++)if(f=h[d],!e[f]){e[f]=!0;var k=f.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),n=l(k[2]),
b=-k[4];if((0<b?b<=n&&(-k[5]||b)>=n:!!n)==!k[1])document.documentElement.className+=" has-"+f}}})},"xstyle/css":function(){define(["require"],function(l){function e(e,h,d){var k=document.documentElement;e=k.insertBefore(document.createElement(e),k.firstChild);e.id=h;h=(e.currentStyle||getComputedStyle(e,null))[d];k.removeChild(e);return h}return{load:function(f,h,d,k){function n(){var a=e("x-parse",null,"content");a&&"none"!=a?h([eval(a)],d):d()}var b=h.toUrl(f),c=h.cache["url:"+b];if(c)return c.xCss&&
(c=c.cssText),l(["./util/createStyleSheet"],function(a){a(c)}),n();if("none"==e("div",f.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return n();l(["./load-css"],function(a){a(b,n)})}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(l,e,f,h,d,k,n,b,c){return f("dgrid.OnDemandList",[l,e],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,
farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:b.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var a=this;n(this.bodyNode,"scroll",b[this.pagingMethod](function(b){a._processScroll(b)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(a,b){function e(a){c(v,"!");if(a)throw f._refreshDeferred&&(f._refreshDeferred.reject(a),delete f._refreshDeferred),
a;}var f=this,k=b&&b.container||this.contentNode,n={query:a,count:0,options:b},l,t=this.preload,u,w={node:c(k,"div.dgrid-preload",{rowIndex:0}),count:0,query:a,next:n,options:b};w.node.style.height="0";n.node=l=c(k,"div.dgrid-preload");n.previous=w;l.rowIndex=this.minRowsPerPage;t?((n.next=t.next)&&l.offsetTop>=t.node.offsetTop?n.previous=t:(n.next=t,n.previous=t.previous),n.previous.next=n,n.next.previous=n):this.preload=n;var v=c(l,"-div.dgrid-loading");c(v,"div.dgrid-below").innerHTML=this.loadingMessage;
b=h.mixin(this.get("queryOptions"),b,{start:0,count:this.minRowsPerPage},"level"in a?{queryLevel:a.level}:null);this._trackError(function(){return u=a(b)});if("undefined"===typeof u)e();else return d.when(f.renderArray(u,l,b),function(a){return d.when("undefined"===typeof u.total?u.length:u.total,function(d){var e=a.length,h=l.parentNode,k=f.noDataNode;c(v,"!");"queryLevel"in b||(f._total=d);0===d&&h&&(k&&(c(k,"!"),delete f.noDataNode),f.noDataNode=k=c("div.dgrid-no-data"),h.insertBefore(k,f._getFirstRowSibling(h)),
k.innerHTML=f.noDataMessage);for(k=h=0;k<e;k++)h+=f._calcRowHeight(a[k]);e&&h&&(f.rowHeight=h/e);d-=e;n.count=d;l.rowIndex=e;d?l.style.height=Math.min(d*f.rowHeight,f.maxEmptySpace)+"px":(l.style.display="none",b.count++);f._previousScrollPosition&&(f.scrollTo(f._previousScrollPosition),delete f._previousScrollPosition);f._processScroll();f._refreshDeferred&&(f._refreshDeferred.resolve(u),delete f._refreshDeferred);return a},e)},e),u},refresh:function(a){var b=this,c=a&&a.keepScrollPosition,e;"undefined"===
typeof c&&(c=this.keepScrollPosition);c&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return c=this._refreshDeferred=new d,e=b.renderQuery(function(a){return b.store.query(b.query,a)}),"undefined"===typeof e&&c.reject(),c.then(function(a){b._refreshTimeout=setTimeout(function(){n.emit(b.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:b,results:a});b._refreshTimeout=null},0);delete b._refreshDeferred;return a},function(a){delete b._refreshDeferred;
throw a;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var b=a.nextSibling;return b&&!/\bdgrid-preload\b/.test(b.className)?b.offsetTop-a.offsetTop:a.offsetHeight},lastScrollTop:0,_processScroll:function(a){function b(a,d,f,g){var h=k.farOffRemoval,n=a.node;if(d>2*h){for(var l,p=n[f],q=0,t=0,r=[];l=p;){var u=k._calcRowHeight(l);if(q+u+h>d||0>p.className.indexOf("dgrid-row")&&0>p.className.indexOf("dgrid-loading"))break;
p=l[f];q+=u;t+=l.count||1;k.removeRow(l,!0);r.push(l)}a.count+=t;g?(n.rowIndex-=t,e(a)):n.style.height=n.offsetHeight+q+"px";var w=c("div",r);setTimeout(function(){c(w,"!")},1)}}function e(a,b){a.node.style.height=Math.min(a.count*k.rowHeight,b?Infinity:k.maxEmptySpace)+"px"}function f(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var k=this,n=k.bodyNode;a=a&&a.scrollTop||this.getScrollPosition().y;var n=n.offsetHeight+a,l,t,u=k.preload,w=k.lastScrollTop,v=k.bufferRows*k.rowHeight,
x=v-k.rowHeight,B,D,C,F=!0;for(k.lastScrollTop=a;u&&!u.node.offsetWidth;)u=u.previous;for(;u&&u!=l;){l=k.preload;k.preload=u;t=u.node;var z=t.offsetTop;if(n+1+x<z)u=f(u,F=!1);else if(a-1-x>z+t.offsetHeight)u=f(u,F=!0);else{var A=((t.rowIndex?a-v:n)-z)/k.rowHeight,z=(n-a+2*v)/k.rowHeight,E=Math.max(Math.min((a-w)*k.rowHeight,k.maxRowsPerPage/2),k.maxRowsPerPage/-2),z=z+Math.min(Math.abs(E),10);0==t.rowIndex&&(A-=z);A=Math.max(A,0);10>A&&(0<A&&z+A<k.maxRowsPerPage)&&(z+=Math.max(0,A),A=0);z=Math.min(Math.max(z,
k.minRowsPerPage),k.maxRowsPerPage,u.count);if(0==z)u=f(u,F);else{var z=Math.ceil(z),A=Math.min(Math.floor(A),u.count-z),H=h.mixin(k.get("queryOptions"),u.options);u.count-=z;var K=t,O,G=k.queryRowsOverlap;if(E=(0<t.rowIndex||t.offsetTop>a)&&u){var J=u.previous;J&&(b(J,a-(J.node.offsetTop+J.node.offsetHeight),"nextSibling"),0<A&&J.node==t.previousSibling?(A=Math.min(u.count,A),u.previous.count+=A,e(u.previous,!0),t.rowIndex+=A,G=0):z+=A,u.count-=A);H.start=t.rowIndex-G;H.count=Math.min(z+G,k.maxRowsPerPage);
t.rowIndex=H.start+H.count}else u.next&&(b(u.next,u.next.node.offsetTop-n,"previousSibling",!0),K=t.nextSibling,K==u.next.node?(u.next.count+=u.count-A,u.next.node.rowIndex=A+z,e(u.next),u.count=A,G=0):O=!0),H.start=u.count,H.count=Math.min(z+G,k.maxRowsPerPage);O&&(K&&K.offsetWidth)&&(O=K.offsetTop);e(u);"level"in u.query&&(H.queryLevel=u.query.level);if("queryLevel"in H||!(H.start>k._total||0>H.count)){t=c(K,"-div.dgrid-loading[style\x3dheight:"+z*k.rowHeight+"px]");c(t,"div.dgrid-"+(E?"below":
"above")).innerHTML=k.loadingMessage;t.count=z;var y=u.query(H);if(void 0===k._trackError(function(){return y})){c(t,"!");return}(function(a,b,f,g){C=d.when(k.renderArray(g,a,H),function(h){D=g;K=a.nextSibling;c(a,"!");if(f&&K&&K.offsetWidth){var n=k.getScrollPosition();k.scrollTo({x:n.x,y:n.y+K.offsetTop-f,preserveMomentum:!0})}d.when(g.total||g.length,function(a){"queryLevel"in H||(k._total=a);b&&(b.count=a-b.node.rowIndex,0===b.count&&H.count++,e(b))});k._processScroll();return h},function(b){c(a,
"!");throw b;})}).call(this,t,E,O,y);u=u.previous}}}}if(C&&(B=this._refreshDeferred))delete this._refreshDeferred,d.when(C,function(){B.resolve(D)})},removeRow:function(a,b){if(a){var c=a.previousSibling,d=a.nextSibling,c=c&&(null!=c.observerIndex?c.observerIndex:c.previousObserverIndex),e=d&&(null!=d.observerIndex?d.observerIndex:d.nextObserverIndex),d=a.observerIndex;a.observerIndex=void 0;b&&(a.nextObserverIndex=e,a.previousObserverIndex=c);if(this.cleanEmptyObservers&&(-1<d&&d!==c&&d!==e)&&(c=
this.observers,e=c[d])){if(!b)for(var f=e.rows,h=0;h<f.length;h++)if(f[h]!=a&&k.isDescendant(f[h],this.domNode))return this.inherited(arguments);e.cancel();this._numObservers--;c[d]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),function(l,e,f,h,d,k,n){function b(a){return a}function c(a){if("object"!==typeof a)a=Error(a);else if("cancel"===a.dojoType)return;
a.grid=this;d.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return e("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};k.before(this,"configStructure",f.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},
destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_updateNotifyHandle:function(a){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);a&&("function"===typeof a.notify&&this.shouldObserveStore)&&(this._notifyHandle=k.after(a,"notify",f.hitch(this,"_onNotify"),!0),a=this.get("sort"),(!a||!a.length)&&console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},
_setStore:function(a,b,c){this._updateNotifyHandle(a);this.store=a;this.dirty={};this.set("query",b,c)},_setQuery:function(a,b){var c=b&&b.sort;this.query=void 0!==a?a:this.query;this.queryOptions=b||this.queryOptions;this._started&&(c?this.set("sort",c):this.refresh())},setStore:function(a,b,c){l.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",a,b,c)},setQuery:function(a,b){l.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",
a,b)},_getQueryOptions:function(){var a=f.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)a.sort=this._sort;return a},_getQuery:function(){var a=this.query;return"object"==typeof a&&null!=a?f.delegate(a,{}):a},_setSort:function(a,b){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(a,b){this.inherited(arguments);a&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var a=this.inherited(arguments);
this.store||(this.noDataNode=n(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return a},renderArray:function(){var a=this,b=this.inherited(arguments);this.store||h.when(b,function(b){b.length&&a.noDataNode&&n(a.noDataNode,"!")});return b},insertRow:function(a,b,c,d,e){var h=this.store,k=this.dirty,h=h&&h.getIdentity(a),n;h in k&&!(h in this._updating)&&(n=k[h]);n&&(a=f.delegate(a,n));return this.inherited(arguments)},updateDirty:function(a,b,c){var d=this.dirty,
e=d[a];e||(e=d[a]={});e[b]=c},setDirty:function(a,b,c){l.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(a,b,c)},save:function(){function a(a,e){return function(f){var k=b._columnsWithSet,n=b._updating,l,q;if("function"===typeof f.set)f.set(e);else for(l in e)f[l]=e[l];for(l in k)q=k[l].set(f),void 0!==q&&(f[l]=q);n[a]=!0;return h.when(c.put(f),function(){delete d[a];delete n[a]})}}var b=this,c=this.store,d=this.dirty,e=new h,f=e.promise,k=function(a){var d;return b.getBeforePut||
!(d=b.row(a).data)?function(){return c.get(a)}:function(){return d}},n;for(n in d)var l=a(n,d[n]),f=f.then(k(n)).then(l);e.resolve();return f},revert:function(){this.dirty={};this.refresh()},_trackError:function(a){var d;"string"==typeof a&&(a=f.hitch(this,a));try{d=a()}catch(e){c.call(this,e)}return h.when(d,b,f.hitch(this,c))},newRow:function(){var a=this.inherited(arguments);this.noDataNode&&(n(this.noDataNode,"!"),delete this.noDataNode);return a},removeRow:function(a,b){var c={element:a};!b&&
(this.noDataMessage&&this.up(c).element===a&&this.down(c).element===a)&&(this.noDataNode=n(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(l,e,f,h,d,k,n,b,c){function a(a,b){for(var c=a.unselectable=b?"on":
"",d=a.getElementsByTagName("*"),e=d.length;--e;)"INPUT"===d[e].tagName||"TEXTAREA"===d[e].tagName||(d[e].unselectable=c)}function g(b,c){var e=b.bodyNode,f=c?"text":21>d("ff")?"-moz-none":"none";p&&"msUserSelect"!==p?e.style[p]=f:d("dom-selectstart")?!c&&!b._selectstartHandle?b._selectstartHandle=h(e,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):c&&b._selectstartHandle&&(b._selectstartHandle.remove(),delete b._selectstartHandle):(a(e,
!c),!c&&!b._unselectableHandle?b._unselectableHandle=k.after(b,"renderRow",function(b){a(b,!0);return b}):c&&b._unselectableHandle&&(b._unselectableHandle.remove(),delete b._unselectableHandle))}d.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});d.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});d.add("css-user-select",function(a,b,c){a=c.style;b=["Khtml","O","ms","Moz","Webkit"];c=b.length;var d="userSelect";do if("undefined"!==
typeof a[d])return d;while(c--&&(d=b[c]+"UserSelect"));return!1});d.add("dom-selectstart","undefined"!==typeof document.onselectstart);var m=d("mac")?"metaKey":"ctrlKey",p=d("css-user-select"),s=(n=d("pointer"))&&"MS"===n.slice(0,2),r=n?n+(s?"Down":"down"):"mousedown",q=n?n+(s?"Up":"up"):"mouseup";return e("dgrid.Selection",null,{selectionDelegate:".dgrid-row",selectionEvents:r+","+q+",dgrid-cellfocusin",selectionTouchEvents:d("touch")?b.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},
selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},
_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){l.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?g(this,a):g(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,
b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&!("dgrid-cellfocusin"===a.type&&"mousedown"===a.parentType||a.type===q&&b!=this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===r&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](a,b);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){var c=a.keyCode?a.ctrlKey:a[m];this._lastSelected===
b?this.select(b,null,!c||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c=this._lastSelected,d=a.keyCode?a.ctrlKey:a[m],e;a.shiftKey||(e=d?null:!0,c=null);this.select(b,c,e);c||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?!this.isSelected(b):!(a.keyCode?a.ctrlKey:a[m]))&&this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,
null,null)},_initSelectionEvents:function(){var a=this,c=this.contentNode,e=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};d("touch")&&!d("pointer")&&this.selectionTouchEvents?(h(c,b.selector(e,this.selectionTouchEvents),function(b){a._handleSelect(b,this);a._ignoreMouseSelect=this}),h(c,h.selector(e,this.selectionEvents),function(b){a._ignoreMouseSelect!==this?a._handleSelect(b,this):b.type===q&&(a._ignoreMouseSelect=null)})):h(c,h.selector(e,this.selectionEvents),function(b){a._handleSelect(b,
this)});this.addKeyHandler&&this.addKeyHandler(32,function(b){a._handleSelect(b,b.target)});if(this.allowSelectAll)this.on("keydown",function(b){b[m]&&(65==b.keyCode&&!/\bdgrid-input\b/.test(b.target.className))&&(b.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())});this._setStore&&k.after(this,"_setStore",function(){a._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(c,d,e){c=d||c&&c[b.idProperty||"id"];if(null!=c&&(d=(c=
b.row(c))&&b.selection[c.id]))b[e](c,null,d)}var b=this,c=this.store,d,e;this._removeDeselectSignals&&this._removeDeselectSignals();c&&c.notify?(d=k.before(c,"notify",function(b,c){b||a(b,c,"deselect")}),e=k.after(c,"notify",function(b,c){a(b,c,"select")},!0),this._removeDeselectSignals=function(){d.remove();e.remove()}):(d=k.before(this,"removeRow",function(a,b){var c;b||(c=this.row(a))&&c.id in this.selection&&this.deselect(c)}),this._removeDeselectSignals=function(){d.remove()})},allowSelect:function(a){return!0},
_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];h.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,b,d){var e,f,g;"undefined"===typeof d&&(d=!0);a.element||(a=this.row(a));if(!1===d||this.allowSelect(a))if(e=
this.selection,f=!!e[a.id],null===d&&(d=!f),g=a.element,!d&&!this.allSelected?delete this.selection[a.id]:e[a.id]=d,g&&(d?c(g,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):c(g,"!dgrid-selected!ui-state-active")),d!==f&&g&&this._selectionEventQueues[(d?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element){e=this._determineSelectionDirection(g,b);e||(b=document.getElementById(b.id),e=this._determineSelectionDirection(g,b));for(;a.element!=b&&(a=this[e](a));)this._select(a,
null,d)}}else this._lastSelected=g,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:d("dom-comparedocumentposition")?function(a,b){var c=b.compareDocumentPosition(a);return c&1?!1:2===c?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>
a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===
typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);f.when(b,function(b){var c=a.selection,d,e,f;for(d=0;d<b.length;d++)e=a.row(b[d]),(f=e.id in c?c[e.id]:a.allSelected)&&a._select(e,null,f);a._fireSelectionEvents()});
return b}})})},"xstyle/main":function(){define("xstyle/main",["require","put-selector/put"],function(l,e){function f(a,b){return a&&a.then?a.then(b):b(a)}function h(a,b,c){return f(a,function(a){var d=b[0];if(!a)return c(d||a);if(d&&a.get)return h(a.get(d),b.slice(1),c);if(a.receive)return a.receive(d?function(a){h(a,b,c)}:c);if(d)return h(a[d],b.slice(1),c);c(a)})}function d(a,b,c){h(a,b.slice(0,b.length-1),function(a){var d=b[b.length-1];a.set?a.set(d,c):a[d]=c})}function k(a){a=z.getElementsByTagName(a);
for(var b=0;b<a.length;b++)c(a[b])}function n(){return this.join("")}function b(a){this.value=a}function c(b,d,e){function f(){l(["xstyle/load-imports"],function(a){a(b,function(){c(b,d,!0)})})}var g=b.sheet||b.styleSheet||b,h=g.needsParsing,k=g.rules||g.cssRules;if(g.imports&&!e&&g.imports.length)return f();if(!h)for(var m=0;m<k.length;m++){var n=k[m];if(n.href&&!e)return f();n.selectorText&&"x-"==n.selectorText.substring(0,2)&&(h=!0,/^'/.test(n.style.content))}a(g.localSource||(g.ownerNode||g.ownerElement).innerHTML,
g,d)}function a(c,d,e){function g(a,b,c){(C[a]||(C[a]={}))[b]=c}function h(a){C[a]||(C[a]={});g("selector","x-"+a,{onRule:function(b){b.eachProperty(function(b,c){var d=c.toString();do{d=d.match(/([^, \(]+)(?:[, ]+(.+))?/);if(!d)break;var e=d[1];if("module"==e)return g(a,b,c[1].args[0]);if("default"==e){if("pseudo"==a)try{z.querySelectorAll("x:"+b);break}catch(f){}}else if("prefix"!=e)return g(a,b,function(){return c})}while(d=d[2])})}})}function k(){}function m(a){this.caller=a;this.args=[]}function p(a,
b){b.onRule();var c=C.selector[a];c&&s(c,"onRule",b)}function s(a,b,c,f){if(a){var g=I,h=function(a){"string"==typeof a&&d.addRule(g.fullSelector(),a);0==--G&&e&&e(d)};G++;var k=function(a){function e(a){console.error("Error occurred processing "+b.slice(2).toLowerCase()+" "+c+("{"==g.operator?' in rule "'+g.selector+'" {'+g.cssText:"")+". "+a.message);a&&console.error(a)}try{var k=a[b](c,f,g,d);g instanceof m&&(g.result=k);k&&k.then?k.then(h,e):h(k)}catch(n){e(n)}};"string"==typeof a?l([a],k):k(a)}}
function y(c,d){function f(a,b){b||(k+=a);if(E)if(E.push)"string"==typeof E[E.length-1]&&"string"==typeof a?E[E.length-1]+=a:a&&E.push(a);else if("string"==typeof E&&"string"==typeof a)E+=a;else{var c=[E,a];c.toString=n;E=c}else E=a}I=H;for(var g=w.lastIndex=0,h=!0,k="",m=!0;;){var l=w.exec(c),q=l[4],r=l[1],z=l[2],l=l[3],P,N,E,R,l=l&&A(l),r=A(r);if(m){if(z?(k=N=r,P=z.charAt(0),R="?"==z.charAt(1)):k=l=r,E=l,N||"/"!=q)m=!1}else l=l?r+z:r,f(l);switch(q){case "'":case '"':var S="'"==q?v:x;S.lastIndex=
w.lastIndex;(q=S.exec(c))||error("unterminated string");q=q[1];w.lastIndex=S.lastIndex;f(new b(q));continue;case "/":"*"==c[w.lastIndex]?(B.lastIndex=w.lastIndex+1,B.exec(c),w.lastIndex=B.lastIndex):f("/");continue;case "\\":q=S.lastIndex++;f(c.charAt(q));continue;case "(":case "{":case "[":var U=!1;if("{"==q){m=!0;f(r=I.newRule(k),!0);if(P){h=!1;if(!z||"\x3e"==z.charAt(1))E.creating=!0;"\x3d"==P&&l&&(U=!0)}I.root&&h&&(r.cssRule=d.cssRules[g++])}else z=l.match(/(.*?)([\w-]*)$/),f(r=I.newCall(z[2],
E,I)),r.ref=t(I,z[2]),(E.calls||(E.calls=[])).push(r);r.parent=I;r.selector=E.creating?".x-generated-"+D++:I.root?k:I.selector+" "+k;U&&(z=t(I,l.match(/[^\s]+$/)[0],!0))&&u(z,r);I.currentName=N;I.currentSequence=E;I.assignmentOperator=P;J.push(I=r);I.operator=q;I.start=w.lastIndex;k="";I.selector&&I.selector.replace(/:([-\w]+)/,function(a,b){var c=C.pseudo[b];c&&s(c,"onPseudo",b,I)});E=N=null;continue}if(E)if(r=E[0],r.charAt&&"@"==r.charAt(0))"import"==E[0].slice(1,7)&&(z=a.getStyleSheet(d.cssRules[g++],
E,d),G++,l=w.lastIndex,y(z.localSource,z),w.lastIndex=l);else try{I[":"==P?"setValue":"declareProperty"](N,E,R)}catch(T){console.error(T.stack||T)}switch(q){case ":":m=!0;P=":";break;case "}":case ")":case "]":F[I.operator]!=q&&console.error("Incorrect opening operator "+I.operator+" with closing operator "+q);N=null;I.cssText=c.slice(I.start,w.lastIndex-1);"}"==q&&(p(I.selector,I),h=!0,k="");J.pop();I=J[J.length-1];E=I.currentSequence;N=I.currentName;P=I.assignmentOperator;I.root&&"}"==q&&(m=!0,
P=!1);break;case "":e&&e();return;case ";":E=null,m=!0,P=h=!1,k=""}}}d.addRule||(d.addRule=function(a,b,c){return this.insertRule(a+"{"+b+"}",0<=c?c:this.cssRules.length)});d.deleteRule||(d.deleteRule=d.removeRule);var C={property:{}};h("property");h("function");h("pseudo");C["function"]["var"]=Q;C["function"]["extends"]=Q;var G=1;(d.href||location.href).replace(/[^\/]+$/,"");k.prototype={eachProperty:function(a){for(var b=this.values||0,c=0;c<b.length;c++){var d=b[c];a.call(this,d||"unnamed",b[d])}},
fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){return(this.rules||(this.rules={}))[a]=new k},newCall:function(a,b,c){return new m(a)},addSheetRule:function(a,b){if(b&&"@"!=a.charAt(0)){var c=d.addRule(a,b);-1==c&&(c=d.cssRules.length-1);return d.cssRules[c]}},onRule:function(){this.getCssRule()},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},
declareProperty:function(a,b,c){if("\x3e"==b[0].toString().charAt(0))a||(this.generator=b,b=r(b,this),Q.addRenderer("",b,this,b));else{var d=a in E.style||t(this,a);if(!c||!d)(this.properties||(this.properties={}))[a]=b,d&&console.warn('Overriding existing property "'+a+'"')}},setValue:function(a,b){var c=this.values||(this.values=[]);c.push(a);c[a]=b;if(c=b.calls)for(var d=0;d<c.length;d++){var e=c[d],g=e.ref;g&&"function"==typeof g.call&&g.call(e,this,a,b)}if(a){do{if(c=t(this,a)){var h=this;f(q(h,
a,c),function(c){c=c.splice?c:[c];for(var d=0;d<c.length&&!c[d].put(b,h,a);d++);});break}a=a.substring(0,a.lastIndexOf("-"))}while(a)}},cssText:""};var R=m.prototype=new k;R.declareProperty=R.setValue=function(a,b){this.args.push(b)};R.toString=function(){var a=this.operator;return a+this.args+F[a]};var I,H=new k;H.root=!0;H.properties={Math:Math,module:function(a){return{then:function(b){l([a],b)}}},item:{forElement:function(a){for(;!a.item;)a=a.parentNode;return{element:a,receive:function(b){b(a.item)}}}},
prefix:{put:function(a,b,c){if("string"==typeof E.style[K+c])return b.addSheetRule(b.selector,K+c+":"+a)}},"var":{put:function(a,b,c){(b.variables||(b.variables={}))[c]=a;b=(b=b.variableListeners)&&b[c]||0;for(c=0;c<b.length;c++)b[c](a)},call:function(a,b,c,d){this.receive(function(a){b.addSheetRule(b.selector,c+": "+d.toString().replace(/var\([^)]+\)/g,a))},b,a.args[0])},receive:function(a,b,c){var d=b;do{if(b=d.variables&&d.variables[c])return d=d.variableListeners||(d.variableListeners={}),(d[c]||
(d[c]=[])).push(a),a(b);d=d.parent}while(d);a()}},on:{put:function(a,b,c){console.log("add event listener");q(b,c,a)}}};H.css=c;H.parse=y;var J=[H];y(c,d);0==--G&&e&&e(d);return H}function g(){k("link");k("style");if(!L)if(L=!0,O["dom-qsa2.1"]){for(var a=0,b=J.length;a<b;a++)m(J[a]);p()}else for(var c=z.all,a=0,b=c.length;a<b;a++)s(c[a])}function m(a){for(var b=z.querySelectorAll(a.selector),c=a.name,d=0,e=b.length;d<e;d++){var f=b[d],g=f.elementalStyle;g||(g=f.elementalStyle={},f.elementalSpecificities=
{});var h=f.renderings;h||(h=f.renderings=[],y.push(f));h.push({name:c,rendered:g[c]==a.propertyValue,renderer:a});g[c]=a.propertyValue}}function p(){for(var a=0;a<y.length;a++){var b=y[a],c=b.renderings,d=b.elementalStyle;delete b.renderings;for(var f=0;f<c.length;f++){var g=c[f],h=g.renderer,k=h.rendered;M=d[g.name]==h.propertyValue;if(!k&&M)try{h.render(b)}catch(m){console.error(m,m.stack),e(b,"div.error",m.toString())}k&&(!M&&h.unrender)&&(h.unrender(b),c.splice(f--,1))}}y=[]}function s(a,b){for(var c=
0,d=J.length;c<d;c++){var e=J[c];(!b||b==e.selector)&&(G?G.call(a,e.selector):a.currentStyle[e.name]==e.propertyValue)&&e.render(a)}}function r(a,b){D++;a=a.sort?a:[a];return function(c,d){for(var g=c,h=0,k=a.length;h<k;h++){var m=a[h];try{if(m.eachProperty)if(m.args)if("("==m.operator){var n=a[h+1];n&&n.eachProperty&&e(g,n.selector);var l=m.args.toString(),p=q(m,0,l);(function(a,c){f(p,function(d){d.forElement&&(d=d.forElement(c));var f=a.appendChild(z.createTextNode("Loading"));d.receive(function(b){if(b&&
b.sort){f&&(f.parentNode.removeChild(f),f=null);var c=n&&n.eachProperty&&n.get("each");c&&(c=r(c,n));b.forEach(c?function(b){c(a,b)}:function(b){e(a,C[a.tagName]||"div",b)})}else"value"in a?(a.value=b,a["-x-variable"]=d):f.nodeValue=b},b,l)})})(g,c)}else e(g,m.toString());else e(g,m.selector),Q.update(g,m.selector);else if("string"==typeof m){"\x3d"==m.charAt(0)&&(m=m.slice(1));for(var s=m.split(","),m=0,t=s.length;m<t;m++){var u=s[m].trim();if(u){var u=u.replace(/\([^)]*\)/,function(a){}),w=e(0==
m?g:c,u);d&&(w.item=d);n=a[h+1];w!=g&&(!n||!n.eachProperty)&&Q.update(w);g=w}}}else g.appendChild(z.createTextNode(m.value))}catch(v){console.error(v,v.stack),g.appendChild(z.createTextNode(v))}}return g}}function q(a,b,c){function e(){var a=k.length+1,b=[],c=[],g,m,n=function(d){return function(e){b[d]=e;a--;if(0>=a){m=!0;g=p?p.apply(this,b):b[0];for(e=0;e<c.length;e++)c[e](g)}}};if(p)for(var l=0;l<k.length;l++){var q=k[l];h(q[0],q.slice(1),n(l))}else{var q=k[0],r={then:function(a){c.push(a)}};f(q[0],
function(a){r=a;for(var b=1;b<q.length;b++)if(r&&r.get)r=r.get(q[b]);else{r={receive:function(b){h(a,q.slice(1),b)},put:function(a){d(resolve,q.slice(1),a)}};break}for(b=0;b<c.length;b++)c[b](r)});return r}n(-1)();return g&&g.then?g:{receive:function(a){c&&c.push(a);m&&a(g)}}}var g=a["var-expr-"+b];if(k)return g;var k=[],m;k.id=D++;var n=[],l;c=c.join?c.join(""):c.toString();g=c.match(/^[\w_$\/\.-]*$/);c=c.replace(/("[^\"]*")|([\w_$\.\/-]+)/g,function(b,c,d){if(d){l=d.split("/");b=l.join("_");n.push(b);
k.push(l);c=l[0];d=t(a,c);if("string"==typeof d||d instanceof Array)d=q(a,c,d);else if(!d)throw Error('Could not find reference "'+c+'"');d.forElement&&(m=!0);l[0]=d}return b});if(!g)var p=Function.apply(this,n.concat(["return xstyleReturn("+c+")"]));k.func=p;a["var-expr-"+b]=k;return a["var-expr-"+b]=m?{forElement:function(b){for(var c,d=b;!G.call(b,a.selector);)b=b.parentNode;for(b=0;b<k.length;b++){var f=k[b],g=f[0];g.forElement&&(g=f[0]=g.forElement(d));f=g.element;if(d!=c){for(;d!=f;){if(d==
c)return;d=d.parentNode}c=d}}d=c["expr-result-"+k.id];d||(c["expr-result-"+k.id]=d=e(),d.element=c);return d}}:e()}function t(a,b,c){do{var d=a.properties&&a.properties[b]||c&&a.rules&&a.rules[b];a=a.parent}while(!d&&a);return d}function u(a,b){b.cssText+=a.cssText;"values,properties,variables,calls".replace(/\w+/g,function(c){a[c]&&(b[c]=Object.create(a[c]))});var c=b.getCssRule();a.eachProperty(function(a,d){b.setValue(a,d);if(a){var e=c.style;e[a]||(e[a]=d)}});a.generator&&b.declareProperty(null,
a.generator)}var w=/\s*([^{\}\[\]\(\)\/\\'":=;]*)([=:]\??\s*([^{\}\[\]\(\)\/\\'":;]*))?([{\}\[\]\(\)\/\\'":;]|$)/g,v=/((?:\\.|[^'])*)'/g,x=/((?:\\.|[^"])*)"/g,B=/\*\//g,D=0,C={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},F={"{":"}","[":"]","(":")"},z=document,A="".trim?function(a){return a.trim()}:function(a){return a.replace(/^\s+|\s+$/g,"")},E=z.createElement("div");b.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};var H=navigator.userAgent,
K=-1<H.indexOf("WebKit")?"-webkit-":-1<H.indexOf("Firefox")?"-moz-":-1<H.indexOf("MSIE")?"-ms-":-1<H.indexOf("Opera")?"-o-":"";a.getStyleSheet=function(a,b){return a.styleSheet};z.addEventListener("change",function(a){a=a.target;var b=a["-x-variable"];b.put&&b.put(a.value)});var E=z.createElement("div"),O={"dom-qsa2.1":!!E.querySelectorAll},G=E.matches||E.matchesSelector||E.webkitMatchesSelector||E.mozMatchesSelector||E.msMatchesSelector||E.oMatchesSelector,J=[],y=[],L;/e/.test(z.readyState||"")?
setTimeout(g,200):z.addEventListener("DOMContentLoaded",g);var M,Q={process:c,vendorPrefix:K,applyProperty:function(a,b){return"opacity"==a&&"-ms-"==K?"filter: alpha(opacity\x3d"+100*b+"); zoom: 1;":K+a+":"+b+";"},onFunction:function(a,b,c){},onCall:function(a,b){function c(){var b=e,f="extends"==a?"rules":"variables";do{if(!b)throw Error('Could not find "'+d[0]+'" in the defined '+f);var g=b[f]&&b[f][d[0]],b=b.parent}while(!g);return g}var d=b.args,e=b.parent;if("extends"==a){var f=c();u(f,e)}else if("var"==
a)return function(a){a.addSheetRule(a.selector,a.currentName+": "+a.currentSequence.toString().replace(/var\([^)]+\)/g,c()))}},parse:a,addRenderer:function(a,b,c,d){a={selector:c.selector,propertyValue:b,name:a,render:d};J.push(a);L&&m(a);p()},update:s,clearRenderers:function(){J=[]},load:function(a,b,c,d){b(["xstyle/css"],function(e){e.load(a,b,c,d)})}};return Q});xstyleReturn=function(l){return 1==arguments.length?l:[].slice.call(arguments)}},"dojo/store/Memory":function(){define(["../_base/declare",
"./util/QueryResults","./util/SimpleQueryEngine"],function(l,e,f){return l("dojo.store.Memory",null,{constructor:function(e){for(var d in e)this[d]=e[d];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:f,get:function(e){return this.data[this.index[e]]},getIdentity:function(e){return e[this.idProperty]},put:function(e,d){var f=this.data,n=this.index,b=this.idProperty,b=e[b]=d&&"id"in d?d.id:b in e?e[b]:Math.random();if(b in n){if(d&&!1===d.overwrite)throw Error("Object already exists");
f[n[b]]=e}else n[b]=f.push(e)-1;return b},add:function(e,d){(d=d||{}).overwrite=!1;return this.put(e,d)},remove:function(e){var d=this.index,f=this.data;if(e in d)return f.splice(d[e],1),this.setData(f),!0},query:function(f,d){return e(this.queryEngine(f,d)(this.data))},setData:function(e){e.items?(this.idProperty=e.identifier||this.idProperty,e=this.data=e.items):this.data=e;this.index={};for(var d=0,f=e.length;d<f;d++)this.index[e[d][this.idProperty]]=d}})})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],
function(l){return function(e,f){function h(d){d=l.filter(d,e);var h=f&&f.sort;h&&d.sort("function"==typeof h?h:function(b,a){for(var d,e=0;d=h[e];e++){var f=b[d.attribute],k=a[d.attribute],f=null!=f?f.valueOf():f,k=null!=k?k.valueOf():k;if(f!=k)return!!d.descending==(null==f||f>k)?-1:1}return 0});if(f&&(f.start||f.count)){var b=d.length;d=d.slice(f.start||0,(f.start||0)+(f.count||Infinity));d.total=b}return d}switch(typeof e){default:throw Error("Can not query with a "+typeof e);case "object":case "undefined":var d=
e;e=function(e){for(var f in d){var b=d[f];if(b&&b.test){if(!b.test(e[f],e))return!1}else if(b!=e[f])return!1}return!0};break;case "string":if(!this[e])throw Error("No filter function "+e+" was found in store");e=this[e];case "function":}h.matches=e;return h}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m){f.isAsync||
b(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var p=e("dojo.dnd.Source",g,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){h.mixin(this,h.mixin({},b));var e=this.accept;if(e.length){this.accept={};for(var f=0;f<e.length;++f)this.accept[e[f]]=1}this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState=
"";this.isSource&&d.add(this.node,"dojoDndSource");this.targetState="";this.accept&&d.add(this.node,"dojoDndTarget");this.horizontal&&d.add(this.node,"dojoDndHorizontal");this.topics=[c.subscribe("/dnd/source/over",h.hitch(this,"onDndSourceOver")),c.subscribe("/dnd/start",h.hitch(this,"onDndStart")),c.subscribe("/dnd/drop",h.hitch(this,"onDndDrop")),c.subscribe("/dnd/cancel",h.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var c=0;c<
b.length;++c){for(var d=a.getItem(b[c].id).type,e=!1,f=0;f<d.length;++f)if(d[f]in this.accept){e=!0;break}if(!e)return!1}return!0},copyState:function(a,b){if(a)return!0;2>arguments.length&&(b=this==m.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){p.superclass.destroy.call(this);l.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(b){if(!(this.isDragging&&"Disabled"==this.targetState)){p.superclass.onMouseMove.call(this,
b);var c=m.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(b.pageX-this._lastX)>this.delay||Math.abs(b.pageY-this._lastY)>this.delay)){var d=this.getSelectedNodes();d.length&&c.startDrag(this,d,this.copyState(a.getCopyKeyState(b),!0))}if(this.isDragging){d=!1;if(this.current){if(!this.targetBox||this.targetAnchor!=this.current)this.targetBox=k.position(this.current,!0);d=this.horizontal?b.pageX-this.targetBox.x<this.targetBox.w/2==k.isBodyLtr(this.current.ownerDocument):b.pageY-
this.targetBox.y<this.targetBox.h/2}if(this.current!=this.targetAnchor||d!=this.before)this._markTargetAnchor(d),c.canDrop(!this.current||c.source!=this||!(this.current.id in this.selection))}}},onMouseDown:function(b){if(!this.mouseDown&&this._legalMouseDown(b)&&(!this.skipForm||!a.isFormElement(b)))this.mouseDown=!0,this._lastX=b.pageX,this._lastY=b.pageY,p.superclass.onMouseDown.call(this,b)},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,p.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==
a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=m.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,b,c){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?c?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(a,b);this._changeState("Target",b?"":"Disabled");this==a&&m.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,
b,c,d){if(this==d)this.onDrop(a,b,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,c){if(this!=a)this.onDropExternal(a,b,c);else this.onDropInternal(b,c)},onDropExternal:function(b,c,d){var e=this._normalizedCreator;this._normalizedCreator=this.creator?function(a,c){return e.call(this,b.getItem(a.id).data,
c)}:d?function(c){var d=b.getItem(c.id);c=c.cloneNode(!0);c.id=a.getUniqueId();return{node:c,data:d.data,type:d.type}}:function(a){var c=b.getItem(a.id);b.delItem(a.id);return{node:a,data:c.data,type:c.type}};this.selectNone();!d&&!this.creator&&b.selectNone();this.insertNodes(!0,c,this.before,this.current);!d&&this.creator&&b.deleteSelectedNodes();this._normalizedCreator=e},onDropInternal:function(b,c){var d=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(c)this._normalizedCreator=
this.creator?function(a,b){return d.call(this,this.getItem(a.id).data,b)}:function(b){var c=this.getItem(b.id);b=b.cloneNode(!0);b.id=a.getUniqueId();return{node:b,data:c.data,type:c.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,b,this.before,this.current);this._normalizedCreator=d}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){p.superclass.onOverEvent.call(this);
m.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){p.superclass.onOutEvent.call(this);m.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){this.current==this.targetAnchor&&this.before==a||(this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&
this._addItemClass(this.targetAnchor,this.before?"Before":"After"))},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!n.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(d.contains(a,"dojoDndHandle"))return!0;
if(d.contains(a,"dojoDndItem")||d.contains(a,"dojoDndIgnore"))break}return!1}});return p})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m){var p=e("dojo.dnd.Selector",m,{constructor:function(b,d){d||(d={});this.singular=d.singular;this.autoSync=d.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;
this.events.push(c(this.node,a.press,h.hitch(this,"onMouseDown")),c(this.node,a.release,h.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new b,c=g._empty,e;for(e in this.selection)e in c||a.push(d.byId(e));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,b){this._addItemClass(d.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=g._empty,
b;for(b in this.selection)if(!(b in a)){var c=d.byId(b);this.delItem(b);k.destroy(c)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||f.global;var c=this.selection,d=g._empty,e;for(e in c)e in d||a.call(b,this.getItem(e),e,this)},sync:function(){p.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],b=g._empty,c;for(c in this.selection)c in b||this.getItem(c)||a.push(c);l.forEach(a,function(a){delete this.selection[a]},
this);return this},insertNodes:function(a,b,c,d){var e=this._normalizedCreator;this._normalizedCreator=function(b,c){var d=e.call(this,b,c);a?(this.anchor?this.anchor!=d.node&&(this._removeItemClass(d.node,"Anchor"),this._addItemClass(d.node,"Selected")):(this.anchor=d.node,this._removeItemClass(d.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[d.node.id]=1):(this._removeItemClass(d.node,"Selected"),this._removeItemClass(d.node,"Anchor"));return d};p.superclass.insertNodes.call(this,
b,c,d);this._normalizedCreator=e;return this},destroy:function(){p.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!g.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,n.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){g.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=
b[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var c=0,d;c<b.length&&!(d=b[c],d==this.anchor||d==this.current);++c);for(++c;c<b.length;++c){d=b[c];if(d==this.anchor||d==this.current)break;this._addItemClass(d,"Selected");this.selection[d.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?g.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=
this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):g.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=
1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=c(this.node,
a.move,h.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=g._empty,b;for(b in this.selection)if(!(b in a)){var c=d.byId(b);c&&this._removeItemClass(c,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return p})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g,m,p,s){e=e("dojo.dnd.Container",c,{skipForm:!1,allowNested:!1,constructor:function(a,b){this.node=k.byId(a);b||(b={});this.creator=b.creator||null;this.skipForm=b.skipForm;this.parent=b.dropParent&&k.byId(b.dropParent);this.map={};this.current=null;this.containerState="";n.add(this.node,"dojoDndContainer");(!b||!b._skipStartup)&&this.startup();this.events=[g(this.node,p.over,h.hitch(this,"onMouseOver")),g(this.node,p.out,h.hitch(this,"onMouseOut")),g(this.node,"dragstart",
h.hitch(this,"onSelectStart")),g(this.node,"selectstart",h.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(a,b){b=b||f.global;var c=this.map,d=s._empty,e;for(e in c)e in d||a.call(b,c[e],e,this);return b},clearItems:function(){this.map={}},getAllNodes:function(){return m((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var c=
this.getItem(b.id);if(c){a[b.id]=c;return}}else b.id=s.getUniqueId();var c=b.getAttribute("dndType"),d=b.getAttribute("dndData");a[b.id]={data:d||b.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,b,c){this.parent.firstChild?b?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var d;if(c)for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),c.parentNode.insertBefore(d.node,c);else for(b=0;b<
a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);return this},destroy:function(){l.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,c){a._skipStartup=!0;return new c(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=
a[0])}this.defaultCreator=s._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&b!=this.node;)try{b=b.parentNode}catch(c){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(b){a=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){if(!this.skipForm||!s.isFormElement(a))a.stopPropagation(),a.preventDefault()},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var c="dojoDnd"+a,d=a.toLowerCase()+"State";n.replace(this.node,c+b,c+this[d]);this[d]=b},_addItemClass:function(a,b){n.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){n.remove(a,"dojoDndItem"+b)},
_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&n.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(a,b){var c=(this.creator||this.defaultCreator).call(this,a,b);h.isArray(c.type)||(c.type=["text"]);c.node.id||(c.node.id=s.getUniqueId());n.add(c.node,"dojoDndItem");return c}});s._createNode=function(a){return!a?s._createSpan:function(c){return b.create(a,{innerHTML:c})}};s._createTrTd=function(a){var c=
b.create("tr");b.create("td",{innerHTML:a},c);return c};s._createSpan=function(a){return b.create("span",{innerHTML:a})};s._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};s._defaultCreator=function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?s._createTrTd:s._createNode(s._defaultCreatorNodes[a]);return function(a,c){var d=a&&h.isObject(a),e,f;d&&a.tagName&&a.nodeType&&a.getAttribute?(e=a.getAttribute("dndData")||a.innerHTML,d=(d=a.getAttribute("dndType"))?d.split(/\s*,\s*/):
["text"],f=a):(e=d&&a.data?a.data:a,d=d&&a.type?a.type:["text"],f=("avatar"==c?s._createSpan:b)(String(e)));f.id||(f.id=s.getUniqueId());return{node:f,data:e,type:d}}};return e})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m,p,s){var r=e("dojo.dnd.Manager",[k],{constructor:function(){this.source=this.avatar=
null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:n("touch")?0:16,OFFSET_Y:n("touch")?-64:16,overSource:function(b){this.avatar&&(this.target=b&&"Disabled"!=b.targetState?b:null,this.canDropFlag=Boolean(this.target),this.avatar.update());a.publish("/dnd/source/over",b)},outSource:function(b){this.avatar?this.target==b&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),a.publish("/dnd/source/over",null)):a.publish("/dnd/source/over",null)},startDrag:function(b,
e,k){function m(a){a.preventDefault();a.stopPropagation()}p.autoScrollStart(h.doc);this.source=b;this.nodes=e;this.copy=Boolean(k);this.avatar=this.makeAvatar();h.body().appendChild(this.avatar.node);a.publish("/dnd/start",b,e,this.copy);this.events=[c(h.doc,g.move,f.hitch(this,"onMouseMove")),c(h.doc,g.release,f.hitch(this,"onMouseUp")),c(h.doc,"keydown",f.hitch(this,"onKeyDown")),c(h.doc,"keyup",f.hitch(this,"onKeyUp")),c(h.doc,"dragstart",m),c(h.body(),"selectstart",m)];d.add(h.body(),"dojoDnd"+
(k?"Copy":"Move"))},canDrop:function(a){a=Boolean(this.target&&a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){d.remove(h.body(),["dojoDndCopy","dojoDndMove"]);l.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new s(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var b=this.avatar;b&&(p.autoScrollNodes(a),b=b.node.style,
b.left=a.pageX+this.OFFSET_X+"px",b.top=a.pageY+this.OFFSET_Y+"px",b=Boolean(this.source.copyState(m.getCopyKeyState(a))),this.copy!=b&&this._setCopyStatus(b));n("touch")&&a.preventDefault()},onMouseUp:function(b){if(this.avatar){if(this.target&&this.canDropFlag){var c=Boolean(this.source.copyState(m.getCopyKeyState(b)));a.publish("/dnd/drop/before",this.source,this.nodes,c,this.target,b);a.publish("/dnd/drop",this.source,this.nodes,c,this.target,b)}else a.publish("/dnd/cancel");this.stopDrag()}},
onKeyDown:function(c){if(this.avatar)switch(c.keyCode){case b.CTRL:c=Boolean(this.source.copyState(!0));this.copy!=c&&this._setCopyStatus(c);break;case b.ESCAPE:a.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==b.CTRL&&(a=Boolean(this.source.copyState(!1)),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();d.replace(h.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?
"Move":"Copy"))}});m._manager=null;r.manager=m.manager=function(){m._manager||(m._manager=new r);return m._manager};return r})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(l,e,f,h,d,k,n,b){return l("dojo.dnd.Avatar",null,{constructor:function(b){this.manager=b;this.construct()},construct:function(){var b=k.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",
margin:"0px"}}),a=this.manager.source,d,e=k.create("tbody",null,b),f=k.create("tr",null,e),l=k.create("td",null,f),r=Math.min(5,this.manager.nodes.length),q=0;n("highcontrast")&&k.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},l);k.create("span",{innerHTML:a.generateText?this._generateText():""},l);for(h.set(f,{"class":"dojoDndAvatarHeader",style:{opacity:0.9}});q<r;++q)a.creator?d=a._normalizedCreator(a.getItem(this.manager.nodes[q].id).data,"avatar").node:(d=this.manager.nodes[q].cloneNode(!0),
"tr"==d.tagName.toLowerCase()&&(f=k.create("table"),k.create("tbody",null,f).appendChild(d),d=f)),d.id="",f=k.create("tr",null,e),l=k.create("td",null,f),l.appendChild(d),h.set(f,{"class":"dojoDndAvatarItem",style:{opacity:(9-q)/10}});this.node=b},destroy:function(){k.destroy(this.node);this.node=!1},update:function(){d.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(n("highcontrast")){var c=f.byId("a11yIcon"),a="+";this.manager.canDropFlag&&!this.manager.copy?a="\x3c ":!this.manager.canDropFlag&&
!this.manager.copy?a="o":this.manager.canDropFlag||(a="x");c.innerHTML=a}b("tr.dojoDndAvatarHeader td span"+(n("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(l,e,f,h){return l("dijit.CheckedMenuItem",
f,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:h,checked:!1,_setCheckedAttr:function(d){this.domNode.setAttribute("aria-checked",d?"true":"false");this._set("checked",d)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(d){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(d)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(l,e,f,h,d,k,n,b,c,a,g){var m=c("dijit.ColorPalette",[f,h,d],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:e,baseClass:"dijitColorPalette",_dyeFactory:function(a,b,c,d){return new this._dyeClass(a,
b,c,d)},buildRendering:function(){this.inherited(arguments);this._dyeClass=c(m._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],n.getLocalization("dojo","colors",this.lang))}});m._Color=c("dijit._Color",b,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":l.toUrl("./themes/a11y/colors7x10.png"),"3x4":l.toUrl("./themes/a11y/colors3x4.png")},constructor:function(a,c,d,e){this._title=e;this._row=c;this._col=d;this.setColor(b.named[a])},getValue:function(){return this.toHex()},fillCell:function(b,c){var d=g.substitute(k("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:c,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});a.place(d,b)}});return m})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(l,e,f,h,d,k,n,b,c,a,g){return l("dijit._PaletteMixin",b,{defaultTimeout:500,timeoutChangeRate:0.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?k.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(a,b){this._cells=[];var e=this._blankGif;this.own(n(this.gridNode,c,k.hitch(this,"_onCellClick")));for(var f=0;f<a.length;f++)for(var l=h.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),t=0;t<a[f].length;t++){var u=a[f][t];if(u){var w=this._dyeFactory(u,f,t,b[u]),u=h.create("td",{"class":this.cellClass,tabIndex:"-1",title:b[u],role:"gridcell"},l);w.fillCell(u,e);u.idx=this._cells.length;this._cells.push({node:u,
dye:w})}}this._xDim=a[0].length;this._yDim=a.length;var v={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},x;for(x in v)this.own(g.addKeyListener(this.domNode,{keyCode:d[x],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=v[x];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){a.focus(this._currentFocus)},
_onCellClick:function(b){for(var c=b.target;"TD"!=c.tagName;){if(!c.parentNode||c==this.gridNode)return;c=c.parentNode}var d=this._getDye(c).getValue();this._setCurrent(c);a.focus(c);this._setValueAttr(d,!0);b.stopPropagation();b.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&e.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&e.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,b){0<=this._selectedCell&&f.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var c=0;c<this._cells.length;c++)if(a==this._cells[c].dye.getValue()){this._selectedCell=c;f.add(this._cells[c].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(b||void 0===b)this.onChange(a)},onChange:function(){},_navigateByKey:function(b,c){if(-1!=c){var d=this._currentFocus.idx+b;d<this._cells.length&&-1<d&&(d=this._cells[d].node,this._setCurrent(d),this.defer(k.hitch(a,"focus",d)))}},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(l){return l})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(l,e,f,h,d,k,n,b,c){h("dijit-legacy-requires")&&k(0,function(){l(["dijit/form/RadioButton"])});return e("dijit.form.CheckBox",[n,b],{templateString:c,baseClass:"dijitCheckBox",_setValueAttr:function(a,
b){"string"==typeof a&&(this.inherited(arguments),a=!0);this._created&&this.set("checked",a,b)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&d("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&d("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");
this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(l,e){return l("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(f){this._set("readOnly",f);e.set(this.focusNode,"readOnly",f)},_setLabelAttr:void 0,_getSubmitValue:function(e){return null==e||""===e?"on":e},_setValueAttr:function(f){f=this._getSubmitValue(f);this._set("value",f);e.set(this.focusNode,
"value",f)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));e.set(this.focusNode,"value",this.value)},_onClick:function(e){return this.readOnly?(e.stopPropagation(),e.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(l,e,f){return l("dijit.form.ComboBox",[e,f],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(l,e,f,h,d,k,n,b,c){return l("dijit.form.ComboBoxMixin",[b,k],{dropDownClass:n,hasDownArrow:!0,templateString:c,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(a){this._set("hasDownArrow",a);this._buttonNode.style.display=a?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(a){a.get||h.mixin(a,{_oldAPI:!0,get:function(a){var b=new e;this.fetchItemByIdentity({identity:a,
onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,b){var c=new e(function(){f.abort&&f.abort()});c.total=new e;var f=this.fetch(h.mixin({query:a,onBegin:function(a){c.total.resolve(a)},onComplete:function(a){c.resolve(a)},onError:function(a){c.reject(a)}},b));return d(c)}});this._set("store",a)},postMixInProperties:function(){var a=this.params.store||this.store;a&&this._setStoreAttr(a);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var b=this.declaredClass;h.mixin(this.store,{getValue:function(a,c){f.deprecated(b+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return a[c]},getLabel:function(a){f.deprecated(b+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return a.name},fetch:function(a){f.deprecated(b+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
h.hitch(this,function(b){(new b({objectStore:this})).fetch(a)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(l,e,f,h,d,k,n,b,c,a,g){e=e("dijit.form._AutoCompleterMixin",g,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(a){var c=0;if("number"==typeof a.selectionStart)c=a.selectionStart;else if(b("ie")){var d=a.ownerDocument.selection.createRange().duplicate();a=a.createTextRange();d.move("character",0);a.move("character",0);try{a.setEndPoint("EndToEnd",d),c=String(a.text).replace(/\r/g,"").length}catch(e){}}return c},_setCaretPos:function(b,c){c=parseInt(c);a.selectInputText(b,c,c)},_setDisabledAttr:function(a){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var b=a.charCode||a.keyCode;if(!(b==h.ALT||b==h.CTRL||b==h.META||b==h.SHIFT)){var c=this.dropDown,d=null;this._abortQuery();this.inherited(arguments);if(!a.altKey&&!a.ctrlKey&&!a.metaKey)switch(this._opened&&(d=c.getHighlightedOption()),b){case h.PAGE_DOWN:case h.DOWN_ARROW:case h.PAGE_UP:case h.UP_ARROW:this._opened&&this._announceOption(d);a.stopPropagation();a.preventDefault();break;case h.ENTER:if(d){if(d==
c.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(d==c.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case h.TAB:b=this.get("displayedValue");if(c&&(b==c._messages.previousMessage||b==c._messages.nextMessage))break;d&&this._selectOption(d);case h.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(b){var c=this.focusNode;a.selectInputText(c,c.value.length);var d=this.ignoreCase?"toLowerCase":"substr";0==b[d](0).indexOf(this.focusNode.value[d](0))?(d=this.autoComplete?this._getCaretPos(c):c.value.length,d+1>c.value.length&&(c.value=b,a.selectInputText(c,d))):(c.value=b,a.selectInputText(c))},_openResultList:function(a,b,c){var e=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();!a.length&&0==c.start?this.closeDropDown():(this._nextSearch=this.dropDown.onPage=
d.hitch(this,function(b){a.nextPage(-1!==b);this.focus()}),this.dropDown.createOptions(a,c,d.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in c?(c.direction?this.dropDown.highlightFirstOption():c.direction||this.dropDown.highlightLastOption(),e&&this._announceOption(this.dropDown.getHighlightedOption())):this.autoComplete&&(!this._prev_key_backspace&&!/^[*]+$/.test(b[this.searchAttr].toString()))&&this._announceOption(this.dropDown.containerNode.firstChild.nextSibling))},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),b=this.dropDown;b&&(a==b._messages.previousMessage||a==b._messages.nextMessage)?this._setValueAttr(this._lastValueReported,
!0):"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState());this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,b,c){var d="";a&&(c||(c=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),d=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):c);this.set("value",d,b,c,a)},_announceOption:function(a){if(a){var b;if(a==
this.dropDown.nextButton||a==this.dropDown.previousButton)b=a.innerHTML,this.item=void 0,this.value="";else{var c=this.dropDown.items[a.getAttribute("item")];b=(this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]).toString();this.set("item",c,!1,b)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",f.get(a,"id"));this._autoCompleteText(b)}},_selectOption:function(a){this.closeDropDown();a&&this._announceOption(a);
this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var b=this.id+"_popup";this.dropDown=new (d.isString(this.dropDownClass)?d.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:d.hitch(this,this._selectOption),id:b,
dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new c({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var b=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,b):a[b]}}},postCreate:function(){var a=k('label[for\x3d"'+this.id+'"]');a.length&&
(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);l.after(this,"onSearch",d.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var b=this.labelType;"none"!=this.highlightMatch&&("text"==this.labelType&&this._lastInput)&&(a=this.doHighlight(a,this._lastInput),b="html");return{html:"html"==b,label:a}},doHighlight:function(a,b){var c=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?
"g":""),d=this.queryExpr.indexOf("${0}");b=n.escapeString(b);return this._escapeHtml(a.replace(RegExp((0==d?"^":"")+"("+b+")"+(d==this.queryExpr.length-4?"$":""),c),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,
b){return(b._oldAPI?b.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,b,c,d){this._set("item",d||null);null==a&&(a="");this.inherited(arguments)}});b("dojo-bidi")&&e.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return e})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(l,
e,f,h,d,k){function n(b){return{id:b.value,value:b.value,name:f.trim(b.innerText||b.textContent||"")}}return l("dijit.form.DataList",d,{constructor:function(b,c){this.domNode=e.byId(c);f.mixin(this,b);this.id&&k.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:h("option",this.domNode).map(n)}])},destroy:function(){k.remove(this.id)},fetchSelectedItem:function(){var b=h("\x3e option[selected]",this.domNode)[0]||h("\x3e option",this.domNode)[0];return b&&n(b)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),
function(l,e,f,h,d,k,n){return l("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(b){this._set("list",b)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(b){return RegExp("^"+b.replace(/(\\.)|(\*)|(\?)|\W/g,function(b,a,d,e){return d?".*":e?".":a?a:"\\"+b})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&
(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(b){if(!this.disabled&&!this.readOnly){var c=b.charOrCode;if(!("type"in b&&"key"==b.type.substring(0,3)&&(b.altKey||(b.ctrlKey||b.metaKey)&&"x"!=c&&"v"!=c||c==e.SHIFT))){this._prev_key_backspace=
b=!1;switch(c){case e.DELETE:case e.BACKSPACE:b=this._maskValidSubsetError=this._prev_key_backspace=!0;break;default:b="string"==typeof c||229==c}if(b)if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(b){this._abortQuery();var c=this,a=f.clone(this.query),e={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},h=
d.substitute(this.queryExpr,[b.replace(/([\\\*\?])/g,"\\$1")]),n,l=function(){var b=c._fetchHandle=c.store.query(a,e);!c.disabled&&!(c.readOnly||n!==c._lastQuery)&&k(b,function(d){c._fetchHandle=null;!c.disabled&&(!c.readOnly&&n===c._lastQuery)&&k(b.total,function(b){d.total=b;var f=c.pageSize;if(isNaN(f)||f>d.total)f=d.total;d.nextPage=function(b){e.direction=b=!1!==b;e.count=f;b?(e.start+=d.length,e.start>=d.total&&(e.count=0)):(e.start-=f,0>e.start&&(e.count=Math.max(f+e.start,0),e.start=0));0>=
e.count?(d.length=0,c.onSearch(d,a,e)):l()};c.onSearch(d,a,e)})},function(a){c._fetchHandle=null;c._cancelingQuery||console.error(c.declaredClass+" "+a.toString())})};f.mixin(e,this.fetchProperties);this.store._oldAPI?n=h:(n=this._patternToRegExp(h),n.toString=function(){return h});this._lastQuery=a[this.searchAttr]=n;this._queryDeferHandle=this.defer(l,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var b=this.list;b&&
(this.store=n.byId(b))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(l,e,f,h,d,k,n,b){return l("dijit.form._ComboBoxMenu",[d,k,b,n],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(e.add(this.previousButton,"dijitMenuItemRtl"),e.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var b=this.ownerDocument.createElement("div");b.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");b.setAttribute("role","option");return b},onHover:function(b){e.add(b,"dijitMenuItemHover")},onUnhover:function(b){e.remove(b,
"dijitMenuItemHover")},onSelect:function(b){e.add(b,"dijitMenuItemSelected")},onDeselect:function(b){e.remove(b,"dijitMenuItemSelected")},_page:function(b){var a=0,d=this.domNode.scrollTop,e=f.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();a<e;){var h=this.getHighlightedOption();if(b){if(!h.previousSibling||"none"==h.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!h.nextSibling||"none"==h.nextSibling.style.display)break;this.selectNextNode()}h=
this.domNode.scrollTop;a+=(h-d)*(b?-1:1);d=h}},handleKey:function(b){switch(b.keyCode){case h.DOWN_ARROW:return this.selectNextNode(),!1;case h.PAGE_DOWN:return this._page(!1),!1;case h.UP_ARROW:return this.selectPreviousNode(),!1;case h.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(l,e,f,h,d){var k=e("dijit.form._ComboBoxMenuMixin"+
(h("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=d.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(d){this._set("value",d);this.onChange(d)},onClick:function(d){if(d==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(d==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(d)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(d,b){var c=this._createMenuItem(),a=b(d);a.html?c.innerHTML=a.label:c.appendChild(c.ownerDocument.createTextNode(a.label));""==c.innerHTML&&(c.innerHTML="\x26#160;");return c},createOptions:function(d,b,c){this.items=d;this.previousButton.style.display=0==b.start?"none":"";f.set(this.previousButton,"id",this.id+
"_prev");l.forEach(d,function(a,b){var d=this._createOption(a,c);d.setAttribute("item",b);f.set(d,"id",this.id+b);this.nextButton.parentNode.insertBefore(d,this.nextButton)},this);var a=!1;d.total&&!d.total.then&&-1!=d.total?b.start+b.count<d.total?a=!0:b.start+b.count>d.total&&b.count==d.length&&(a=!0):b.count==d.length&&(a=!0);this.nextButton.style.display=a?"":"none";f.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var d=this.containerNode;2<d.childNodes.length;)d.removeChild(d.childNodes[d.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});h("dojo-bidi")&&(k=e("dijit.form._ComboBoxMenuMixin",
k,{_createOption:function(){var d=this.inherited(arguments);this.applyTextDir(d);return d}}));return k})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(l,e,f,h){return l("dijit.form._ListMouseMixin",h,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(d,e){this._setSelectedAttr(e,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(e)})},_onMouseDown:function(d,e){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(e,!1)},_onMouseUp:function(d,e){this._isDragging=!1;var f=this.selected,b=this._hoveredNode;f&&e==f?this.defer(function(){this._onClick(d,
f)}):b&&this.defer(function(){this._onClick(d,b)})},_onMouseOut:function(d,e){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(d,e){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=e;this.onHover(e);this._isDragging&&this._setSelectedAttr(e,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(l,e,f){return l("dijit.form._ListBase",null,{selected:null,_listConnect:function(f,d){var k=this;return k.own(e(k.containerNode,e.selector(function(d,b,c){return d.parentNode==c},f),function(e){k[d](e,this)}))},selectFirstNode:function(){for(var e=this.containerNode.firstChild;e&&"none"==e.style.display;)e=e.nextSibling;this._setSelectedAttr(e,!0)},selectLastNode:function(){for(var e=this.containerNode.lastChild;e&&"none"==e.style.display;)e=e.previousSibling;this._setSelectedAttr(e,
!0)},selectNextNode:function(){var e=this.selected;if(e){for(e=e.nextSibling;e&&"none"==e.style.display;)e=e.nextSibling;e?this._setSelectedAttr(e,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var e=this.selected;if(e){for(e=e.previousSibling;e&&"none"==e.style.display;)e=e.previousSibling;e?this._setSelectedAttr(e,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(e,d){if(this.selected!=e){var k=this.selected;if(k)this.onDeselect(k);
e&&(d&&f.scrollIntoView(e),this.onSelect(e));this._set("selected",e)}else if(e)this.onSelect(e)}})})},"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cimg data-dojo-attach-point\x3d"loadingImg"/\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"dijit/form/Select"\r\n\t\t\t\t\t\t style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'0\' selected\x3d"selected"\x3e${nls.basic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'1\'\x3eA-Z\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'2\'\x3e${nls.arrows}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'3\'\x3e${nls.business}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'4\'\x3e${nls.cartographic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'5\'\x3e${nls.nationalParkService}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'6\'\x3e${nls.outdoorRecreation}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'7\'\x3e${nls.peoplePlaces}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'8\'\x3e${nls.safetyHealth}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'9\'\x3e${nls.shapes}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'10\'\x3e${nls.transportation}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n                        data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t${nls.transparency}\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e${nls.outlineWidth}:\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" \r\n                        data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.style}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e${nls.transparency}\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.width}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" \r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t${nls.transparency}\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineWidth}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" \r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.text}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"inputText" type\x3d"text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontColor}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontSize}\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv style\x3d"min-width: 170px;"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e0%\x3c/li\x3e\r\n      \x3cli\x3e50%\x3c/li\x3e\r\n      \x3cli\x3e100%\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"POINT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cspan class\x3d"drawings-clear jimu-float-trailing" data-dojo-attach-point\x3d"btnClear"\x3e${nls.clear}\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"text" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(l){l(['dojo/i18n!*preload*jimu/nls/main*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main".split(" "),function(l,e,f,h,d,k,n,b,c,a,g,m,p,s,r,q,t,u,w,v,x,B){k={};"function"!==typeof a.getAll&&(a.getAll=function(b){var c=[];(b=a(b))&&c.push(b);return c});window.jimuNls=B;t.setProtocolErrorHandler(function(){return!0});
t=w.getAncestorWindow();var D=!1;try{D=0===t.location.href.indexOf("https://")}catch(C){console.log(C),D="https:"===window.location.protocol}r.setRequestPreCallback(function(a){a.content&&a.content.printFlag&&(a.timeout=3E5);D&&(a.url=a.url.replace(/^http(s?):\/\//gi,"//"));-1!==a.url.indexOf("/queryRelatedRecords?")&&!w.isHostedService(a.url)&&(a.url=a.url.replace("FeatureServer","MapServer"));return a});n(window,"mousedown",function(a){if(b.isMiddle(a))return a.preventDefault(),a.stopPropagation(),
a.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=d.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="1.3";window.productVersion=
"Online 3.8";k.initApp=function(){var a,b;console.log("jimu.js init...");b=window.location.search;a=""===b?{}:b=p.queryToObject(b.substr(1));f.getInstance();h.setStyle(jimuConfig.loadingId,"display","none");h.setStyle(jimuConfig.mainPageId,"display","block");b=e.getInstance({mapId:jimuConfig.mapId},jimuConfig.layoutId);a=l.getInstance(a);b.startup();a.loadConfig()};return k});