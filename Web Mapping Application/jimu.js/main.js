//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils esri/config esri/tasks/GeometryService".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f,p,t){function s(b){var c=e.clone(b),d=a.widgetProperties;delete c.mode;a.visitElement(c,function(b,f){b.widgets?(delete b.isOnScreen,delete b.gid,"jimu.js/images/group_icon.png"===b.icon&&
delete b.icon,delete b.openType,f.isOnScreen&&b.panel&&a.isEqual(b.panel,c.widgetOnScreen.panel)&&delete b.panel):(b.icon&&b.icon===b.amdFolder+"images/icon.png"&&delete b.icon,delete b.panel,delete b.folderUrl,delete b.amdFolder,delete b.thumbnail,delete b.configFile,delete b.gid,delete b.isOnScreen,d.forEach(function(a){delete b[a]}),b.visible&&delete b.visible,delete b.manifest)});delete c.rawAppConfig;delete c._ssl;delete c.getConfigElementById;delete c.getConfigElementsByName;delete c.getConfigElementByLabel;
delete c.processNoUriWidgets;delete c.addElementId;delete c.getCleanConfig;delete c.visitElement;delete c.agolConfig;delete c._itemData;delete c.oldWabVersion;return c}var r=null,q;q=m(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a){this.urlParams=a||{};this.listenBuilderEvents();this.versionManager=new b;this.widgetManager=c.getInstance();this.configLoader=n.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&
(window.parent.setConfigViewerTopic&&e.isFunction(window.parent.setConfigViewerTopic))&&window.parent.setConfigViewerTopic(d);"preview"===this.urlParams.mode&&(window.parent.setPreviewViewerTopic&&e.isFunction(window.parent.setPreviewViewerTopic))&&window.parent.setPreviewViewerTopic(d);l(window,"resize",e.hitch(this,this._onWindowResize))},listenBuilderEvents:function(){d.subscribe("builder/widgetChanged",e.hitch(this,this._onWidgetChanged));d.subscribe("builder/groupChanged",e.hitch(this,this._onGroupChanged));
d.subscribe("builder/widgetPoolChanged",e.hitch(this,this._onWidgetPoolChanged));d.subscribe("builder/openAtStartChange",e.hitch(this,this._onOpenAtStartChanged));d.subscribe("builder/mapChanged",e.hitch(this,this._onMapChanged));d.subscribe("builder/mapOptionsChanged",e.hitch(this,this._onMapOptionsChanged));d.subscribe("builder/appAttributeChanged",e.hitch(this,this._onAppAttributeChanged));d.subscribe("builder/setAppConfig",e.hitch(this,this._onAppConfigSet));d.subscribe("builder/themeChanged",
e.hitch(this,this._onThemeChanged));d.subscribe("builder/layoutChanged",e.hitch(this,this._onLayoutChanged));d.subscribe("builder/styleChanged",e.hitch(this,this._onStyleChanged));d.subscribe("builder/syncExtent",e.hitch(this,this._onSyncExtent));d.subscribe("builder/loadingPageChanged",e.hitch(this,this._onLoadingPageChanged));d.subscribe("builder/templateConfigChanged",e.hitch(this,this._onTemplateConfigChanged))},loadConfig:function(){if(!("preview"===this.urlParams.mode||"config"===this.urlParams.mode))return this.configLoader.loadConfig().then(e.hitch(this,
function(a){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(a);window.appInfo.isRunInMobile=this._isRunInMobile();console.timeEnd("Load Config");a=this.getAppConfig();d.publish("appConfigLoaded",a);return a}),e.hitch(this,function(a){console.error(a);a&&(a.message&&"string"===typeof a.message)&&this._showErrorMessage(a.message)}))},_showErrorMessage:function(a){h.create("div",{"class":"create-map-error",innerHTML:"Unable to create map: "+a},document.body)},getAppConfig:function(){var b;
window.appInfo.isRunInMobile?(console.log("Switch to mobile mode."),b=e.clone(this._getMobileConfig(this.appConfig)),b._originConfig=e.clone(this.appConfig)):(console.log("Switch to desktop mode."),b=e.clone(this.appConfig));b.getConfigElementById=function(b){return a.getConfigElementById(this,b)};b.getConfigElementByLabel=function(b){return a.getConfigElementByLabel(this,b)};b.getConfigElementsByName=function(b){return a.getConfigElementsByName(this,b)};b.getCleanConfig=function(){return this._originConfig?
s(this._originConfig):s(this)};b.visitElement=function(b){a.visitElement(this,b)};return b},_onWindowResize:function(){var a=this._isRunInMobile();window.appInfo.isRunInMobile!==a&&(window.appInfo.isRunInMobile=a,this.appConfig&&d.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var a=h.getMarginBox(window.jimuConfig.layoutId);if(a.w<=window.jimuConfig.breakPoints[0]||a.h<=window.jimuConfig.breakPoints[0])return h.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),
!0;h.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1},_getMobileConfig:function(b){return a.mixinAppConfigPosition(b,b.mobileLayout)},_onWidgetChanged:function(b){var c=a.reCreateObject(b);b=a.getConfigElementById(this.appConfig,b.id);!1===c.inPanel&&!b.uri&&(c.closeable=!0);for(var f in c)b[f]=c[f];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetChange",c)},_onGroupChanged:function(b){var c=
a.reCreateObject(b);b=a.getConfigElementById(this.appConfig,b.id);for(var f in c)b[f]=c[f];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"groupChange",c)},_onWidgetPoolChanged:function(b){b=a.reCreateObject(b);if(1===this.widgetManager.getControllerWidgets().length)this.appConfig.widgetPool.widgets=b.widgets,this.appConfig.widgetPool.groups=b.groups;else{var c=a.getConfigElementById(this.appConfig,b.controllerId);
g.forEach(c.controlledWidgets,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this);g.forEach(c.controlledGroups,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this);this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?b.widgets:this.appConfig.widgetPool.widgets.concat(b.widgets);this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?b.groups:this.appConfig.widgetPool.groups.concat(b.groups);
this.configLoader.addNeedValues(this.appConfig);c.controlledWidgets=g.map(b.widgets,function(a){return a.id});c.controlledGroups=g.map(b.groups,function(a){return a.id})}this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",b)},_removeWidgetOrGroupFromPoolById:function(a,b){g.some(a.widgetPool.widgets,function(c,f){if(c.id===b)return a.widgetPool.widgets.splice(f,1),!0});g.some(a.widgetPool.groups,
function(c,f){if(c.id===b)return a.widgetPool.groups.splice(f,1),!0})},_onOpenAtStartChanged:function(b){var c=a.reCreateObject(b),f=this.appConfig;b.isOnScreen?(f=f.widgetOnScreen&&f.widgetOnScreen.widgets)&&0<f.length&&g.forEach(f,e.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})):((f=f.widgetPool)&&(f.groups&&0<f.groups.length)&&g.forEach(f.groups,e.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})),f&&(f.widgets&&0<f.widgets.length)&&
g.forEach(f.widgets,e.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})));d.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",c)},_onAppAttributeChanged:function(b){b=a.reCreateObject(b);e.mixin(this.appConfig,b);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"attributeChange",b)},_onLoadingPageChanged:function(b){b=
a.reCreateObject(b);var c;"backgroundColor"in b?this.appConfig.loadingPage.backgroundColor=b.backgroundColor:"backgroundImage"in b?(c=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=e.mixin(c,b.backgroundImage)):"loadingGif"in b&&(c=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=e.mixin(c,b.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),
"loadingPageChange",b)},_onTemplateConfigChanged:function(b){b=a.reCreateObject(b);this.appConfig.templateConfig=b;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",b)},_onMapChanged:function(b){b=a.reCreateObject(b);b.itemId&&b.itemId!==this.appConfig.map.itemId&&this.appConfig.map.mapOptions&&a.deleteMapOptions(this.appConfig.map.mapOptions);e.mixin(this.appConfig.map,b);this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"mapChange",b)},_onMapOptionsChanged:function(b){b=a.reCreateObject(b);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});e.mixin(this.appConfig.map.mapOptions,b);d.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",b)},_onThemeChanged:function(a){this._getAppConfigFromTheme(a).then(e.hitch(this,function(b){this.appConfig=b;d.publish("appConfigChanged",this.getAppConfig(),"themeChange",
a.getName())}))},_onLayoutChanged:function(b){this.appConfig=a.mixinAppConfigPosition(this.appConfig,b.layoutConfig);this._addDefaultPanelAndPosition(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"layoutChange",b.name)},_onStyleChanged:function(a){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,a.name);d.publish("appConfigChanged",this.getAppConfig(),"styleChange",a.name)},_onSyncExtent:function(a){d.publish("syncExtent",a)},_genStyles:function(a,b){var c=
[];c.push(b);g.forEach(a,function(a){0>c.indexOf(a)&&c.push(a)});return c},_getAppConfigFromTheme:function(a){var b=new k,c,f=[],f=this.getAppConfig().getCleanConfig();f.mode=this.urlParams.mode;g.forEach(f.widgetPool.groups,function(a){delete a.panel},this);if(a.appConfig)c=e.clone(a.appConfig),c.map=f.map,c.map.position=a.appConfig.map.position,this._copyPoolToThemePool(f,c),c.links=f.links,c.title=f.title,c.subtitle=f.subtitle,c.logo=f.logo;else{var d=a.getCurrentLayout(),n=a.getCurrentStyle();
c=e.clone(f);d=e.clone(d.layoutConfig);c.widgetOnScreen=d.widgetOnScreen;d.widgetPool&&(g.forEach(d.widgetPool.widgets,function(a){a.isPreconfiguredInTheme=!0}),g.forEach(d.widgetPool.groups,function(a){a.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(f,d);c.widgetPool=d.widgetPool;d.map&&d.map.position&&(c.map.position=d.map.position);c.mobileLayout=d.mobileLayout;f=this._genStyles(g.map(a.getStyles(),function(a){return a.name}),n.name);c.theme={name:a.getName(),styles:f,version:a.getVersion()}}this.configLoader.addNeedValues(c);
this.configLoader.loadWidgetsManifest(c).then(e.hitch(this,function(){this._addDefaultValues(c);b.resolve(c)}));return b},_copyPoolToThemePool:function(a,b){var c=a.widgetPool;b.widgetPool||(b.widgetPool={});var f=b.widgetPool,d=g.filter(f.widgets,function(a){if(a.isPreconfiguredInTheme||!g.some(c.widgets,function(b){return b.name===a.name}))return!0}),n=g.filter(f.groups,function(a){return a.isPreconfiguredInTheme}),p=g.filter(c.widgets,function(a){return!a.isPreconfiguredInTheme}),q=g.filter(c.groups,
function(a){return!a.isPreconfiguredInTheme}),p=this._getPoolWidgetsWithoutDuplicated(p,b.widgetOnScreen.widgets||[]);f.widgets=p.concat(d);f.groups=q.concat(n)},_getPoolWidgetsWithoutDuplicated:function(b,c){for(var f=e.clone(b),d=b.length-1;0<=d;d--)for(var n=c.length-1;0<=n;n--)if(c[n].uri){var p=c[n].name;p||(p=a.getWidgetNameFromUri(c[n].uri));var q=b[d].id,q=this.getAppConfig().getConfigElementById(q);b[d]&&(b[d].name===p&&!1===q.supportMultiInstance)&&(console.log("Widget",b[d].name,"is not copied to new theme because this widget exists in new theme."),
f.splice(d,1))}return f},_onAppConfigSet:function(b){b=a.reCreateObject(b);window.appInfo.isRunInMobile=this._isRunInMobile();this.configLoader.processProxy(b);this.configLoader.addNeedValues(b);this._addDefaultValues(b);f.setPortalUrl(b.portalUrl);this.appConfig?(b.map.itemId&&b.map.itemId!==this.appConfig.map.itemId&&a.deleteMapOptions(b.map.mapOptions),this.appConfig=b,d.publish("appConfigChanged",this.getAppConfig(),"resetConfig",b)):(this.appConfig=b,d.publish("appConfigLoaded",this.getAppConfig()))},
_addDefaultValues:function(a){this._addDefaultPortalUrl(a);this._addDefaultGeometryService(a);this._addDefaultStyle(a);this._addDefaultMap(a);this._addDefaultVisible(a);"undefined"===typeof a.widgetOnScreen&&(a.widgetOnScreen={});"undefined"===typeof a.widgetPool&&(a.widgetPool={});this._addDefaultPanelAndPosition(a);this._addDefaultOfWidgetGroup(a);(a.widgetPool.widgets&&0<a.widgetPool.widgets.length&&void 0===a.widgetPool.widgets[0].index||a.widgetPool.groups&&0<a.widgetPool.groups.length&&void 0===
a.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(a);return a},_addDefaultPortalUrl:function(a){"undefined"===typeof a.portalUrl&&(a.portalUrl="http://www.arcgis.com/");a.portalUrl&&"/"!==a.portalUrl.substr(a.portalUrl.length-1)&&(a.portalUrl+="/")},_addDefaultGeometryService:function(a){var b=a&&a.geometryService,b=b&&"string"===typeof b&&e.trim(b)?e.trim(b):this.portalSelf.helperServices.geometry.url;a.geometryService=b;p.defaults.geometryService=new t(a.geometryService)},_addDefaultStyle:function(a){if(a.theme&&
(!a.theme.styles||0===a.theme.styles.length))a.theme.styles=["default"]},_addDefaultMap:function(a){a.map.id="map";"undefined"===typeof a.map["3D"]&&"undefined"===typeof a.map["2D"]&&(a.map["2D"]=!0);"undefined"===typeof a.map.position&&(a.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof a.map.portalUrl&&(a.map.portalUrl=a.portalUrl)},_addDefaultVisible:function(b){a.visitElement(b,function(a){void 0===a.visible&&(a.visible=!0)})},_addDefaultPanelAndPosition:function(a){this._addOnScreenDefaultPanelAndPosition(a);
this._addPoolDefaultPanelAndPosition(a)},_addOnScreenDefaultPanelAndPosition:function(a){var b,c;if(a=a.widgetOnScreen){b=a.panel&&a.panel.positionRelativeTo?a.panel.positionRelativeTo:"map";"undefined"===typeof a.panel||"undefined"===typeof a.panel.uri?a.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof a.panel.position?a.panel.position={relativeTo:b}:"undefined"===typeof a.panel.position.relativeTo&&(a.panel.position.relativeTo=b);if(a.widgets)for(b=0;b<a.widgets.length;b++)a.widgets[b].position||
(a.widgets[b].position={}),a.widgets[b].position.relativeTo||(a.widgets[b].position.relativeTo=a.widgets[b]&&a.widgets[b].positionRelativeTo?a.widgets[b].positionRelativeTo:"map"),!0===a.widgets[b].inPanel&&!a.widgets[b].panel&&(a.widgets[b].panel=e.clone(a.panel),a.widgets[b].panel.position=a.widgets[b].position,a.widgets[b].panel.position.relativeTo=a.widgets[b].position.relativeTo);if(a.groups)for(b=0;b<a.groups.length;b++){a.groups[b].panel||(a.groups[b].panel=a.panel);a.groups[b].panel&&!a.groups[b].panel.position&&
(a.groups[b].panel.position={});a.groups[b].panel.position.relativeTo||(a.groups[b].panel.position.relativeTo=a.groups[b].panel.positionRelativeTo?a.groups[b].panel.positionRelativeTo:"map");a.groups[b].widgets||(a.groups[b].widgets=[]);for(c=0;c<a.groups[b].widgets.length;c++)a.groups[b].widgets[c].panel=a.groups[b].panel}}},_addPoolDefaultPanelAndPosition:function(a){var b,c,f=a.widgetPool;if(f){b=f.panel&&f.panel.positionRelativeTo?f.panel.positionRelativeTo:"map";"undefined"===typeof f.panel||
"undefined"===typeof f.panel.uri?f.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof f.panel.position?f.panel.position={relativeTo:b}:"undefined"===typeof f.panel.position.relativeTo&&(f.panel.position.relativeTo=b);if(f.groups)for(b=0;b<f.groups.length;b++){f.groups[b].panel?f.groups[b].panel.position.relativeTo||(f.groups[b].panel.position.relativeTo=f.groups[b].panel.positionRelativeTo?f.groups[b].panel.positionRelativeTo:"map"):f.groups[b].panel=f.panel;f.groups[b].widgets||
(f.groups[b].widgets=[]);for(c=0;c<f.groups[b].widgets.length;c++)f.groups[b].widgets[c].panel=f.groups[b].panel}if(f.widgets)for(b=0;b<f.widgets.length;b++)!1===f.widgets[b].inPanel?(c=f.widgets[b].positionRelativeTo?f.widgets[b].positionRelativeTo:"map",f.widgets[b].position?f.widgets[b].position.relativeTo||(f.widgets[b].position.relativeTo=c):f.widgets[b].position={relativeTo:c}):f.widgets[b].panel||(f.widgets[b].panel=a.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(b){a.visitElement(b,
e.hitch(this,function(b,c){b.isOnScreen=c.isOnScreen;b.widgets?(b.gid=b.id,1===b.widgets.length?(b.label||(b.label=b.widgets[0].label?b.widgets[0].label:"Group"),b.icon||(b.icon=b.widgets[0].uri?this._getDefaultIconFromUri(b.widgets[0].uri):"jimu.js/images/group_icon.png")):(b.icon=b.icon?b.icon:"jimu.js/images/group_icon.png",b.label=b.label?b.label:"Group_"+c.index)):(b.gid=c.groupId,b.uri&&a.processWidgetSetting(b))}))},_getDefaultIconFromUri:function(a){a=a.split("/");a.pop();return a.join("/")+
"/images/icon.png"},_addIndexForWidgetPool:function(a){var b=0,c,f;if(a.widgetPool.widgets)for(c=0;c<a.widgetPool.widgets.length;c++)a.widgetPool.widgets[c].index=b,b++;if(a.widgetPool.groups)for(c=0;c<a.widgetPool.groups.length;c++){a.widgetPool.groups[c].index=b;b++;for(f=0;f<a.widgetPool.groups[c].widgets.length;f++)a.widgetPool.groups[c].widgets[f].index=f}}});q.getInstance=function(a){null===r?r=new q(a):a&&(r.urlParams=a);window.getAppConfig=e.hitch(r,r.getAppConfig);return r};return q})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale esri/arcgis/utils esri/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/urlUtils esri/request esri/graphicsUtils jimu/portalUrlUtils ./shared/utils".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w,v,x,B,D,C,F,A,z,E){function H(a,b){var c=a.match(/url\([^)]+\)/gi),f,d;if(null===c||""===b)return a;for(f=0;f<c.length;f++)if(d=c[f].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=d.length){var n=d[2];b.endWith("/")||(b+="/");a=a.replace(d[1]+n+d[3],d[1]+b+n+d[3])}return a}function K(a,b){var c=Array.isArray(b),f=c&&[]||{};c?(a=a||[],f=f.concat(a),b.forEach(function(b,c){"undefined"===typeof a[c]?f[c]=b:"object"===typeof b?f[c]=K(a[c],b):-1===a.indexOf(b)&&
f.push(b)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(b){f[b]=a[b]}),Object.keys(b).forEach(function(c){f[c]="object"!==typeof b[c]||!b[c]?b[c]:a[c]?K(a[c],b[c]):b[c]}));return f}function P(a){var b,c={};b=a.indexOf("/");a.substring(0,b);a=a.substring(0,a.lastIndexOf("/")+1);c.folderUrl=require(y.getRequireConfig()).toUrl(a);c.amdFolder=a;return c}function G(a){a.panels.forEach(function(a){a.uri="panels/"+a.name+"/Panel.js"});a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});
a.layouts.forEach(function(a){a.uri="layouts/"+a.name+"/config.json";a.icon="layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+a.name+"/icon_rtl.png"})}function J(a,b,c){b=function(a){var b=[];a.split("_").forEach(function(a){var c=!1,f;"--"===a.slice(a.length-2)&&(c=!0,a=a.slice(0,a.length-2));f=a.search(/\[[0-9]+\]/);-1===f&&(f=a.length);b.push({key:a.slice(0,f),index:Number(a.slice(f+1,-1)),deleteFlag:c})});return b}(b);for(var f=1;f<b.length-1;f++)if(a=m.isArray(a[b[f].key])?a[b[f].key][b[f].index]:
a[b[f].key],!a)return;if(b[b.length-1].deleteFlag)!0===c&&(m.isArray(a[b[b.length-1].key])?delete a[b[b.length-1].key][b[b.length-1].index]:delete a[b[b.length-1].key]);else if(m.isArray(a[b[b.length-1].key])){if(void 0===c)return a[b[b.length-1].key][b[b.length-1].index];a[b[b.length-1].key][b[b.length-1].index]=c}else{if(void 0===c)return a[b[b.length-1].key];a[b[b.length-1].key]=c}}function M(a,b,c){function f(c){c=y.template.getSearchRange(b,c,"]");var d=b.slice(c.firstPos,c.lastPos);return-1!==
c.firstPos?(d=b.slice(c.firstPos+d.indexOf("[")+1,c.lastPos-1),c=b.slice(c.lastPos+1),(d=y.getConfigElementById(a,d))?{object:d,key:"section_"+c,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var d=a,n=b=b.replace(/\//g,"_"),p=f("groups\\[.+\\]");if("deleted"!==p.state&&("isSection"===p.state&&(d=p.object,n=p.key),p=f("widgets\\[.+\\]"),"delete"!==p.state))return"isSection"===p.state&&(d=p.object,n=p.key),J(d,n,c)}var y={},L={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};
m.mixin(y,E);var O=[];require.on("error",function(a){e.forEach(O,function(b){a.info[0]&&-1<a.info[0].indexOf(b.resKey)&&b.def.reject(a);for(var c in a.info)-1<c.indexOf(b.resKey)&&b.def.reject(a)})});y.checkError=function(a,b){O.push({resKey:a,def:b})};y.replacePlaceHolder=function(a,b){var c=n.stringify(a),f=c.match(/\$\{(\w)+\}/g),d;if(null===f)return a;for(d=0;d<f.length;d++){var p=f[d].match(/(\w)+/g)[0];b[p]&&(c=c.replace(f[d],b[p]))}return n.parse(c)};y.changeUnit=function(a){var b=Math.abs(a),
c;a=Math.floor(b);c=Math.floor(60*(b-a));b=(60*(60*(b-a)-c)).toFixed(2);return a+"\u00b0"+(10>c?"0"+c:c)+"'"+(10>b?"0"+b:b)+'"'};y.formatTime=function(a){var b=a/1E3;a=Math.floor(b/60);b=Number(b-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};y.parseTime=function(a){var b=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!b.test(a))return console.log("wrong time format."),-1;a=a.match(b);return 1E3*(60*parseInt(a[1],10)+parseInt(a[2],10)+parseInt(a[3],10)/10)};y.preloadImg=function(a,b){var c=[],c="string"===
typeof a?[a]:a;e.forEach(c,function(a){(new Image).src=b?b+a:a})};y.getPositionStyle=function(a){var b={};if(!a)return b;a=m.clone(a);if(window.isRTL){var c;"undefined"!==typeof a.left&&"undefined"!==typeof a.right?(c=a.left,a.left=a.right,a.right=c):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?(c=a.paddingLeft,a.paddingLeft=a.paddingRight,a.paddingRight=
c):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight)}c="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom".split(" ");for(var f=0;f<c.length;f++){var d=c[f];"number"===typeof a[d]?b[d]=a[d]+"px":"undefined"!==typeof a[d]?b[d]=a[d]:"padding"===d.substr(0,7)?b[d]=0:b[d]="auto"}b.zIndex="undefined"===typeof a.zIndex?"auto":a.zIndex;
return b};y.isEqual=function(a,b){function c(a,b){var n;if(isNaN(a)&&isNaN(b)&&"number"===typeof a&&"number"===typeof b||a===b)return!0;if("function"===typeof a&&"function"===typeof b||a instanceof Date&&b instanceof Date||a instanceof RegExp&&b instanceof RegExp||a instanceof String&&b instanceof String||a instanceof Number&&b instanceof Number)return a.toString()===b.toString();if(-1<f.indexOf(a)||-1<d.indexOf(b))return!1;if(null!==b){for(n in b)if(b.hasOwnProperty(n)!==a.hasOwnProperty(n)||typeof b[n]!==
typeof a[n])return!1;for(n in a){if(b.hasOwnProperty(n)!==a.hasOwnProperty(n)||typeof b[n]!==typeof a[n])return!1;switch(typeof a[n]){case "object":case "function":f.push(a);d.push(b);if(!c(a[n],b[n]))return!1;f.pop();d.pop();break;default:if(a[n]!==b[n])return!1}}}return!0}var f,d;f=[];d=[];return!c(a,b)?!1:!0};y.file={supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return h("safari")&&6>h("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?
!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(b){a=null}else navigator.plugins&&0<navigator.plugins.length&&(a=navigator.plugins["Shockwave Flash"]);return!!a},containSeparator:function(a){return 0<=a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var b="",b=0<=a.indexOf("/")?"/":"\\";a=a.split(b);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-y.file.getNameFromPath(a).length)},
readFile:function(a,b,c,f){if(this.supportHTML5()){var d=a.target.files[0];d&&(d.type.match(b)?d.size>=c?f({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){f(null,d.name,a.target.result)},a.readAsDataURL(d)):f({errCode:"invalidType"}))}else if(this.supportFileAPI()){var n=window.FileAPI.getFiles(a);n[0].type.match(b)?n[0].size>=c?f({errCode:"exceed"}):window.FileAPI.readAsDataURL(n[0],function(a){a&&a.result?f(null,n[0].name,a.result):f({errCode:"readError"})}):f({errCode:"invalidType"})}}};
y.processWidgetSetting=function(a){if(!a.uri)return a;m.mixin(a,P(a.uri));a.icon||(a.icon=a.amdFolder+"images/icon.png");a.thumbnail||(a.thumbnail=a.amdFolder+"images/thumbnail.png");return a};y.getRequireConfig=function(){if(jimuConfig){var a=[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};y.getTypeByGeometryType=function(a){var b=
"",c="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),f=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(a)?b="point":0<=c.indexOf(a)?b="polyline":0<=f.indexOf(a)&&(b="polygon");return b};y.getSymbolTypeByGeometryType=function(a){var b=null;a=y.getTypeByGeometryType(a);"point"===a?b="marker":"polyline"===a?b="line":"polygon"===a&&(b=
"fill");return b};y.getServices=function(){return L};y.getArcGISDefaultGeometryService=function(){return new B(L.geometryService)};y.restoreToDefaultWebMapExtent=function(a,b,f){var d=new c;if(!(a&&"esri.Map"===a.declaredClass))return setTimeout(function(){d.reject("Invalid map.")},0),d;b=b&&b.itemInfo;if(!b)return setTimeout(function(){d.reject("Invalid itemInfo")},0),d;b=b.item&&b.item.extent;if(!b)return setTimeout(function(){d.reject("Invalid itemInfo.item.extent")}),d;var n=new r({wkid:4326}),
n=new q(b[0][0],b[0][1],b[1][0],b[1][1],n);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(n);if(a.spatialReference.isWebMercator())return n=x.geographicToWebMercator(n),a.setExtent(n);b=new D;b.geometries=[n];b.outSR=a.spatialReference;n=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;n&&"esri.tasks.GeometryService"===n.declaredClass||(f&&"string"===typeof f&&m.trim(f)?(f=m.trim(f),n=new B(f)):n=y.getArcGISDefaultGeometryService());n.project(b).then(function(b){if(b=
b&&b[0])return a.setExtent(b);d.reject("Invalid projected geometry.");return d},function(a){console.error(a);d.reject(a);return d});return d};y.getAncestorWindow=function(){for(var a=window;a&&a.parent&&a!==a.parent;)a=a.parent;return a};y.getAncestorDom=function(a,b,c){if(a&&1===a.nodeType&&b&&"function"===typeof b){var f=100,d=document.body;c&&("number"===typeof c?(c=parseInt(c,10),0<c&&(f=c)):1===c.nodeType&&(d=c));for(c=0;a.parentNode&&c<f&&g.isDescendant(a.parentNode,d);){if(b(a.parentNode))return a.parentNode;
a=a.parentNode;c++}}return null};y.bindClickAndDblclickEvents=function(a,c,f,d){var n=null;if(a&&1===a.nodeType&&c&&"function"===typeof c&&f&&"function"===typeof f){var p=200;d&&"number"===typeof d&&(d=parseInt(d,10),0<d&&(p=d));var q=0,n=b(a,"click",function(a){q++;1===q?setTimeout(function(){1===q&&(q=0,c(a))},p):2===q&&(q=0,f(a))})}return n};y.isScrollToBottom=function(a){var b=g.getContentBox(a);return 0===a.scrollHeight-(a.scrollTop+b.h)};y.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map",
"Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service","Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));
return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer","Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};y.getItemQueryStringByTypes=function(a){var b=
"",c=y.getAllItemTypes();if(a&&0<a.length&&0<a.length){var f="";e.forEach(a,function(b,c){f+=' type:"'+b+'" ';c!==a.length-1&&(f+=" OR ")});b=" ( "+f+" ) ";c=a.concat(c);c=e.filter(c,function(b){return e.every(a,function(a){return 0>a.toLowerCase().indexOf(b.toLowerCase())})});e.forEach(c,function(a){b+=' -type:"'+a+'" '})}return b};y.getItemQueryStringByTypeKeywords=function(a){var b="";a&&0<a.length&&(b=' typekeywords:"'+a.join(",")+'" ');return b};y.isNotEmptyString=function(a,b){var c=a&&"string"===
typeof a;return c?b?c&&m.trim(a):!0:!1};y.isValidNumber=function(a){return"number"===typeof a&&!isNaN(a)};y.isObject=function(a){return a&&"object"===typeof a};y.createWebMap=function(a,b,c,f){a=z.getStandardPortalUrl(a);a=z.getBaseItemUrl(a);s.arcgisUrl=a;return s.createMap(b,c,f)};y.getRandomString=function(){var a=Math.random().toString();return a=a.slice(2,a.length)};y._getDomainsByServerName=function(a){var b=a.split("."),c=b.length;return e.map(b,m.hitch(this,function(a,f){var d=b.slice(f,c),
n="",p=d.length-1;e.forEach(d,m.hitch(this,function(a,b){n+=a;b!==p&&(n+=".")}));return n}))};y.removeCookie=function(a,b){var c=this._getDomainsByServerName(window.location.hostname);e.forEach(c,m.hitch(this,function(c){f(a,null,{expires:-1,path:b});f(a,null,{expires:-1,path:b,domain:c});f(a,null,{expires:-1,path:b,domain:"."+c})}))};y.isLocaleChanged=function(a,b){return!a.startWith(b)};y.hashToObject=function(a){a=a.replace("#","");a=k.queryToObject(a);for(var b in a)if(a.hasOwnProperty(b))try{a[b]=
n.parse(a[b])}catch(c){}return a};y.reCreateObject=function(a){function b(a){var f=[];a.forEach(function(a){Array.isArray(a)?f.push(b(a)):"object"===typeof a?f.push(c(a)):f.push(a)});return f}function c(a){var f={},d;for(d in a)a.hasOwnProperty(d)&&(null===a[d]?f[d]=null:Array.isArray(a[d])?f[d]=b(a[d]):f[d]="object"===typeof a[d]?c(a[d]):a[d]);return f}return Array.isArray(a)?b(a):c(a)};y.setVerticalCenter=function(a){setTimeout(function(){var b=l(".jimu-vcenter-text",a),c,f;e.forEach(b,function(a){c=
g.getContentBox(a).h;g.setStyle(a,{lineHeight:c+"px"})},this);b=l(".jimu-vcenter",a);e.forEach(b,function(a){c=g.getContentBox(a).h;f=g.getContentBox(l(a).parent()[0]).h;g.setStyle(a,{marginTop:(f-c)/2+"px"})},this)},10)};y.merge=K;y.loadStyleLink=function(a,f,d){var n=new c,p,q=require(y.getRequireConfig()).toUrl(f);if(require.cache["url:"+q]){p=require.cache["url:"+q];var s=q.split("/").pop(),q=q.substr(0,q.length-s.length);p=H(p,q);a=d?g.create("style",{id:a,type:"text/css"},g.byId(d),"before"):
g.create("style",{id:a,type:"text/css"},document.getElementsByTagName("head")[0]);a.styleSheet&&!a.sheet?a.styleSheet.cssText=p:a.appendChild(g.toDom(p));n.resolve("load");return n}p=d?g.create("link",{id:a,rel:"stylesheet",type:"text/css",href:q},g.byId(d),"before"):g.create("link",{id:a,rel:"stylesheet",type:"text/css",href:q},document.getElementsByTagName("head")[0]);b(p,"load",function(){n.resolve("load")});var r=setInterval(function(){var a;if(e.some(document.styleSheets,function(b){if(b.href&&
b.href.substr(b.href.indexOf(f),b.href.length)===f)return a=b,!0}))try{!n.isFulfilled()&&(a.cssRules&&a.cssRules.length||a.rules&&a.rules.length)&&n.resolve("load"),clearInterval(r)}catch(b){}},50);return n};y.changeLocation=function(a){window.history.pushState&&window.history.pushState({path:a},"",a)};y.urlToObject=function(a){var b=null;-1===a.indexOf("#")?(b=C.urlToObject(a),b.hash=null):(a=a.split("#"),b=C.urlToObject(a[0]),b.hash=a[1]?-1<a[1].indexOf("\x3d")?k.queryToObject(a[1]):a[1]:null);
return b};y.addManifestProperies=function(a){a.icon=a.url+"images/icon.png";"theme"===a.category?G(a):("undefined"!==typeof a["2D"]&&(a.support2D=a["2D"]),"undefined"!==typeof a["3D"]&&(a.support3D=a["3D"]),"undefined"===typeof a["2D"]&&"undefined"===typeof a["3D"]&&(a.support2D=!0),delete a["2D"],delete a["3D"],"undefined"===typeof a.properties&&(a.properties={}),E.processWidgetProperties(a))};y.getUniqueValues=function(a,b){var f=new c,d=a.replace(/\/*$/g,"")+"/generateRenderer",p=n.stringify({type:"uniqueValueDef",
uniqueValueFields:[b]});F({url:d,content:{classificationDef:p,f:"json"},handleAs:"json",callbackParamName:"callback"}).then(m.hitch(this,function(a){var b=[];(a=a&&a.uniqueValueInfos)&&0<a.length&&(b=e.map(a,m.hitch(this,function(a){return a.value})));f.resolve(b)}),m.hitch(this,function(a){f.reject(a)}));return f};y.combineRadioCheckBoxWithLabel=function(a,b){var c=!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var f=a.getAttribute("type")||"",f=f.toLowerCase();if("radio"===f||"checkbox"===
f)c=!0}f=!1;b&&(1===b.nodeType&&"label"===b.tagName.toLowerCase())&&(f=!0);c&&f&&(c=a.getAttribute("id"),c||(c="input_"+y.getRandomString(),a.setAttribute("id",c)),b.setAttribute("for",c),g.setStyle(b,"cursor","pointer"))};y.convertExtentToPolygon=function(a){var b=a.xmin,c=a.xmax,f=a.ymin,d=a.ymax;return new v({rings:[[[b,d],[c,d],[c,f],[b,f],[b,d]]],spatialReference:a.toJson()})};y.combineGeometries=function(a){function b(a){var c={points:[],spatialReference:a[0].spatialReference.toJson()};e.forEach(a,
function(a){c.points=c.points.concat(a.points)});return new u(c)}function c(a){var b={paths:[],spatialReference:a[0].spatialReference.toJson()};e.forEach(a,function(a){b.paths=b.paths.concat(a.paths)});return new w(b)}function f(a){var b={rings:[],spatialReference:a[0].spatialReference.toJson()};e.forEach(a,function(a){"polygon"===a.type?b.rings=b.rings.concat(a.rings):"extent"===a.type&&(a=y.convertExtentToPolygon(a),b.rings=b.rings.concat(a.rings))});return new v(b)}var d=null;if(a&&0<a.length)if(1===
a.length)d=a[0];else{for(var n=null,p=null,q=null,s=null,r=0;r<a.length;r++){n=a[r];switch(n.type){case "point":case "multipoint":s="point";break;case "polyline":s="polyline";break;case "polygon":case "extent":s="polygon";break;default:return null}if(0===r)q=s;else if(q!==s)return null;if(r!==a.length-1&&(p=a[r+1],!n.spatialReference.equals(p.spatialReference)))return null}"point"===s?d=b(a):"polyline"===s?d=c(a):"polygon"===s&&(d=f(a))}return d};y.isFeaturelayerUrlSupportQuery=function(a,b){var c=
!1,f=/\/featureserver\//gi.test(a),d=/\/mapserver\//gi.test(a);b=(b||"").toLowerCase();f?c=0<=b.indexOf("query"):d&&(c=0<=b.indexOf("data"));return c};y.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};y.isStringEndWith=function(a,b){return a.lastIndexOf(b)+b.length===a.length};y.processManifestLabel=function(a,b){a.label=a.i18nLabels&&(a.i18nLabels[b]||a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&e.forEach(a.layouts,function(c){var f="i18nLabels_layout_"+
c.name;c.label=a[f]&&(a[f][b]||a[f].defaultLabel)||c.label||c.name});a.styles&&e.forEach(a.styles,function(c){var f="i18nLabels_style_"+c.name;c.label=a[f]&&(a[f][b]||a[f].defaultLabel)||c.label||c.name})};y.addManifest2WidgetJson=function(a,b){m.mixin(a,b.properties);a.name=b.name;a.label||(a.label=b.label);a.manifest=b};y.addI18NLabel=function(a){var b=new c;if(a.i18nLabels)return b.resolve(a),b;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return b.resolve(a),b;var f="widget"===
a.category?"_widgetLabel":"_themeLabel";require(y.getRequireConfig(),["dojo/i18n!"+a.amdFolder+"nls/strings"],function(c){a.i18nLabels[dojoConfig.locale]=c[f];"theme"===a.category&&(a.layouts&&a.layouts.forEach(function(b){a["i18nLabels_layout_"+b.name]={};a["i18nLabels_layout_"+b.name][dojoConfig.locale]=c["_layout_"+b.name]}),a.styles&&a.styles.forEach(function(b){a["i18nLabels_style_"+b.name]={};a["i18nLabels_style_"+b.name][dojoConfig.locale]=c["_style_"+b.name]}));b.resolve(a)});return b};y.localizeNumber=
function(a,b){var c=(a.toString().split(".")[1]||"").length,f="",f=0<c?"#,###,###,##0.0"+Array.prototype.join.call({length:c},"0"):"#,###,###,##0",c={locale:d.locale,pattern:f};m.mixin(c,b||{});try{return p.format(a,c)}catch(n){return console.error(n),a.toLocaleString()}};y.parseNumber=function(a,b){var c={locale:d.locale};m.mixin(c,b||{});try{return p.parse(a,c)}catch(f){return console.error(f),a}};y.localizeDate=function(a,b){var c={locale:d.locale,fullYear:!0};m.mixin(c,b||{});try{return t.format(a,
c)}catch(f){return console.error(f),"date"===c.selector?a.toLocaleDateString():"time"===c.selector?a.toLocaleTimeString():a.toLocaleString()}};y.addRelativePathInCss=H;y.url={isAbsolute:function(a){return!a?!1:a.startWith("http")||a.startWith("/")},removeQueryParamFromUrl:function(a,b){var c=C.urlToObject(a);c.query&&delete c.query[b];var f=c.path,d;for(d in c.query)f=f===c.path?f+"?"+d+"\x3d"+c.query[d]:f+"\x26"+d+"\x3d"+c.query[d];return f},addQueryParamToUrl:function(a,b,c){a=C.urlToObject(a);
a.query||(a.query={});a.query[b]=c;b=a.path;for(var f in a.query)b=b===a.path?b+"?"+f+"\x3d"+a.query[f]:b+"\x26"+f+"\x3d"+a.query[f];return b}};y.processUrlInWidgetConfig=function(a,b){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):b+a};y.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:window.appInfo.appPath+a};y.getLocationUrlWithoutHashAndQueryParams=
function(){var a=window.location,b=a.protocol+"//"+a.host+a.pathname,a=C.urlToObject(a.href);a.query&&a.query.apiurl&&(b=y.url.addQueryParamToUrl(b,"apiurl",a.query.apiurl));return b};y.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};y.invertColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?"#000000":"#ffffff"};y.mixinAppConfigPosition=function(a,
b){var c=m.clone(a);if(!b)return c;b=m.clone(b);var f=c.widgetOnScreen,d=b.widgetOnScreen;d&&d.widgets&&("[object Object]"===Object.prototype.toString.call(d.widgets)?e.forEach(f.widgets,function(a,b){var c;c=a.uri?a.uri:"ph_"+b;d.widgets[c]&&d.widgets[c].position&&(d.widgets[c].position.relativeTo||(d.widgets[c].position.relativeTo="map"),a.position=d.widgets[c].position)},this):e.forEach(d.widgets,function(a,b){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");f.widgets[b]&&a.position&&
(f.widgets[b].position=a.position)}));d&&d.groups&&("[object Object]"===Object.prototype.toString.call(d.groups)?e.forEach(f.groups,function(a,b){var c;c=a.label?a.label:"g_"+b;d.groups[c]&&(d.groups[c].panel&&d.groups[c].panel.position)&&(d.groups[c].panel.position.relativeTo||(d.groups[c].panel.position.relativeTo="map"),a.panel.position=d.groups[c].panel.position)},this):e.forEach(d.groups,function(a,b){a.panel&&(a.panel.position&&!a.panel.position.relativeTo)&&(a.panel.position.relativeTo="map");
f.groups[b]&&a.panel.position&&(f.groups[b].panel.position=a.panel.position)}));b.map&&b.map.position&&(c.map?c.map.position=b.map.position:c.map={position:b.map.position});b.widgetPool&&b.widgetPool.panel&&(b.widgetPool.panel.position&&!b.widgetPool.panel.position.relativeTo&&(b.widgetPool.panel.position.relativeTo="map"),c.widgetPool.panel.position=b.widgetPool.panel.position);b.mobileLayout&&(c.mobileLayout=b.mobileLayout);return c};y.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",
getSearchRange:function(a,b,c){var f=-1;b=a.search(RegExp(b));0<=b&&(a=a.slice(b,a.length),a=a.indexOf(c),f=b+a+c.length);return{firstPos:b,lastPos:f}},setConfigValue:function(a,b,c){J(a,b,c)},getConfigValue:function(a,b){return J(a,b)},setConfigValueWithId:function(a,b,c){M(a,b,c)},getConfigValueWithId:function(a,b){return M(a,b)},getKeyInfo:function(a){var b=this.getWidgetIdByKey(a);if(null!==b)return{type:"widget",id:b};a=this.getGroupIdByKey(a);return null!==a?{type:"group",id:a}:{type:"unknow",
id:null}},getWidgetIdByKey:function(a){var b=y.template.getSearchRange(a,y.template.widgetIdentification,"]");if(-1===b.firstPos)a=null;else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,b.lastPos-1)}return a},getGroupIdByKey:function(a){var b=y.template.getSearchRange(a,y.template.groupIdentification,"]");if(-1===b.firstPos)a=null;else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,b.lastPos-1)}return a},getConfigedWidgetsByTemplateConfig:function(a){var b=
[],c=y.template.widgetIdentification+"_config",f;e.forEach(a.configurationSettings,function(a){e.forEach(a.fields,function(a){a.fieldName&&(f=y.template.getSearchRange(a.fieldName,c,"]"),0<=f.firstPos&&(a=y.template.getWidgetIdByKey(a.fieldName),-1===b.indexOf(a)&&b.push(a)))},this)},this);return b},mergeTemplateAppConfigToAppConfig:function(a,b,c){function f(a){var b=[];e.forEach(a,function(a){a&&b.push(a)},this);return b}var d=a.widgetOnScreen,n=a.portalUrl;b.values.webmap&&(a.map.itemId=b.values.webmap);
c&&(a.map.mapOptions&&y.deleteMapOptions(a.map.mapOptions),a.map.portalUrl=n,b.values.app_title||(b.values.app_title=c.title),b.values.app_subtitle||(b.values.app_subtitle=c.snippet));for(var p in b.values)"webmap"!==p&&y.template.setConfigValueWithId(a,p,b.values[p]);a.widgetPool.widgets=f(a.widgetPool.widgets);d.widgets=f(d.widgets);if(a.widgetPool.groups)for(b=0;b<a.widgetPool.groups.length;b++)a.widgetPool.groups[b].widgets=f(a.widgetPool.groups[b].widgets);if(d.groups)for(b=0;b<d.groups.length;b++)d.groups[b].widgets=
f(d.groups[b].widgets);return a}};y.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,delete a.maxZoom,delete a.minScale,delete a.minZoom)};y.localeIsSame=function(a,b){return a.split("-")[0]===b.split("-")[0]};y.graphicsExtent=function(a,b){var c=null;try{0<a.length&&(c=A.graphicsExtent(a))&&"number"===typeof b&&0<b&&(c=c.expand(b))}catch(f){console.error(f)}return c};return y})},"dojo/NodeList-traverse":function(){define(["./query",
"./_base/lang","./_base/array"],function(m,e,g){var h=m.NodeList;e.extend(h,{_buildArrayFromCallback:function(d){for(var e=[],l=0;l<this.length;l++){var a=d.call(this[l],this[l],e);a&&(e=e.concat(a))}return e},_getUniqueAsNodeList:function(d){for(var e=[],l=0,a;a=d[l];l++)1==a.nodeType&&-1==g.indexOf(e,a)&&e.push(a);return this._wrap(e,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(d,e){var l=this._getUniqueAsNodeList(d),l=e?m._filterResult(l,e):l;return l._stash(this)},_getRelatedUniqueNodes:function(d,
e){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(e),d)},children:function(d){return this._getRelatedUniqueNodes(d,function(d,l){return e._toArray(d.childNodes)})},closest:function(d,e){return this._getRelatedUniqueNodes(null,function(l,a){do if(m._filterResult([l],d,e).length)return l;while(l!=e&&(l=l.parentNode)&&1==l.nodeType);return null})},parent:function(d){return this._getRelatedUniqueNodes(d,function(d,e){return d.parentNode})},parents:function(d){return this._getRelatedUniqueNodes(d,
function(d,e){for(var a=[];d.parentNode;)d=d.parentNode,a.push(d);return a})},siblings:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var a=[],c=d.parentNode&&d.parentNode.childNodes,b=0;b<c.length;b++)c[b]!=d&&a.push(c[b]);return a})},next:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var a=d.nextSibling;a&&1!=a.nodeType;)a=a.nextSibling;return a})},nextAll:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var a=[],c=d;c=c.nextSibling;)1==
c.nodeType&&a.push(c);return a})},prev:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var a=d.previousSibling;a&&1!=a.nodeType;)a=a.previousSibling;return a})},prevAll:function(d){return this._getRelatedUniqueNodes(d,function(d,e){for(var a=[],c=d;c=c.previousSibling;)1==c.nodeType&&a.push(c);return a})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-
1]]:[],this)},even:function(){return this.filter(function(d,e){return 0!=e%2})},odd:function(){return this.filter(function(d,e){return 0==e%2})}});return h})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(m,e,g,h,d,k,l,a){return m(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var c=
g.map(this.geometries,function(a){return a.toJson()}),b={};b.outSR=this.outSR.wkid||h.toJson(this.outSR.toJson());b.inSR=this.geometries[0].spatialReference.wkid||h.toJson(this.geometries[0].spatialReference.toJson());b.geometries=h.toJson({geometryType:a.getJsonType(this.geometries[0]),geometries:c});this.transformation&&(b.transformation=this.transformation.wkid||h.toJson(this.transformation));l.isDefined(this.transformForward)&&(b.transformForward=this.transformForward);return b}})})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang",
"jimu/shared/basePortalUrlUtils"],function(m,e){var g=m.clone(e);g.declaredClass="jimu.portalUrlUtils";g.getPortalUrlFromLocation=function(){return g.getPortalServerFromLocation()+g.getDeployContextFromLocation()};g.getPortalSignInUrlFromLocation=function(){return g.getPortalUrlFromLocation()+"home/signin.html"};g.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};g.getDeployContextFromLocation=function(){var e=window.location.href.split("?")[0],d=e.indexOf("/home");
0>d&&(d=e.indexOf("/apps"));e=e.substring(e.indexOf(window.location.host)+window.location.host.length+1,d);"/"!==e&&(e="/"+e+"/");return e};g.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+g.getDeployContextFromLocation()+"sharing/rest/"};return g})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var m={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,
"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(e){return this.substr(0,e.length)===e});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(e){return this.substr(this.length-e.length,e.length)===e});m.getServerByUrl=function(e){e=(e||"").trim();e=e.replace(/^(http(s?):?)\/\//gi,"");0===e.indexOf("//")&&(e=e.slice(2));return e.split("/")[0]};m.getServerWithProtocol=function(e){var g="";if(e=(e||"").trim()){var h=
m.getServerByUrl(e);if(!h)return g;var d=m.getProtocol(e);d?g=d+"://"+h:0===e.indexOf("//")&&(g="//"+h)}return g};m.isSameServer=function(e,g){e=m.getServerByUrl(e)||"";g=m.getServerByUrl(g)||"";return e.toLowerCase()===g.toLowerCase()};m.isOnline=function(e){return 0<=m.getServerByUrl(e).toLowerCase().indexOf(".arcgis.com")};m.isArcGIScom=function(e){e=m.getServerByUrl(e).toLowerCase();return"www.arcgis.com"===e||"arcgis.com"===e};m.getStandardPortalUrl=function(e){var g=m.getServerByUrl(e);if(""===
g)return"";m.isOnline(g)?(m.isArcGIScom(g)&&(g="www.arcgis.com"),e=m.addProtocol(e),e=m.getProtocol(e)+"://"+g):(e=(e||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),e=m.addProtocol(e),e.replace(RegExp("http(s?)://"+g,"g"),"")||(e+="/arcgis"));return e};m.isSamePortalUrl=function(e,g){var h=/^http(s?):\/\//gi,d=/^\/\//gi;e=m.getStandardPortalUrl(e).toLowerCase().replace(h,"").replace(d,"");g=m.getStandardPortalUrl(g).toLowerCase().replace(h,"").replace(d,"");return e===g};m.addProtocol=
function(e){if(-1>=e.toLowerCase().indexOf("http://")&&-1>=e.toLowerCase().indexOf("https://")){var g="";"undefined"!==typeof window&&window.location?(g=window.location.protocol,e=e.startWith("//")?g+e:e.startWith("/")?g+"//"+window.location.host+e:g+"//"+e):(g="http:",e.startWith("//")&&(e=g+e))}return e};m.getProtocol=function(e){var g="";e=e.toLowerCase();0===e.indexOf("https://")?g="https":0===e.indexOf("http://")&&(g="http");return g};m.updateUrlProtocolByOtherUrl=function(e,g){g=g.toLowerCase();
0===g.indexOf("https://")?e=m.setHttpsProtocol(e):0===g.indexOf("http://")&&(e=m.setHttpProtocol(e));return e};m.removeProtocol=function(e){return e.replace(/^http(s?):\/\//i,"//")};m.setHttpProtocol=function(e){e=m.addProtocol(e);return e.replace(/^https:\/\//,"http://")};m.setHttpsProtocol=function(e){e=m.addProtocol(e);return e.replace(/^http:\/\//,"https://")};m.setProtocol=function(e,g){return 0<=g.indexOf("https")?m.setHttpsProtocol(e):0<=g.indexOf("http")?m.setHttpProtocol(e):e};m.getSharingUrl=
function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/sharing");return g};m.getOAuth2Url=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/sharing/oauth2");return g};m.getAppIdUrl=function(e,g){var h="",d=m.getStandardPortalUrl(e);d&&(h=d+"/sharing/oauth2/apps/"+g);return h};m.getSignInUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/home/signin.html");return g};m.getBaseSearchUrl=function(e){var g="";e=m.getStandardPortalUrl(e);(e=e.replace(/\/*$/g,""))&&(g=e+"/sharing/rest/search");
return g};m.getBaseItemUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/sharing/rest/content/items");return g};m.getItemUrl=function(e,g){var h="",d=m.getBaseItemUrl(e);d&&g&&(h=d+"/"+g);return h};m.getItemDataUrl=function(e,g){var h="",d=m.getItemUrl(e,g);d&&(h=d+"/data");return h};m.getGenerateTokenUrl=function(e){var g="";e&&(e=m.getStandardPortalUrl(e),g=e+"/sharing/generateToken");return g};m.getItemDetailsPageUrl=function(e,g){var h="";e&&g&&(e=m.getStandardPortalUrl(e),h=e+"/home/item.html?id\x3d"+
g);return h};m.getUserProfilePageUrl=function(e,g){var h="";e&&g&&(e=m.getStandardPortalUrl(e),h=e+"/home/user.html?user\x3d"+g);return h};m.getBaseGroupUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/sharing/rest/community/groups");return g};m.getPortalSelfInfoUrl=function(e){var g="";(e=m.getStandardPortalUrl(e||""))&&(g=e+"/sharing/portals/self");return g};m.getCommunitySelfUrl=function(e){var g="";(e=m.getStandardPortalUrl(e||""))&&(g=e+"/sharing/rest/community/self");return g};
m.getBaseUserUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/sharing/rest/community/users");return g};m.getUserUrl=function(e,g){var h="",d=m.getBaseUserUrl(e);e&&g&&(h=d+"/"+g);return h};m.getUserTagsUrl=function(e,g){var h="",d=m.getUserUrl(e,g);e&&g&&(h=d+"/tags");return h};m.getUserThumbnailUrl=function(e,g,h){var d="";(e=m.getUserUrl(e,g))&&h&&(d=e+"/info/"+h);return d};m.getContentUrl=function(e){var g="";e&&(e=m.getStandardPortalUrl(e),g=e+"/sharing/rest/content");return g};
m.getUserContentUrl=function(e,g,h){var d="",d="";e&&g&&(d=m.getContentUrl(e),d=h?d+"/users/"+g+"/"+h:d+"/users/"+g);return d};m.getAddItemUrl=function(e,g,h){var d="",d="";e&&g&&(d=m.getUserContentUrl(e,g,h),d+="/addItem");return d};m.getDeleteItemUrl=function(e,g,h){var d="";(e=m.getUserItemsUrl(e,g))&&(d=e+"/"+h+"/delete");return d};m.getUserItemsUrl=function(e,g,h){var d="",d="";e&&g&&(d=m.getUserContentUrl(e,g,h),d+="/items");return d};m.getUpdateItemUrl=function(e,g,h,d){var k="",k="";e&&g&&
(k=m.getUserItemsUrl(e,g,d),k=k+"/"+h+"/update");return k};m.shareItemUrl=function(e,g,h,d){var k="",k="";e&&g&&(k=m.getUserItemsUrl(e,g,d),k=k+"/"+h+"/share");return k};m.getHomeIndexUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/home/index.html");return g};m.getHomeMapViewerUrl=function(e,g){var h="",d=m.getStandardPortalUrl(e);d&&(h=d+"/home/webmap/viewer.html",h=g?h+("?webmap\x3d"+g):h+"?useExisting\x3d1");return h};m.getHomeGalleryUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&
(g=e+"/home/gallery.html");return g};m.getHomeGroupsUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/home/groups.html");return g};m.getHomeMyContentUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/home/content.html");return g};m.getHomeMyOrganizationUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/home/organization.html");return g};m.getHomeUserUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/home/user.html");return g};m.getPortalHelpUrl=function(e,
g){var h="",d=m.getStandardPortalUrl(e);d&&(h=d+"/portalhelp/"+(g||"en")+"/website/help/");return h};m.getPortalAdminHelpUrl=function(e,g){var h="",d=m.getStandardPortalUrl(e);d&&(h=d+"/portalhelp/"+(g||"en")+"/admin/help/");return h};m.getPortalProxyUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/sharing/proxy");return g};m.getOAuth2SignOutUrl=function(e){var g="";(e=m.getStandardPortalUrl(e))&&(g=e+"/sharing/oauth2/signout");return g};m.getNewPrintUrl=function(e){var g="";if(e=m.getStandardPortalUrl(e))e=
m.setHttpProtocol(e),g=e+"/sharing/tools/newPrint";return g};return m})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(m){function e(d,e){function l(a,c){var b,n,f,p,e="widgetOnScreen"===a;if(d[a]){if(d[a].groups)for(b=0;b<d[a].groups.length;b++)if(f=d[a].groups[b],c(f,{index:b,isWidget:!1,groupId:f.id,isThemeWidget:!1,isOnScreen:e}),d[a].groups[b].widgets)for(n=0;n<d[a].groups[b].widgets.length;n++)p=d[a].groups[b].widgets[n],c(p,{index:n,isWidget:!0,groupId:f.id,isThemeWidget:p.uri&&
-1<p.uri.indexOf("themes/"+d.theme.name),isOnScreen:e});if(d[a].widgets)for(b=0;b<d[a].widgets.length;b++)p=d[a].widgets[b],c(d[a].widgets[b],{index:b,isWidget:!0,groupId:a,isThemeWidget:p.uri&&-1<p.uri.indexOf("themes/"+d.theme.name),isOnScreen:e})}}l("widgetOnScreen",e);l("widgetPool",e)}var g={},h="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwithched isController hasVersionManager isThemeWidget supportMultiInstance".split(" ");
g.visitElement=e;g.getConfigElementById=function(d,k){var l;if("map"===k)return d.map;e(d,function(a){if(a.id===k)return l=a,!0});return l};g.getConfigElementByLabel=function(d,k){var l;if("map"===k)return d.map;e(d,function(a){if(a.label||a.name===k)return l=a,!0});return l};g.getConfigElementsByName=function(d,k){var l=[];if("map"===k)return[d.map];e(d,function(a){a.name===k&&l.push(a)});return l};g.getWidgetNameFromUri=function(d){d=d.split("/");d.pop();return d.pop()};g.getAmdFolderFromUri=function(d){d=
d.split("/");d.pop();return d.join("/")+"/"};g.widgetProperties=h;g.processWidgetProperties=function(d){"undefined"===typeof d.properties.isController&&(d.properties.isController=!1);"undefined"===typeof d.properties.isThemeWidget&&(d.properties.isThemeWidget=!1);"undefined"===typeof d.properties.hasVersionManager&&(d.properties.hasVersionManager=!1);h.forEach(function(e){"undefined"===typeof d.properties[e]&&(d.properties[e]=!0)})};g.isHostedService=function(d){var e=m.getServerByUrl(d)+"/[^/]+/[^/]+/rest/services";
return RegExp(e,"gi").test(d)};return g})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r){var q=null,u=m(l,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(k.subscribe("app/mapLoaded",
e.hitch(this,this._onMapLoaded)),k.subscribe("app/mapChanged",e.hitch(this,this._onMapChanged))):(k.subscribe("mapLoaded",e.hitch(this,this._onMapLoaded)),k.subscribe("mapChanged",e.hitch(this,this._onMapChanged)));window.isBuilder?(k.subscribe("app/appConfigLoaded",e.hitch(this,this._onAppConfigLoaded)),k.subscribe("app/appConfigChanged",e.hitch(this,this._onAppConfigChanged))):(k.subscribe("appConfigLoaded",e.hitch(this,this._onAppConfigLoaded)),k.subscribe("appConfigChanged",e.hitch(this,this._onAppConfigChanged)));
k.subscribe("userSignIn",e.hitch(this,this._onUserSignIn));k.subscribe("userSignOut",e.hitch(this,this._onUserSignOut));k.subscribe("builder/actionTriggered",e.hitch(this,this._onActionTriggered));k.subscribe("/dnd/move/start",e.hitch(this,this._onMoveStart))},loadWidget:function(a){var b=new d,c;a=e.clone(a);a.folderUrl||t.processWidgetSetting(a);(c=this.getWidgetById(a.id))?b.resolve(c):p([this.loadWidgetClass(a),this.loadWidgetManifest(a)]).then(e.hitch(this,function(a){var c=a[0],f=a[1];this.loadWidgetResources(f).then(e.hitch(this,
function(a){try{var d=this.createWidget(f,c,a);console.log("widget ["+f.uri+"] created.")}catch(n){console.log("create ["+f.uri+"] error:"+n.stack),new r({message:"create widget error: "+f.uri}),b.reject(n)}setTimeout(e.hitch(this,function(){b.resolve(d);this.emit("widget-created",d);k.publish("widgetCreated",d)}),50)}),function(a){b.reject(a)})}),function(a){b.reject(a)});return b},loadWidgetClass:function(a){var b=new d;require(t.getRequireConfig(),[a.uri],e.hitch(this,function(a){b.resolve(a)}));
t.checkError(a.uri,b);return b},loadWidgetResources:function(a){var b=new d,c,f,n,q=[];n=e.clone(a);a=this.tryLoadWidgetConfig(n);c=this._tryLoadResource(n,"i18n");f=this._tryLoadResource(n,"style");n=this._tryLoadResource(n,"template");q.push(a);q.push(c);q.push(n);q.push(f);p(q).then(e.hitch(this,function(a){var c={};c.config=a[0];c.i18n=a[1];c.template=a[2];c.style=a[3];b.resolve(c)}),function(a){b.reject(a)});return b},loadWidgetManifest:function(a){var b=new d,c=a.folderUrl+"manifest.json";if(a.manifest)return b.resolve(a),
b;f(c,{handleAs:"json"}).then(e.hitch(this,function(c){c.amdFolder=a.amdFolder;c.category="widget";a.label?(this._processManifest(c),t.addManifest2WidgetJson(a,c),b.resolve(a)):t.addI18NLabel(c).then(e.hitch(this,function(){this._processManifest(c);t.addManifest2WidgetJson(a,c);b.resolve(a)}))}),function(a){b.reject(a)});return b},getWidgetMarginBox:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return{};if(a._marginBox)return a._marginBox;a.setPosition({left:-9999,top:-9999,relativeTo:a.position.relativeTo});
this.openWidget(a);a._marginBox=a.getMarginBox();this.closeWidget(a);return a._marginBox},_processManifest:function(a){t.addManifestProperies(a);t.processManifestLabel(a,window.dojoConfig.locale)},createWidget:function(b,f,d){if(this.getWidgetById(b.id))return this.getWidgetById(b.id);d.config&&d.i18n&&(d.config=t.replacePlaceHolder(d.config,d.i18n));b.rawConfig=b.config;b.config=d.config||{};this.appConfig._appData&&this._mergeAgolConfig(b);b.nls=d.i18n||{};d.template&&(b.templateString=d.template);
b["class"]="jimu-widget";b.label||(b.label=b.name);this.map&&(b.map=this.map);b.appConfig=this.appConfig;d={};for(var n in b)b.hasOwnProperty(n)&&(d[n]=b[n]);d.widgetManager=this;b=new f(d);b.clazz=f;c.after(b,"startup",e.hitch(this,this._postWidgetStartup,b));c.before(b,"destroy",e.hitch(this,this._onDestroyWidget,b));a(b.domNode,"click",e.hitch(this,this._onClickWidget,b));this.loaded.push(b);return b},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var a=g.map(this.loaded,
function(a){return a.id});g.forEach(a,function(a){this.destroyWidget(a)},this);this.loaded=[]},loadWidgetSettingPage:function(a){var b=new d;a=e.clone(a);a.id+="_setting";p([this.loadWidgetSettingClass(a)]).then(e.hitch(this,function(f){var d=f[0];this.loadWidgetSettingPageResources(a).then(e.hitch(this,function(f){var n;f={nls:f.i18n,templateString:f.template,appConfig:this.appConfig,map:this.map,"class":"jimu-widget-setting"};for(var p in a)a.hasOwnProperty(p)&&(f[p]=a[p]);try{n=new d(f),c.before(n,
"destroy",e.hitch(this,this._onDestroyWidgetSetting,n)),b.resolve(n)}catch(q){new r({message:"Create widget setting page error:"+a.uri}),b.reject(q)}}),function(a){console.log(a)})}),function(a){b.reject(a)});return b},loadWidgetSettingClass:function(a){var b=new d;require(t.getRequireConfig(),[a.folderUrl+"setting/Setting.js"],e.hitch(this,function(a){b.resolve(a)}));t.checkError(a.folderUrl+"setting/Setting.js",b);return b},loadWidgetSettingPageResources:function(a){var b=new d,c,f,n=[];a=e.clone(a);
c=this._tryLoadResource(a,"settingI18n");f=this._tryLoadResource(a,"settingTemplate");a=this._tryLoadResource(a,"settingStyle");n.push(c);n.push(f);n.push(a);p(n).then(e.hitch(this,function(a){var c={};c.i18n=a[0]||{};c.template=a[1];c.style=a[2];b.resolve(c)}),function(a){console.log(a)});return b},getWidgetById:function(a){var b;g.some(this.loaded,function(c){if(c.id===a)return b=c,!0},this);return b},getWidgetByLabel:function(a){var b;g.some(this.loaded,function(c){if(c.label===a)return b=c,!0},
this);return b},getWidgetsByName:function(a){var b=[];g.some(this.loaded,function(c){c.name===a&&b.push(c)},this);return b},changeWindowStateTo:function(a,b){"normal"===b?this.normalizeWidget(a):"minimized"===b?this.minimizeWidget(a):"maximized"===b?this.maximizeWidget(a):console.log("error state: "+b)},closeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if("closed"!==a.state){this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget.onDeActive(),this.activeWidget=
null);h.setStyle(a.domNode,"display","none");a.setState("closed");try{a.onClose()}catch(b){console.log(console.error("fail to close widget "+a.name+". "+b.stack))}}},openWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if(!a.started)try{a.started=!0,a.startup()}catch(b){console.error("fail to startup widget "+a.name+". "+b.stack)}if("closed"===a.state){h.setStyle(a.domNode,"display","");a.setState("opened");try{a.onOpen()}catch(c){console.error("fail to open widget "+
a.name+". "+c.stack)}}},maximizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("maximized");try{a.onMaximize()}catch(b){console.log(console.error("fail to maximize widget "+a.name+". "+b.stack))}},minimizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("minimized");try{a.onMinimize()}catch(b){console.log(console.error("fail to minimize widget "+
a.name+". "+b.stack))}},normalizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("normal");try{a.onNormalize()}catch(b){console.log(console.error("fail to normalize widget "+a.name+". "+b.stack))}},destroyWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this._removeWidget(a);try{a.destroy()}catch(b){console.log(console.error("fail to destroy widget "+a.name+". "+b.stack))}},tryLoadWidgetConfig:function(a){return this._tryLoadWidgetConfig(a).then(e.hitch(this,
function(b){return this._upgradeWidgetConfig(a,b).then(function(b){return a.config=b})}))},_tryLoadWidgetConfig:function(a){var c=new d;if(a.config&&e.isObject(a.config))return c.resolve(a.config),c;if(a.config){if(require.cache["url:"+a.config])return c.resolve(b.parse(require.cache["url:"+a.config])),c;a=t.processUrlInAppConfig(a.config);a=a.split("/");a[a.length-1]=encodeURIComponent(a[a.length-1]);a=a.join("/");return f(a,{handleAs:"json"})}return this._tryLoadResource(a,"config")},_upgradeWidgetConfig:function(a,
b){var c=new d,f=a.manifest.version,n=a.version,p;if(f===n)return c.resolve(b),c;if(!1===a.hasVersionManager)return a.version=f,c.resolve(b),c;require(t.getRequireConfig(),[a.amdFolder+"VersionManager"],e.hitch(this,function(d){d=new d;var q=d.getVersionIndex(n),e=d.getVersionIndex(f);if(q>e)c.reject("Bad widget version number, "+a.name+","+n);else try{p=d.upgrade(b,n,f),a.version=f,c.resolve(p)}catch(s){console.log("Read widget ["+a.name+"] old config error,"+s.stack),c.resolve(b)}}));return c},
loadWidgetStyle:function(a){var b="widget/style/"+a.uri,c=new d,b=this._replaceId(b);return h.byId(b)?(c.resolve("load"),c):t.loadStyleLink(b,a.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(a){var b="widget/style/"+a.uri+"/setting",c=new d,b=this._replaceId(b);return h.byId(b)?(c.resolve("load"),c):t.loadStyleLink(b,a.settingStyleFile)},loadWidgetConfig:function(a){a=require(t.getRequireConfig()).toUrl(a.configFile);if(require.cache["url:"+a]){var c=
new d;c.resolve(b.parse(require.cache["url:"+a]));return c}return f(a,{handleAs:"json"})},loadWidgetI18n:function(a){var b=new d;require(t.getRequireConfig(),["dojo/i18n!"+a.i18nFile],function(a){b.resolve(a)});return b},loadWidgetSettingI18n:function(a){var b=new d;require(t.getRequireConfig(),["dojo/i18n!"+a.settingI18nFile],function(a){b.resolve(a)});return b},loadWidgetTemplate:function(a){var b=new d;require(t.getRequireConfig(),["dojo/text!"+a.templateFile],function(a){b.resolve(a)});t.checkError(a.templateFile,
b);return b},loadWidgetSettingTemplate:function(a){var b=new d;require(t.getRequireConfig(),["dojo/text!"+a.settingTemplateFile],function(a){b.resolve(a)});t.checkError(a.settingTemplateFile,b);return b},removeWidgetStyle:function(a){h.destroy(this._replaceId("widget/style/"+a.uri))},removeWidgetSettingStyle:function(a){h.destroy(this._replaceId("widget/style/"+a.uri+"/setting"))},getControllerWidgets:function(){return g.filter(this.loaded,function(a){return a.isController})},getOffPanelWidgets:function(){return g.filter(this.loaded,
function(a){return!a.inPanel})},getOnScreenOffPanelWidgets:function(){return g.filter(this.loaded,function(a){return a.isOnScreen&&!a.inPanel})},closeOtherWidgetsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a.gid&&this.loaded[b].id!==a.id&&this.closeWidget(this.loaded[b])},closeAllWidgetsInGroup:function(a){for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a&&this.closeWidget(this.loaded[b])},
_mergeAgolConfig:function(a){var b=this.appConfig._appData.values,c="widgets["+a.id+"]",f;for(f in b){var d=f.replace(/\//g,"_").indexOf(c+"_config");0<=d&&t.template.setConfigValue(a,f.replace(/\//g,"_").substr(d,f.length).replace(c,"widget"),b[f])}},_onUserSignIn:function(a){g.forEach(this.loaded,function(b){b.onSignIn(a)},this)},_onUserSignOut:function(){g.forEach(this.loaded,function(a){a.onSignOut()},this)},_activeWidget:function(a){if(this.activeWidget){if(this.activeWidget.id===a.id){!1===
this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&h.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&h.setStyle(a.domNode,"zIndex","zIndex"in a.position?a.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=a;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&h.setStyle(this.activeWidget.domNode,
"zIndex",101),this.activeWidget.onActive(),k.publish("widgetActived",a))},_onClickWidget:function(a,b){var c=n(".jimu-widget",a.domNode);if(0<c.length)for(var f=0;f<c.length;f++)if(b.target===c[f]||h.isDescendant(b.target,c[f]))return;this._activeWidget(a)},_onMoveStart:function(a){g.forEach(this.loaded,function(b){b.domNode===a.node&&this._activeWidget(b)},this)},_onAppConfigLoaded:function(a){this.appConfig=a=e.clone(a);s.setPortalUrl(a.portalUrl)},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=
a},_onAppConfigChanged:function(a,b,c,f){var d=e.clone(a);this.appConfig=d;g.forEach(this.loaded,function(a){a&&(a.onAppConfigChanged(d,b,c,f),"widgetChange"===b&&this._onConfigChanged(c.id,c.config,f))},this)},_onConfigChanged:function(a,b){var c=this.getWidgetById(a);c&&(c.onConfigChanged(b),e.mixin(c.config,b))},_onActionTriggered:function(a){if(!("map"===a.elementId||"app"===a.elementId)){var b=this.getWidgetById(a.elementId);if(b)b.onAction(a.action,a.data);else this.missedActions.push({id:a.elementId,
action:{name:a.action,data:a.data}});g.forEach(this.getControllerWidgets(),function(b){if(b.widgetIsControlled(a.elementId))b.onAction(a.action,{widgetId:a.elementId,data:a.data})},this)}},_postWidgetStartup:function(a){a.started=!0;t.setVerticalCenter(a.domNode);c.after(a,"resize",e.hitch(this,t.setVerticalCenter,a.domNode));this.openWidget(a);var b=s.getPortalCredential(this.appConfig.portalUrl);if(b)a.onSignIn(b);else a.onSignOut();this._triggerMissedAction(a)},_triggerMissedAction:function(a){this.missedActions.forEach(function(b){if(b.id===
a.id)a.onAction(b.action.name,b.action.data)})},_remove:function(a){return g.some(this.loaded,function(b,c){if(b.id===a)return this.loaded.splice(c,1),!0},this)},_tryLoadResource:function(a,b){var c,f=new d;if("config"===b)c=a.amdFolder+"config.json",a.configFile=c,c="hasConfig";else if("style"===b)c=a.amdFolder+"css/style.css",a.styleFile=c,c="hasStyle";else if("i18n"===b)c=a.amdFolder+"nls/strings.js",a.i18nFile=a.amdFolder+"nls/strings",c="hasLocale";else if("template"===b)c=a.amdFolder+"Widget.html",
a.templateFile=c,c="hasUIFile";else if("settingTemplate"===b)c=a.amdFolder+"setting/Setting.html",a.settingTemplateFile=c,c="hasSettingUIFile";else if("settingI18n"===b)c=a.amdFolder+"setting/nls/strings.js",a.settingI18nFile=a.amdFolder+"setting/nls/strings",c="hasSettingLocale";else if("settingStyle"===b)c=a.amdFolder+"setting/css/style.css",a.settingStyleFile=c,c="hasSettingStyle";else return f;a[c]?function(){var c;if("config"===b)c=this.loadWidgetConfig(a);else if("style"===b)c=this.loadWidgetStyle(a);
else if("i18n"===b)c=this.loadWidgetI18n(a);else if("template"===b)c=this.loadWidgetTemplate(a);else if("settingTemplate"===b)c=this.loadWidgetSettingTemplate(a);else if("settingStyle"===b)c=this.loadWidgetSettingStyle(a);else if("settingI18n"===b)c=this.loadWidgetSettingI18n(a);else return f;c.then(function(a){f.resolve(a)},function(b){new r({message:"load widget resouce error: "+a.uri});f.reject(b)})}.apply(this):f.resolve(null);return f},_replaceId:function(a){return a.replace(/\//g,"_").replace(/\./g,
"_")},_onDestroyWidget:function(a){"closed"!==a.state&&this.closeWidget(a);this._removeWidget(a);console.log("destroy widget ["+a.uri+"].")},_onDestroyWidgetSetting:function(a){this.removeWidgetSettingStyle(a)},_removeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget=null);this._remove(a.id);0===this.getWidgetsByName(a.name).length&&this.removeWidgetStyle(a)}});u.getInstance=function(a){null===q&&(q=new u(a));
return window._widgetManager=q};return u})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r){"function"!==typeof d.getAll&&(d.getAll=function(a){var b=[];(a=d(a))&&b.push(a);return b});p={portalUrl:null,cookiePath:"/",_started:!1,
webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){var a=!1;try{a=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(b){console.log(b),a=!1}return!!a},isStringStartWith:function(a,b){return a.substr(0,b.length)===b},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=s.getStandardPortalUrl(a))&&(a+="/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(d){var n=
new h,p=s.getStandardPortalUrl(d);d=p+"/sharing";var e=s.setHttpsProtocol(p+"/sharing/generateToken?f\x3djson"),r=s.setHttpsProtocol(d);a.get(e,{jsonp:"callback"}).then(m.hitch(this,function(a){a.token?(this.webTierPortalUrls.push(p),this.removeWabAuthCookie(),c.id.getCredential(r).then(m.hitch(this,function(c){c.token||(c.token=a.token);c=f.canUseXhr(c.server,!0);-1<c&&b.defaults.io.corsEnabledServers.splice(c,1);b.defaults.io.corsEnabledServers.push({host:s.getServerByUrl(p),withCredentials:!0});
n.resolve(!0)}),m.hitch(this,function(){n.resolve(!0)}))):n.resolve(!1)}),m.hitch(this,function(a){console.error(a);n.reject(a)}));return n},tryRegisterCredential:function(a){return!this.isValidCredential(a)?!1:!e.some(c.id.credentials,m.hitch(this,function(b){return a.token===b.token}))?(c.id.credentials.push(a),!0):!1},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&m.trim(a)},signInPortal:function(a){var b=new h;if(this._isInvalidPortalUrl(a)){a=s.getStandardPortalUrl(a);var f=s.getSharingUrl(a),
d=this.getPortalCredential(a);d?setTimeout(m.hitch(this,function(){b.resolve(d)}),0):b=c.id.getCredential(f)}else setTimeout(m.hitch(this,function(){b.reject("Invalid portalurl.")}),0);return b},_loadPortalSelfInfo:function(a){a=s.getPortalSelfInfoUrl(a);return n({url:a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(a,b){if(!a||!("string"===typeof a&&b&&"string"===typeof b))return null;var f=c.id.findOAuthInfo(a);f||(f=window.location.protocol+"//"+window.location.host+
require.toUrl("jimu")+"/oauth-callback.html",f=new t({appId:b,expiration:20160,portalUrl:a,authNamespace:"/",popup:!0,popupCallbackUrl:f}),c.id.registerOAuthInfos([f]));f.appId=b;return f},signOutAll:function(){var a=s.getStandardPortalUrl(this.portalUrl),b=!!c.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();c.id.destroyCredentials();c.id._oAuthHash=null;b&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(m.trim(a||
""))},isValidCredential:function(a){var b=!1;if(a){var b=a.token,c=a.server,f=a.scope,b=b&&"string"===typeof b&&m.trim(b),c=c&&"string"===typeof c&&m.trim(c),f="portal"===f||"server"===f,d=!0;a.expires&&(a=parseInt(a.expires,10),d=(new Date).getTime(),d=a>d);b=b&&c&&f&&d}return b},isValidPortalCredentialOfPortalUrl:function(a,b){var c=!1;if(this.isValidCredential(b))var c="portal"===b.scope,f=s.isSameServer(a,b.server),c=c&&f;return c},getPortalCredential:function(a){var b=null;a=m.trim(a||"");if(!a)return null;
a=s.getStandardPortalUrl(a);return b=this._filterPortalCredential(a,c.id.credentials)},saveAndRegisterCookieToCredential:function(a){a=m.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=!!a.isAdmin;this.saveWabCookie(a);var b=a.server+"/sharing/rest";a.server=b;c.id.registerToken(a);return c.id.findCredential(b,a.userId)},registerAuth2Hash:function(a){a=m.clone(a);var b=1E3*parseInt(a.expires_in,10),b=(new Date).getTime()+b,c=s.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,
server:c,token:a.access_token,expires:b,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");d("wab_auth",k.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,
b){var c=null;if(b&&0<b.length){var f=e.filter(b,m.hitch(this,function(b){return this.isValidPortalCredentialOfPortalUrl(a,b)}));0<f.length&&(c=f[f.length-1])}return c},_removePortalCredential:function(a){var b=m.trim(a||"");if(b){b=s.getStandardPortalUrl(b);for(a=e.filter(c.id.credentials,m.hitch(this,function(a){return this.isValidPortalCredentialOfPortalUrl(b,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);c.id.credentials=e.filter(c.id.credentials,m.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(b,
a)}))}},getUserIdByToken:function(a,b){var f=new h;if(a&&"string"===typeof a&&b&&"string"===typeof b){var d=s.getStandardPortalUrl(b),p=e.filter(c.id.credentials,m.hitch(this,function(b){var c=b.token===a&&b.userId;b=s.isSameServer(d,b.server);return c&&b}));if(0<p.length){var r=p[0];setTimeout(m.hitch(this,function(){f.resolve(r.userId)}),0);return f}p=s.getCommunitySelfUrl(d);n({url:p,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(m.hitch(this,function(a){f.resolve(a&&a.username||
"")}),m.hitch(this,function(a){console.error(a);f.reject("fail to get userId by token")}))}else setTimeout(m.hitch(this,function(){f.reject("invalid parameters")}),0);return f},xtGetCredentialFromCookie:function(a){var b=d("wab_auth"),f=null;if(b)try{f=k.parse(b)}catch(n){console.error(n)}if(!(f&&"object"===typeof f)||!s.isSameServer(a,f.server)||window.location.host!==f.referer)return null;f.expires=parseInt(f.expires,10);b=(new Date).getTime();if(!(f.expires>b))return this.removeCookie("wab_auth"),
null;a+="/sharing/rest";f.server=a;(b=c.id.findCredential(a))||c.id.registerToken(f);return b=c.id.findCredential(a)},removeCookie:function(a){var b=this.getCookiePath();r.removeCookie(a,b)},_getDomainsByServerName:function(a){var b=a.split("."),c=b.length;return e.map(b,m.hitch(this,function(a,f){var d=b.slice(f,c),n="",p=d.length-1;e.forEach(d,m.hitch(this,function(a,b){n+=a;b!==p&&(n+=".")}));return n}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{l.publish("userSignIn",
a)}catch(b){console.error(b)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{l.publish("anyUserSignIn",a)}catch(b){console.error(b)}},_publishCurrentPortalUserSignOut:function(a){try{l.publish("userSignOut",a)}catch(b){console.error(b)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(b){console.error(b)}},_bindEvents:function(){g.after(c.id,"signIn",m.hitch(this,
function(a,b){console.log(b[1]);g.after(a,"callback",m.hitch(this,function(a,b){this._signInSuccess(b[0],!1)}));return a}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var b=a.esri&&a.esri.id;b&&(c.id=b,b=window.esriConfig.defaults.io,a=a.esriConfig.defaults.io,b.corsEnabledServers=a.corsEnabledServers,b.webTierAuthServers=a.webTierAuthServers,b._processedCorsServers=a._processedCorsServers,b.corsStatus=
a.corsStatus)}}this._bindEvents();this._started=!0}}};p.startup();return p})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(m,e,g,h,d,k){return m(k,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=
g.create("div",{"class":"title"},this.domNode),this.titleLabeNode=g.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=g.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(d(this.closeBtnNode,"click",e.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:"OK",key:h.ENTER,onClick:e.hitch(this,this.close)})},_increaseZIndex:function(){g.setStyle(this.domNode,
"zIndex",501);g.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase".split(" "),function(m,e,g,h,d,k,l,a,c,b,n){var f=0;return m(n,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,
maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this.domNode.tabIndex=1;this._initDomNode();this._positioning();h.place(this.domNode,this.container);setTimeout(e.hitch(this,function(){this._moveToMiddle()}),50);this.own(k(window,"resize",e.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),
this._moveToMiddle()):this._positioning()})));this.overlayNode=h.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();d.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=h.create("div",{"class":"title"},this.domNode);this.titleLabeNode=h.create("span",
{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=h.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var b=null,b="ontouchstart"in document?a.press:"click";this.own(k(this.closeBtnNode,b,e.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=h.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=
this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&h.place(this.content,this.contentContainerNode));this.buttonContainer=h.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&h.setStyle(this.buttonContainer,"display","none");for(var a=this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=
this.enabledButtons.length;if(0!==a){var b=h.getContentBox(this.buttonContainer),c=h.getMarginExtents(this.enabledButtons[0]),f=h.getPadBorderExtents(this.enabledButtons[0]),d=0,f=8===l("ie")?f.l+f.r:0,d=(b.w-(c.l+c.r+f)*a)/a;0<d&&(g.forEach(this.enabledButtons,e.hitch(this,function(a){h.setStyle(a,"maxWidth",d+"px")})),g.forEach(this.disabledButtons,e.hitch(this,function(a){h.setStyle(a,"maxWidth",d+"px")})))}},_moveableNode:function(a,c){this.moveable&&(this.moveable.destroy(),this.moveable=null);
var f=h.getMarginBox(this.container);f.l=f.l-a+c;f.w+=2*(a-c);this.moveable=new b.boxConstrainedMoveable(this.domNode,{box:f,handle:this.titleNode,within:!0});this.own(k(this.moveable,"Moving",e.hitch(this,this.onMoving)));this.own(k(this.moveable,"MoveStop",e.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===c("#header").length?{t:0,l:0,w:0,h:0}:h.getMarginBox("header")},_getFooterBox:function(){return 0===c(".footer",this.container).length?{t:0,l:0,w:0,h:0}:h.getMarginBox(c(".footer",
this.container)[0])},_calculatePosition:function(){var a=h.getContentBox(this.container),b=this._getHeaderBox(),c=this._getFooterBox(),c=a.h-b.h-c.h-40,f=0;f=this._fixedHeight?this.height:this.autoHeight?c-200:this.height=c>this.maxHeight?this.maxHeight:c;c=(c-f)/2+b.h+20;c=c<b.h?b.h:c;this.width=this.width||this.maxWidth;h.setStyle(this.domNode,{left:(a.w-this.width)/2+"px",top:c+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(h.setStyle(this.domNode,"height","auto"),h.addClass(this.contentContainerNode,
"content-static"),0===this.buttons.length&&h.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(h.setStyle(this.domNode,"height",this.height+"px"),h.addClass(this.contentContainerNode,"content-absolute"),h.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&h.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var a=h.getMarginBox(this.domNode),b=h.getContentBox(this.container),
c=this._getHeaderBox(),f=this._getFooterBox(),f=b.h-c.h-f.h-40,d=0,d=a.h||f-200,a=(f-d)/2+c.h+20,a=a<c.h?c.h:a;h.setStyle(this.domNode,{left:(b.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();this._calculateHeight()},_increaseZIndex:function(){h.setStyle(this.domNode,"zIndex",f+200+1);h.setStyle(this.overlayNode,"zIndex",f+200);f++},onMoving:function(a){h.setStyle(a.node,"opacity",0.9)},onMoveStop:function(a){h.setStyle(a.node,"opacity",
1)},close:function(){if(!(this.onClose&&!1===this.onClose())){var a=this.domNode.parentNode,b=e.clone(this.domNode);h.setStyle(this.domNode,"display","none");h.destroy(this.overlayNode);this.destroy();this.moveable.destroy();h.place(b,a);d.animateProperty({node:b,properties:{opacity:0},duration:200,onEnd:function(){h.destroy(b)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(b){var c=h.create("div",{"class":"jimu-btn jimu-float-trailing jimu-leading-margin1",innerHTML:b.label},
this.buttonContainer);this.enabledButtons.unshift(c);var f=h.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-leading-margin1",innerHTML:b.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(f);f=null;f="ontouchstart"in document?a.press:"click";this.own(k(c,f,e.hitch(this,function(a){if(b.onClick)b.onClick(a);else this.close()})))},enableButton:function(a){"number"===typeof a?(h.setStyle(this.enabledButtons[a],"display","inline-block"),h.setStyle(this.disabledButtons[a],
"display","none")):(g.forEach(this.enabledButtons[a],e.hitch(this,function(a){h.setStyle(a,"display","inline-block")})),g.forEach(this.disabledButtons[a],e.hitch(this,function(a){h.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a?(h.setStyle(this.disabledButtons[a],"display","inline-block"),h.setStyle(this.enabledButtons[a],"display","none")):(g.forEach(this.disabledButtons,e.hitch(this,function(a){h.setStyle(a,"display","inline-block")})),g.forEach(this.enabledButtons,
e.hitch(this,function(a){h.setStyle(a,"display","none")})))}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(m,e,g,h,d,k){h=m("dojo.dnd.move.constrainedMoveable",k,{constraints:function(){},within:!1,constructor:function(d,a){a||(a={});this.constraints=a.constraints;this.within=a.within},onFirstMove:function(d){var a=this.constraintBox=this.constraints.call(this,d);a.r=a.l+a.w;a.b=a.t+a.h;this.within&&(d=e.getMarginSize(d.node),
a.r-=d.w,a.b-=d.h)},onMove:function(d,a){var c=this.constraintBox,b=d.node.style;this.onMoving(d,a);a.l=a.l<c.l?c.l:c.r<a.l?c.r:a.l;a.t=a.t<c.t?c.t:c.b<a.t?c.b:a.t;b.left=a.l+"px";b.top=a.t+"px";this.onMoved(d,a)}});d=m("dojo.dnd.move.boxConstrainedMoveable",h,{box:{},constructor:function(d,a){var c=a&&a.box;this.constraints=function(){return c}}});m=m("dojo.dnd.move.parentConstrainedMoveable",h,{area:"content",constructor:function(d,a){var c=a&&a.area;this.constraints=function(){var a=this.node.parentNode,
d=g.getComputedStyle(a),f=e.getMarginBox(a,d);if("margin"==c)return f;var p=e.getMarginExtents(a,d);f.l+=p.l;f.t+=p.t;f.w-=p.w;f.h-=p.h;if("border"==c)return f;p=e.getBorderExtents(a,d);f.l+=p.l;f.t+=p.t;f.w-=p.w;f.h-=p.h;if("padding"==c)return f;p=e.getPadExtents(a,d);f.l+=p.l;f.t+=p.t;f.w-=p.w;f.h-=p.h;return f}}});return{constrainedMoveable:h,boxConstrainedMoveable:d,parentConstrainedMoveable:m}})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager","./utils"],function(m,
e){function g(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(e){return e},compatible:!0},{version:"1.1",description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(e){e.widgetOnScreen&&(e.widgetOnScreen.panel&&"themes/FoldableTheme/panels/TitlePanel/Panel"===e.widgetOnScreen.panel.uri)&&(e.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel");return e},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",
upgrader:function(e){var d=0;if(e.widgetOnScreen&&e.widgetOnScreen.widgets){for(var k=!1,d=0;d<e.widgetOnScreen.widgets.length;d++)"widgets/Splash/Widget"===e.widgetOnScreen.widgets[d].uri&&(k=!0);k||e.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});k=!1;for(d=0;d<e.widgetOnScreen.widgets.length;d++)"widgets/TimeSlider/Widget"===e.widgetOnScreen.widgets[d].uri&&(k=!0);k||e.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",
visible:!1,position:{bottom:55,left:7},version:"1.2"});k=!1;for(d=0;d<e.widgetOnScreen.widgets.length;d++)"widgets/Swipe/Widget"===e.widgetOnScreen.widgets[d].uri&&(k=!0);k||e.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return e},compatible:!0},{version:"1.3",description:"The version embedded in online3.8.",upgrader:function(g){(function(d){e.visitElement(d,function(d){d.positionRelativeTo&&(d.position?d.position.relativeTo=d.positionRelativeTo:
d.position={relativeTo:d.positionRelativeTo},d.panel&&(d.panel.position?d.panel.position.relativeTo=d.panel.positionRelativeTo:d.panel.position={relativeTo:d.panel.positionRelativeTo}))});var k=d.widgetOnScreen;k&&(k.panel&&k.panel.positionRelativeTo)&&(k.panel.position?k.panel.position.relativeTo=k.panel.positionRelativeTo:k.panel.position={relativeTo:k.panel.positionRelativeTo});if((k=d.widgetPool)&&k.panel&&k.panel.positionRelativeTo)k.panel.position?k.panel.position.relativeTo=k.panel.positionRelativeTo:
k.panel.position={relativeTo:k.panel.positionRelativeTo}})(g);g.widgetOnScreen&&(g.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===g.widgetOnScreen.panel.uri)&&(g.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(d){if(d.widgetOnScreen&&d.widgetOnScreen.widgets&&d.theme&&"FoldableTheme"===d.theme.name){var e=null,l=null;void 0!==d.widgetOnScreen.widgets[4].position.top?(e={position:{left:205,top:45}},l={position:{left:255,top:45}}):(e={position:{left:205,bottom:55}},l={position:{left:255,
bottom:55}});d.widgetOnScreen.widgets.splice(7,0,e,l)}})(g);(function(){for(var d=0,e=0,l=!1,d=0;d<g.widgetOnScreen.widgets.length;d++)if("widgets/Geocoder/Widget"===g.widgetOnScreen.widgets[d].uri){l=!0;break}for(var a=!1,e=0;e<g.widgetOnScreen.widgets.length;e++)if("widgets/Search/Widget"===g.widgetOnScreen.widgets[e].uri){a=!0;break}!a&&l&&(d=g.widgetOnScreen.widgets[d],d.uri="widgets/Search/Widget",d.name="Search")})(g);(function(d){for(var e=0,e=d.widgetOnScreen.widgets.length-1;0<=e;e--){var l=
d.widgetOnScreen.widgets[e];if("widgets/Swipe/Widget"===l.uri&&!l.closeable&&(d.widgetOnScreen.widgets.splice(e,1),!1!==l.visible)){l.closeable=!0;var a;a:{for(a=a=0;a<d.widgetOnScreen.widgets.length;a++)if(!d.widgetOnScreen.widgets[a].uri)break a;a=-1}0<=a&&(l.position=d.widgetOnScreen.widgets[a].position,d.widgetOnScreen.widgets[a]=l)}"widgets/TimeSlider/Widget"===l.uri&&(!1===l.visible?d.widgetOnScreen.widgets.splice(e,1):l.closeable=!0)}})(g);g.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",
position:{top:5,left:7},version:"1.3"});g.loadingPage||(g.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return g},compatible:!0}];this.isCompatible=function(e,d){for(var k=this.getVersionIndex(e),l=this.getVersionIndex(d),k=k+1;k<=l;k++)if(!1===this.versions[k].compatible)return!1;return!0}}g.prototype=new m;return g.prototype.constructor=g})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=
[];this.upgrade=function(m,e,g){e=this.getVersionIndex(e);g=this.getVersionIndex(g);if(e>=g)throw Error("New version should higher than old version.");for(e+=1;e<=g;e++)this.versions[e].upgrader&&(m=this.versions[e].upgrader(m));return m};this.getVersionIndex=function(m){m=this.fixVersion(m);var e,g;for(g=0;g<this.versions.length;g++)this.versions[g].version===m&&(e=g);null===m&&(e=-1);void 0===e&&(e=-1);return e};this.fixVersion=function(m){return!m?null:m}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./portalUrlUtils esri/IdentityManager esri/config esri/urlUtils esri/geometry/Point esri/SpatialReference esri/request".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w){var v=null,x;x=m(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a,c){this._removeHash(a);this.urlParams=a||{};this.widgetManager=b.getInstance();e.mixin(this,c)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(e.hitch(this,function(a){var b=this.checkConfig(a);if(b)throw b;this.rawAppConfig=e.clone(a);a=this._upgradeAppConfig(a);this._processAfterTryLoad(a);
this.appConfig=a;if(this.urlParams.id)return this.loadWidgetsManifest(a).then(e.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(e.hitch(this,function(){this._configLoaded=!0;a.title&&(document.title=window.isBuilder?a.title+" - Web AppBuilder for ArcGIS":a.title);return this.getAppConfig()}));f.setPortalUrl(a.portalUrl);return this._proesssWebTierAndSignin(a).then(e.hitch(this,function(){return this.urlParams.appid?window.appInfo.isRunInPortal?this._getAppConfigFromTemplateAppId(a.portalUrl,
this.urlParams.appid).then(e.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})):this._processNotInPortalAppProtocol(a).then(e.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(e.hitch(this,function(b){b.appData.appConfig&&(a=b.appData.appConfig);a._appData=b.appData;a.templateConfig=b.templateData;return a}))})):this._processNotInPortalAppProtocol(a)})).then(e.hitch(this,
function(a){this._processAfterTryLoad(a);this.appConfig=a;return a.map.itemId?a:p.getDefaultWebMap(a.portalUrl).then(function(b){a.map.itemId=b;return a})})).then(e.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(e.hitch(this,function(a){return a._appData?a._appData.values&&a._appData.values.webmap?p.getPortal(a.portalUrl).getItemById(a._appData.values.webmap).then(e.hitch(this,function(b){return c.template.mergeTemplateAppConfigToAppConfig(a,a._appData,b)})):c.template.mergeTemplateAppConfigToAppConfig(a,
a._appData):a})).then(e.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(e.hitch(this,function(){this._configLoaded=!0;a.title&&(document.title=a.title);return this.getAppConfig()}))}))},getAppConfig:function(){var a=e.clone(this.appConfig);a.getConfigElementById=function(a){return c.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return c.getConfigElementsByName(this,a)};a.visitElement=function(a){c.visitElement(this,a)};return a},checkConfig:function(a){return(a=
this._getRepeatedId(a))?"repeated id:"+a:null},processProxy:function(a){r.defaults.io.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;r.defaults.io.proxyUrl="";r.defaults.io.proxyRules=[];a.httpProxy&&(a.httpProxy.useProxy&&a.httpProxy.url)&&(r.defaults.io.proxyUrl=a.httpProxy.url);a.httpProxy&&(a.httpProxy.useProxy&&a.httpProxy.rules)&&g.forEach(a.httpProxy.rules,function(a){q.addProxyRule(a)})},addNeedValues:function(a){this._processNoUriWidgets(a);this._addElementId(a);
this._processWidgetJsons(a)},showError:function(a){document.body.innerHTML='\x3cdiv class\x3d"jimu-error-code"\x3e\x3cspan\x3e'+this.nls.errorCode+":\x3c/span\x3e\x3cspan\x3e"+a.response.status+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-error-message"\x3e\x3cspan\x3e'+this.nls.errorMessage+":\x3c/span\x3e\x3cspan\x3e"+a.message+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-error-detail"\x3e\x3cspan\x3e'+this.nls.errorDetail+":\x3c/span\x3e\x3cspan\x3e"+a.response.text+"\x3cspan\x3e\x3c/div\x3e"},
_tryLoadConfig:function(){if(this.urlParams.config)return this.configFile=this.urlParams.config,a(this.configFile,{handleAs:"json"});if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var b=t.getPortalUrlFromLocation(),c=new k;f.setPortalUrl(b);p.getPortal(b).loadSelfInfo().then(e.hitch(this,function(a){this.portalSelf=a;a.allSSL&&"http:"===window.location.protocol?(window.location.href=t.setHttpsProtocol(window.location.href),c.reject()):this._processSignIn(b).then(e.hitch(this,function(){this._getAppConfigFromAppId(b,
this.urlParams.id).then(e.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})).then(function(a){c.resolve(a)},function(a){c.reject(a)})}))}));return c}this.configFile="config.json";return a(this.configFile,{handleAs:"json"})},_upgradeAppConfig:function(a){var b=window.wabVersion,c=a.wabVersion;if(b===c)return a;var f=this.versionManager.getVersionIndex(c),d=this.versionManager.getVersionIndex(b);if(f>d)throw Error("Bad version number, "+c);
a=this.versionManager.upgrade(a,c,b);a.wabVersion=b;a.isUpgraded=!0;return a},_upgradeAllWidgetsConfig:function(a){var b=new k,c=[];if(!a.isUpgraded)return b.resolve(a),b;delete a.isUpgraded;n.visitElement(a,e.hitch(this,function(a){a.uri&&(a.config?(a=this.widgetManager.tryLoadWidgetConfig(a),c.push(a)):a.version=a.manifest.version)}));l(c).then(e.hitch(this,function(){b.resolve(a)}),function(a){b.reject(a)});return b},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);
this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);s.tokenValidity=10080;return a},_tryUpdateAppConfigByLocationUrl:function(a){var b=t.getPortalUrlFromLocation(),b=t.getStandardPortalUrl(b);t.isOnline(b)&&(b=t.updateUrlProtocolByOtherUrl(b,a.portalUrl),a.map.portalUrl&&t.isSamePortalUrl(a.portalUrl,a.map.portalUrl)&&(a.map.portalUrl=b),a.portalUrl=b,a.httpProxy&&a.httpProxy.url&&(a.httpProxy.url=t.getPortalProxyUrl(b)))},_processWidgetJsons:function(a){n.visitElement(a,function(a,
b){b.isWidget&&a.uri&&c.processWidgetSetting(a)})},_processNoUriWidgets:function(a){var b=0;n.visitElement(a,function(a,c){c.isWidget&&!a.uri&&(b++,a.placeholderIndex=b)})},_addElementId:function(a){var b=0,c;n.visitElement(a,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var f=a.id.lastIndexOf("_");-1<f&&(c=a.id.substr(f+1),b=Math.max(b,c))}});n.visitElement(a,function(a){a.id||(b++,a.id=a.uri?a.uri.replace(/\//g,"_")+"_"+b:"_"+b)})},_setPortalUrl:function(a){if(a.portalUrl){var b=t.getPortalUrlFromLocation(),
c=t.isOnline(b);!t.isSamePortalUrl(a.portalUrl,b)&&!c&&(window.appInfo.isRunInPortal=!1)}else window.isXT&&d("wab_portalurl")?a.portalUrl=d("wab_portalurl"):(window.appInfo.isRunInPortal=!0,a.portalUrl=t.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(a,b){a.portalUrl=t.setProtocol(a.portalUrl,b);a.map.portalUrl&&(a.map.portalUrl=t.setProtocol(a.map.portalUrl,b));a.httpProxy&&(a.httpProxy.url=t.setProtocol(a.httpProxy.url,b),a.httpProxy&&a.httpProxy.rules&&g.forEach(a.httpProxy.rules,
e.hitch(this,function(a){a.proxyUrl=t.setProtocol(a.proxyUrl,b)})))},_processInPortalAppProtocol:function(a){var b=new k,c=p.getPortal(a.portalUrl),f=e.hitch(this,function(c){if("https:"===window.location.protocol)this._changePortalUrlProtocol(a,"https");else{if(c){window.location.href=t.setHttpsProtocol(window.location.href);b.reject();return}this._changePortalUrlProtocol(a,"http")}this._checkLocale();b.resolve(a)});c.loadSelfInfo().then(e.hitch(this,function(b){"private"===b.access?(b=0===a.portalUrl.toLowerCase().indexOf("https://"),
f(b)):f(b.allSSL)}),e.hitch(this,function(a){b.reject(a)}));return b},_processNotInPortalAppProtocol:function(a){var b=new k;a.portalUrl?p.getPortal(a.portalUrl).loadSelfInfo().then(e.hitch(this,function(c){var d="https:"===window.location.protocol;(c.allSSL||d)&&this._changePortalUrlProtocol(a,"https");0===a.portalUrl.toLowerCase().indexOf("https://")&&!d&&!f.isInConfigOrPreviewWindow()?(window.location.href=t.setHttpsProtocol(window.location.href),b.reject()):b.resolve(a)}),e.hitch(this,function(a){b.reject(a)})):
b.resolve(a);return b},_proesssWebTierAndSignin:function(a){var b=new k,c=!1,f=a.portalUrl;this._processWebTier(a).then(e.hitch(this,function(a){c=a;return p.getPortal(f).loadSelfInfo()})).then(e.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(f,c)})).then(e.hitch(this,function(){b.resolve()}),function(a){b.reject(a)});return b},_processWebTier:function(a){var b=new k,c=a.portalUrl;a.isWebTier?f.isWebTierPortal(c).then(e.hitch(this,function(a){var d=f.getPortalCredential(c);d&&
d.ssl&&"http:"===window.location.protocol&&!f.isInConfigOrPreviewWindow()?window.location.href=t.setHttpsProtocol(window.location.href):b.resolve(a)}),e.hitch(this,function(a){b.reject(a)})):b.resolve(!1);return b},_processSignIn:function(a,b){var c=new k,d=p.getPortal(a),n=t.getSharingUrl(a);window.appInfo.isRunInPortal?(n=s.checkSignInStatus(n),n.promise.always(e.hitch(this,function(){c.resolve()}))):(!f.isInBuilderWindow()&&(!f.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig.appId&&
!b)&&f.registerOAuthInfo(a,this.rawAppConfig.appId),n=s.checkSignInStatus(n),n.promise.always(e.hitch(this,function(){f.xtGetCredentialFromCookie(a);d.loadSelfInfo().then(e.hitch(this,function(a){this.portalSelf=a;this._checkLocale();c.resolve()}))})));return c},_checkLocale:function(){if(!f.isInConfigOrPreviewWindow()){var a=this.portalSelf.user&&this.portalSelf.user.culture||h.locale,a=a.toLowerCase();c.isLocaleChanged(h.locale,a)&&(d("wab_app_locale",a),window.location.reload())}},_getAppConfigFromTemplateAppId:function(a,
b){var c=p.getPortal(a);return this._getWabAppIdAndDataFromTemplateAppId(a,b).then(e.hitch(this,function(b){var f=b.appData;return l([this._getAppConfigFromAppId(a,b.appId),c.getItemData(f.source)]).then(e.hitch(this,function(a){var b;f.appConfig?(b=f.appConfig,delete f.appConfig):b=a[0];b=this._upgradeAppConfig(b);a=a[1];b._appData=f;b.templateConfig=a;return b}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(a,b){var c=p.getPortal(a);return c.getItemData(b).then(function(a){return c.getItemData(a.source).then(function(b){return{appData:a,
templateData:b}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,b){var c=new k,f=p.getPortal(a);f.getItemData(b).then(e.hitch(this,function(a){f.getItemById(a.source).then(e.hitch(this,function(b){b=q.urlToObject(b.url);c.resolve({appId:b.query.id,appData:a})}))}),function(a){c.reject(a)});return c},_getAppConfigFromAppId:function(a,b){return p.getPortal(a).getItemData(b)},_removeHash:function(a){for(var b in a)a[b]&&(a[b]=a[b].replace("#",""))},loadWidgetsManifest:function(a){var b=[],f=new k;
a._buildInfo&&a._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(e.hitch(this,function(d){n.visitElement(a,e.hitch(this,function(a){!a.widgets&&a.uri&&(d[a.uri]?(this._addNeedValuesForManifest(d[a.uri]),c.addManifest2WidgetJson(a,d[a.uri])):b.push(this.widgetManager.loadWidgetManifest(a)))}));l(b).then(function(){f.resolve(a)})})):(n.visitElement(a,e.hitch(this,function(a){!a.widgets&&a.uri&&b.push(this.widgetManager.loadWidgetManifest(a))})),l(b).then(function(){f.resolve(a)}));
setTimeout(function(){f.isResolved()||f.resolve(a)},jimuConfig.timeout);return f},_addNeedValuesForManifest:function(a){c.addManifestProperies(a);c.processManifestLabel(a,h.locale)},_loadMergedWidgetManifests:function(){return a(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(a){var b=[],c;n.visitElement(a,function(a){if(0<b.indexOf(a.id))return c=a.id,!0;b.push(a.id)});return c},_processUrlParams:function(a){var b=this.urlParams.itemid||this.urlParams.webmap;
b&&a.map.itemId!==b&&(a.map.mapOptions&&c.deleteMapOptions(a.map.mapOptions),a.map.itemId=b);this.urlParams.mode&&(a.mode=this.urlParams.mode);a.map.mapOptions||(a.map.mapOptions={});this.urlParams.extent&&(b=-1<this.urlParams.extent.indexOf(";")?";":",",b=this.urlParams.extent.split(b),4===b.length?a.map.mapOptions.extent={xmin:parseFloat(b[0]),ymin:parseFloat(b[1]),xmax:parseFloat(b[2]),ymax:parseFloat(b[3])}:5===b.length&&(a.map.mapOptions.extent={xmin:parseFloat(b[0]),ymin:parseFloat(b[1]),xmax:parseFloat(b[2]),
ymax:parseFloat(b[3]),spatialReference:{wkid:parseInt(b[4],10)}}));this.urlParams.center&&(b=-1<this.urlParams.center.indexOf(";")?";":",",b=this.urlParams.center.split(b),2===b.length?a.map.mapOptions.center=b:3===b.length&&(b=new u(parseInt(b[0],10),parseInt(b[1],10),new w(parseInt(b[2],10))),a.map.mapOptions.center=b.toJson()));this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});
x.getInstance=function(a,b){null===v?v=new x(a,b):(v.urlParams=a,v.options=b);return v};return x})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(m,e,g,h,d,k,l,a,c,b,n){var f=m([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(a){this.portalUrl=b.getStandardPortalUrl(a);
this.selfUrl=b.getPortalSelfInfoUrl(a)},loadSelfInfo:function(){var b=new d,c={url:this.selfUrl,content:{f:"json"},handleAs:"json",callbackParamName:"callback",preventCache:!0};this.isValidCredential()&&(c.content.token=this.credential.token);a(c).then(e.hitch(this,function(a){var c=a.user;delete a.user;e.mixin(this,a);a.user=c;b.resolve(a)}),e.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_checkCredential:function(){var a=n.isValidCredential(this.credential);a||this.clearCredentialAndUser();
return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=n.getPortalCredential(this.portalUrl))},signIn:function(){var a=new d;this.updateCredential();this.isValidCredential()?setTimeout(e.hitch(this,function(){a.resolve(this.credential)}),0):a=n.signInPortal(this.portalUrl);return a},haveSignIn:function(){return n.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=
this.credential=null},getUser:function(){this.updateCredential();var a=new d;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(e.hitch(this,function(){this.user.updateCredential();a.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(e.hitch(this,function(b){this.user=b;a.resolve(this.user)}),e.hitch(this,function(b){console.error(b);a.reject(b)})):n.getUserIdByToken(this.credential.token,this.portalUrl).then(e.hitch(this,
function(b){this.credential.userId=b;this._getUser(this.credential.userId).then(e.hitch(this,function(b){this.user=b;a.resolve(this.user)}),e.hitch(this,function(b){console.error(b);a.reject(b)}))}),e.hitch(this,function(b){console.error(b);a.reject(b)})):setTimeout(e.hitch(this,function(){a.reject("credential is null.")}),0);return a},queryItems:function(c){this.updateCredential();var f=new d,n=b.getBaseSearchUrl(this.portalUrl),p={f:"json"};c&&(p=e.mixin(p,c));this.isValidCredential()&&(p.token=
this.credential.token);!p.sortField&&!p.sortOrder&&(p.sortField="title",p.sortOrder="asc");a({url:n,handleAs:"json",content:p,callbackParamName:"callback"}).then(e.hitch(this,function(a){a.results=g.map(a.results,e.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new s(a)}));f.resolve(a)}),e.hitch(this,function(a){console.error(a);f.reject(a)}));return f},getItemData:function(c){this.updateCredential();c={url:b.getItemDataUrl(this.portalUrl,c),handleAs:"json",
content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(c.content.token=this.credential.token);return a(c)},getItemById:function(c){var f=new d;this.updateCredential();c={url:b.getItemUrl(this.portalUrl,c),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(c.content.token=this.credential.token);a(c).then(e.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new s(a);f.resolve(a)}),e.hitch(this,
function(a){console.error(a);f.reject(a)}));return f},getAppById:function(c){var f=new d;this.updateCredential();this.isValidCredential()?(c=b.getAppIdUrl(this.portalUrl,c),f=a({url:c,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(e.hitch(this,function(){f.reject("token is null.")}),0);return f},queryGroups:function(c){this.updateCredential();var f=new d,n=b.getBaseGroupUrl(this.portalUrl),p={f:"json"};c&&(p=e.mixin(p,c));this.isValidCredential()&&(p.token=this.credential.token);
a({url:n,handleAs:"json",content:p,callbackParamName:"callback"}).then(e.hitch(this,function(a){a.results=g.map(a.results,e.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new t(a)}));f.resolve(a)}),e.hitch(this,function(a){console.error(a);f.reject(a)}));return f},registerApp:function(c,f,n){var p=new d;this.updateCredential();if(this.isValidCredential())var s=this.credential&&this.credential.token,r=b.getOAuth2Url(this.portalUrl),p=a({url:r+"/registerApp",
content:{itemId:c,appType:f,redirect_uris:l.stringify(n),token:s,f:"json"},handleAs:"json"},{usePost:!0});else setTimeout(e.hitch(this,function(){p.reject("token is null.")}),0);return p},createAndRegisterApp:function(a){var b=new d;this.updateCredential();this.isValidCredential()?this.getUser().then(e.hitch(this,function(c){c.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(e.hitch(this,function(c){c.success?this.registerApp(c.id,
"browser",a).then(e.hitch(this,function(a){b.resolve(a)}),e.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject("create app failed")}),e.hitch(this,function(a){console.error(a);b.reject(a)}))}),e.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(e.hitch(this,function(){b.reject("token is null.")}),0);return b},_getUser:function(c){this.updateCredential();var f=new d;c={url:b.getUserUrl(this.portalUrl,c),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&
(c.content.token=this.credential&&this.credential.token);a(c).then(e.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;this.user=new p(a);f.resolve(this.user)}),e.hitch(this,function(a){console.error(a);f.reject(a)}));return f}}),p=m([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&e.mixin(this,a)},_checkCredential:function(){var a=n.isValidCredential(this.credential);a||(this.credential=null);return a},
isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var a=[];this.groups&&(a=g.map(this.groups,e.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new t(a)})));return a},getItemsByKeywords:function(a,b){return this.portal.queryItems({start:b||1,num:100,q:"owner:"+
this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var c={url:b.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(c.content.token=this.credential.token);return a(c)},getTags:function(){this.updateCredential();var c={url:b.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(c.content.token=
this.credential.token);return a(c)},addItem:function(c,f){this.updateCredential();var n=new d;if(this.isValidCredential()){var p={f:"json",token:this.credential.token};c&&(p=e.mixin(p,c));a({url:b.getAddItemUrl(this.portalUrl,this.username,f),handleAs:"json",callbackParamName:"callback",content:p},{usePost:!0}).then(e.hitch(this,function(a){n.resolve(a)}),e.hitch(this,function(a){console.error(a);n.reject(a)}))}else setTimeout(e.hitch(this,function(){n.reject("token is null.")}),0);return n},deleteItem:function(c){this.updateCredential();
var f=new d;this.isValidCredential()?(c=b.getDeleteItemUrl(this.portalUrl,this.username,c),f=a({url:c,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(e.hitch(this,function(){f.reject("token is null.")}),0);return f},getItemById:function(c,f){this.updateCredential();var n=new d,p={url:b.getUserItemsUrl(this.portalUrl,this.username,f)+"/"+c,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(p.content.token=this.credential.token);
a(p).then(e.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new s(a);n.resolve(a)}),e.hitch(this,function(a){console.error(a);n.reject(a)}));return n},shareItem:function(c,f,n){this.updateCredential();var p=new d;this.isValidCredential()?(f={url:b.shareItemUrl(this.portalUrl,this.username,f,n),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},c&&(f.content=e.mixin(f.content,c)),a(f,{usePost:!0}).then(e.hitch(this,
function(a){p.resolve(a)}),e.hitch(this,function(a){console.error(a);p.reject(a)}))):setTimeout(e.hitch(this,function(){p.reject("token is null.")}),0);return p},updateItem:function(c,f){this.updateCredential();var n=new d;this.isValidCredential()?this.portal.getItemById(c).then(e.hitch(this,function(d){var p={f:"json",token:this.credential.token};f&&(p=e.mixin(p,f));a({url:b.getUpdateItemUrl(this.portalUrl,this.username,c,d.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:p},
{usePost:!0}).then(e.hitch(this,function(a){n.resolve(a)}),e.hitch(this,function(a){console.error(a);n.reject(a)}))}),e.hitch(this,function(a){console.error(a);n.reject(a)})):setTimeout(e.hitch(this,function(){n.reject("token is null.")}),0);return n},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role}}),
t=m([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&e.mixin(this,a)},_checkCredential:function(){var a=n.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+" AND "+a.q;
return this.portal.queryItems(a)}}),s=m([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(a){a&&e.mixin(this,a);this.itemUrl=b.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&(this.thumbnail&&this.itemUrl)&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);
this.portalUrl&&this.id&&(this.detailsPageUrl=b.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=b.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var a=n.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},
getItemData:function(){return this.portal.getItemData(this.id)}}),r={portals:[],webMapQueryStr:" "+c.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+c.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(a){for(var c=0;c<this.portals.length;c++){var f=this.portals[c];if(b.isSamePortalUrl(a,f.portalUrl))return f.updateCredential(),f}return null},getPortal:function(a){if(!a||!("string"===typeof a&&e.trim(a)))return null;a=b.getStandardPortalUrl(a);var c=this._findPortal(a);
c||(c=new f(a),c.credential=n.getPortalCredential(c.portalUrl),c.updateCredential(),this.portals.push(c));return c},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(a){var b="english",c="",f=new d;this.getPortal(a).getUser().then(e.hitch(this,function(a){a&&a.units?b=a.units:
(c=h.locale,b=c.startWith("en")?"english":"metric");f.resolve(b)}),e.hitch(this,function(d){console.warn(d);this.getPortalSelfInfo(a).then(e.hitch(this,function(a){c=a&&a.culture||h.locale}),e.hitch(this,function(a){console.warn(a);c=h.locale})).always(e.hitch(this,function(){b=c.startWith("en")?"english":"metric";f.resolve(b)}))}));return f.promise},_getPortalSelfGroup:function(a,b){var c=new d,f=this.getPortal(a);f||setTimeout(e.hitch(this,function(){c.reject()}),0);this.getPortalSelfInfo(a).then(e.hitch(this,
function(a){f.queryGroups({f:"json",q:a[b]}).then(e.hitch(this,function(a){0<a.results.length?(a=a.results[0],a.portalUrl=f.portalUrl,a.credential=f.credential,a.portal=f,a=new t(a),c.resolve(a)):c.reject("Can't find portal self group.")}),e.hitch(this,function(a){console.error(a);c.reject(a)}))}),e.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getWebMapsFromBasemapGalleryGroup:function(a){var b=new d;this.getBasemapGalleryGroup(a).then(e.hitch(this,function(a){a?a.queryItems({start:1,
num:100,f:"json",q:this.webMapQueryStr}).then(e.hitch(this,function(a){b.resolve(a)}),e.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject()}),e.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getDefaultWebScene:function(a){var b=new d,c=this.getPortal(a);c.getUser().then(e.hitch(this,function(a){c.queryItems({start:1,num:1,f:"json",q:this.webSceneQueryStr+' AND owner:"'+a.username+'" ',sortField:"numViews",sortOrder:"desc"}).then(e.hitch(this,function(a){a=a.results;
a=g.filter(a,e.hitch(this,function(a){return a.type&&"web scene"===a.type.toLowerCase()}));0<a.length?b.resolve(a[0].id):b.resolve(null)}),e.hitch(this,function(a){b.reject(a)}))}),e.hitch(this,function(){b.reject("not sign in")}));return b},getDefaultWebMap:function(a){var b=new d;this.getPortalSelfInfo(a).then(e.hitch(this,function(c){var f=c.defaultBasemap&&c.defaultBasemap.id;f?b.resolve(f):this._getDefaultWebMapByBasemapGallery(a,c).then(e.hitch(this,function(c){c?b.resolve(c):this._getMostNumViewsWebMap(a).then(e.hitch(this,
function(a){a?b.resolve(a):b.reject()}),e.hitch(this,function(a){console.error(a);b.reject(a)}))}),e.hitch(this,function(a){console.error(a);b.reject(a)}))}),e.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_getDefaultWebMapByBasemapGallery:function(a,b){var c=new d,f=this.getPortal(a),n=b.defaultBasemap&&b.defaultBasemap.title;f.queryGroups({f:"json",q:b.basemapGalleryGroupQuery}).then(e.hitch(this,function(a){a=a.results;0<a.length?f.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+
" AND group:"+a[0].id+" AND title:"+n}).then(e.hitch(this,function(a){a=a.results;a=g.filter(a,e.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?c.resolve(a[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),f.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+n}).then(e.hitch(this,function(a){a=a.results;a=g.filter(a,e.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));if(0<a.length){var b=a[0];
f.getItemData(b.id).then(e.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?c.resolve(b.id):c.resolve(null)}),e.hitch(this,function(){c.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),c.resolve(null)}),e.hitch(this,function(a){console.error(a);c.reject(a)})))}),e.hitch(this,function(a){console.error(a);c.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),c.resolve(null))}),e.hitch(this,function(a){console.error(a);c.reject(a)}));
return c},_getMostNumViewsWebMap:function(a){var b=new d;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(e.hitch(this,function(a){a=a.results;a=g.filter(a,e.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?b.resolve(a[0].id):b.reject("Can't find most-num-views web map.")}),e.hitch(this,function(a){console.error(a);b.reject(a)}));return b}};k.subscribe("userSignOut",
function(a){(a=r._findPortal(a))&&a.clearCredentialAndUser()});return r})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/dom-construct dojo/dom-geometry dojo/Deferred dojo/promise/all dojo/when require ./WidgetManager ./PanelManager ./MapManager ./utils ./OnScreenWidgetIcon ./WidgetPlaceholder ./dijit/LoadingShelter".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w,v){var x=null,B;B=m([d],
{constructor:function(a,b){this.widgetManager=t.getInstance();this.panelManager=s.getInstance();this.own(k.subscribe("appConfigLoaded",e.hitch(this,this.onAppConfigLoaded)));this.own(k.subscribe("appConfigChanged",e.hitch(this,this.onAppConfigChanged)));this.own(k.subscribe("mapLoaded",e.hitch(this,this.onMapLoaded)));this.own(k.subscribe("mapChanged",e.hitch(this,this.onMapChanged)));this.own(k.subscribe("beforeMapDestory",e.hitch(this,this.onBeforeMapDestory)));this.own(k.subscribe("builder/actionTriggered",
e.hitch(this,this.onActionTriggered)));this.own(k.subscribe("openWidget",e.hitch(this,this._onOpenWidgetRequest)));this.widgetPlaceholders=[];this.preloadWidgetIcons=[];this.preloadGroupPanels=[];this.invisibleWidgetIds=[];this.own(l(window,"resize",e.hitch(this,this.resize)));this.id=b},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",hlDiv:null,animTime:500,resize:function(){g.forEach(this.widgetManager.getAllWidgets(),function(a){!1===a.inPanel&&a.resize()},this)},onAppConfigLoaded:function(a){this.appConfig=
e.clone(a);this.appConfig.theme&&this._loadTheme(this.appConfig.theme);this._loadMap()},onAppConfigChanged:function(a,b,c){a=e.clone(a);switch(b){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,c);break;case "groupChange":this._onGroupChange(a,c);break;case "widgetPoolChange":this._onWidgetPoolChange(a,c);break;case "resetConfig":this._onResetConfig(a);break;
case "loadingPageChange":this._onLoadingPageChange(a,c)}this.appConfig=a},onMapLoaded:function(a){this.map=a;this.panelManager.setMap(a);this._loadPreloadWidgets(this.appConfig)},onMapChanged:function(a){this.map=a;this.panelManager.setMap(a);this._loadPreloadWidgets(this.appConfig)},onBeforeMapDestory:function(){this.panelManager.destroyAllPanels();this._destroyOffPanelWidgets();this._destroyWidgetPlaceholders();this._destroyPreloadWidgetIcons()},onActionTriggered:function(a){"highLight"===a.action&&
(g.forEach(this.widgetPlaceholders,function(b){b.configId===a.elementId&&this._highLight(b)},this),g.forEach(this.preloadWidgetIcons,function(b){b.configId===a.elementId&&this._highLight(b)},this),g.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(b){b.configId===a.elementId&&this._highLight(b)},this),g.forEach(this.preloadGroupPanels,function(b){b.configId===a.elementId&&this._highLight(b)},this));"removeHighLight"===a.action&&this._removeHighLight();"showLoading"===a.action&&(h.setStyle(jimuConfig.loadingId,
"display","block"),h.setStyle(jimuConfig.mainPageId,"display","none"));"showApp"===a.action&&(h.setStyle(jimuConfig.loadingId,"display","none"),h.setStyle(jimuConfig.mainPageId,"display","block"))},_highLight:function(b){if(b.domNode){this.hlDiv&&this._removeHighLight(b);var f=c.getMarginBox(b.domNode);this.hlDiv=a.create("div",{style:{position:"absolute",left:f.l+"px",top:f.t+"px",width:f.w+"px",height:f.h+"px"},"class":"icon-highlight"},b.domNode,"before")}},_removeHighLight:function(){this.hlDiv&&
(a.destroy(this.hlDiv),this.hlDiv=null)},_onWidgetChange:function(a,b){b=a.getConfigElementById(b.id);b.isController?this._reloadControllerWidget(a,b.id):(g.forEach(this.widgetPlaceholders,function(c){c.configId===b.id&&(c.destroy(),this._loadPreloadWidget(b,a))},this),this._removeDestroyed(this.widgetPlaceholders),g.forEach(this.preloadWidgetIcons,function(c){if(c.configId===b.id){var f=c.state;c.destroy();this._loadPreloadWidget(b,a).then(function(a){if(b.uri&&"opened"===f)a.onClick()})}},this),
this._removeDestroyed(this.preloadWidgetIcons),g.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(c){c.configId===b.id&&(c.destroy(),!1===b.visible?0>this.invisibleWidgetIds.indexOf(b.id)&&this.invisibleWidgetIds.push(b.id):this._loadPreloadWidget(b,a))},this),g.forEach(this.preloadGroupPanels,function(a){a.reloadWidget(b)},this),this._updatePlaceholder(a),g.forEach(this.invisibleWidgetIds,function(c){c===b.id&&!1!==b.visible&&(this._loadPreloadWidget(b,a),c=this.invisibleWidgetIds.indexOf(b.id),
this.invisibleWidgetIds.splice(c,1))},this),b.isOnScreen||g.forEach(this.widgetManager.getControllerWidgets(),function(c){c.widgetIsControlled(b.id)&&this._reloadControllerWidget(a,c.id)},this))},_onGroupChange:function(a,b){b=a.getConfigElementById(b.id);b.isOnScreen?(this.panelManager.destroyPanel(b.id+"_panel"),this._removeDestroyed(this.preloadGroupPanels),this._loadPreloadGroup(b)):(g.forEach(this.widgetManager.getControllerWidgets(),function(c){c.isControlled(b.id)&&this._reloadControllerWidget(a,
c.id)},this),g.forEach(this.panelManager.panels,function(a){a.config.id===b.id&&a.updateConfig(b)},this))},_updatePlaceholder:function(a){g.forEach(this.widgetPlaceholders,function(b){b.setIndex(a.getConfigElementById(b.configId).placeholderIndex)},this)},_onWidgetPoolChange:function(a,b){this._reloadControllerWidget(a,b.controllerId)},_reloadControllerWidget:function(a,b){var c=this.widgetManager.getWidgetById(b);if(c){var f=c.getOpenedIds(),d=c.windowState;g.forEach(c.getAllConfigs(),function(a){if(a.widgets)this.panelManager.destroyPanel(a.id+
"_panel"),g.forEach(a.widgets,function(a){this.panelManager.destroyPanel(a.id+"_panel")},this);else{var b=this.widgetManager.getWidgetById(a.id);b&&(a.inPanel?this.panelManager.destroyPanel(b.getPanel()):this.widgetManager.destroyWidget(b))}},this);this.widgetManager.destroyWidget(c);c=a.getConfigElementById(b);!1!==c.visible&&this._loadPreloadWidget(c,a).then(e.hitch(this,function(a){this.widgetManager.changeWindowStateTo(a,d);f&&a.setOpenedIds(f)}))}},_removeDestroyed:function(a){var b=[];g.forEach(a,
function(a){a._destroyed&&b.push(a)});g.forEach(b,function(b){b=a.indexOf(b);a.splice(b,1)})},_destroyPreloadWidgetIcons:function(){g.forEach(this.preloadWidgetIcons,function(a){a.destroy()},this);this.preloadWidgetIcons=[]},_destroyOffPanelWidgets:function(){g.forEach(this.widgetManager.getOffPanelWidgets(),function(a){this.widgetManager.destroyWidget(a)},this)},_destroyWidgetPlaceholders:function(){g.forEach(this.widgetPlaceholders,function(a){a.destroy()},this);this.widgetPlaceholders=[]},_destroyPreloadGroupPanels:function(){g.forEach(this.preloadGroupPanels,
function(a){this.panelManager.destroyPanel(a)},this);this.preloadGroupPanels=[]},_changeMapPosition:function(a){this.map&&(q.isEqual(this.mapManager.getMapPosition(),a.map.position)||this.mapManager.setMapPosition(a.map.position))},_onThemeChange:function(a){this._destroyPreloadWidgetIcons();this._destroyWidgetPlaceholders();this._destroyOffPanelWidgets();this.panelManager.destroyAllPanels();this._updateCommonStyle(a);this._onStyleChange(a);this._changeMapPosition(a);this._loadPreloadWidgets(a)},
_onResetConfig:function(a){a.map.itemId!==this.appConfig.map.itemId?(k.publish("appConfigChanged",a,"mapChange",a),this._updateCommonStyle(a),this._onStyleChange(a),this._changeMapPosition(a)):this._onThemeChange(a)},_onLoadingPageChange:function(a,b){if("backgroundColor"in b)h.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor);else if("backgroundImage"in b){var c=a.loadingPage.backgroundImage;c.visible&&c.uri?(h.setStyle(jimuConfig.loadingImageId,"background-image","url('"+
c.uri+"')"),h.setStyle(jimuConfig.loadingImageId,"width",c.width+"px"),h.setStyle(jimuConfig.loadingImageId,"height",c.height+"px")):(h.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),h.setStyle(jimuConfig.loadingImageId,"width","0px"),h.setStyle(jimuConfig.loadingImageId,"height","0px"))}else"loadingGif"in b&&(c=a.loadingPage.loadingGif,c.visible&&c.uri?(h.setStyle(jimuConfig.loadingGifId,"background-image","url('"+c.uri+"')"),h.setStyle(jimuConfig.loadingGifId,"width",c.width+"px"),
h.setStyle(jimuConfig.loadingGifId,"height",c.height+"px")):(h.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),h.setStyle(jimuConfig.loadingGifId,"width","0px"),h.setStyle(jimuConfig.loadingGifId,"height","0px")))},_updateCommonStyle:function(a){var b=this.appConfig.theme;h.removeClass(this.domNode,b.name);h.destroy(this._getThemeCommonStyleId(b));this._loadThemeCommonStyle(a.theme)},_onStyleChange:function(a){var b=this.appConfig.theme;b.styles!==a.theme.styles&&(b.styles[0]!==a.theme.styles[0]&&
h.removeClass(this.domNode,b.styles[0]),h.destroy(this._getThemeCurrentStyleId(b)),this._loadThemeCurrentStyle(a.theme))},_onLayoutChange:function(a){this._changeMapPosition(a);g.forEach(this.widgetPlaceholders,function(b){b.moveTo(a.getConfigElementById(b.configId).position)},this);g.forEach(this.preloadWidgetIcons,function(b){b.moveTo(a.getConfigElementById(b.configId).position)},this);g.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(b){if(!b.closeable){var c=a.getConfigElementById(b.id).position;
b.setPosition(c)}},this);g.forEach(this.preloadGroupPanels,function(b){var c=a.getConfigElementById(b.config.id).panel.position;b.setPosition(c)},this)},_loadTheme:function(a){p(["themes/"+a.name+"/main"],e.hitch(this,function(){this._loadThemeCommonStyle(a);this._loadThemeCurrentStyle(a)}))},_loadThemeCommonStyle:function(a){q.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css");h.addClass(this.domNode,a.name)},_loadThemeCurrentStyle:function(a){q.loadStyleLink(this._getThemeCurrentStyleId(a),
"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css");h.addClass(this.domNode,a.styles[0])},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_loadMap:function(){h.create("div",{id:this.mapId,style:e.mixin({position:"absolute",backgroundColor:"#EEEEEE",overflow:"hidden",minWidth:"1px",minHeight:"1px"})},this.id);this.mapManager=r.getInstance(this.appConfig,this.mapId);this.mapManager.setMapPosition(this.appConfig.map.position);
this.mapManager.showMap()},_createPreloadWidgetPlaceHolder:function(a){var b;b="map"===a.position.relativeTo?this.mapId:this.id;var c=e.clone(a);c.position.width=40;c.position.height=40;var f=q.getPositionStyle(c.position);a=new w({index:c.placeholderIndex,configId:a.id});h.setStyle(a.domNode,f);h.place(a.domNode,b);this.widgetPlaceholders.push(a);return a},_createPreloadWidgetIcon:function(a){var b=new u({panelManager:this.panelManager,widgetManager:this.widgetManager,widgetConfig:a,configId:a.id,
map:this.map});"map"===a.position.relativeTo?h.place(b.domNode,this.mapId):h.place(b.domNode,this.id);h.setStyle(b.domNode,q.getPositionStyle({top:a.position.top,left:a.position.left,right:a.position.right,bottom:a.position.bottom,width:40,height:40}));b.startup();!this.openAtStartWidget&&a.openAtStart&&(b.switchToOpen(),this.openAtStartWidget=a.name);this.preloadWidgetIcons.push(b);return b},_loadPreloadWidgets:function(a){console.time("Load widgetOnScreen");var b=new v,c=[];b.placeAt(this.id);b.startup();
g.forEach(a.widgetOnScreen.widgets,function(b){!1===b.visible?this.invisibleWidgetIds.push(b.id):c.push(this._loadPreloadWidget(b,a))},this);g.forEach(a.widgetOnScreen.groups,function(a){c.push(this._loadPreloadGroup(a))},this);n(c).then(e.hitch(this,function(){b&&(b.destroy(),b=null);console.timeEnd("Load widgetOnScreen");k.publish("preloadWidgetsLoaded");this._doPostLoad()}),e.hitch(this,function(){b&&(b.destroy(),b=null);console.timeEnd("Load widgetOnScreen");k.publish("preloadWidgetsLoaded");
this._doPostLoad()}))},_doPostLoad:function(){p(["dynamic-modules/postload"])},_loadPreloadWidget:function(a,c){var f=new b;if("config"===c.mode&&!a.uri){var d=this._createPreloadWidgetPlaceHolder(a);f.resolve(d);return f}if(!a.uri)return f.resolve(null),f;a.inPanel||a.closeable?(d=this._createPreloadWidgetIcon(a),f.resolve(d)):this.widgetManager.loadWidget(a).then(e.hitch(this,function(b){try{b.setPosition(b.position),this.widgetManager.openWidget(b)}catch(c){console.log(console.error("fail to startup widget "+
b.name+". "+c.stack))}b.configId=a.id;f.resolve(b)}),function(a){f.reject(a)});return f},_loadPreloadGroup:function(a){return!this.appConfig.mode&&(!a.widgets||0===a.widgets.length)?f(null):this.panelManager.showPanel(a).then(e.hitch(this,function(b){b.configId=a.id;this.preloadGroupPanels.push(b);return b}))},_onOpenWidgetRequest:function(a){g.forEach(this.preloadWidgetIcons,function(b){b.configId===a&&b.switchToOpen()},this);g.forEach(this.widgetManager.getControllerWidgets(),function(b){b.widgetIsControlled(a)&&
b.setOpenedIds([a])},this)}});B.getInstance=function(a,b){null===x&&(x=new B(a,b));return x};return B})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f){var p,t=null;p=m(null,{constructor:function(){this.panels=[];this.widgetManager=f.getInstance();l(window,"resize",e.hitch(this,this.onWindowResize));this.activePanel=
null;a.subscribe("/dnd/move/start",e.hitch(this,this._onMoveStart));a.subscribe("widgetActived",e.hitch(this,this._onWidgetActived))},showPanel:function(a){var c=new k,f=this.getPanelById(a.id+"_panel");f?("closed"===f.state&&this.openPanel(f),c.resolve(f)):b([a.panel.uri],e.hitch(this,function(b){var f=a.id+"_panel",d=this.getPanelById(f),p={label:a.label,config:a,uri:a.panel.uri,position:a.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,id:f,gid:a.gid};e.mixin(p,a.panel.options);
try{d=new b(p),console.log("panel ["+f+"] created.")}catch(t){console.log("create panel error: "+t+", panelId: "+f);c.reject(t);return}d.setPosition(a.panel.position);n.setVerticalCenter(d.domNode);this.openPanel(d);this.panels.push(d);l(d.domNode,"click",e.hitch(this,this._onPanelClick,d));c.resolve(d)}));return c},setMap:function(a){this.map=a;l(this.map,"resize",e.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;
for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a&&this.closePanel(this.panels[b])},openPanel:function(a){var b=new k;if("string"===typeof a&&(a=this.getPanelById(a),!a))return b.reject(),b;if(!a.started)try{a.started=!0,a.startup()}catch(c){console.error("fail to startup panel "+a.id+". "+c.stack)}if("opened"===a.state)return b.resolve(a),
b;a.setState("opened");return this.playOpenPanelAnimation(a).then(e.hitch(this,function(){h.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new k;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&h.setStyle(a.domNode,
"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(b){console.log(console.error("fail to minimize panel "+a.id+". "+b.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(b){console.log(console.error("fail to maximize panel "+
a.id+". "+b.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(b){console.log(console.error("fail to noralize panel "+a.id+". "+b.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+
b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(b){console.log(console.error("fail to destroy panel "+a.id+". "+b.stack))}}},destroyAllPanels:function(){var a=g.map(this.panels,function(a){return a.id});g.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return c();var b=new k;"string"===typeof a.openAnimation?
"fadeIn"===a.openAnimation?(h.setStyle(a.domNode,{opacity:0,display:""}),d.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return c();var b=new k;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?d.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():
b.resolve());return b},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=h.getMarginBox(window.jimuConfig.layoutId),c=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?b.h>b.w?{left:0,right:0,top:"auto",
bottom:0,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:0,width:b.w/2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:
b.h>b.w?{left:0,right:0,top:c,bottom:0,width:"auto",height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,
borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&h.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),h.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=
this.widgetManager.activeWidget;b&&("active"===b.state&&b.getPanel()!==a)&&(b.setState("opened"),!1===b.inPanel&&h.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&h.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);
-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){g.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},this)},_onWidgetActived:function(a){this.activePanel&&("active"===this.activePanel.state&&a.getPanel()!==this.activePanel)&&(this.activePanel.setState("opened"),h.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),
this.activePanel.onDeActive(),this.activePanel=null)}});p.getInstance=function(){null===t&&(t=new p);return window._panelManager=t};return p})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/aspect dojo/keys esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/geometry/Extent esri/geometry/Point require ./utils ./dijit/LoadingShelter".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q){var u=
null,w=m(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,constructor:function(a,b){this.appConfig=a;this.id=this.mapDivId=b;d.subscribe("appConfigChanged",e.hitch(this,this.onAppConfigChanged));d.subscribe("changeMapPosition",e.hitch(this,this.onChangeMapPosition));d.subscribe("syncExtent",e.hitch(this,this.onSyncExtent));k(window,"resize",e.hitch(this,this.onWindowResize))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");
this.loading=new q;this.loading.placeAt(this.mapDivId);this.loading.startup();a.map["3D"]?a.map.itemId?this._show3DWebScene(a):this._show3DLayersMap(a):a.map.itemId?this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(a){a&&(this._mapInfoWindow=
this.map.infoWindow,this._mapMobileInfoWindow&&this._mapMobileInfoWindow.destroy(),this._mapMobileInfoWindow=new b(null,h.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=
!1)},onChangeMapPosition:function(a){var b=e.clone(this.mapPosition);e.mixin(b,a);this.setMapPosition(b)},setMapPosition:function(a){this.mapPosition=a;a=r.getPositionStyle(a);h.setStyle(this.mapDivId,a);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncExtent:function(a){this.map&&(a=new p(a.extent),this.map.setExtent(a))},_visitConfigMapLayers:function(a,b){g.forEach(a.map.basemaps,function(a,c){a.isOperationalLayer=!1;b(a,c)},this);g.forEach(a.map.operationallayers,
function(a,c){a.isOperationalLayer=!0;b(a,c)},this)},_show3DLayersMap:function(a){s(["esri3d/Map"],e.hitch(this,function(b){var c;c=new b(this.mapDivId,{camera:a.map.mapOptions.camera});this._visitConfigMapLayers(a,e.hitch(this,function(a){this.createLayer(c,"3D",a)}));c.usePlugin=b.usePlugin;this._publishMapEvent(c)}))},_show3DWebScene:function(a){this._getWebsceneData(a.map.itemId).then(e.hitch(this,function(b){s(["esri3d/Map"],e.hitch(this,function(c){var f=new c(this.mapDivId,a.map.mapOptions);
g.forEach(b.itemData.operationalLayers,function(a){this.createLayer(f,"3D",a)},this);g.forEach(b.itemData.baseMap.baseMapLayers,function(a){a.type="tile";this.createLayer(f,"3D",a)},this);g.forEach(b.itemData.baseMap.elevationLayers,function(a){a.type="elevation";this.createLayer(f,"3D",a)},this);f.toc=b.itemData.toc;f.bookmarks=b.itemData.bookmarks;f.tours=b.itemData.tours}))}))},_publishMapEvent:function(a){window._viewerMap=a;this.loading&&this.loading.destroy();console.timeEnd("Load Map");this.map?
(this.map=a,this.resetInfoWindow(!0),console.log("map changed."),d.publish("mapChanged",this.map)):(this.map=a,this.resetInfoWindow(!0),d.publish("mapLoaded",this.map))},_getWebsceneData:function(a){return f({url:"http://184.169.133.166/sharing/rest/content/items/"+a+"/data",handleAs:"json"})},_show2DWebMap:function(b){b.map.mapOptions||(b.map.mapOptions={});var c=this._processMapOptions(b.map.mapOptions)||{};c.isZoomSlider=!1;r.createWebMap(b.map.portalUrl,b.map.itemId,this.mapDivId,{mapOptions:c,
bingMapsKey:b.bingMapsKey,usePopupManager:!0}).then(e.hitch(this,function(c){var f=c.map;f.hideZoomSlider();f.infoWindow.resize(270,316);f.itemId=b.map.itemId;f.itemInfo=c.itemInfo;f.webMapResponse=c;f.enableSnapping({snapKey:a.copyKey});h.setStyle(f.root,"zIndex",0);this._publishMapEvent(f)}),e.hitch(this,function(){this.loading&&this.loading.destroy();d.publish("mapCreatedFailed")}))},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=e.clone(a),
a.extent&&(a.extent=new p(a.extent)),a.center&&!e.isArrayLike(a.center)&&(a.center=new t(a.center)),a.infoWindow&&(a.infoWindow=new c(a.infoWindow,h.create("div",{},this.mapDivId))),a},createLayer:function(a,b,c){s([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer","2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer","2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer",
"2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[b+"_"+c.type]],e.hitch(this,function(b){var f,d={};f="label url type icon infoTemplate isOperationalLayer".split(" ");for(var p in c)0>
f.indexOf(p)&&(d[p]=c[p]);c.infoTemplate?(f=new n(c.infoTemplate.title,c.infoTemplate.content),d.infoTemplate=f,b=new b(c.url,d),c.infoTemplate.width&&c.infoTemplate.height&&l.after(b,"onClick",e.hitch(this,function(){a.infoWindow.resize(c.infoTemplate.width,c.infoTemplate.height)}),!0)):b=new b(c.url,d);b.isOperationalLayer=c.isOperationalLayer;b.label=c.label;b.icon=c.icon;a.addLayer(b)}))},onAppConfigChanged:function(a,b,c){this.appConfig=a;"mapChange"===b?this._recreateMap(a):"mapOptionsChange"===
b&&c.lods&&this._recreateMap(a)},_recreateMap:function(a){this.map&&(d.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(a)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});w.getInstance=function(a,b){null===u&&(u=new w(a,b));return u};return w})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w){var v=m([u,f,p,t,q],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:w,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(a){this.inherited(arguments);b.place(this.domNode,a.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[v.ANCHOR_UPPERRIGHT,v.ANCHOR_LOWERRIGHT,v.ANCHOR_LOWERLEFT,v.ANCHOR_UPPERLEFT];
if(7>k("ie")){var a="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+n.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",c=b.create("div",null,h.body());n.set(c,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:a});var f=setTimeout(function(){b.destroy(c);clearTimeout(f);f=c=null},100);d.query(".sprite",this.domNode).forEach(function(b){b.style.backgroundImage="none";b.style.filter=
a})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(a,b){if(a&&b){var c=n.set;c(this._topleft,{height:b+"px",marginLeft:a+"px"});c(this._topright,{width:a+"px",height:b+"px"});c(this._user,"width",a-8+"px");c(this._hide,"marginLeft",a-22+"px");c(this._title,"width",a-25+
"px");c(this._content,"height",b-37+"px");c(this._bottomleft,{marginLeft:a+"px",marginTop:b+"px"});c(this._bottomright,{width:a-5+"px",marginTop:b+"px"});this.width=a;this.height=b;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(a,b)}},_adjustPosition:function(a,b){var c=n.set;c(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"});b===v.ANCHOR_UPPERLEFT?c(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):b===v.ANCHOR_UPPERRIGHT?
c(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):b===v.ANCHOR_LOWERRIGHT?c(this._window,{left:"6px",right:null,top:"43px",bottom:null}):b===v.ANCHOR_LOWERLEFT&&c(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(a){var b=this.map;return b&&a?(a.y<b.height/2?"lower":"upper")+(a.x<b.width/2?"right":"left"):"upperright"},show:function(a,b,f){if(a){a.spatialReference?(this.mapCoords=a,a=this.coords=this.map.toScreen(a,!0)):(this.mapCoords=
null,this.coords=a);var d=this.map._getFrameWidth();if(-1!==d&&(a.x%=d,0>a.x&&(a.x+=d),this.map.width>d))for(var n=(this.map.width-d)/2;a.x<n;)a.x+=d;if(!b||-1===g.indexOf(this._ANCHORS,b))b=this._getAnchor(a);c.remove(this._pointer,this.anchor);b=this.anchor=this.fixedAnchor||b;this._adjustPosition(a,b);c.add(this._pointer,b);r.show(this.domNode);this.isShowing=!0;if(!f)this.onShow()}},hide:function(a,b){r.hide(this.domNode);this.isShowing=!1;if(!b)this.onHide()},showTitleBar:function(){r.show(this._titlebar);
r.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){r.hide(this._titlebar);r.hide(this._border);this.isTitleBarShowing=!1},showContent:function(){r.show(this._content);r.show(this._border);this.isContentShowing=!0},hideContent:function(){r.hide(this._content);r.hide(this._border);this.isContentShowing=!1},move:function(a,b){b?a=this.coords.offset(a.x,a.y):(this.coords=a,this.mapCoords&&(this.mapCoords=this.map.toMap(a)));n.set(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+
"px"})},setFixedAnchor:function(a){a&&-1===g.indexOf(this._ANCHORS,a)||(this.fixedAnchor=a,this.isShowing&&this.show(this.mapCoords||this.coords,a),this.onAnchorChange(a))},setTitle:function(a){this.destroyDijits(this._title);this.__setValue("_title",a);return this},setContent:function(a){this.destroyDijits(this._content);this.__setValue("_content",a);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},
onResize:function(){},onAnchorChange:function(){}});e.mixin(v,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});return v})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w,v,x,B){return e([r,q],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:m.toUrl("./images/whitex.png"),dArrowIcon:m.toUrl("./images/whitedown.png"),lArrowIcon:m.toUrl("./images/whitel.png"),rArrowIcon:m.toUrl("./images/whiter.png"),constructor:function(a,c){this.initialize();g.mixin(this,a);this.domNode=b.byId(c);this._nls=g.mixin({},
B.widgets.popup);var d=this.domNode;f.add(d,"esriPopupMobile");n.set(d,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
var p=l.query(".titlePane",d)[0];this._arrowButton=l.query(".arrow",p)[0];this._pointerTop=l.query(".top",d)[0];this._pointerBottom=l.query(".bottom",d)[0];this._title=l.query(".title",p)[0];this._footer=l.query(".footer",p)[0];this._prev=l.query(".prev",p)[0];this._next=l.query(".next",p)[0];this._spinner=l.query(".spinner",p)[0];this._eventConnections=[h.connect(l.query(".close",p)[0],"onclick",this,this.hide),h.connect(this._arrowButton,"onclick",this,this._toggleView),h.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),h.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();x.hide(d);this.isShowing=!1},setMap:function(a){this.inherited(arguments);p.place(this.domNode,a.root);this.highlight&&this.enableHighlight(a)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(a,b){this.destroyDijits(this._title);this.place(a,this._title);
this.destroyDijits(this._footer);this.place(b,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(a){this.destroyDijits(this._contentPane);this.place(a,this._contentPane);this.startupDijits(this._contentPane)},show:function(a){if(a){var b=this.map;a.spatialReference?(this.location=a,a=b.toScreen(a)):this.location=b.toMap(a);this._maximized?this.restore():this._setPosition(a);this.isShowing||(x.show(this.domNode),this.isShowing=!0,this.onShow())}else x.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(x.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);d.forEach(this._eventConnections,h.disconnect);p.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");f.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var a=this.selectedIndex;this._updateUI();0<=a&&(this.setContent(this.features[a].getContent()),this.updateHighlight(this.map,this.features[a]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var a=this.map;this._handles=[h.connect(a,"onPanStart",this,this._onPanStart),h.connect(a,"onPan",this,this._onPan),h.connect(a,"onZoomStart",this,this._onZoomStart),h.connect(a,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var a=this._handles;a&&(d.forEach(a,h.disconnect),this._handles=null)},_onPanStart:function(){var a=this.domNode.style;this._panOrigin={left:a.left,top:a.top,right:a.right,
bottom:a.bottom}},_onPan:function(a,b){var c=this._panOrigin,f=b.x,d=b.y,n=c.left,p=c.top,e=c.right,c=c.bottom;n&&(n=parseFloat(n)+f+"px");p&&(p=parseFloat(p)+d+"px");e&&(e=parseFloat(e)-f+"px");c&&(c=parseFloat(c)-d+"px");s.set(this.domNode,{left:n,top:p,right:e,bottom:c})},_onZoomStart:function(){x.hide(this.domNode)},_onExtentChange:function(a,b,c){c&&(x.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(a){var b=a.x;a=a.y;var c=
t.getContentBox(this.map.container),d=c.w,c=c.h,n=0,p=a+10,e=118,r=d-18;18<b&&b<r?(n=b-130,0>n?n=0:n>d-260&&(n=d-260)):18>=b?n=b-18:b>=r&&(n=d-260+(b-r));118<b&&b<d-130?e=118:118>=b?18<b?e=b-12:18>=b&&(e=6):b>=d-130&&(b<r?e=118+b-(d-130):b>=r&&(e=118+r-(d-130)));a<=c/2?(s.set(this.domNode,{left:n+"px",top:p+"px",bottom:null}),s.set(this._pointerTop,{left:e+"px"}),f.add(this._pointerBottom,"hidden"),f.remove(this._pointerTop,"hidden")):(s.set(this.domNode,{left:n+"px",top:p-64+"px",bottom:null}),s.set(this._pointerBottom,
{left:e+"px"}),f.add(this._pointerTop,"hidden"),f.remove(this._pointerBottom,"hidden"))},_showPointer:function(a){d.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(b){b===a?l.query(".pointer."+b,this.domNode).removeClass("hidden"):l.query(".pointer."+b,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();x.show(this.popupNavigationBar.container);x.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(a){this.popupInfoView.animateTo(0);switch(a.name){case "CloseButton":x.hide(this.popupNavigationBar.container);x.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":x.hide(this.popupNavigationBar.container);x.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var a={};a.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new w(a,p.create("div",{},k.body()));h.connect(this.popupNavigationBar,"onCreate",this,function(a){this._prevFeatureButton=a[3]._node;this._nextFeatureButton=a[4]._node});h.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);h.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();x.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new u({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},p.create("div",{},k.body()));f.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();h.connect(this.popupInfoView,"onCreate",this,function(a){this._contentPane=a[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});h.connect(this.popupInfoView,"onSwipeLeft",this,function(){});h.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var a="\x26nbsp;",b="\x26nbsp;",c=this.selectedIndex,d=this.features,n=this.deferreds,p=this._prevFeatureButton.parentNode,e=this._nextFeatureButton.parentNode,t=this._spinner,r=this._nls;d&&1<=d.length?(a=d[c].getTitle(),b=c+1+" of "+d.length,f.remove(this._arrowButton,"hidden"),0===c?(f.add(p,"hidden"),f.add(this._prev,"hidden")):(f.remove(p,"hidden"),f.remove(this._prev,"hidden")),c===d.length-1?(f.add(e,"hidden"),
f.add(this._next,"hidden")):(f.remove(e,"hidden"),f.remove(this._next,"hidden"))):(f.add(this._arrowButton,"hidden"),f.add(p,"hidden"),f.add(e,"hidden"),f.add(this._prev,"hidden"),f.add(this._next,"hidden"));this.setTitle(a,b);this.popupNavigationBar.getItems()[1]._node.innerHTML=b;n&&n.length?(f.remove(t,"hidden"),this.setTitle(r.NLS_searching+"...","\x26nbsp;")):(f.add(t,"hidden"),(!d||!d.length)&&this.setTitle("No Information","\x26nbsp;"))}})})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p){return m(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(f,d){var n;this.container=a.byId(d);this._touchBase=p(this.container,null);this._slideDiv=b.create("div",null,this.container,"first");this.events=[];this._items=f.items;f.sections&&(this._sections=f.sections);c.add(this.container,"esriMobileInfoView");if(0===this._sections.length)b.create("div",{},this._slideDiv);else for(n=0;n<this._sections.length;n++){var e=
b.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv);b.create("div",{innerHTML:this._sections[n].title},e)}for(n=0;n<this._items.length;n++){var k,e=0;this._items[n].section&&(e=this._items[n].section);switch(this._items[n].type){case "div":k=b.create("div",{"class":"esriMobileInfoViewItem",style:this._items[n].style},this._slideDiv.childNodes[e]),k=b.create("div",{innerHTML:this._items[n].text},k)}this._items[n].className&&c.add(k,this._items[n].className);k._index=n;k._item=this._items[n];
this._items[n]._node=k}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){g.forEach(this.events,h.disconnect);this._touchBase=null;d.query("img",this.container).forEach(function(a){a._index=null;a._item=null;b.destroy(a)});this._items=null;b.destroy(this._slideDiv);b.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);
this.events.push(h.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(h.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(h.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){h.disconnect(this.events.pop());h.disconnect(this.events.pop());h.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);
this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},
_onTouchMoveHandler:function(a){this._moveDirection||(Math.abs(a.curY)>Math.abs(a.curX)?this._moveDirection="vertical":this._moveDirection="horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(a.touches[0].clientY-this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===
this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return 0.2<Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var a,b;a=n.getContentBox(this.container);var c=0>this._velocity?0.0010:-0.0010;b=-(this._velocity*this._velocity)/(2*c);var f=-this._velocity/c,c=3*0.6-0,d=1-c,p=0,e=0;if(a.h>
this._slideDiv.scrollHeight)this.contentOffsetY=0,e=300;else if(0<this.contentOffsetY+b){a=0;for(b=Math.floor(f/20);a<b;a++)if(p=(d*20*a^3)+(c*20*a^2)+0*20*a+0,p=0>this._velocity?-p:p,0<this.contentOffsetY+p){e=20*a;break}0===e&&(e=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+b)+a.h>this._slideDiv.scrollHeight){this.contentOffsetY=a.h-this._slideDiv.scrollHeight;a=0;for(b=Math.floor(f/20);a<b;a++)if(p=(d*20*a^3)+(c*20*a^2)+0*20*a+0,p=0>this._velocity?-p:p,Math.abs(this.contentOffsetY+
p)>this._slideDiv.scrollHeight){e=20*a;break}}else e=f,this.contentOffsetY+=b;this._slideDiv.style.webkitTransition="-webkit-transform "+e+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=n.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration=
"0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState=
"OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))}})})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),function(m,e,g,h,d,k){return m(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(d,a){this.domNode=h.byId(d);this.events=[g.connect(this.domNode,"touchstart",this,this._touchStartHandler),
g.connect(this.domNode,"touchmove",this,this._touchMoveHandler),g.connect(this.domNode,"touchend",this,this._touchEndHandler),g.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(d){this._preventDefault=d},disableOnClick:function(){g.disconnect(this.events.pop())},_clickHandler:function(d){if(this._moved)d.preventDefault();else this.onclick(d)},_touchStartHandler:function(d){this._moved=!1;this.client_x=d.targetTouches[0].clientX;this.client_y=d.targetTouches[0].clientY;
this.down_x=d.targetTouches[0].pageX;this.down_y=d.targetTouches[0].pageY;d.downX=this.down_x;d.downY=this.down_y;this.onTouchStart(d)},_touchMoveHandler:function(d){this._preventDefault&&d.preventDefault();this._moved=!0;this.up_x=d.targetTouches[0].pageX;this.cur_x=d.targetTouches[0].pageX-this.down_x;this.cur_y=d.targetTouches[0].pageY-this.down_y;d.curX=this.cur_x;d.curY=this.cur_y;this.onTouchMove(d)},_touchEndHandler:function(d){this._moved?(d.curX=this.cur_x,d.curY=this.cur_y,this.down_x-this.up_x>
this._swipeThreshold?d.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(d.swipeDirection="right")):(d.clientX=this.client_x,d.clientY=this.client_y);this.onTouchEnd(d)},onTouchStart:function(d){},onTouchMove:function(d){},onTouchEnd:function(d){},onclick:function(d){}})})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f){return m(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(f,d){var e;this.container=a.byId(d);this._touchBase=n(this.container,null);this._slideDiv=b.create("div",{},this.container,"first");this.events=[g.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=f.items;c.add(this.container,"esriMobileNavigationBar");var k=b.create("div",{},this._slideDiv);for(e=0;e<this._items.length;e++){var l,h;switch(this._items[e].type){case "img":h=
b.create("div",{"class":"esriMobileNavigationItem"},k);l=b.create("img",{src:this._items[e].src.toString(),style:{width:"100%",height:"100%"}},h);break;case "span":h=b.create("div",{"class":"esriMobileNavigationItem"},k);l=b.create("span",{innerHTML:this._items[e].text},h);break;case "div":h=b.create("div",{"class":"esriMobileNavigationInfoPanel"},k),l=b.create("div",{innerHTML:this._items[e].text},h)}c.add(h,this._items[e].position);this._items[e].className&&c.add(l,this._items[e].className);l._index=
e;l._item=this._items[e];this._items[e]._node=l}},startup:function(){this.onCreate(this._items)},destroy:function(){h.forEach(this.events,g.disconnect);this._touchBase=null;d.query("img",this.container).forEach(function(a){a._index=null;a._item=null;b.destroy(a)});this._items=null;b.destroy(this._slideDiv);b.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(a){this._markSelected(a._node,a)},onSelect:function(a){},onUnSelect:function(a){},
onCreate:function(a){},_onClickHandler:function(a){if("img"===a.target.tagName.toLowerCase()){var b=a.target,c=b._item;d.query("img",this.container).forEach(function(a){a!==b&&a._item.toggleGroup===c.toggleGroup&&this._markUnSelected(a,a._item)},this);this._toggleNode(b,c)}},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))},_markSelected:function(a,b){b.toggleState=
"ON";b.srcAlt&&(a.src=b.srcAlt);this.onSelect(b)},_markUnSelected:function(a,b){"ON"===b.toggleState&&(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b))}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(m,e,g,h,d){return m([e,g],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:h,loadingText:null,
hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&d.setStyle(this.domNode,"display","none");d.setStyle(this.domNode,{width:"100%",height:"100%"});this.loadingImg.src=require.toUrl("jimu")+"/images/loading.gif";this.showLoading||d.setStyle(this.loadingImg,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(e){this.domNode&&this.hidden&&
("string"===typeof e&&(this.textNode.innerHTML=e),d.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(d.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/OnScreenWidgetIcon":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dijit/_WidgetBase ./utils".split(" "),function(m,e,g,h,d,k,l){return m(k,{"class":"jimu-widget-onscreen-icon",postCreate:function(){this.inherited(arguments);this.iconNode=
h.create("img",{src:this.widgetConfig.icon},this.domNode);h.setAttr(this.domNode,"title",this.widgetConfig.label);this.own(d(this.domNode,"click",e.hitch(this,function(){this.onClick()})));this.position=e.clone(this.widgetConfig.position);"map"===this.widgetConfig.position.relativeTo&&this.own(d(this.map,"resize",e.hitch(this,function(){var a=e.clone(this.position);delete a.width;delete a.height;this.panel&&this.panel.setPosition(a)})));this.state="closed"},startup:function(){this.inherited(arguments)},
onClick:function(){"closed"===this.state?this.switchToOpen():this.switchToClose()},moveTo:function(a){var c={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},c=e.mixin(c,l.getPositionStyle(a));delete c.width;delete c.height;h.setStyle(this.domNode,c);this.position=e.clone(a);this.widgetConfig&&this.widgetConfig.panel&&(this.widgetConfig.panel.position=e.clone(a),this.widgetConfig.position=e.clone(a));this.panel&&this.panel.setPosition(e.clone(a));this.widget&&this.widget.setPosition(this.getOffPanelWidgetPosition(this.widget))},
destroy:function(){this.panel?this.panelManager.destroyPanel(this.panel):this.widget&&this.widgetManager.destroyWidget(this.widget);this.inherited(arguments)},switchToOpen:function(){this.state="opened";this.panelManager.closeAllPanelsInGroup(this.widgetConfig.gid);g.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){a.closeable&&this.widgetManager.closeWidget(a)},this);h.addClass(this.domNode,"jimu-state-selected");this._showLoading();!1===this.widgetConfig.inPanel?this.widgetManager.loadWidget(this.widgetConfig).then(e.hitch(this,
function(a){this.widget=a;a.setPosition(this.getOffPanelWidgetPosition(a));this.widgetManager.openWidget(a);this.own(d(a,"close",e.hitch(this,function(){this.switchToClose()})));this._hideLoading()})):this.panelManager.showPanel(e.clone(this.widgetConfig)).then(e.hitch(this,function(a){this.panel=a;this.own(d(a,"close",e.hitch(this,function(){this.switchToClose()})));this._hideLoading()}))},switchToClose:function(){this.state="closed";h.removeClass(this.domNode,"jimu-state-selected");!1===this.widgetConfig.inPanel?
this.widgetManager.closeWidget(this.widget):this.panelManager.closePanel(this.panel)},getOffPanelWidgetPosition:function(a){var c={relativeTo:a.position.relativeTo},b=h.getMarginBox(this.domNode);a=this.widgetManager.getWidgetMarginBox(a);var d=h.getMarginBox("map"===c.relativeTo?this.map.id:jimuConfig.layoutId),f=b.t+b.h+1;f+a.h>d.h?c.bottom=d.h-b.t+1:c.top=f;window.isRTL?c.right=0>b.l+b.w-a.w?0:b.l+b.w-a.w:b.l+a.w>d.w?c.right=0:c.left=b.l;return c},_showLoading:function(){h.setAttr(this.iconNode,
"src",require.toUrl("jimu")+"/images/loading_circle.gif")},_hideLoading:function(){h.setAttr(this.iconNode,"src",this.widgetConfig.icon)}})})},"jimu/WidgetPlaceholder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase","./utils"],function(m,e,g,h,d){return m(h,{"class":"jimu-widget-placeholder",postCreate:function(){this.inherited(arguments);this.indexNode=g.create("div",{"class":"inner",innerHTML:this.index},this.domNode);g.setAttr(this.domNode,"title",
window.jimuNls.widgetPlaceholderTooltip)},moveTo:function(k){var l={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},l=e.mixin(l,d.getPositionStyle(k));delete l.width;delete l.height;g.setStyle(this.domNode,l)},setIndex:function(d){this.index=d;this.indexNode.innerHTML=d}})})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","./WidgetManager"],function(m,e,g,h){var d=null,k;k=m(null,{constructor:function(){g.subscribe("publishData",
e.hitch(this,this.onDataPublished));g.subscribe("fetchData",e.hitch(this,this.onFetchData));g.subscribe("clearAllData",e.hitch(this,this.onClearAllData));g.subscribe("removeData",e.hitch(this,this.onRemoveData));g.subscribe("clearDataHistory",e.hitch(this,this.onClearDataHistory));this.widgetManager=h.getInstance()},_dataStore:{},onDataPublished:function(d,a,c,b){"undefined"===typeof b&&(b=!1);this._dataStore[a]?(this._dataStore[a].current=c,b&&(this._dataStore[a].history?this._dataStore[a].history.push(c):
this._dataStore[a].history=[c])):(this._dataStore[a]={current:c},b&&(this._dataStore[a].history=[c]))},onFetchData:function(d){var a;if(d)(a=this.widgetManager.getWidgetById(d))?this._dataStore[d]?g.publish("dataFetched",a.name,d,this._dataStore[d].current,this._dataStore[d].history):g.publish("noData",a.name,d):g.publish("noData",void 0,d);else for(var c in this._dataStore)(a=this.widgetManager.getWidgetById(c))&&g.publish("dataFetched",a.name,c,this._dataStore[c].current,this._dataStore[c].history)},
onClearAllData:function(){this._dataStore={};g.publish("allDataCleared")},onRemoveData:function(d){delete this._dataStore[d];g.publish("dataRemoved",d)},onClearDataHistory:function(d){this._dataStore[d]&&(this._dataStore[d].history=[]);g.publish("dataHistoryCleared",d)}});k.getInstance=function(){null===d&&(d=new k);return d};return k})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),
function(m,e,g,h,d,k,l,a,c,b){return m([l,a],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(d.subscribe("publishData",e.hitch(this,this._onReceiveData)));this.own(d.subscribe("dataFetched",e.hitch(this,
this._onReceiveData)));this.own(d.subscribe("noData",e.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(a){},onSignOut:function(){},onPositionChange:function(a){this.setPosition(a)},setPosition:function(a,b){this.position=a;var d=c.getPositionStyle(this.position);d.position="absolute";
b||(b="map"===a.relativeTo?this.map.id:window.jimuConfig.layoutId);h.place(this.domNode,b);h.setStyle(this.domNode,d);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return h.getMarginBox(this.domNode)},setMap:function(a){this.map=a},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){},onConfigChanged:function(a){},onAppConfigChanged:function(a,b,c){},onAction:function(a,b){},getPanel:function(){if(!1===
this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return b.getInstance().getPanelById(this.id+"_panel");var a=b.getInstance().getPanelById(this.gid+"_panel");return a?a:b.getInstance().getPanelById(this.id+"_panel")},publishData:function(a,b){"undefined"===typeof b&&(b=!1);d.publish("publishData",this.name,this.id,a,b)},fetchData:function(a){a?d.publish("fetchData",a):0!==this.listenWidgetIds.length?g.forEach(this.listenWidgetIds,function(a){d.publish("fetchData",a)},
this):d.publish("fetchData")},fetchDataByName:function(a){a=this.widgetManager.getWidgetsByName(a);g.forEach(a,function(a){this.fetchData(a.id)},this)},openWidgetById:function(a){var b=new k;if(this.widgetManager.getWidgetById(a))return b.resolve(this.widgetManager.getWidgetById(a)),b;var c=d.subscribe("widgetCreated",e.hitch(this,function(d){d.id===a&&(c.remove(),b.resolve(d))}));d.publish("openWidget",a);return b},_onReceiveData:function(a,b,c,d){if(b!==this.id&&!(0!==this.listenWidgetIds.length&&
0>this.listenWidgetIds.indexOf(b)))this.onReceiveData(a,b,c,d)},onReceiveData:function(a,b,c,d){},_onNoData:function(a,b){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(b)))this.onNoData(a,b)},onNoData:function(a,b){}})})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(m,e,g,h){return m([h],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);
this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&("closed"!==this.widget.state&&e.isFunction(this.widget.resize))&&this.widget.resize()},setLoading:function(d){this.loading=d;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(d){this.widget=d;this.loading&&this.loading.destroy();g.place(d.domNode,
this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(d){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+d.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(m,e,g,h,d,k,l,a,
c){return m([d,k],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var a=this.getAllWidgetConfigs(),a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];g.forEach(a,function(a){var b,c;!1!==a.visible&&(c=new l,b=this.createFrame(a),this.addChild(b),
b.setLoading(c),this.widgetManager.loadWidget(a).then(e.hitch(this,function(a){b.setWidget(a);a.startup()})))},this)},getAllWidgetConfigs:function(){var a=[];return a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(a){for(var c=this.getChildren(),f=0;f<c.length;f++)if(c[f].getWidget()&&c[f].getWidget().id===a)return c[f].getWidget()},createFrame:function(b){return new a},setPosition:function(a,d){this.position=a;var f=c.getPositionStyle(this.position);
f.position="absolute";d||(d="map"===a.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(f.display="none");h.place(this.domNode,d);h.setStyle(this.domNode,f)},getPosition:function(){return this.position},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){this.getChildren().forEach(function(a){a.resize()})},onPositionChange:function(a){this.setPosition(a)},onOpen:function(){g.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.openWidget(a.getWidget())},this)},onClose:function(){g.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.closeWidget(a.getWidget())},this)},onMaximize:function(){g.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.maximizeWidget(a.getWidget())},this)},onMinimize:function(){g.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.minimizeWidget(a.getWidget())},this)},onNormalize:function(){g.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.normalizeWidget(a.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(a){this._updateConfig(a)},reloadWidget:function(a){this.isWidgetInPanel(a)&&(this._updateConfig(a),this.getChildren().forEach(function(c){c.getWidget()&&c.getWidget().id===a.id&&(c.getWidget().destroy(),c.setLoading(new l),this.widgetManager.loadWidget(a).then(e.hitch(this,function(a){c.setWidget(a);a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},
this))},isWidgetInPanel:function(a){return g.some(this.getAllWidgetConfigs(),function(c){if(a.id===c.id)return!0})?!0:!1},_updateConfig:function(a){if(Array.isArray(this.config.widgets)){for(var c=-1,f=0;f<this.config.widgets.length;f++)this.config.widgets[f].id===a.id&&(c=f);0<c&&(this.config.widgets[c]=a)}else this.config=a},destroy:function(){this.getChildren().forEach(function(a){try{a.domNode&&a.destroy()}catch(c){console.error("destroy widget frame error."+c.stack)}});this.inherited(arguments)}})})},
"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(m,e,g,h){return m(e,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&g.set(this.domNode,{display:"none"});g.set(this.domNode,{width:"100%",height:"100%"});var d='\x3cimg class\x3d"jimu-loading" src\x3d"'+require.toUrl("jimu")+'/images/loading.gif"\x3e';
h.place(d,this.domNode)},show:function(){this.domNode&&g.set(this.domNode,"display","block")},hide:function(){this.domNode&&g.set(this.domNode,"display","none")}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(m,e,g,h,d){return m([h,d],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(g(window,"resize",e.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},
_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define(["dojo/_base/lang","dojo/_base/html","dojox/gfx","esri/symbols/jsonUtils"],function(m,e,g,h){return{cloneSymbol:function(d){if(!d)return null;var e=null;try{var g=d.toJson(),e=h.fromJson(g)}catch(a){console.error(a)}return e},getDefaultMarkerSymbol:function(){return h.fromJson({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return h.fromJson({tags:["solid"],
title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return h.fromJson({tags:["opaque"],title:"Blue",style:"esriSFSSolid",color:[79,129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return h.fromJson({color:[255,255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,
255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return h.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return h.fromJson({color:[255,255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},createSymbolNode:function(d,k){var l=32,a=32,c=e.create("div",{},document.body);e.setStyle(c,"display","inline-block");
if(k)l=k.width,a=k.height;else if(l=80,a=30,this.isSimpleMarkerSymbol(d))a=l=Math.min(d.size+12,125);else if(this.isPictureMarkerSymbol(d)){if(!d.url||"http://"===d.url||-1===d.url.indexOf("http://")&&-1===d.url.indexOf("https://")&&-1===d.url.indexOf("data:"))return;a=l=Math.min(Math.max(d.width,d.height),125)}else if(this.isSimpleLineSymbol(d)||this.isCartographicLineSymbol(d))l=190,a=20;var b=g.createSurface(c,l,a);if("vml"===g.renderer){var n=b.getEventSource();e.setStyle(n,"position","relative");
e.setStyle(n.parentNode,"position","relative")}var n=null,n=k?h.getShapeDescriptors(d):this.isSimpleLineSymbol(d)||this.isCartographicLineSymbol(d)?this._getLineShapeDesc(d):h.getShapeDescriptors(d),f;try{f=b.createShape(n.defaultShape),n.fill&&f.setFill(n.fill),n.stroke&&f.setStroke(n.stroke)}catch(p){b.clear();b.destroy();return}var b=b.getDimensions(),b={dx:b.width/2,dy:b.height/2},t=f.getBoundingBox(),n=t.width,t=t.height;if(n>l||t>a)l=((l<a?l:a)-5)/(n>t?n:t),m.mixin(b,{xx:l,yy:l});f.applyTransform(b);
return c},_getLineShapeDesc:function(d){var e=null;if(this.isSimpleLineSymbol(d)||this.isCartographicLineSymbol(d))e={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:d.getStroke()};return e},isSimpleMarkerSymbol:function(d){return d&&"esri.symbol.SimpleMarkerSymbol"===d.declaredClass},isPictureMarkerSymbol:function(d){return d&&"esri.symbol.PictureMarkerSymbol"===d.declaredClass},isSimpleLineSymbol:function(d){return d&&"esri.symbol.SimpleLineSymbol"===d.declaredClass},isCartographicLineSymbol:function(d){return d&&
"esri.symbol.CartographicLineSymbol"===d.declaredClass},isSimpleFillSymbol:function(d){return d&&"esri.symbol.SimpleFillSymbol"===d.declaredClass},isPictureFillSymbol:function(d){return d&&"esri.symbol.PictureFillSymbol"===d.declaredClass},isTextSymbol:function(d){return d&&"esri.symbol.TextSymbol"===d.declaredClass}}})},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale esri/lang dojo/data/ItemFileWriteStore jimu/utils".split(" "),function(m,
e,g,h,d,k,l){return m([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:86399E3,fieldsStore:null,isHosted:!1,constructor:function(){String.prototype.startsWith=function(a){return 0===this.indexOf(a)};String.prototype.endsWith=function(a){return this.substring(this.length-a.length)===a};String.prototype.count=function(a){return this.split(a).length-
1};String.prototype.trim||(String.prototype.trim=e.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes)},OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",
stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",
numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",
dateOperatorMonths:"dateOperatorMonths",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast"},isAskForValues:function(a){var c=!1;return c=g.some(a.parts,e.hitch(this,function(a){return a.parts?g.some(a.parts,e.hitch(this,function(a){return!!a.interactiveObj})):!!a.interactiveObj}))},setFieldsStoreByFieldInfos:function(a){a=g.filter(a,e.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)}));a=g.map(a,function(a,b){var d;switch(a.type){case "esriFieldTypeString":d=
"string";break;case "esriFieldTypeDate":d="date";break;default:d="number"}return{id:b,label:a.name,shortType:d,alias:a.alias,editable:a.editable,name:a.name,nullable:a.nullable,type:a.type}},this);this.fieldsStore=new k({data:{identifier:"id",label:"label",items:a}});return a.length},_validatePartsObj:function(a){return a&&"object"===typeof a},_isObject:function(a){return a&&"object"===typeof a},_isString:function(a){return a&&"string"===typeof a},containsNonLatinCharacter:function(a){for(var c=0;c<
a.length;c++)if(255<a.charCodeAt(c))return!0;return!1},getExprByFilterObj:function(a){if(!g.every(a.parts,function(a){return!!a}))return null;if(!this.isPartsObjReadyToBuild(a))return a.expr="",a.expr;var c="";if(0===a.parts.length)c="1\x3d1";else if(1===a.parts.length)c=this.builtFilterString(a.parts[0]);else for(var b="",n=0;n<a.parts.length;n++){var f=this.builtFilterString(a.parts[n]);if(!d.isDefined(f))return null;c+=b+"("+f+")";b=b||" "+a.logicalOperator+" "}return a.expr=c},isPartsObjReadyToBuild:function(a){return g.every(a.parts,
e.hitch(this,function(a){return a.parts?g.every(a.parts,e.hitch(this,function(a){return this._isPartReadyToBuild(a)})):this._isPartReadyToBuild(a)}))},_isPartReadyToBuild:function(a){var c=a.fieldObj.shortType,b=a.operator,d=a.valueObj;a=d.type;var f=d.value,e=d.value1,d=d.value2;if("value"===a){if("string"===c)return b===this.OPERATORS.stringOperatorIsBlank||b===this.OPERATORS.stringOperatorIsNotBlank?!0:l.isNotEmptyString(f);if("number"===c)return b===this.OPERATORS.numberOperatorIsBlank||b===this.OPERATORS.numberOperatorIsNotBlank?
!0:b===this.OPERATORS.numberOperatorIsBetween||b===this.OPERATORS.numberOperatorIsNotBetween?l.isValidNumber(e)&&l.isValidNumber(d):l.isValidNumber(f);if("date"===c)return b===this.OPERATORS.dateOperatorIsBlank||b===this.OPERATORS.dateOperatorIsNotBlank?!0:b===this.OPERATORS.dateOperatorIsBetween||b===this.OPERATORS.dateOperatorIsNotBetween?l.isNotEmptyString(e)&&l.isNotEmptyString(d):l.isNotEmptyString(f)}else{if("field"===a)return l.isNotEmptyString(f);if("unique"===a){if("string"===c)return l.isNotEmptyString(f);
if("number"===c)return l.isValidNumber(f)}}return!1},builtFilterString:function(a){var c="";if(a.parts)for(var b="",n=0;n<a.parts.length;n++){var f=a.parts[n],e=this.builtSingleFilterString(f);f.expr=e.whereClause;if(!d.isDefined(e.whereClause))return null;c+=b+e.whereClause;b=" "+a.logicalOperator+" "}else c=this.builtSingleFilterString(a).whereClause;return a.expr=c},builtSingleFilterString:function(a,c){this.isHosted&&(a.caseSensitive=!1);if(d.isDefined(a.valueObj.isValid)&&!a.valueObj.isValid)return{whereClause:null};
var b=a.valueObj.value,n=a.valueObj.value1,f=a.valueObj.value2,e=!1;a.interactiveObj&&d.isDefined(c)&&(e=!0,d.isDefined(a.valueObj.value)&&(b="{"+c+"}"),d.isDefined(a.valueObj.value1)&&(n="{"+c+"}"),d.isDefined(a.valueObj.value2)&&(f="{"+(c+1)+"}"));var k="";if("string"===a.fieldObj.shortType)switch(n="",e&&this.isHosted?n="N":b&&"field"!==a.valueObj.type&&this.isHosted&&this.containsNonLatinCharacter(b)&&(n="N"),a.operator){case this.OPERATORS.stringOperatorIs:k="field"===a.valueObj.type?a.fieldObj.name+
" \x3d "+b:a.fieldObj.name+" \x3d "+n+"'"+b.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorIsNot:k="field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+b:a.fieldObj.name+" \x3c\x3e "+n+"'"+b.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorStartsWith:k=a.caseSensitive?a.fieldObj.name+" LIKE "+n+"'"+b.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+n+"'"+b.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorEndsWith:k=a.caseSensitive?
a.fieldObj.name+" LIKE "+n+"'%"+b.replace(/\'/g,"''")+"'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+n+"'%"+b.replace(/\'/g,"''")+"')";break;case this.OPERATORS.stringOperatorContains:k=a.caseSensitive?a.fieldObj.name+" LIKE "+n+"'%"+b.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+n+"'%"+b.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorDoesNotContain:k=a.caseSensitive?a.fieldObj.name+" NOT LIKE "+n+"'%"+b.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") NOT LIKE UPPER("+
n+"'%"+b.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorIsBlank:k=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:k=a.fieldObj.name+" IS NOT NULL"}else if("number"===a.fieldObj.shortType)switch(a.operator){case this.OPERATORS.numberOperatorIs:k=a.fieldObj.name+" \x3d "+b;break;case this.OPERATORS.numberOperatorIsNot:k=a.fieldObj.name+" \x3c\x3e "+b;break;case this.OPERATORS.numberOperatorIsAtLeast:k=a.fieldObj.name+" \x3e\x3d "+b;break;case this.OPERATORS.numberOperatorIsLessThan:k=
a.fieldObj.name+" \x3c "+b;break;case this.OPERATORS.numberOperatorIsAtMost:k=a.fieldObj.name+" \x3c\x3d "+b;break;case this.OPERATORS.numberOperatorIsGreaterThan:k=a.fieldObj.name+" \x3e "+b;break;case this.OPERATORS.numberOperatorIsBetween:k=a.fieldObj.name+" BETWEEN "+n+" AND "+f;break;case this.OPERATORS.numberOperatorIsNotBetween:k=a.fieldObj.name+" NOT BETWEEN "+n+" AND "+f;break;case this.OPERATORS.numberOperatorIsBlank:k=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:k=
a.fieldObj.name+" IS NOT NULL"}else switch(d.isDefined(b)&&("field"!==a.valueObj.type&&"string"===typeof b)&&(b=new Date(b)),"field"!==a.valueObj.type&&(b&&(b=new Date(b)),n&&(n=new Date(n)),f&&(f=new Date(f))),a.operator){case this.OPERATORS.dateOperatorIsOn:k="field"===a.valueObj.type?a.fieldObj.name+" \x3d "+b:e?a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+c+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(c+1)+"}'":a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+
"'"+this.formatDate(b)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(b))+"'";break;case this.OPERATORS.dateOperatorIsNotOn:k="field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+b:e?a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+c+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(c+1)+"}'":a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(b))+
"'";break;case this.OPERATORS.dateOperatorIsBefore:k="field"===a.valueObj.type?a.fieldObj.name+" \x3c "+b:a.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+"'";break;case this.OPERATORS.dateOperatorIsAfter:k="field"===a.valueObj.type?a.fieldObj.name+" \x3e "+b:a.fieldObj.name+" \x3e "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(b))+"'";break;case this.OPERATORS.dateOperatorIsBetween:k=e?a.fieldObj.name+" BETWEEN '"+n+"' AND '"+f+"'":a.fieldObj.name+
" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(n)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(f))+"'";break;case this.OPERATORS.dateOperatorIsNotBetween:k=e?a.fieldObj.name+" NOT BETWEEN '"+n+"' AND '"+f+"'":a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(n)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(f))+"'";break;case this.OPERATORS.dateOperatorIsBlank:k=a.fieldObj.name+" IS NULL";break;
case this.OPERATORS.dateOperatorIsNotBlank:k=a.fieldObj.name+" IS NOT NULL"}return{whereClause:k}},formatDate:function(a){var c=h.format(a,{datePattern:"yyyy-MM-dd",selector:"date"});a=h.format(a,{selector:"time",timePattern:"HH:mm:ss"});return c+" "+a},addDay:function(a){return new Date(a.getTime()+this.dayInMS)},getFilterObjByExpr:function(a){if(a&&this.fieldsStore){var c=this.replaceStrings(a);a=c.defExpr;var b=this.findParts(a,"AND");1===b.parts.length&&(b=this.findParts(a,"OR"),1===b.parts.length&&
(b.logicalOperator="AND"));g.forEach(b.parts,function(a){a.expr=a.expr.trim();if(a.expr.startsWith("(")&&-1<a.expr.search(/\)$/)){var b=a.expr.substring(1,a.expr.length-1),c=b.indexOf("("),d=b.indexOf(")");if(-1===c&&-1===d||c<d)a.expr=b}b=this.findParts(a.expr,"AND");1===b.parts.length&&(b=this.findParts(a.expr,"OR"));1<b.parts.length&&(a.parts=b.parts,a.logicalOperator=b.logicalOperator)},this);this.parseExpr(b);this.reReplaceStrings(c,b);b&&b.parts&&g.forEach(b.parts,e.hitch(this,function(a){a&&
(a.parts?g.forEach(a,e.hitch(this,function(a){this._handleParsedPartValue(a)})):this._handleParsedPartValue(a))}));return b}},_handleParsedPartValue:function(a){a&&(a.fieldObj&&"number"===a.fieldObj.shortType&&a.valueObj)&&(a.valueObj.hasOwnProperty("value")&&(a.valueObj.value=parseFloat(a.valueObj.value)),a.valueObj.hasOwnProperty("value1")&&(a.valueObj.value1=parseFloat(a.valueObj.value1)),a.valueObj.hasOwnProperty("value2")&&(a.valueObj.value2=parseFloat(a.valueObj.value2)))},replaceStrings:function(a){for(var c=
a,b=function(a,c,f){var d=-1,d=a.indexOf("'",f+1);return d===f+1?(d=a.indexOf("'",d+1),b(a,c,d)):f},d=[],f=a.indexOf("'");-1<f;){var e=f,f=a.indexOf("'",f+1),k=0,f=b(a,e,f);"%"===a[e+1]&&e++;"%"===a[f-1]&&(f-=1,k++);var g=a.substring(e+1,f);"N"===a[e-1]&&(a=a.substring(0,e-1)+a.substring(e),e-=1,f-=1);!this.isDateString(g)&&-1===g.indexOf("{")?(d.push(g),a=a.substring(0,e+1)+"#"+(d.length-1)+"#"+a.substring(f),f=a.indexOf("'",a.lastIndexOf("#")+2+k)):f=a.indexOf("'",f+1+k)}return{origDefExpr:c,defExpr:a,
savedStrings:d}},reReplaceStrings:function(a,c){var b=a.savedStrings;if(b.length&&b.length){var n=function(a,b){if("string"!==a.fieldObj.shortType)return!1;var c=a.valueObj.value.indexOf("#"),f=a.valueObj.value.lastIndexOf("#");return d.isDefined(a.valueObj.value)&&-1<c?(a.valueObj.value=b[parseInt(a.valueObj.value.substring(c+1,f),10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},n=e.hitch(this,n),f=!1;g.forEach(c.parts,function(a){if(a.parts){var c=!1;g.forEach(a.parts,function(a){c=
n(a,b)||c});c&&(f=c,a.expr=this.builtFilterString(a))}else(f=n(a,b)||f)&&this.builtFilterString(a)},this);f&&(c.expr=null,this.getExprByFilterObj(c))}},isDateString:function(a){return 19===a.length&&"-"===a.charAt(4)&&"-"===a.charAt(7)&&" "===a.charAt(10)&&":"===a.charAt(13)&&":"===a.charAt(16)?!0:!1},findParts:function(a,c){for(var b=a.toLowerCase(),d=" "+c.toLowerCase()+" ",f=[],e=0,k=b.indexOf(d);0<k;){var g=a.substring(e,k),r=g.toLowerCase(),l=g.count("("),h=g.count(")"),m=g.count("'");l!==h||
1===m%2?k=b.indexOf(d,k+1):-1<r.indexOf(" between ")&&-1===r.indexOf(" and ")?k=b.indexOf(d,k+1):(f.push({expr:g}),e=k+d.length,k=b.indexOf(d,e))}f.push({expr:a.substring(e)});for(b=f.length-1;0<=b;b--)!this.hasOperator(f[b].expr)&&0<b&&(f[b-1].expr+=" "+c+" "+f[b].expr,f.splice(b,1));return{expr:a,parts:f,logicalOperator:c}},hasOperator:function(a){a=a.toLowerCase();return-1<a.indexOf("{")&&-1<a.indexOf("}")||-1<a.indexOf(" \x3d ")||-1<a.indexOf(" \x3c ")||-1<a.indexOf(" \x3e ")||-1<a.indexOf(" \x3c\x3e ")||
-1<a.indexOf(" \x3c\x3d ")||-1<a.indexOf(" \x3e\x3d ")||-1<a.indexOf(" like ")||-1<a.indexOf(" between ")||-1<a.indexOf(" date")||-1<a.indexOf(" is null")||-1<a.indexOf(" is not null")?!0:!1},parseExpr:function(a){g.forEach(a.parts,function(a){a.parts?this.parseExpr(a):this.parseSingleExpr(a)},this)},_preParseSingleExpr:function(a){var c=null;try{if(c=e.clone(a),c.expr=c.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(c.expr)){var b=a="",d=c.expr.match(/^UPPER\((.*)\)\s+/i);
if(d&&2<=d.length)a=d[1];else return null;var f=c.expr.match(/UPPER\(N?'(.*)'\)$/i);if(f&&2<=f.length)b="'"+f[1]+"'";else return null;c.expr=c.expr.replace(/^UPPER\((.*)\)\s+/i,a+" ");c.expr=c.expr.replace(/UPPER\(N?'(.*)'\)$/i,b);c.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(c.expr)&&(c.caseSensitive=!0)}catch(p){return console.log(p),null}c&&this.isHosted&&(c.caseSensitive=!1);return c},parseSingleExpr:function(a){var c=this._preParseSingleExpr(a);c&&(a=e.mixin(a,c));var c=
a.expr.trim(),b=c.indexOf(" "),n=c.substring(0,b);a.fieldObj={name:n};a.valueObj={};this.getFieldItemByName({name:n},function(b){a.fieldObj.shortType=b.shortType[0];a.fieldObj.label=b.label[0]},function(){a.error={msg:"unknown field name ("+n+")",code:1}});c=c.substring(b+1).trim();b=c.toLowerCase();b.startsWith("\x3d ")?(c="date"===a.fieldObj.shortType&&!this.isHosted?c.substring(12).trim():c.substring(2).trim(),this.storeValue(c,a),a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsOn:
"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):b.startsWith("\x3c ")?(c="date"===a.fieldObj.shortType&&!this.isHosted?c.substring(12).trim():c.substring(2).trim(),this.storeValue(c,a),"date"===a.fieldObj.shortType?a.operator=this.OPERATORS.dateOperatorIsBefore:"number"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsLessThan:a.error={msg:"operator ("+b+") not supported for string",code:3}):b.startsWith("\x3e ")?(c="date"===a.fieldObj.shortType&&
!this.isHosted?c.substring(12).trim():c.substring(2).trim(),this.storeValue(c,a),"date"===a.fieldObj.shortType?a.operator=this.OPERATORS.dateOperatorIsAfter:"number"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsGreaterThan:a.error={msg:"operator ("+b+") not supported for string",code:3}):b.startsWith("\x3c\x3e ")?(c="date"===a.fieldObj.shortType&&!this.isHosted?c.substring(13).trim():c.substring(3).trim(),this.storeValue(c,a),a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:
"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):b.startsWith("\x3c\x3d ")?(this.storeValue(c.substring(3).trim(),a),a.operator=this.OPERATORS.numberOperatorIsAtMost):b.startsWith("\x3e\x3d ")?(this.storeValue(c.substring(3).trim(),a),a.operator=this.OPERATORS.numberOperatorIsAtLeast):b.startsWith("like ")?(c=c.substring(5).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&c.endsWith("%'")?(this.storeValue(c.substring(2,
c.length-2),a),a.operator=this.OPERATORS.stringOperatorContains):c.startsWith("'%")&&c.endsWith("'")?(this.storeValue(c.substring(2,c.length-1),a),a.operator=this.OPERATORS.stringOperatorEndsWith):c.startsWith("'")&&c.endsWith("%'")?(this.storeValue(c.substring(1,c.length-2),a),a.operator=this.OPERATORS.stringOperatorStartsWith):a.error={msg:"value ("+b+") not supported for LIKE",code:3}):b.startsWith("not like ")?(c=c.substring(9).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&
c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-2),a),a.operator=this.OPERATORS.stringOperatorDoesNotContain):a.error={msg:"value ("+b+") not supported for NOT LIKE",code:3}):b.startsWith("between ")?(c="date"===a.fieldObj.shortType&&!this.isHosted?c.substring(18).trim():c.substring(8).trim(),b=c.toLowerCase().indexOf(" and "),-1<b?(this.storeValue1(c.substring(0,b).trim(),a),"date"===a.fieldObj.shortType&&!this.isHosted?this.storeValue2(c.substring(b+15).trim(),a):this.storeValue2(c.substring(b+
5).trim(),a)):a.error={msg:"missing AND operator for BETWEEN",code:3},"date"===a.fieldObj.shortType?"string"===typeof a.valueObj.value1?a.operator=this.OPERATORS.dateOperatorIsBetween:1E3>Math.abs(this.subtractDay(a.valueObj.value2).getTime()-a.valueObj.value1.getTime())?(a.valueObj.value=a.valueObj.value1,delete a.valueObj.value1,delete a.valueObj.value2,a.operator=this.OPERATORS.dateOperatorIsOn):a.operator=this.OPERATORS.dateOperatorIsBetween:"number"===a.fieldObj.shortType||"oid"===a.fieldObj.shortType?
a.operator=this.OPERATORS.numberOperatorIsBetween:a.error={msg:"string field not supported for BETWEEN",code:3}):b.startsWith("not between ")?(c="date"===a.fieldObj.shortType&&!this.isHosted?c.substring(22).trim():c.substring(12).trim(),b=c.toLowerCase().indexOf(" and "),-1<b?(this.storeValue1(c.substring(0,b).trim(),a),"date"===a.fieldObj.shortType&&!this.isHosted?this.storeValue2(c.substring(b+15).trim(),a):this.storeValue2(c.substring(b+5).trim(),a)):a.error={msg:"missing AND operator for NOT BETWEEN",
code:3},"date"===a.fieldObj.shortType?"string"===typeof a.valueObj.value1?a.operator=this.OPERATORS.dateOperatorIsNotBetween:1E3>Math.abs(this.subtractDay(a.valueObj.value2).getTime()-a.valueObj.value1.getTime())?(a.valueObj.value=a.valueObj.value1,delete a.valueObj.value1,delete a.valueObj.value2,a.operator=this.OPERATORS.dateOperatorIsNotOn):a.operator=this.OPERATORS.dateOperatorIsNotBetween:"number"===a.fieldObj.shortType||"oid"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsNotBetween:
a.error={msg:"string field not supported for NOT BETWEEN",code:3}):"is null"===b?(a.valueObj.value=null,a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===b?(a.valueObj.value=null,a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:this.OPERATORS.numberOperatorIsNotBlank):
a.error={msg:"unknown operator ("+b+")",code:2};if(d.isDefined(a.valueObj.value)&&"string"===typeof a.valueObj.value&&a.valueObj.value.startsWith("{")&&a.valueObj.value.endsWith("}")||d.isDefined(a.valueObj.value1)&&"string"===typeof a.valueObj.value1&&a.valueObj.value1.startsWith("{")&&a.valueObj.value1.endsWith("}"))a.isInteractive=!0},getFieldItemByName:function(a,c,b){this.fieldsStore.fetch({query:a,onComplete:e.hitch(this,function(a){a&&a.length?c(a[0]):b()})})},subtractDay:function(a){return new Date(a.getTime()-
this.dayInMS)},storeValue:function(a,c){if(a.startsWith("{")&&a.endsWith("}"))c.valueObj.value=a;else if(a.startsWith("'{")&&a.endsWith("}'"))c.valueObj.value=a.substring(1,a.length-1);else if("date"===c.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var b=a.substring(1,a.length-1);c.valueObj.value=this.parseDate(b)}else c.valueObj.value=a,c.valueObj.type="field";else"string"===c.fieldObj.shortType?(a.startsWith("#")||a.startsWith("%#"))&&(a.endsWith("#")||a.endsWith("#%"))?c.valueObj.value=
a:a.startsWith("'")&&a.endsWith("'")?c.valueObj.value=a.substring(1,a.length-1).replace(/\'\'/g,"'"):(c.valueObj.value=a,c.valueObj.type="field",this.getFieldItemByName({name:a},function(a){c.valueObj.label=a.label[0]},function(){c.error={msg:"unknown field name ("+a+")",code:1}})):(c.valueObj.value=a,isNaN(a)&&(c.valueObj.type="field",this.getFieldItemByName({name:a},function(a){c.valueObj.label=a.label[0]},function(){c.error={msg:"unknown field name ("+a+")",code:1}})))},storeValue1:function(a,
c){if(a.startsWith("{")&&a.endsWith("}"))c.valueObj.value1=a;else if(a.startsWith("'{")&&a.endsWith("}'"))c.valueObj.value1=a.substring(1,a.length-1);else if("date"===c.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var b=a.substring(1,a.length-1);c.valueObj.value1=this.parseDate(b)}else c.valueObj.value1=a,c.valueObj.type="field";else c.valueObj.value1=a,isNaN(a)&&(c.valueObj.type="field")},storeValue2:function(a,c){if(a.startsWith("{")&&a.endsWith("}"))c.valueObj.value2=a;else if(a.startsWith("'{")&&
a.endsWith("}'"))c.valueObj.value2=a.substring(1,a.length-1);else if("date"===c.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var b=a.substring(1,a.length-1);c.valueObj.value2=this.parseDate(b)}else c.valueObj.value2=a,c.valueObj.type="field";else c.valueObj.value2=a,isNaN(a)&&(c.valueObj.type="field")},parseDate:function(a){var c=h.parse(a,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});c||(c=h.parse(a.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(c=h.parse(a.replace(" ",
" - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return c}})})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),function(m,e,g,h,d,k,l){return e("dojo.data.ItemFileWriteStore",k,{constructor:function(a){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||
(this._datatypeMap.Date.serialize=function(a){return l.toISOString(a,{zulu:!0})});a&&!1===a.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(a){if(!a)throw Error("assertion failed in ItemFileWriteStore");},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(a,c){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof a&&"undefined"!=typeof a)throw Error("newItem() was passed something other than an object");
var b=null,d=this._getIdentifierAttribute();if(d===Number)b=this._arrayOfAllItems.length;else{b=a[d];if("undefined"===typeof b)throw Error("newItem() was not passed an identity for the new item");if(m.isArray(b))throw Error("newItem() was not passed an single-valued identity");}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[b]);this._assert("undefined"===typeof this._pending._newItems[b]);this._assert("undefined"===typeof this._pending._deletedItems[b]);var f={};f[this._storeRefPropName]=
this;f[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[b]=f,f[d]=[b]);this._arrayOfAllItems.push(f);d=null;if(c&&c.parent&&c.attribute){var d={item:c.parent,attribute:c.attribute,oldValue:void 0},e=this.getValues(c.parent,c.attribute);if(e&&0<e.length){var k=e.slice(0,e.length);d.oldValue=1===e.length?e[0]:e.slice(0,e.length);k.push(f);this._setValueOrValues(c.parent,c.attribute,k,!1);d.newValue=this.getValues(c.parent,c.attribute)}else this._setValueOrValues(c.parent,
c.attribute,f,!1),d.newValue=f}else f[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(f);this._pending._newItems[b]=f;for(var g in a){if(g===this._storeRefPropName||g===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");b=a[g];m.isArray(b)||(b=[b]);f[g]=b;if(this.referenceIntegrity)for(e=0;e<b.length;e++)k=b[e],this.isItem(k)&&this._addReferenceToMap(k,f,g)}this.onNew(f,d);return f},_removeArrayElement:function(a,c){var b=g.indexOf(a,c);return-1!=b?(a.splice(b,
1),!0):!1},deleteItem:function(a){this._assert(!this._saveInProgress);this._assertIsItem(a);var c=a[this._itemNumPropName],b=this.getIdentity(a);if(this.referenceIntegrity){var d=this.getAttributes(a);a[this._reverseRefMap]&&(a["backup_"+this._reverseRefMap]=m.clone(a[this._reverseRefMap]));g.forEach(d,function(b){g.forEach(this.getValues(a,b),function(c){this.isItem(c)&&(a["backupRefs_"+this._reverseRefMap]||(a["backupRefs_"+this._reverseRefMap]=[]),a["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(c),
attr:b}),this._removeReferenceFromMap(c,a,b))},this)},this);if(d=a[this._reverseRefMap])for(var f in d){var e=null;if(e=this._itemsByIdentity?this._itemsByIdentity[f]:this._arrayOfAllItems[f])for(var k in d[f]){var l=this.getValues(e,k)||[],r=g.filter(l,function(a){return!(this.isItem(a)&&this.getIdentity(a)==b)},this);this._removeReferenceFromMap(a,e,k);r.length<l.length&&this._setValueOrValues(e,k,r,!0)}}}this._arrayOfAllItems[c]=null;a[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[b];
this._pending._deletedItems[b]=a;a[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,a);this.onDelete(a);return!0},setValue:function(a,c,b){return this._setValueOrValues(a,c,b,!0)},setValues:function(a,c,b){return this._setValueOrValues(a,c,b,!0)},unsetAttribute:function(a,c){return this._setValueOrValues(a,c,[],!0)},_setValueOrValues:function(a,c,b,d){this._assert(!this._saveInProgress);this._assertIsItem(a);this._assert(m.isString(c));this._assert("undefined"!==typeof b);
var f=this._getIdentifierAttribute();if(c==f)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var f=this._getValueOrValues(a,c),e=this.getIdentity(a);if(!this._pending._modifiedItems[e]){var k={},l;for(l in a)k[l]=l===this._storeRefPropName||l===this._itemNumPropName||l===this._rootItemPropName?a[l]:l===this._reverseRefMap?m.clone(a[l]):a[l].slice(0,a[l].length);this._pending._modifiedItems[e]=k}e=!1;if(m.isArray(b)&&0===b.length){if(e=delete a[c],
b=void 0,this.referenceIntegrity&&f){l=f;m.isArray(l)||(l=[l]);for(var r=0;r<l.length;r++)k=l[r],this.isItem(k)&&this._removeReferenceFromMap(k,a,c)}}else{e=m.isArray(b)?b.slice(0,b.length):[b];if(this.referenceIntegrity)if(f){l=f;m.isArray(l)||(l=[l]);var h={};g.forEach(l,function(a){this.isItem(a)&&(a=this.getIdentity(a),h[a.toString()]=!0)},this);g.forEach(e,function(b){if(this.isItem(b)){var f=this.getIdentity(b);h[f.toString()]?delete h[f.toString()]:this._addReferenceToMap(b,a,c)}},this);for(r in h)this._removeReferenceFromMap(this._itemsByIdentity?
this._itemsByIdentity[r]:this._arrayOfAllItems[r],a,c)}else for(r=0;r<e.length;r++)k=e[r],this.isItem(k)&&this._addReferenceToMap(k,a,c);a[c]=e;e=!0}if(d)this.onSet(a,c,f,b);return e},_addReferenceToMap:function(a,c,b){c=this.getIdentity(c);var d=a[this._reverseRefMap];d||(d=a[this._reverseRefMap]={});(a=d[c])||(a=d[c]={});a[b]=!0},_removeReferenceFromMap:function(a,c,b){c=this.getIdentity(c);var d=a[this._reverseRefMap],f;if(d){for(f in d)f==c&&(delete d[f][b],this._isEmpty(d[f])&&delete d[f]);this._isEmpty(d)&&
delete a[this._reverseRefMap]}},_dumpReferenceMap:function(){var a;for(a=0;a<this._arrayOfAllItems.length;a++){var c=this._arrayOfAllItems[a];c&&c[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(c)+"] is referenced by: "+h.toJson(c[this._reverseRefMap]))}},_getValueOrValues:function(a,c){var b=void 0;this.hasAttribute(a,c)&&(b=this.getValues(a,c),b=1==b.length?b[0]:b);return b},_flatten:function(a){if(this.isItem(a))return{_reference:this.getIdentity(a)};if("object"===typeof a)for(var c in this._datatypeMap){var b=
this._datatypeMap[c];if(m.isObject(b)&&!m.isFunction(b)){if(a instanceof b.type){if(!b.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+c+"]");return{_type:c,_value:b.serialize(a)}}}else if(a instanceof b)return{_type:c,_value:a.toString()}}return a},_getNewFileContentString:function(){var a={},c=this._getIdentifierAttribute();c!==Number&&(a.identifier=c);this._labelAttr&&(a.label=this._labelAttr);a.items=[];for(c=0;c<this._arrayOfAllItems.length;++c){var b=this._arrayOfAllItems[c];
if(null!==b){var d={},f;for(f in b)if(f!==this._storeRefPropName&&f!==this._itemNumPropName&&f!==this._reverseRefMap&&f!==this._rootItemPropName){var e=this.getValues(b,f);if(1==e.length)d[f]=this._flatten(e[0]);else for(var k=[],g=0;g<e.length;++g)k.push(this._flatten(e[g])),d[f]=k}a.items.push(d)}}return h.toJson(a,!0)},_isEmpty:function(a){var c=!0;if(m.isObject(a))for(var b in a){c=!1;break}else m.isArray(a)&&0<a.length&&(c=!1);return c},save:function(a){this._assert(!this._saveInProgress);this._saveInProgress=
!0;var c=this,b=function(){c._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};c._saveInProgress=!1;a&&a.onComplete&&a.onComplete.call(a.scope||d.global)},e=function(b){c._saveInProgress=!1;a&&a.onError&&a.onError.call(a.scope||d.global,b)};if(this._saveEverything){var f=this._getNewFileContentString();this._saveEverything(b,e,f)}this._saveCustom&&this._saveCustom(b,e);!this._saveEverything&&!this._saveCustom&&b()},revert:function(){this._assert(!this._saveInProgress);for(var a in this._pending._modifiedItems){var c=
this._pending._modifiedItems[a],b=null,b=this._itemsByIdentity?this._itemsByIdentity[a]:this._arrayOfAllItems[a];c[this._storeRefPropName]=this;for(var d in b)delete b[d];m.mixin(b,c)}var f;for(a in this._pending._deletedItems)f=this._pending._deletedItems[a],f[this._storeRefPropName]=this,c=f[this._itemNumPropName],f["backup_"+this._reverseRefMap]&&(f[this._reverseRefMap]=f["backup_"+this._reverseRefMap],delete f["backup_"+this._reverseRefMap]),this._arrayOfAllItems[c]=f,this._itemsByIdentity&&(this._itemsByIdentity[a]=
f),f[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(f);for(a in this._pending._deletedItems)f=this._pending._deletedItems[a],f["backupRefs_"+this._reverseRefMap]&&(g.forEach(f["backupRefs_"+this._reverseRefMap],function(a){this._addReferenceToMap(this._itemsByIdentity?this._itemsByIdentity[a.id]:this._arrayOfAllItems[a.id],f,a.attr)},this),delete f["backupRefs_"+this._reverseRefMap]);for(a in this._pending._newItems)c=this._pending._newItems[a],c[this._storeRefPropName]=null,this._arrayOfAllItems[c[this._itemNumPropName]]=
null,c[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,c),this._itemsByIdentity&&delete this._itemsByIdentity[a];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(a){return a?(a=this.getIdentity(a),(new Boolean(this._pending._newItems[a]||this._pending._modifiedItems[a]||this._pending._deletedItems[a])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},
onSet:function(a,c,b,d){},onNew:function(a,c){},onDelete:function(a){},close:function(a){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),
function(m,e,g,h,d,k,l,a,c){g=g("dojo.data.ItemFileReadStore",[k],{constructor:function(a){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=a.url;this._jsonData=a.data;this.data=null;this._datatypeMap=a.typeMap||{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(a){return c.fromISOString(a)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName=
"_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==a.urlPreventCache&&(this.urlPreventCache=a.urlPreventCache?!0:!1);void 0!==a.hierarchical&&(this.hierarchical=a.hierarchical?!0:!1);a.clearOnClose&&(this.clearOnClose=!0);"failOk"in a&&(this.failOk=a.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(a){if(!this.isItem(a))throw Error(this.declaredClass+
": Invalid item argument.");},_assertIsAttribute:function(a){if("string"!==typeof a)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(a,c,d){a=this.getValues(a,c);return 0<a.length?a[0]:d},getValues:function(a,c){this._assertIsItem(a);this._assertIsAttribute(c);return(a[c]||[]).slice(0)},getAttributes:function(a){this._assertIsItem(a);var c=[],d;for(d in a)d!==this._storeRefPropName&&(d!==this._itemNumPropName&&d!==this._rootItemPropName&&d!==this._reverseRefMap)&&
c.push(d);return c},hasAttribute:function(a,c){this._assertIsItem(a);this._assertIsAttribute(c);return c in a},containsValue:function(a,c,d){var e=void 0;"string"===typeof d&&(e=l.patternToRegExp(d,!1));return this._containsValue(a,c,d,e)},_containsValue:function(a,c,d,p){return h.some(this.getValues(a,c),function(a){if(null!==a&&!e.isObject(a)&&p){if(a.toString().match(p))return!0}else if(d===a)return!0})},isItem:function(a){return a&&a[this._storeRefPropName]===this&&this._arrayOfAllItems[a[this._itemNumPropName]]===
a?!0:!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(a){this._assertIsItem(a.item)},getFeatures:function(){return this._features},getLabel:function(a){if(this._labelAttr&&this.isItem(a))return this.getValue(a,this._labelAttr)},getLabelAttributes:function(a){return this._labelAttr?[this._labelAttr]:null},filter:function(a,c,d){var e=[],k,g;if(a.query){var r;k=a.queryOptions?a.queryOptions.ignoreCase:!1;var h={};for(g in a.query)r=a.query[g],"string"===typeof r?h[g]=l.patternToRegExp(r,
k):r instanceof RegExp&&(h[g]=r);for(k=0;k<c.length;++k){var m=!0,w=c[k];if(null===w)m=!1;else for(g in a.query)r=a.query[g],this._containsValue(w,g,r,h[g])||(m=!1);m&&e.push(w)}}else for(k=0;k<c.length;++k)g=c[k],null!==g&&e.push(g);d(e,a)},_fetchItems:function(a,c,f){var p=this;if(this._loadFinished)this.filter(a,this._getItemsArray(a.queryOptions),c);else if(this._jsonFileUrl!==this._ccUrl?(m.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),
this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:a,filter:e.hitch(p,"filter"),findCallback:e.hitch(p,c)});else{this._loadInProgress=!0;var k=d.get({url:p._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});k.addCallback(function(d){try{p._getItemsFromLoadedData(d),
p._loadFinished=!0,p._loadInProgress=!1,p.filter(a,p._getItemsArray(a.queryOptions),c),p._handleQueuedFetches()}catch(e){p._loadFinished=!0,p._loadInProgress=!1,f(e,a)}});k.addErrback(function(c){p._loadInProgress=!1;f(c,a)});var g=null;a.abort&&(g=a.abort);a.abort=function(){k&&-1===k.fired&&k.cancel();g&&g.call(a)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,p.filter(a,this._getItemsArray(a.queryOptions),c)}catch(r){f(r,a)}else f(Error(this.declaredClass+
": No JSON source data was provided as either URL or a nested Javascript object."),a)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var a=0;a<this._queuedFetches.length;a++){var c=this._queuedFetches[a],d=c.args,e=c.filter,c=c.findCallback;e?e(d,this._getItemsArray(d.queryOptions),c):this.fetchItemByIdentity(d)}this._queuedFetches=[]}},_getItemsArray:function(a){return a&&a.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(a){this.clearOnClose&&(this._loadFinished&&
!this._loadInProgress)&&((""==this._jsonFileUrl||null==this._jsonFileUrl)&&(""==this.url||null==this.url)&&null==this.data&&console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(a){function c(a){return null!==
a&&"object"===typeof a&&(!e.isArray(a)||p)&&!e.isFunction(a)&&(a.constructor==Object||e.isArray(a))&&"undefined"===typeof a._reference&&"undefined"===typeof a._type&&"undefined"===typeof a._value&&k.hierarchical}function d(a){k._arrayOfAllItems.push(a);for(var b in a){var p=a[b];if(p)if(e.isArray(p))for(var g=0;g<p.length;++g){var r=p[g];c(r)&&d(r)}else c(p)&&d(p)}}var p=!1,k=this;this._labelAttr=a.label;var g,r;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=a.items;for(g=0;g<this._arrayOfTopLevelItems.length;++g)r=
this._arrayOfTopLevelItems[g],e.isArray(r)&&(p=!0),d(r),r[this._rootItemPropName]=!0;var l={},h;for(g=0;g<this._arrayOfAllItems.length;++g)for(h in r=this._arrayOfAllItems[g],r){if(h!==this._rootItemPropName){var m=r[h];null!==m?e.isArray(m)||(r[h]=[m]):r[h]=[null]}l[h]=h}for(;l[this._storeRefPropName];)this._storeRefPropName+="_";for(;l[this._itemNumPropName];)this._itemNumPropName+="_";for(;l[this._reverseRefMap];)this._reverseRefMap+="_";if(l=a.identifier){this._itemsByIdentity={};this._features["dojo.data.api.Identity"]=
l;for(g=0;g<this._arrayOfAllItems.length;++g)if(r=this._arrayOfAllItems[g],a=r[l],a=a[0],Object.hasOwnProperty.call(this._itemsByIdentity,a)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+l+"].  Value collided: ["+a+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+
l+"].  Value collided: ["+a+"]");}else this._itemsByIdentity[a]=r}else this._features["dojo.data.api.Identity"]=Number;for(g=0;g<this._arrayOfAllItems.length;++g)r=this._arrayOfAllItems[g],r[this._storeRefPropName]=this,r[this._itemNumPropName]=g;for(g=0;g<this._arrayOfAllItems.length;++g)for(h in r=this._arrayOfAllItems[g],r){a=r[h];for(l=0;l<a.length;++l)if(m=a[l],null!==m&&"object"==typeof m){if("_type"in m&&"_value"in m){var v=m._type,x=this._datatypeMap[v];if(x)if(e.isFunction(x))a[l]=new x(m._value);
else if(e.isFunction(x.deserialize))a[l]=x.deserialize(m._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+v+"'");}if(m._reference){m=m._reference;if(e.isObject(m))for(v=0;v<this._arrayOfAllItems.length;++v){var x=this._arrayOfAllItems[v],B=!0,D;for(D in m)x[D]!=m[D]&&
(B=!1);B&&(a[l]=x)}else a[l]=this._getItemByIdentity(m);this.referenceIntegrity&&(m=a[l],this.isItem(m)&&this._addReferenceToMap(m,r,h))}else this.isItem(m)&&this.referenceIntegrity&&this._addReferenceToMap(m,r,h)}}},_addReferenceToMap:function(a,c,d){},getIdentity:function(a){var c=this._features["dojo.data.api.Identity"];return c===Number?a[this._itemNumPropName]:(a=a[c])?a[0]:null},fetchItemByIdentity:function(a){var c,f;if(this._loadFinished)c=this._getItemByIdentity(a.identity),a.onItem&&(f=
a.scope?a.scope:m.global,a.onItem.call(f,c));else{var e=this;this._jsonFileUrl!==this._ccUrl?(m.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:a}):
(this._loadInProgress=!0,f=d.get({url:e._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),f.addCallback(function(d){var f=a.scope?a.scope:m.global;try{e._getItemsFromLoadedData(d),e._loadFinished=!0,e._loadInProgress=!1,c=e._getItemByIdentity(a.identity),a.onItem&&a.onItem.call(f,c),e._handleQueuedFetches()}catch(k){e._loadInProgress=!1,a.onError&&a.onError.call(f,k)}}),f.addErrback(function(c){e._loadInProgress=!1;a.onError&&a.onError.call(a.scope?
a.scope:m.global,c)})):this._jsonData&&(e._getItemsFromLoadedData(e._jsonData),e._jsonData=null,e._loadFinished=!0,c=e._getItemByIdentity(a.identity),a.onItem&&(f=a.scope?a.scope:m.global,a.onItem.call(f,c)))}},_getItemByIdentity:function(a){var c=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,a)&&(c=this._itemsByIdentity[a]):Object.hasOwnProperty.call(this._arrayOfAllItems,a)&&(c=this._arrayOfAllItems[a]);void 0===c&&(c=null);return c},getIdentityAttributes:function(a){a=
this._features["dojo.data.api.Identity"];return a===Number?null:[a]},_forceLoad:function(){var a=this;this._jsonFileUrl!==this._ccUrl?(m.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var c=d.get({url:this._jsonFileUrl,
handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});c.addCallback(function(c){try{if(!0!==a._loadInProgress&&!a._loadFinished)a._getItemsFromLoadedData(c),a._loadFinished=!0;else if(a._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(d){throw console.log(d),d;}});c.addErrback(function(a){throw a;})}else this._jsonData&&(a._getItemsFromLoadedData(a._jsonData),a._jsonData=null,a._loadFinished=
!0)}});e.extend(g,a);return g})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(m){var e={};m.setObject("dojo.data.util.filter",e);e.patternToRegExp=function(e,h){for(var d="^",k=null,l=0;l<e.length;l++)switch(k=e.charAt(l),k){case "\\":d+=k;l++;d+=e.charAt(l);break;case "*":d+=".*";break;case "?":d+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":d+="\\";default:d+=k}d+="$";return h?RegExp(d,"mi"):RegExp(d,
"m")};return e})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(m,e,g){var h={};m.setObject("dojo.data.util.simpleFetch",h);h.errorHandler=function(d,k){k.onError&&k.onError.call(k.scope||e.global,d,k)};h.fetchHandler=function(d,k){var l=k.abort||null,a=!1,c=k.start?k.start:0,b=k.count&&Infinity!==k.count?c+k.count:d.length;k.abort=function(){a=!0;l&&l.call(k)};var n=k.scope||e.global;k.store||(k.store=this);k.onBegin&&k.onBegin.call(n,
d.length,k);k.sort&&d.sort(g.createSortFunction(k.sort,this));if(k.onItem)for(var f=c;f<d.length&&f<b;++f){var p=d[f];a||k.onItem.call(n,p,k)}k.onComplete&&!a&&(f=null,k.onItem||(f=d.slice(c,b)),k.onComplete.call(n,f,k))};h.fetch=function(d){d=d||{};d.store||(d.store=this);this._fetchItems(d,m.hitch(this,"fetchHandler"),m.hitch(this,"errorHandler"));return d};return h})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(m){var e={};m.setObject("dojo.data.util.sorter",e);e.basicComparator=
function(e,h){var d=-1;null===e&&(e=void 0);null===h&&(h=void 0);if(e==h)d=0;else if(e>h||null==e)d=1;return d};e.createSortFunction=function(g,h){function d(a,b,c,d){return function(f,e){var n=d.getValue(f,a),k=d.getValue(e,a);return b*c(n,k)}}for(var k=[],l,a=h.comparatorMap,c=e.basicComparator,b=0;b<g.length;b++){l=g[b];var n=l.attribute;if(n){l=l.descending?-1:1;var f=c;a&&("string"!==typeof n&&"toString"in n&&(n=n.toString()),f=a[n]||c);k.push(d(n,l,f,h))}}return function(a,b){for(var c=0;c<
k.length;){var d=k[c++](a,b);if(0!==d)return d}return 0}};return e})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(m,e,g){return m(null,{constructor:function(){this.panelManager=g.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(e){},getConfigById:function(e){for(var d=this.getAllConfigs(),
k=0;k<d.length;k++)if(d[k].id===e)return d[k]},getAllConfigs:function(){var g=[],g=g.concat(this.getWidgetConfigs(),this.getGroupConfigs()),g=e.filter(g,function(d){return d.visible});return g.sort(function(d,e){return d.index-e.index})},getAllConfigsIncludeInvisible:function(){var e=[],e=e.concat(this.getWidgetConfigs(),this.getGroupConfigs());return e.sort(function(d,e){return d.index-e.index})},isControlled:function(g){return e.some(this.getAllConfigsIncludeInvisible(),function(d){return d.id===
g})},widgetIsControlled:function(g){return e.some(this.getAllConfigsIncludeInvisible(),function(d){return d.id===g?!0:e.some(d.widgets,function(d){return d.id===g})})},getGroupConfigs:function(){var g=[];if(!this.appConfig.widgetPool)return g;this.appConfig.widgetPool.groups&&e.forEach(this.appConfig.widgetPool.groups,function(d){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(d.id)&&g.push(d):"all"===this.controlledGroups&&g.push(d))},this);return g},
getWidgetConfigs:function(){var g=[];if(!this.appConfig.widgetPool)return g;this.appConfig.widgetPool.widgets&&e.forEach(this.appConfig.widgetPool.widgets,function(d){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(d.id)&&g.push(d):"all"===this.controlledWidgets&&g.push(d))},this);return g}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),
function(m,e,g,h,d,k,l,a){var c=null,b=null,n=!1;m=m(null,function(){});var f=require.toUrl("jimu"),p=k(f+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),t=k(f+"/SpatialReference/transform.json",{handleAs:"json"});m.loadResource=function(){var a=new h;if(c&&b)return a.resolve(),a;d([p,t]).then(function(d){c=d[0];b=d[1];n=!0;a.resolve()},function(b){console.error(b);n=!1;a.reject(b)});return a};m.getAllCSUnits=function(){if(n){var a=[];g.forEach(c.wkids,e.hitch(this,function(b){b=this.getCSUnit(b);
-1===g.indexOf(a,b)&&a.push(b)}));return a}};m.convertUnit=function(b,c,d){if(n)return a.convertUnit(b,c,d)};m.getUnitRate=function(b,c){if(n)return a.getUnitRate(b,c)};m.isProjectUnit=function(b){if(n)return a.isProjectUnit(b)};m.isGeographicUnit=function(b){if(n)return a.isGeographicUnit(b)};m.getGeographicUnits=function(){if(n)return a.getGeographicUnits()};m.getProjectUnits=function(){if(n)return a.getProjectUnits()};m.getCSUnit=function(a){if(n){a=this.getCSStr(a);var b=0,c=0,b=a.lastIndexOf("UNIT"),
c=a.indexOf(",",b);return a.slice(b+6,c-1)}};m.isSameSR=function(a,b){if(n){var d=this.indexOfWkid(a),f=this.indexOfWkid(b);return c.labels[d]===c.labels[f]}};m.isValidWkid=function(a){if(n)return-1<this.indexOfWkid(a)};m.getSRLabel=function(a){if(n&&this.isValidWkid(a))return a=this.indexOfWkid(a),c.labels[a]};m.indexOfWkid=function(a){if(n)return g.indexOf(c.wkids,a)};m.isWebMercator=function(a){return l.prototype._isWebMercator?l.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new l(parseInt(a,
10))).isWebMercator()};m.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};m.isValidTfWkid=function(a){if(n)return-1<this.indexOfTfWkid(a)};m.getTransformationLabel=function(a){if(n)return this.isValidTfWkid(a)?(a=this.indexOfTfWkid(a),b.labels[a]):""};m.indexOfTfWkid=function(a){if(n)return g.indexOf(b.tfWkids,a)};m.isGeographicCS=function(a){if(n)return this.isValidWkid(a)?c.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};m.isProjectedCS=function(a){if(n)return this.isValidWkid(a)?
c.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};m.getGeoCSByProj=function(a){if(n&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=g.indexOf(c.details,a),c.wkids[a]};m.getSpheroidStr=function(a){if(n){if(this.isGeographicCS(a))return c.details[this.indexOfWkid(a)];if(this.isProjectedCS(a)){a=c.details[this.indexOfWkid(a)];var b=a.indexOf("GEOGCS"),d=a.indexOf("PROJECTION")-1;return a.slice(b,d)}return null}};m.getCSStr=function(a){if(n)return c.details[this.indexOfWkid(a)]};m.isSameSpheroid=
function(a,b){if(n){var c=this.getSpheroidStr(a),d=this.getSpheroidStr(b);return c&&d&&c===d?!0:!1}};return m})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(m,e){var g="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
h="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),d={INCHES:0.0254,FOOT:0.3048,FOOT_US:0.3048006096012192,YARDS:0.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:0.0010,CENTIMETERS:0.01,METER:1,KILOMETERS:1E3,DECIMETERS:0.1,LINK_CLARKE:0.2011661949,FOOT_GOLD_COAST:0.3047997101815088,FOOT_CLARKE:0.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:0.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:0.9143984146160287,CHAIN_SEARS:20.11676512155263,
FOOT_SEARS:0.3047994715386762,YARD_INDIAN_1937:0.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:0.0174532925199433,DECIMAL_DEGREES:0.0174532925199433,MGRS:0.0174532925199433,USNG:0.0174532925199433,DEGREE_MINUTE_SECONDS:0.0174532925199433,GRAD:0.01570796326794897},k=m(null,function(){});k.convertUnit=function(e,a,c){return d[e.toUpperCase()]/d[a.toUpperCase()]*c};k.getUnitRate=function(e,a){return d[e.toUpperCase()]/d[a.toUpperCase()]};k.isProjectUnit=function(d){return-1<e.indexOf(g,d.toUpperCase())};
k.isGeographicUnit=function(d){return-1<e.indexOf(h,d.toUpperCase())};k.getGeographicUnits=function(){return h};k.getProjectUnits=function(){return g};return k})},"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/_base/unload dojo/Evented dojo/promise/all ./LayerInfoFactory".split(" "),function(m,e,g,h,d,k,l,a,c,b){var n=m([a],{map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,_tableInfos:null,_finalTableInfos:null,
_basemapLayers:null,constructor:function(a,b){this._basemapLayers=b.baseMap.baseMapLayers;this._operLayers=b.operationalLayers;this.tables=b.tables;this.map=a;this._initLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();this._clearAddedFlag(this._layerinfos);this._initFinalTableInfos();this._initFinalLayerInfos(this._layerinfos);this._markFirstOrLastNode()},getLayerInfoArray:function(){return this._finalLayerInfos},getTableInfoArray:function(){return this._finalTableInfos},
addFeatureCollection:function(a,c){var d=this._getUniqueTopLayerInfoId(c),f={layers:[]};e.forEach(a,function(a,b){a.id=d+"_"+b;f.layers.push({id:a.id,layerObject:a})},this);this.map.addLayers(a);var n;try{n=b.getInstance().create({featureCollection:f,title:c||d,id:d},this.map),n.init()}catch(p){console.warn(p.message),n=null}n&&(this._layerinfos.push(n),this.update(),this._onUpdated())},addTable:function(a){var b=[];a=this._addTable(a,this._finalTableInfos);this._tableInfos.push(a);b.push(a);this._onTableChange(b,
"added")},_addTable:function(a,c){var d;try{a.empty=!0,d=b.getInstance().create({layerObject:a,title:a.title,id:this._getUniqueTableId(a.id),selfType:"table"}),d.init()}catch(f){console.warn(f.message),d=null}d&&c&&c.push(d);return d},_getUniqueTableId:function(a){var b=this._tableInfos.concat(this._finalTableInfos||[]);return this._getUniqueLayerOrTableId(a,b)},_getUniqueTopLayerInfoId:function(a){return this._getUniqueLayerOrTableId(a,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(a,
b){var c=1,d;a||(a="table");for(d=a;;){for(var f=0;f<b.length&&b[f].id!==d;f++);if(f===b.length)return d;d=a+"_"+c.toString();c++}},removeTable:function(){},traversal:function(a){for(var b=this.getLayerInfoArray(),c=0;c<b.length;c++)if(b[c].traversal(a))return!0},getLayerInfoById:function(a){return this._findLayerInfoById(a)},moveUpLayer:function(a){var b=null,c;a=this._getTopLayerInfoIndexById(a);0<a&&(b=this._finalLayerInfos[a-1].obtainLayerIndexesInMap().length,this._finalLayerInfos[a].moveRightOfIndex(this._finalLayerInfos[a-
1].obtainLayerIndexesInMap()[b-1].index),b=this._finalLayerInfos[a-1].id,c=this._finalLayerInfos[a],this._finalLayerInfos.splice(a,1),this._finalLayerInfos.splice(a-1,0,c),this._markFirstOrLastNode());return b},moveDownLayer:function(a){var b=null,c=this._getTopLayerInfoIndexById(a);c<this._finalLayerInfos.length-1&&(this._finalLayerInfos[c].moveLeftOfIndex(this._finalLayerInfos[c+1].obtainLayerIndexesInMap()[0].index),b=this._finalLayerInfos[c+1].id,a=this._finalLayerInfos[c+1],this._finalLayerInfos.splice(c+
1,1),this._finalLayerInfos.splice(c,0,a),this._markFirstOrLastNode());return b},getBasemapLayers:function(){var a=[];e.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);("basemap"===b._basemapGalleryLayerType||"reference"===b._basemapGalleryLayerType)&&a.push(b)},this);0===a.length&&(a=this._basemapLayers);return a},getMapNotesLayerInfoArray:function(){return e.filter(this.getLayerInfoArray(),function(a){return a.originOperLayer.featureCollection&&0===a.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===
a.originOperLayer.layerType&&!this.map.getLayer(a.id)},this)},_initLayerInfos:function(){var a;this._layerinfos=[];e.forEach(this._operLayers,function(c){try{a=b.getInstance().create(c),a.init()}catch(d){console.warn(d.message),a=null}a&&this._layerinfos.push(a)},this)},_extraSetLayerInfos:function(){e.forEach(this._layerinfos,function(a,c){var d;if("esri.layers.GeoRSSLayer"===a.layerObject.declaredClass||"esri.layers.KMLLayer"===a.layerObject.declaredClass){try{d=b.getInstance().create(a.originOperLayer),
d.init()}catch(f){console.warn(f.message),d=null}d&&(a.destroyLayerInfo(),this._layerinfos[c]=d)}else if(a.originOperLayer.featureCollection){var n=[];e.forEach(a.getSubLayers(),function(a){n.push(a.id)});e.forEach(n,function(b){this.map.getLayer(b)||a.removeSubLayerById(b)},this);1===a.getSubLayers().length&&(d=a.getSubLayers()[0],this.map.getLayer(d.id).title=a.title,a.removeSubLayerById(d.id))}},this)},_initFinalLayerInfos:function(a){var b,c;this._finalLayerInfos=[];for(b=this.map.graphicsLayerIds.length-
1;0<=b;b--)c=this.map.graphicsLayerIds[b],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,a),c,!0);for(b=this.map.layerIds.length-1;0<=b;b--)c=this.map.layerIds[b],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,a),c,!1)},_isBasemap:function(a){for(var b=!1,c=this.getBasemapLayers(),d=0;d<c.length;d++)c[d].id===a&&(b=!0);return b},_addToFinalLayerInfos:function(a,c,d){var f;if(a)!a._addedFlag&&a.isGraphicLayer()===
d&&(this._finalLayerInfos.push(a),a._addedFlag=!0);else{a=this.map.getLayer(c);if("esri.layers.GraphicsLayer"!==a.declaredClass&&"labels"!==a.id){try{f=b.getInstance().create({layerObject:a,title:this._getLayerTitle(a),id:a.id||" "},this.map),f.init()}catch(n){console.warn(n.message),f=null}f&&this._finalLayerInfos.push(f)}("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass)&&f&&f._getLayerDefinition().then(g.hitch(this,function(a){var b=
[];e.forEach(a.tables,function(a){a.url=f.getUrl()+"/"+a.id;a.id=f.id+"_"+a.id;a.title=this._getLayerTitle(a);(a=this._addTable(a,this._finalTableInfos))&&b.push(a)},this);this._onTableChange(b,"added")}))}},_getLayerTitle:function(a){var b=a.label||a.title||a.name||"";if(a.url){var c;c=a.url.indexOf("rest/services/");-1<c&&(c=a.url.substring(c+14).split("/")[0],b=b?c+" - "+b:c)}return b||a.id},_findLayerInfoByIdAndReturnTopLayer:function(a,b){var c,d=null;b||(b=this._finalLayerInfos);for(c=0;c<b.length;c++)if(d=
b[c].findLayerInfoById(a)){d=b[c];break}return d},_findLayerInfoById:function(a,b){var c,d=null;b||(b=this._finalLayerInfos);for(c=0;c<b.length&&!(d=b[c].findLayerInfoById(a));c++);return d},_findTopLayerInfoById:function(a){var b,c=null,d=this._finalLayerInfos;for(b=0;b<d.length;b++)if(d[b].id===a){c=d[b];break}return c},_getTopLayerInfoIndexById:function(a){var b,c=-1;for(b=0;b<this._finalLayerInfos.length;b++)if(this._finalLayerInfos[b].id===a){c=b;break}return c},_clearAddedFlag:function(a){e.forEach(a,
function(a){a._addedFlag=!1})},_markFirstOrLastNode:function(){var a;if(this._finalLayerInfos.length){for(a=0;a<this._finalLayerInfos.length;a++)this._finalLayerInfos[a].isFirst=!1,this._finalLayerInfos[a].isLast=!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(a=0;a<this._finalLayerInfos.length;a++)if(!this._finalLayerInfos[a].isGraphicLayer()){a&&(this._finalLayerInfos[a-1].isLast=!0);this._finalLayerInfos[a].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(a,
b,c){"BasemapGallery"===a&&(this._basemapLayers.length=0,e.forEach(c,g.hitch(this,function(a){this._basemapLayers.push({layerObject:a,id:a.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(a){var b;for(b=this._basemapLayers.length=0;b<a.layers.length;b++)this._basemapLayers.push({layerObject:a.layer[b],id:a.layers[b].id})},_destroyLayerInfos:function(){e.forEach(this.getLayerInfoArray(),g.hitch(this,function(a){a.destroyLayerInfo()}))},_bindEvents:function(){var a,
b,c,f,e;a=d(this.map,"layer-add-result",g.hitch(this,this._onLayersChange,"added"));b=d(this.map,"layer-remove",g.hitch(this,this._onLayersChange,"removed"));f=k.subscribe("layerInfos/layerInfo/isShowInMapChanged",g.hitch(this,this._onShowInMapChanged));e=k.subscribe("layerInfos/layerInfo/visibleChanged",g.hitch(this,this._onVisibleChanged));c=d(this.map,"before-unload",g.hitch(this,function(){a.remove();b.remove();f.remove();e.remove();this._destroyLayerInfos()}));l.addOnUnload(function(){a.remove();
b.remove();c.remove();f.remove();e.remove()})},_onLayersChange:function(a,b){var c=null,d;!b.error&&("esri.layers.GraphicsLayer"!==b.layer.declaredClass&&!b.layer._basemapGalleryLayerType)&&("added"===a?(this.update(),c=this._findTopLayerInfoById(b.layer.id),d=this._findLayerInfoById(b.layer.id)):(c=this._findTopLayerInfoById(b.layer.id),d=this._findLayerInfoById(b.layer.id),this.update()),this.emit("layerInfosChanged",c,a,d))},_onShowInMapChanged:function(a){this.emit("layerInfosIsShowInMapChanged",
a)},_onVisibleChanged:function(a){this.emit("layerInfosIsVisibleChanged",a)},_initTablesInfos:function(){this._tableInfos=[];e.forEach(this.tables,function(a){this._addTable(a,this._tableInfos)},this)},_initFinalTableInfos:function(){this._finalTableInfos=[];e.forEach(this._tableInfos,function(a){this._finalTableInfos.push(a)},this)},_onTableChange:function(a,b){this.emit("tableInfosChanged",a,b)},_onUpdated:function(){this.emit("updated")}});n.getLayerInfoArrayByType=function(a,b){var d=new h,f=
[],p=[];n.getInstance(a,a.iteminfo).then(function(a){a.traversal(function(a){var b=a.getLayerType();b.layerInfo=a;f.push(b)});c(f).then(function(a){e.forEach(a,function(a,c){b===a&&p.push(f[c].layerInfo)});d.resolve(p)})});return d};var f=!0,p=null,t=null,s=new h;n.getInstance=function(a,c){p&&p!==a&&(f=!0,t=p=null,s=new h);t?s.resolve(t):f&&(f=!1,b.getInstance(a).init().then(g.hitch(this,function(){var b=new n(a,c.itemData);p=a;t=b;s.resolve(b)})));return s};return n})},"jimu/LayerInfos/LayerInfoFactory":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/Deferred"],function(m,e,g){var h=null,d=m(null,{constructor:function(){},init:function(){var d=new g;require("jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForGroup jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream".split(" "),
e.hitch(this,function(e,a,c,b,n,f,p,g,h,r,q,m,w){this.LayerInfoForCollection=e;this.LayerInfoForMapService=a;this.LayerInfoForKML=c;this.LayerInfoForGeoRSS=b;this.LayerInfoForDefault=n;this.LayerInfoForWMS=f;this.LayerInfoForGroup=p;this.LayerInfoForDefaultDynamic=g;this.LayerInfoForDefaultTile=h;this.LayerInfoForDefaultWMS=r;this.LayerInfoForDefaultTable=q;this.LayerInfoForDefaultImage=m;this.LayerInfoForDefaultStream=w;d.resolve()}));return d},create:function(d){if(d.featureCollection)return new this.LayerInfoForCollection(d,
this.map);if("esri.layers.KMLLayer"===d.layerObject.declaredClass)return new this.LayerInfoForKML(d,this.map);if("esri.layers.GeoRSSLayer"===d.layerObject.declaredClass)return new this.LayerInfoForGeoRSS(d,this.map);if("esri.layers.WMSLayer"===d.layerObject.declaredClass&&!d.selfType)return new this.LayerInfoForWMS(d,this.map);if("esri.layers.ArcGISDynamicMapServiceLayer"===d.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===d.layerObject.declaredClass)return new this.LayerInfoForMapService(d,
this.map);if("esri.layers.ArcGISImageServiceLayer"===d.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===d.layerObject.declaredClass)return new this.LayerInfoForDefaultImage(d,this.map);if("esri.layers.StreamLayer"===d.layerObject.declaredClass)return new this.LayerInfoForDefaultStream(d,this.map);"Table"===d.layerObject.type&&(d.selfType="table");switch(d.selfType){case "mapservice_dynamic_group":return new this.LayerInfoForGroup(d,this.map);case "mapservice_tiled_group":return new this.LayerInfoForGroup(d,
this.map,!0);case "mapservice_dynamic":return new this.LayerInfoForDefaultDynamic(d,this.map);case "mapservice_tiled":return new this.LayerInfoForDefaultTile(d,this.map);case "wms":return new this.LayerInfoForDefaultWMS(d,this.map);case "table":return new this.LayerInfoForDefaultTable(d,this.map);default:return new this.LayerInfoForDefault(d,this.map)}}});d.getInstance=function(e){null===h&&(h=new d);e&&(h.map=e);return h};return d})},"jimu/dijit-all":function(){define([],1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),
function(m,e,g,h,d,k,l,a){return m(e,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){l.create("div",{"class":"jimu-radio-inner"},this.domNode);this.checked&&k.add(this.domNode,"jimu-radio-checked");this.own(d(this.domNode,"click",g.hitch(this,function(){this.checked||this.check()})))},check:function(a){void 0===a&&(a=!0);this.checked=!0;k.add(this.domNode,"jimu-radio-checked");a&&this._changeOthersState(!1);this.onStateChange()},
uncheck:function(a){void 0===a&&(a=!0);this.checked=!1;k.remove(this.domNode,"jimu-radio-checked");a&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(c){null!==this.group&&h.forEach(a.toArray(),function(a){a.id!==this.id&&(a["class"]===this["class"]&&a.group===this.group)&&(c?a.check(!1):a.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/Evented".split(" "),
function(m,e,g,h,d,k){return m([e,k],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,status:!0,postCreate:function(){this.checkNode=h.create("div",{"class":"checkbox jimu-float-leading"},this.domNode);this.label&&(this.labelNode=h.create("div",{"class":"label jimu-float-leading",innerHTML:this.label},this.domNode));this.checked&&h.addClass(this.checkNode,"checked");this.own(d(this.checkNode,"click",g.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})));
this.label&&this.own(d(this.labelNode,"click",g.hitch(this,function(){this.checked&&this.status?this.uncheck():this.status&&this.check()})))},setValue:function(d){this.status&&(!0===d?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(d){d=!!d;var a=this.status!==d;this.status=d;a&&this.emit("status-change",d);this.labelNode&&(this.status?h.setStyle(this.labelNode,"color","#000000"):h.setStyle(this.labelNode,"color","#818181"))},check:function(){this.status&&
(this.checked=!0,h.addClass(this.checkNode,"checked"),this.onStateChange())},uncheck:function(d){if(this.status&&(this.checked=!1,h.removeClass(this.checkNode,"checked"),!d))this.onStateChange()},onStateChange:function(){if(this.onChange&&g.isFunction(this.onChange))this.onChange(this.checked)}})})},"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr jimu/utils jimu/symbolUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font dijit/form/Select dijit/form/NumberSpinner jimu/dijit/ColorPicker jimu/dijit/_Transparency".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w,v,x){return m([e,g,h,k],{templateString:d,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,symbol:null,type:null,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser},postCreate:function(){this.inherited(arguments);this.own(b(document.body,"click",l.hitch(this,this._onBodyClicked)));(this._isIE8=
8===n("ie"))&&a.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(a){this.reset();var b=a&&a.declaredClass;b&&("string"===typeof b&&0<=b.indexOf("esri.symbol"))&&(this.symbol=this._cloneSymbol(a),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?
(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(a){this.reset();if("marker"===a||"line"===a||"fill"===a||"text"===a)this.type=a,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===this.type&&this._initTextSection()},getSymbol:function(){var a=
null;"marker"===this.type?a=this._getPointSymbolBySetting():"line"===this.type?a=this._getLineSymbolBySetting():"fill"===this.type?a=this._getFillSymbolBySetting():"text"===this.type&&(a=this._getTextSymbolBySetting());var b=null;a&&(b=this._cloneSymbol(a));return b},_onBodyClicked:function(a){a=a.target||a.srcElement;this._tryHideDropDownOfSelectDijit(a,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(a,this.lineStylesSelect)},_tryHideDropDownOfSelectDijit:function(b,c){var d=c.domNode,
f=c.dropDown.domNode,d=b===d||a.isDescendant(b,d),f=b===f||a.isDescendant(b,f);if(!d&&!f)c.dropDown.onCancel()},_onChange:function(a){a=this._cloneSymbol(a);this.emit("change",a)},_hideAllSections:function(){f(".symbol-section",this.domNode).style("display","none")},_showSection:function(a){this._hideAllSections();f("."+a+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(a,b,c){return t.getAncestorDom(a,b,c)},_getAbsoluteUrl:function(a){return window.location.protocol+
"//"+window.location.host+require.toUrl(a)},_cloneSymbol:function(a){if(!a)return null;var b=a;try{var c=a.toJson(),b=r.fromJson(c)}catch(d){console.error(d)}return b},_createSymbolIconTable:function(b,d,e){var n=this.type+"-icon-table";b=a.toDom('\x3ctable class\x3d"'+("icon-table "+n+" "+(n+"-"+b))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');for(var n=f("tbody",b)[0],p=Math.ceil(d.length/8),k=0;k<p;k++)a.create("tr",{},n);var g=f("tr",b);c.forEach(d,l.hitch(this,function(b,c){var d=l.clone(b),
f=r.fromJson(b),n=a.create("td",{},g[Math.floor(c/8)]);a.addClass(n,"symbol-td-item");f=this._createSymbolNode(f);a.addClass(f,"symbol-div-item");var p=f.firstChild;a.addClass(p,"svg-node");if(this._isIE8&&"point"===e)if(window.isRTL){if("Cross"===b.name||"X"===b.name)a.setStyle(p,"right","-20px"),a.setStyle(f,"marginTop","20px")}else("Cross"===b.name||"X"===b.name)&&a.setStyle(f,"marginTop","20px");f.symbol=d;a.place(f,n)}));return b},_updatePreview:function(b){var c=this._cloneSymbol(this.symbol);
a.empty(b);(c=s.createSymbolNode(c))||(c=a.create("div"));a.place(c,b)},_createSymbolNode:function(b){(b=s.createSymbolNode(b,{width:36,height:36}))||(b=a.create("div"));a.setStyle(b,{width:"36px",height:"36px"});return b},_getLineShapeDesc:function(a){var b=null;if(this.isSimpleLineSymbol(a)||this.isCartographicLineSymbol(a))b={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:a.getStroke()};return b},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||
(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new q({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(b(this.pointIconTables,
".symbol-div-item:click",l.hitch(this,this._onPointSymIconItemClick)));this.own(b(this.pointSymClassSelect,"Change",l.hitch(this,this._onPointSymClassSelectChange)));this.own(b(this.pointSize,"change",l.hitch(this,this._onPointSymbolChange)));this.own(b(this.pointColor,"change",l.hitch(this,this._onPointSymbolChange)));this.own(b(this.pointAlpha,"change",l.hitch(this,this._onPointSymbolChange)));this.own(b(this.pointOutlineColor,"change",l.hitch(this,this._onPointSymbolChange)));this.own(b(this.pointOutlineWidth,
"change",l.hitch(this,this._onPointSymbolChange)))},_onPointSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(),this._onChange(this.symbol))},_initPointSettings:function(a){if(a){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(a)){if(this.pointSize.set("value",a.size),this.pointColor.setColor(a.color),this.pointAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a=a.outline)this.pointOutlineColor.setColor(a.color),this.pointOutlineWidth.set("value",parseFloat(a.width.toFixed(0)))}else this.isPictureMarkerSymbol(a)&&
this.pointSize.set("value",a.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(a){return a&&"esri.symbol.SimpleMarkerSymbol"===a.declaredClass},isPictureMarkerSymbol:function(a){return a&&"esri.symbol.PictureMarkerSymbol"===a.declaredClass},_onPointSymClassSelectChange:function(){this._showSelectedPointSymIconTable();var a=this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+a]||this._requestPointSymJson(a)},_showSelectedPointSymIconTable:function(){var a=this.pointSymClassSelect.get("value");
f(".marker-icon-table",this.pointIconTables).style("display","none");a=f(".marker-icon-table-"+a,this.pointIconTables);0<a.length&&a.style("display","table")},_requestPointSymJson:function(b){var c="def"+b,d=this.pointSymClassSelect[c];d||(d=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json"),d=p(d,{handleAs:"json"}),this.pointSymClassSelect[c]=d,d.then(l.hitch(this,function(c){c=this._createSymbolIconTable(b,c,"point");a.place(c,this.pointIconTables);this._showSelectedPointSymIconTable()}),
l.hitch(this,function(a){console.error("get point symbol failed",a)})))},_onPointSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return a.hasClass(b,"symbol-div-item")},5))if(f(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(b,"selected-symbol-div-item"),b=b.symbol){this.symbol=r.fromJson(b);b=a.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():
this._showPictureMarkerSymSettings();this._onPointSymbolChange();var c=a.getStyle(this.pointColorTr,"display");b!==c&&this.emit("resize")}},_showSimpleMarkerSymSettings:function(){a.setStyle(this.pointColorTr,"display","");a.setStyle(this.pointOpacityTr,"display","");a.setStyle(this.pointOutlineColorTr,"display","");a.setStyle(this.pointOulineWidthTr,"display","")},_showPictureMarkerSymSettings:function(){a.setStyle(this.pointColorTr,"display","none");a.setStyle(this.pointOpacityTr,"display","none");
a.setStyle(this.pointOutlineColorTr,"display","none");a.setStyle(this.pointOulineWidthTr,"display","none")},_getPointSymbolBySetting:function(){if(!this.symbol)return null;var a=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){this.symbol.setSize(a);var a=this.pointColor.getColor(),b=this.pointAlpha.getAlpha();a.a=b;this.symbol.setColor(a);var a=this.pointOutlineColor.getColor(),b=parseFloat(this.pointOutlineWidth.get("value")),c=new u;c.setStyle(u.STYLE_SOLID);c.setColor(a);
c.setWidth(b);this.symbol.setOutline(c)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(a),this.symbol.setHeight(a));this._updatePreview(this.pointSymPreview);return this.symbol},_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(b(this.lineIconTables,".symbol-div-item:click",
l.hitch(this,this._onLineSymIconItemClick)));this.own(b(this.lineColor,"change",l.hitch(this,this._onLineSymbolChange)));this.own(b(this.lineStylesSelect,"change",l.hitch(this,this._onLineSymbolChange)));this.own(b(this.lineAlpha,"change",l.hitch(this,this._onLineSymbolChange)));this.own(b(this.lineWidth,"change",l.hitch(this,this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(a){a&&
(this._invokeSymbolChangeEvent=!1,this.lineColor.setColor(a.color),this.lineAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(a.width.toFixed(0))),this.lineStylesSelect.set("value",a.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(a){return a&&"esri.symbol.SimpleLineSymbol"===a.declaredClass},isCartographicLineSymbol:function(a){return a&&"esri.symbol.CartographicLineSymbol"===a.declaredClass},_requestLineSymJson:function(b){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+
b+".json");p(c,{handleAs:"json"}).then(l.hitch(this,function(c){c=this._createSymbolIconTable(b,c,"line");a.place(c,this.lineIconTables)}),l.hitch(this,function(a){console.error("get line symbol failed",a)}))},_onLineSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return a.hasClass(b,"symbol-div-item")},5))if(f(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=
r.fromJson(b),this._initLineSettings(b),this._onLineSymbolChange()},_getLineSymbolBySetting:function(){this.symbol=new u;var a=this.lineColor.getColor(),b=this.lineStylesSelect.get("value");a.a=this.lineAlpha.getAlpha();var c=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(b);this.symbol.setColor(a);this.symbol.setWidth(c);this._updatePreview(this.lineSymPreview);return this.symbol},_initFillSection:function(){this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,
this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(b(this.fillIconTables,".symbol-div-item:click",l.hitch(this,this._onFillSymIconItemClick)));this.own(b(this.fillColor,"change",l.hitch(this,this._onFillSymbolChange)));this.own(b(this.fillAlpha,"change",l.hitch(this,this._onFillSymbolChange)));this.own(b(this.fillOutlineColor,"change",l.hitch(this,this._onFillSymbolChange)));this.own(b(this.fillOutlineWidth,
"change",l.hitch(this,this._onFillSymbolChange)))},_onFillSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(),this._onChange(this.symbol))},_initFillSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(a.color),this.fillAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a.outline&&(this.fillOutlineColor.setColor(a.outline.color),this.fillOutlineWidth.set("value",parseInt(a.outline.width,10))),this._invokeSymbolChangeEvent=!0)},_isSimpleFillSymbol:function(a){return a&&
"esri.symbol.SimpleFillSymbol"===a.declaredClass},_requestFillSymJson:function(b){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");p(c,{handleAs:"json"}).then(l.hitch(this,function(c){c=this._createSymbolIconTable(b,c,"fill");a.place(c,this.fillIconTables)}),l.hitch(this,function(a){console.error("get fill symbol failed",a)}))},_onFillSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return a.hasClass(b,"symbol-div-item")},5))if(f(".selected-symbol-div-item",
b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=r.fromJson(b),this._initFillSettings(b),this._onFillSymbolChange()},_getFillSymbolBySetting:function(){this.symbol=new w;var a=this.fillColor.getColor();a.a=this.fillAlpha.getAlpha();var b=this.fillOutlineColor.getColor(),c=parseInt(this.fillOutlineWidth.get("value"),10);this.symbol.setColor(a);this.symbol.setStyle(w.STYLE_SOLID);a=new u;a.setStyle(u.STYLE_SOLID);a.setColor(b);
a.setWidth(c);this.symbol.setOutline(a);this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(b(this.inputText,"change",l.hitch(this,this._onTextSymbolChange)));this.own(b(this.textColor,"change",l.hitch(this,this._onTextSymbolChange)));this.own(b(this.textFontSize,"change",
l.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.inputText.value=a.text,this.textColor.setColor(a.color),a=parseInt(a.font.size,10),this.textFontSize.set("value",a),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(a){return a&&"esri.symbol.TextSymbol"===a.declaredClass},_updateTextPreview:function(){var b=
this.textColor.getColor().toHex(),c=parseInt(this.textFontSize.get("value"),10)+"px";a.setStyle(this.textPreview,{color:b,fontSize:c});this.textPreview.innerHTML=this.inputText.value},_getTextSymbolBySetting:function(){this.symbol=new v;var a=this.inputText.value,b=this.textColor.getColor(),c=parseInt(this.textFontSize.get("value"),10),d=new x;d.setSize(c);this.symbol.setText(a);this.symbol.setColor(b);this.symbol.setFont(d);this._updateTextPreview();return this.symbol}})})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w){function v(b){return function(c){this._isLoaded?this.inherited(b,arguments):this.loadDropDown(a.hitch(this,b,c))}}var x=e("dijit.form._SelectMenu",p,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(c(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var b=!1,c=this.parentWidget.value;
a.isArray(c)&&(c=c[c.length-1]);c&&m.forEach(this.parentWidget._getChildren(),function(a){a.option&&c===a.option.value&&(b=!0,this.focusChild(a,!1))},this);b||this.inherited(arguments)}});d=e("dijit.form.Select"+(b("dojo-bidi")?"_NoBidi":""),[n,f,q],{baseClass:"dijitSelect dijitValidationTextBox",templateString:w,_buttonInputDisabled:b("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=a?a:0].value)}this.dropDown=new x({id:this.id+"_menu",parentWidget:this});h.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(b){if(!b.value&&!b.label)return new s({ownerDocument:this.ownerDocument});var c=a.hitch(this,"_setValueAttr",b);b=new t({option:b,label:("text"===this.labelType?(b.label||"").toString().replace(/&/g,
"\x26amp;").replace(/</g,"\x26lt;"):b.label)||this.emptyLabel,onClick:c,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:b.disabled||!1});b.focusNode.setAttribute("role","option");return b},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return!this.dropDown?[]:this.dropDown.getChildren()},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(a){}},focusChild:function(a){a&&
this.set("value",a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=u.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{m.forEach(this._getChildren(),
function(a){a.destroyRecursive()});var b=new t({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);g.set(this.valueNode,"value",this.get("value"));this._refreshState()},
_setNameAttr:"valueNode",_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?r.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):r.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);r.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=k.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(c(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[l.LEFT_ARROW];delete a[l.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);
h.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);r.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){r.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
b("dojo-bidi")&&(d=e("dijit.form.Select",d,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));d._Menu=x;d.prototype._onContainerKeydown=v("_onContainerKeydown");d.prototype._onContainerKeypress=v("_onContainerKeypress");return d})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p){return d("dijit.form._FormSelectWidget",p,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(c.isArray(a))return m.map(a,"return this.getOptions(item);",this);c.isString(a)&&(a={value:a});c.isObject(a)&&(m.some(b,function(b,c){for(var d in a)if(!(d in b)||b[d]!=a[d])return!1;a=c;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){m.forEach(c.isArray(a)?a:[a],function(a){a&&c.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(c.isArray(a)?
a:[a]);m.forEach(a,function(a){a&&(this.options=m.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){m.forEach(c.isArray(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),c;if(b)for(c in a)b[c]=a[c]},this);this._loadChildren()},setStore:function(b,c,d){a.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(b,c,d)},_deprecatedSetStore:function(a,b,d){var p=this.store;d=d||{};if(p!==a){for(var k;k=this._notifyConnections.pop();)k.remove();a.get||(c.mixin(a,{_oldAPI:!0,get:function(a){var b=new e;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,b){var d=new e(function(){n.abort&&n.abort()});d.total=new e;var n=this.fetch(c.mixin({query:a,onBegin:function(a){d.total.resolve(a)},
onComplete:function(a){d.resolve(a)},onError:function(a){d.reject(a)}},b));return new f(d)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[g.after(a,"onNew",c.hitch(this,"_onNewItem"),!0),g.after(a,"onDelete",c.hitch(this,"_onDeleteItem"),!0),g.after(a,"onSet",c.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);d.query&&this._set("query",d.query);d.queryOptions&&this._set("queryOptions",d.queryOptions);a&&a.query&&(this._loadingStore=!0,this.onLoadDeferred=new e,this._queryRes=a.query(this.query,this.queryOptions),n(this._queryRes,c.hitch(this,function(f){if(this.sortByLabel&&!d.sort&&f.length)if(a.getValue)f.sort(h.createSortFunction([{attribute:a.getLabelAttributes(f[0])[0]}],a));else{var e=this.labelAttr;f.sort(function(a,b){return a[e]>b[e]?1:b[e]>
a[e]?-1:0})}d.onFetch&&(f=d.onFetch.call(this,f,d));m.forEach(f,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(c.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:b);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(f):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)}));return p},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=c.isArray(a)?m.map(a,function(a){return c.isObject(a)?a:{value:a}}):c.isObject(a)?[a]:[{value:a}];a=m.filter(this.getOptions(a),function(a){return a&&a.value});var d=this.getOptions()||[];if(!this.multiple&&(!a[0]||!a[0].value)&&d.length)a[0]=d[0];m.forEach(d,
function(b){b.selected=m.some(a,function(a){return a.value===b.value})});d=m.map(a,function(a){return a.value});if(!("undefined"==typeof d||"undefined"==typeof d[0])){var f=m.map(a,function(a){return a.label});this._setDisplay(this.multiple?f:f[0]);this.inherited(arguments,[this.multiple?d:d[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=m.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?a:a[0]},
_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(m.forEach(this._getChildren(),function(a){a.destroyRecursive()}),m.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;m.forEach(this._getChildren(),function(c){var d=m.some(a,function(a){return c.option&&
a===c.option.value});d&&!b.multiple&&(b.focusedChild=c);l.toggle(c.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),d);c.domNode.setAttribute("aria-selected",d?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=m.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?m.map(m.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){(!b||!b.parent)&&this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,c=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:c?b.getIdentity(a):null,label:c,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);k.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?b("\x3e *",this.srcNodeRef).map(function(b){return"separator"===b.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:b.getAttribute("data-"+a._scopeName+"-value")||b.getAttribute("value"),
label:String(b.innerHTML),selected:b.getAttribute("selected")||!1,disabled:b.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);g.after(this,"onChange",c.hitch(this,"_updateSelection"));var a=this.store;if(a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"]))this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions});this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(m,e,g){var h=function(d){function k(a){d[a]=function(){var c=arguments,b=g(d,function(b){Array.prototype.unshift.call(c,b);return h(m[a].apply(m,c))});if("forEach"!==a||l)return b}}if(!d)return d;var l=!!d.then;l&&(d=e.delegate(d));k("forEach");k("filter");
k("map");null==d.total&&(d.total=g(d,function(a){return a.length}));return d};e.setObject("dojo.store.util.QueryResults",h);return h})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(m,e,g,h){return m("dijit.DropDownMenu",h,{templateString:g,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(d){this._moveToPopup(d);d.stopPropagation();d.preventDefault()},
_onLeftArrow:function(d){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else d.stopPropagation(),d.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s){return e("dijit._MenuBase",[f,
s,t,p],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){d.toggle(this.domNode,"dijitMenuActive",a);d.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var b=n.byNode(a);return a.parentNode==this.containerNode&&
b&&b.focus},postCreate:function(){var c=this,d="string"==typeof this.childSelector?this.childSelector:k.hitch(this,"childSelector");this.own(a(this.containerNode,a.selector(d,l.enter),function(){c.onItemHover(n.byNode(this))}),a(this.containerNode,a.selector(d,l.leave),function(){c.onItemUnhover(n.byNode(this))}),a(this.containerNode,a.selector(d,b),function(a){c.onItemClick(n.byNode(this),a);a.stopPropagation()}),a(this.containerNode,a.selector(d,"focusin"),function(){c._onItemFocus(n.byNode(this))}));
this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},
_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),a.popup&&(!a.disabled&&!this.hover_timer)&&(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=
a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&
(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var c=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY;this._openItemPopup(a,
c)}else this.onExecute(),a._onClick?a._onClick(b):a.onClick(b)},_openItemPopup:function(b,c){if(b!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var d=b.popup;d.parentMenu=this;this.own(this._mouseoverHandle=a.once(d.domNode,"mouseover",k.hitch(this,"_onPopupHover")));var f=this;b._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){c&&f.focusChild(b);f._cleanUp()},onExecute:k.hitch(this,
"_cleanUp",!0),onClose:function(){f._mouseoverHandle&&(f._mouseoverHandle.remove(),delete f._mouseoverHandle)}},c);this.currentPopupItem=b}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(h.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),
this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(m,e,g,h,d,k,l,a,c,b){return e("dijit._KeyNavContainer",[c,b,a],{connectKeyNavHandlers:function(a,b){var c=this._keyNavCodes={},e=k.hitch(this,"focusPrev"),g=k.hitch(this,"focusNext");m.forEach(a,function(a){c[a]=e});m.forEach(b,function(a){c[a]=g});c[d.HOME]=k.hitch(this,"focusFirstChild");c[d.END]=k.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){h.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);m.forEach(this.getChildren(),
k.hitch(this,"_startupChild"))},addChild:function(a,b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=
l.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(m,e,g,h,d,k,l,a){return e("dijit._KeyNavMixin",a,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);g.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var a=this._keyNavCodes={};a[h.HOME]=d.hitch(this,"focusFirstChild");a[h.END]=d.hitch(this,
"focusLastChild");a[this.isLeftToRight()?h.LEFT_ARROW:h.RIGHT_ARROW]=d.hitch(this,"_onLeftArrow");a[this.isLeftToRight()?h.RIGHT_ARROW:h.LEFT_ARROW]=d.hitch(this,"_onRightArrow");a[h.UP_ARROW]=d.hitch(this,"_onUpArrow");a[h.DOWN_ARROW]=d.hitch(this,"_onDownArrow")}var b=this,a="string"==typeof this.childSelector?this.childSelector:d.hitch(this,"childSelector");this.own(k(this.domNode,"keypress",d.hitch(this,"_onContainerKeypress")),k(this.domNode,"keydown",d.hitch(this,"_onContainerKeydown")),k(this.domNode,
"focus",d.hitch(this,"_onContainerFocus")),k(this.containerNode,k.selector(a,"focusin"),function(a){b._onChildFocus(l.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(a,b){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),a.set("tabIndex",this.tabIndex),a.focus(b?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){g.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){g.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(a){a&&a!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a,b,d,f){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,b){var d=a.domNode,d=(a.label||(d.focusNode?
d.focusNode.label:"")||d.innerText||d.textContent||"").replace(/^\s+/,"").substr(0,b.length).toLowerCase();return b.length&&d==b?-1:0},_isFormElement:function(a){return"INPUT"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"BUTTON"===a.tagName},_onContainerKeydown:function(a){if(!this._isFormElement(document.activeElement)){var b=this._keyNavCodes[a.keyCode];b?(b(a,this.focusedChild),a.stopPropagation(),a.preventDefault(),this._searchString=""):a.keyCode==h.SPACE&&(this._searchTimer&&
!a.ctrlKey&&!a.altKey&&!a.metaKey)&&(a.stopImmediatePropagation(),a.preventDefault(),this._keyboardSearch(a," "))}},_onContainerKeypress:function(a){if(!this._isFormElement(document.activeElement)&&!(a.charCode<=h.SPACE||a.ctrlKey||a.altKey||a.metaKey))a.preventDefault(),a.stopPropagation(),this._keyboardSearch(a,String.fromCharCode(a.charCode).toLowerCase())},_keyboardSearch:function(a,b){var e=null,f,p=0;d.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=b;
var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;f=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var c=this.focusedChild||null;if(1==a||!c)if(c=this._getNextFocusableChild(c,1),!c)return;a=c;do{var d=this._keyboardSearchCompare(c,f);d&&0==p++&&(e=c);if(-1==d){p=-1;break}c=this._getNextFocusableChild(c,1)}while(c!=a)})();this.onKeyboardSearch(e,a,f,p)},_onChildBlur:function(){},
_getNextFocusableChild:function(a,b){var d=a;do{if(a)a=this._getNext(a,b);else if(a=this[0<b?"_getFirst":"_getLast"](),!a)break;if(null!=a&&a!=d&&a.isFocusable())return a}while(a!=d);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(a,b){if(a)for(a=a.domNode;a;)if((a=a[0>b?"previousSibling":"nextSibling"])&&"getAttribute"in a){var d=l.byNode(a);if(d)return d}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f){l=m("dijit.MenuItem"+(k("dojo-bidi")?"_NoBidi":""),[a,c,b,n],{templateString:f,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),d=a.substr(0,c);a=a.substr(c+3);c=d+b+a;a=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){a&&!("label"in this.params)&&this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);g.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&g.set(this.accelKeyNode,"id",this.id+"_accel");e.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==k("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_setSelected:function(a){h.toggle(this.domNode,
"dijitMenuItemSelected",a)},setLabel:function(a){d.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){d.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=
a?"":"none",this.accelKeyNode.innerHTML=a,g.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});k("dojo-bidi")&&(l=m("dijit.MenuItem",l,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return l})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(m,e){return m("dijit._Contained",null,{_getSibling:function(g){var h=this.domNode;do h=h[g+"Sibling"];while(h&&1!=h.nodeType);return h&&
e.byNode(h)},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var e=this.getParent();return!e||!e.getIndexOfChild?-1:e.getIndexOfChild(this)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(m,e,g,h,d,k){return m("dijit.MenuSeparator",[g,h,d],{templateString:k,buildRendering:function(){this.inherited(arguments);
e.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(m,e,g,h){return m("dijit.form.NumberSpinner",[g,h.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(d,e){var g=this.constraints,a=isNaN(d),c=!isNaN(g.max),b=!isNaN(g.min);a&&0!=e&&(d=0<e?b?g.min:c?g.max:0:c?this.constraints.max:b?g.min:0);var n=d+e;if(a||isNaN(n))return d;c&&n>
g.max&&(n=g.max);b&&n<g.min&&(n=g.min);return n},_onKeyDown:function(d){if(!this.disabled&&!this.readOnly&&(d.keyCode==e.HOME||d.keyCode==e.END)&&!d.ctrlKey&&(!d.altKey&&!d.metaKey)&&"undefined"!=typeof this.get("value")){var k=this.constraints[d.keyCode==e.HOME?"min":"max"];"number"==typeof k&&this._setValueAttr(k,!1);d.stopPropagation();d.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(m,e,g,h,d,k,l,a,c,b){return m("dijit.form._Spinner",a,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:0.9,smallDelta:1,largeDelta:10,templateString:c,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(a){return a},_arrowPressed:function(a,c,d){!this.disabled&&!this.readOnly&&(this._setValueAttr(this.adjust(this.get("value"),c*d),!1),b.selectInputText(this.textbox,this.textbox.value.length))},
_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(a,b,c){var d=this.smallDelta;b==this.textbox&&(b=c.keyCode,d=b==e.PAGE_UP||b==e.PAGE_DOWN?this.largeDelta:this.smallDelta,b=b==e.UP_ARROW||b==e.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==a?this._arrowReleased(b):this._arrowPressed(b,b==this.upArrowNode?1:-1,d)},_wheelTimer:null,_mouseWheeled:function(a){a.stopPropagation();a.preventDefault();var b=a.wheelDelta/120;Math.floor(b)!=b&&(b=0<a.wheelDelta?1:-1);a=a.detail?
-1*a.detail:b;if(0!==a){var c=this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(c,a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(c)},50)}},_setConstraintsAttr:function(a){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",
this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,b){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(k(this.domNode,d.wheel,g.hitch(this,"_mouseWheeled")),l.addListener(this.upArrowNode,this.textbox,{keyCode:e.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),l.addListener(this.downArrowNode,
this.textbox,{keyCode:e.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),l.addListener(this.upArrowNode,this.textbox,{keyCode:e.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),l.addListener(this.downArrowNode,this.textbox,{keyCode:e.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",
this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(m,e,g){return m("dijit.form.RangeBoundTextBox",g,{rangeMessage:"",rangeCheck:function(e,d){return("min"in d?0<=this.compare(e,d.min):!0)&&("max"in d?0>=this.compare(e,d.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var e=
this.get("value");if(null==e)return!1;var d=!1;"min"in this.constraints&&(d=this.constraints.min,d=0>this.compare(e,"number"==typeof d&&0<=d&&0!=e?0:d));!d&&"max"in this.constraints&&(d=this.constraints.max,d=0<this.compare(e,"number"!=typeof d||0<d?d:0));return d},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(e){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(e))},getErrorMessage:function(e){var d=
this.get("value");return null!=d&&""!==d&&("number"!=typeof d||!isNaN(d))&&!this.isInRange(e)?this.rangeMessage:this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=e.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(m,e,g,h){return m("dijit.form.MappedTextBox",
h,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(d){return d.toString?d.toString():""},toString:function(){var d=this.filter(this.get("value"));return null!=d?"string"==typeof d?d:this.serialize(d,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=g.place("\x3cinput type\x3d'hidden'"+(this.name&&
!e("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(m,e,g,h,d,k){var l=function(a){a=a||{};var b=g.getLocalization("dojo.cldr","number",g.normalizeLocale(a.locale)),d=a.pattern?a.pattern:b[(a.type||"decimal")+"Format"];a="number"==
typeof a.places?a.places:"string"===typeof a.places&&0<a.places.length?a.places.replace(/.*,/,""):-1!=d.indexOf(".")?d.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:b.decimal,places:a}},a=m("dijit.form.NumberTextBoxMixin",null,{pattern:function(a){return"("+(this.focused&&this.editOptions?this._regExpGenerator(e.delegate(a,this.editOptions))+"|":"")+this._regExpGenerator(a)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:d.format,_regExpGenerator:d.regexp,_decimalInfo:l(),postMixInProperties:function(){this.inherited(arguments);
this._set("type","text")},_setConstraintsAttr:function(a){var b="number"==typeof a.places?a.places:0;b&&b++;"number"!=typeof a.max&&(a.max=9*Math.pow(10,15-b));"number"!=typeof a.min&&(a.min=-9*Math.pow(10,15-b));this.inherited(arguments,[a]);this.focusNode&&(this.focusNode.value&&!isNaN(this.value))&&this.set("value",this.value);this._decimalInfo=l(a)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var a=this.get("value");"number"==typeof a&&!isNaN(a)&&(a=this.format(a,this.constraints),
void 0!==a&&(this.textbox.value=a));this.inherited(arguments)}},format:function(a,b){var d=String(a);if("number"!=typeof a)return d;if(isNaN(a))return"";if(!("rangeCheck"in this&&this.rangeCheck(a,b))&&!1!==b.exponent&&/\de[-+]?\d/i.test(d))return d;this.editOptions&&this.focused&&(b=e.mixin({},b,this.editOptions));return this._formatter(a,b)},_parser:d.parse,parse:function(a,b){var d=this._parser(a,e.mixin({},b,this.editOptions&&this.focused?this.editOptions:{}));this.editOptions&&(this.focused&&
isNaN(d))&&(d=this._parser(a,b));return d},_getDisplayedValueAttr:function(){var a=this.inherited(arguments);return isNaN(a)?this.textbox.value:a},filter:function(a){if(null==a||"string"==typeof a&&""==a)return NaN;"number"==typeof a&&(!isNaN(a)&&0!=a)&&(a=d.round(a,this._decimalInfo.places));return this.inherited(arguments,[a])},serialize:function(a,b){return"number"!=typeof a||isNaN(a)?"":this.inherited(arguments)},_setBlurValue:function(){var a=e.hitch(e.delegate(this,{focused:!0}),"get")("value");
this._setValueAttr(a,!0)},_setValueAttr:function(a,b,d){if(void 0!==a&&void 0===d)if(d=String(a),"number"==typeof a)if(isNaN(a))d="";else{if("rangeCheck"in this&&this.rangeCheck(a,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(d))d=void 0}else a?a=void 0:(d="",a=NaN);this.inherited(arguments,[a,b,d])},_getValueAttr:function(){var a=this.inherited(arguments);if(isNaN(a)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&RegExp("^"+
d._realNumberRegexp(e.delegate(this.constraints))+"$").test(this.textbox.value))return a=Number(this.textbox.value),isNaN(a)?void 0:a}else return a},isValid:function(a){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var b=this.get("value");return!isNaN(b)&&this.rangeCheck(b,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var a="number"==typeof this.constraints.min,
b="number"==typeof this.constraints.max,d=this.get("value");if(isNaN(d)||!a&&!b)return this.inherited(arguments);var f=d|0,e=0>d,k=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),g=(this.maxLength||20)-this.textbox.value.length,l=k?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",f=k?f+"."+l:f+"",g=h.rep("9",g),k=d;e?k=Number(f+g):d=Number(f+g);return!(a&&d<this.constraints.min||b&&k>this.constraints.max)}});m=m("dijit.form.NumberTextBox",[k,a],{baseClass:"dijitTextBox dijitNumberTextBox"});
m.Mixin=a;return m})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup dojox/widget/ColorPicker".split(" "),function(m,e,g,h,d,k,l,a,c,b){return m([e,g],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,postCreate:function(){this.inherited(arguments);
this.color?this.color instanceof l||(this.color=new l(this.color)):this.color=new l("#ccc");d.setStyle(this.domNode,"backgroundColor",this.color.toHex());this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){c.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(a){var b=this.tooltipDialog.domNode;return a===b||d.isDescendant(a,b)},_showTooltipDialog:function(){c.open({parent:this.getParent(),
popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=!0},_hideTooltipDialog:function(){c.close(this.tooltipDialog);this._isTooltipDialogOpened=!1},_createTooltipDialog:function(){var c=d.create("div");this.tooltipDialog=new a({style:"width: 350px;",content:c});var f=new b({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:h.hitch(this,function(a){a=new l(a);this.setColor(a)})});f.placeAt(c);f.startup();this.own(k(this.domNode,"click",
h.hitch(this,function(a){a.stopPropagation();a.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(k(document.body,"click",h.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=f},setColor:function(a){if(a instanceof l){var b=this.color,c="";b&&(c=b.toHex());b=a.toHex();this.color=a;d.setStyle(this.domNode,"backgroundColor",b);if(c!==b)this.onChange(new l(b))}},getColor:function(){return this.color},
onChange:function(a){}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),function(m,
e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w,v,x,B,D){m.experimental("dojox.widget.ColorPicker");return e("dojox.widget.ColorPicker",q,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:D,postMixInProperties:function(){n.contains(a.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=s.getUniqueId(this.id);g.mixin(this,v.getLocalization("dojox.widget","ColorPicker"));g.mixin(this,v.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>l("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new t.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new t.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(k.subscribe("/dnd/move/stop",g.hitch(this,"_clearTimer"))),this._subs.push(k.subscribe("/dnd/move/start",
g.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(u.addKeyListener(this.hueCursorNode,{charOrCode:f.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(u.addKeyListener(this.hueCursorNode,{charOrCode:f.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:f.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:f.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:f.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateCursorNode),25,25)),this._connects.push(u.addKeyListener(this.cursorNode,{charOrCode:f.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(a,b){this._started&&this.setColor(a,b)},setColor:function(a,b){a=w.fromString(a);this._updatePickerLocations(a);this._updateColorInputs(a);this._updateValue(a,b)},_setTimer:function(a){a.node!=this.cursorNode&&a.node!=this.hueCursorNode||(r.focus(a.node),b.setSelectable(this.domNode,!1),this._timer=setInterval(g.hitch(this,"_updateColor"),45))},_clearTimer:function(a){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),b.setSelectable(this.domNode,!0))},_setHue:function(a){d.style(this.colorUnderlay,"backgroundColor",w.fromHsv(a,100,100).toHex())},_updateHueCursorNode:function(a,b,c){if(-1!==a){a=d.style(this.hueCursorNode,"top");b=this.PICKER_HUE_SELECTOR_H/2;a+=b;var e=!1;c.charOrCode==f.UP_ARROW?0<a&&(a-=1,e=!0):c.charOrCode==f.DOWN_ARROW&&a<this.PICKER_HUE_H&&(a+=1,e=!0);e&&d.style(this.hueCursorNode,"top",a-b+"px")}else this._updateColor(!0)},_updateCursorNode:function(a,
b,c){b=this.PICKER_SAT_SELECTOR_H/2;var e=this.PICKER_SAT_SELECTOR_W/2;if(-1!==a){a=d.style(this.cursorNode,"top");var n=d.style(this.cursorNode,"left");a+=b;var n=n+e,p=!1;c.charOrCode==f.UP_ARROW?0<a&&(a-=1,p=!0):c.charOrCode==f.DOWN_ARROW?a<this.PICKER_SAT_VAL_H&&(a+=1,p=!0):c.charOrCode==f.LEFT_ARROW?0<n&&(n-=1,p=!0):c.charOrCode==f.RIGHT_ARROW&&n<this.PICKER_SAT_VAL_W&&(n+=1,p=!0);p&&(n-=e,d.style(this.cursorNode,"top",a-b+"px"),d.style(this.cursorNode,"left",n+"px"))}else this._updateColor(!0)},
_updateColor:function(a){var b=this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,f=this.PICKER_SAT_SELECTOR_W/2,b=d.style(this.hueCursorNode,"top")+b,c=d.style(this.cursorNode,"top")+c,f=d.style(this.cursorNode,"left")+f,b=Math.round(360-360*(b/this.PICKER_HUE_H)),f=w.fromHsv(b,100*(f/this.PICKER_SAT_VAL_W),100-100*(c/this.PICKER_SAT_VAL_H));this._updateColorInputs(f);this._updateValue(f,a);b!=this._hue&&this._setHue(b)},_colorInputChange:function(a){var b,c=!1;switch(a.target){case this.hexCode:b=
w.fromString(a.target.value);c=!0;break;case this.Rval:case this.Gval:case this.Bval:b=w.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);c=!0;break;case this.Hval:case this.Sval:case this.Vval:b=w.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),c=!0}c&&(this._updatePickerLocations(b),this._updateColorInputs(b),this._updateValue(b,!0))},_updateValue:function(a,b){var c=a.toHex();this.value=this.valueNode.value=c;if(b&&(!this._timer||this.liveUpdate))this.onChange(c)},_updatePickerLocations:function(a){var b=
this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,f=this.PICKER_SAT_SELECTOR_W/2;a=a.toHsv();b=Math.round(this.PICKER_HUE_H-a.h/360*this.PICKER_HUE_H)-b;f=Math.round(a.s/100*this.PICKER_SAT_VAL_W)-f;c=Math.round(this.PICKER_SAT_VAL_H-a.v/100*this.PICKER_SAT_VAL_H)-c;this.animatePoint?(p.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:b,left:0}).play(),p.slideTo({node:this.cursorNode,duration:this.slideDuration,top:c,left:f}).play()):(d.style(this.hueCursorNode,"top",b+"px"),
d.style(this.cursorNode,{left:f+"px",top:c+"px"}));a.h!=this._hue&&this._setHue(a.h)},_updateColorInputs:function(a){var b=a.toHex();this.showRgb&&(this.Rval.value=a.r,this.Gval.value=a.g,this.Bval.value=a.b);this.showHsv&&(a=a.toHsv(),this.Hval.value=Math.round(a.h),this.Sval.value=Math.round(a.s),this.Vval.value=Math.round(a.v));this.showHex&&(this.hexCode.value=b);this.previewNode.style.backgroundColor=b;this.webSafe&&(this.safePreviewNode.style.backgroundColor=b)},_setHuePoint:function(a){a=a.layerY-
this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?p.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:a,left:0,onEnd:g.hitch(this,function(){this._updateColor(!1);r.focus(this.hueCursorNode)})}).play():(d.style(this.hueCursorNode,"top",a+"px"),this._updateColor(!1))},_setPoint:function(a){var b=a.layerY-this.PICKER_SAT_SELECTOR_H/2,c=a.layerX-this.PICKER_SAT_SELECTOR_W/2;a&&r.focus(a.target);this.animatePoint?p.slideTo({node:this.cursorNode,duration:this.slideDuration,top:b,left:c,onEnd:g.hitch(this,
function(){this._updateColor(!0);r.focus(this.cursorNode)})}).play():(d.style(this.cursorNode,{left:c+"px",top:b+"px"}),this._updateColor(!1))},_handleKey:function(a){},focus:function(){this.focused||r.focus(this.focusNode)},_stopDrag:function(a){c.stop(a)},destroy:function(){this.inherited(arguments);h.forEach(this._subs,function(a){k.unsubscribe(a)});delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(m){return m})},"dojox/color/_base":function(){define(["../main",
"dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(m,e,g,h){m=e.getObject("color",!0,m);m.Color=g;m.blend=g.blendColors;m.fromRgb=g.fromRgb;m.fromHex=g.fromHex;m.fromArray=g.fromArray;m.fromString=g.fromString;m.greyscale=h.makeGrey;e.mixin(m,{fromCmy:function(d,k,l){e.isArray(d)?(k=d[1],l=d[2],d=d[0]):e.isObject(d)&&(k=d.m,l=d.y,d=d.c);k=1-k/100;l=1-l/100;return new g({r:Math.round(255*(1-d/100)),g:Math.round(255*k),b:Math.round(255*l)})},fromCmyk:function(d,k,l,a){e.isArray(d)?(k=d[1],
l=d[2],a=d[3],d=d[0]):e.isObject(d)&&(k=d.m,l=d.y,a=d.b,d=d.c);k/=100;l/=100;a/=100;d=1-Math.min(1,d/100*(1-a)+a);k=1-Math.min(1,k*(1-a)+a);l=1-Math.min(1,l*(1-a)+a);return new g({r:Math.round(255*d),g:Math.round(255*k),b:Math.round(255*l)})},fromHsl:function(d,k,l){e.isArray(d)?(k=d[1],l=d[2],d=d[0]):e.isObject(d)&&(k=d.s,l=d.l,d=d.h);k/=100;for(l/=100;0>d;)d+=360;for(;360<=d;)d-=360;var a,c;120>d?(a=(120-d)/60,c=d/60,d=0):240>d?(a=0,c=(240-d)/60,d=(d-120)/60):(a=(d-240)/60,c=0,d=(360-d)/60);a=2*
k*Math.min(a,1)+(1-k);c=2*k*Math.min(c,1)+(1-k);d=2*k*Math.min(d,1)+(1-k);0.5>l?(a*=l,c*=l,d*=l):(a=(1-l)*a+2*l-1,c=(1-l)*c+2*l-1,d=(1-l)*d+2*l-1);return new g({r:Math.round(255*a),g:Math.round(255*c),b:Math.round(255*d)})}});m.fromHsv=function(d,k,l){e.isArray(d)?(k=d[1],l=d[2],d=d[0]):e.isObject(d)&&(k=d.s,l=d.v,d=d.h);360==d&&(d=0);k/=100;l/=100;var a,c,b;if(0==k)c=b=a=l;else{var n=d/60;d=Math.floor(n);var f=n-d,n=l*(1-k),p=l*(1-k*f);k=l*(1-k*(1-f));switch(d){case 0:a=l;c=k;b=n;break;case 1:a=
p;c=l;b=n;break;case 2:a=n;c=l;b=k;break;case 3:a=n;c=p;b=l;break;case 4:a=k;c=n;b=l;break;case 5:a=l,c=n,b=p}}return new g({r:Math.round(255*a),g:Math.round(255*c),b:Math.round(255*b)})};e.extend(g,{toCmy:function(){var d=1-this.g/255,e=1-this.b/255;return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*d),y:Math.round(100*e)}},toCmyk:function(){var d,e,g,a=this.r/255;d=this.g/255;e=this.b/255;g=Math.min(1-a,1-d,1-e);d=(1-d-g)/(1-g);e=(1-e-g)/(1-g);return{c:Math.round(100*((1-a-g)/(1-g))),m:Math.round(100*
d),y:Math.round(100*e),b:Math.round(100*g)}},toHsl:function(){var d=this.r/255,e=this.g/255,g=this.b/255,a=Math.min(d,g,e),c=Math.max(d,e,g),b=c-a,n=0,f=0,a=(a+c)/2;0<a&&1>a&&(f=b/(0.5>a?2*a:2-2*a));0<b&&(c==d&&c!=e&&(n+=(e-g)/b),c==e&&c!=g&&(n+=2+(g-d)/b),c==g&&c!=d&&(n+=4+(d-e)/b),n*=60);return{h:n,s:Math.round(100*f),l:Math.round(100*a)}},toHsv:function(){var d=this.r/255,e=this.g/255,g=this.b/255,a=Math.min(d,g,e),c=Math.max(d,e,g),a=c-a,b=null,n=0==c?0:a/c;0==n?b=0:(b=d==c?60*(e-g)/a:e==c?120+
60*(g-d)/a:240+60*(d-e)/a,0>b&&(b+=360));return{h:b,s:Math.round(100*n),v:Math.round(100*c)}}});return m})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(m,e,g,h){var d={};e.setObject("dojo.colors",d);var k=function(a,c,b){0>b&&++b;1<b&&--b;var d=6*b;return 1>d?a+(c-a)*d:1>2*b?c:2>3*b?a+6*(c-a)*(2/3-b):a};m.colorFromRgb=g.fromRgb=function(a,c){var b=a.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(b){var d=b[2].split(/\s*,\s*/),
f=d.length,b=b[1];if("rgb"==b&&3==f||"rgba"==b&&4==f)return b=d[0],"%"==b.charAt(b.length-1)?(b=h.map(d,function(a){return 2.56*parseFloat(a)}),4==f&&(b[3]=d[3]),g.fromArray(b,c)):g.fromArray(d,c);if("hsl"==b&&3==f||"hsla"==b&&4==f){var b=(parseFloat(d[0])%360+360)%360/360,e=parseFloat(d[1])/100,l=parseFloat(d[2])/100,e=0.5>=l?l*(e+1):l+e-l*e,l=2*l-e,b=[256*k(l,e,b+1/3),256*k(l,e,b),256*k(l,e,b-1/3),1];4==f&&(b[3]=d[3]);return g.fromArray(b,c)}}return null};var l=function(a,c,b){a=Number(a);return isNaN(a)?
b:a<c?c:a>b?b:a};g.prototype.sanitize=function(){this.r=Math.round(l(this.r,0,255));this.g=Math.round(l(this.g,0,255));this.b=Math.round(l(this.b,0,255));this.a=l(this.a,0,1);return this};d.makeGrey=g.makeGrey=function(a,c){return g.fromArray([a,a,a,c])};e.mixin(g.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],
cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],
darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,
92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,
153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,
245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,
82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return g})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f){return m([e,g,h,d],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:k,nls:null,alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency},postCreate:function(){this.inherited(arguments);"number"===typeof this.alpha&&this.setAlpha(this.alpha)},setAlpha:function(a){a=Math.round(100-100*a);this.opacitySlider.set("value",a)},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var a=
this.getAlpha();this.emit("change",a)}})})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w,v,x){var B=e("dijit.form._SliderMover",
n,{onMouseMove:function(b){var c=this.widget,f=c._abspos;f||(f=c._abspos=d.position(c.sliderBarContainer,!0),c._setPixelValue_=a.hitch(c,"_setPixelValue"),c._isReversed_=c._isReversed());b=b[c._mousePixelCoord]-f[c._startingPixelCoord];c._setPixelValue_(c._isReversed_?f[c._pixelCount]-b:b,f[c._pixelCount],!1)},destroy:function(a){n.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,!0)}});g=e("dijit.form.HorizontalSlider",[w,v],{templateString:x,value:0,
showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:s.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",_onKeyUp:function(a){!this.disabled&&(!this.readOnly&&!a.altKey&&
!a.ctrlKey&&!a.metaKey)&&this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!this.disabled&&!this.readOnly&&!a.altKey&&!a.ctrlKey&&!a.metaKey){switch(a.keyCode){case l.HOME:this._setValueAttr(this.minimum,!1);break;case l.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?l.RIGHT_ARROW:l.LEFT_ARROW:case !1===this._descending?l.DOWN_ARROW:l.UP_ARROW:case !1===this._descending?l.PAGE_DOWN:l.PAGE_UP:this.increment(a);break;case this._descending||this.isLeftToRight()?
l.LEFT_ARROW:l.RIGHT_ARROW:case !1===this._descending?l.UP_ARROW:l.DOWN_ARROW:case !1===this._descending?l.PAGE_UP:l.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){!this.disabled&&!this.readOnly&&(c("ie")||r.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&this.clickSelect){r.focus(this.sliderHandle);a.stopPropagation();
a.preventDefault();var b=d.position(this.sliderBarContainer,!0),c=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-c:c,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;a=Math.round(a/(b/d));this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*a/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,
b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,d=!1===this._descending?this.remainingBar:this.progressBar,f=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&d.style[this._progressPixelSize]){var e=this,n={},p=parseFloat(d.style[this._progressPixelSize]),
g=this.slideDuration*(c-p/100);0!=g&&(0>g&&(g=0-g),n[this._progressPixelSize]={start:p,end:100*c,units:"%"},this._inProgressAnim=h.animateProperty({node:d,duration:g,onAnimate:function(a){f.style[e._progressPixelSize]=100-parseFloat(a[e._progressPixelSize])+"%"},onEnd:function(){delete e._inProgressAnim},properties:n}),this._inProgressAnim.play())}else d.style[this._progressPixelSize]=100*c+"%",f.style[this._progressPixelSize]=100*(1-c)+"%"},_bumpValue:function(a,b){if(!this.disabled&&!(this.readOnly||
this.maximum<=this.minimum)){var c=k.getComputedStyle(this.sliderBarContainer),f=d.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=f[this._pixelCount];c--;f=(this.value-this.minimum)*c/(this.maximum-this.minimum)+a;0>f&&(f=0);f>c&&(f=c);f=f*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(f,b)}},_onClkBumper:function(a){!this.disabled&&(!this.readOnly&&this.clickSelect)&&this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===
this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==l.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==l.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){a.stopPropagation();a.preventDefault();this._bumpValue(0>a.wheelDelta?-1:1,!0)},startup:function(){this._started||(m.forEach(this.getChildren(),function(a){this[a.container]!=
this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display="");var a=f('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+
"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(q.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),q.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(t(this.domNode,p.wheel,a.hitch(this,"_mouseWheeled")));var c=e(B,{widget:this});this._movable=
new b(this.sliderHandle,{mover:c});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});g._Mover=B;return g})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(m,e,g,h,d,k){m=m("dijit.form.HorizontalRuleLabels",k,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',
labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(d){return d},_genHTML:function(d,a){var c=this.labels[a];return this._positionPrefix+this._calcPosition(d)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(c)+this._labelPrefix+
c+this._suffix},_genDirectionHTML:function(d){return""},getLabels:function(){var d=this.labels;!d.length&&this.srcNodeRef&&(d=h("\x3e li",this.srcNodeRef).map(function(a){return String(a.innerHTML)}));if(!d.length&&1<this.count)for(var a=this.minimum,c=(this.maximum-a)/(this.count-1),b=0;b<this.count;b++)d.push(b<this.numericMargin||b>=this.count-this.numericMargin?"":g.format(a,this.constraints)),a+=c;return d},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();
this.count=this.labels.length}});e("dojo-bidi")&&m.extend({_setTextDirAttr:function(e){this.textDir!=e&&(this._set("textDir",e),h(".dijitRuleLabelContainer",this.domNode).forEach(d.hitch(this,function(a){a.style.direction=this.getTextDir(a.innerText||a.textContent||"")})))},_genDirectionHTML:function(d){return this.textDir?"direction:"+this.getTextDir(d)+";":""}});return m})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(m,e,g){return m("dijit.form.HorizontalRule",
[e,g],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(e){return this._positionPrefix+e+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var e;if(1==this.count)e=this._genHTML(50,0);else{var d,
g=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){e=this._genHTML(0,0);for(d=1;d<this.count-1;d++)e+=this._genHTML(g*d,d);e+=this._genHTML(100,this.count-1)}else{e=this._genHTML(100,0);for(d=1;d<this.count-1;d++)e+=this._genHTML(100-g*d,d);e+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=e}})})},"jimu/dijit/Search":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/string","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(m,e,g,h,d){return m([h,d],{baseClass:"jimu-search",
declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',placeholder:"",
onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&e.setAttr(this.inputSearch,"placeholder",this.placeholder)},doSearch:function(){if(this.onSearch)this.onSearch(g.trim(this.inputSearch.value))},_onKeyDown:function(d){13===(void 0!==d.keyCode?d.keyCode:d.which)&&this.doSearch();d.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()}})})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),
function(m,e,g,h,d,k,l,a){return m([a],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=e.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=e.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=e.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},
this.domNode);e.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(h(this,"Change",g.hitch(this,"_onServiceUrlChange")))},setProcessFunction:function(a,b){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof a&&(this._fetchHandle=k.after(this,"onFetch",a),this.own(this._fetchHandle));"function"===typeof b&&(this._fetchErrHandle=k.after(this,"onFetchError",b),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&
this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),this._fetchErrHandle=null)},onFetch:function(a){return a},onFetchError:function(a){},getStatus:function(){return this._status},_onServiceUrlChange:function(a){var b=new d;b.then(g.hitch(this,function(){this._valid()}),g.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();a?l({url:g.trim(a||""),handleAs:"json",content:{f:"json"},
callbackParamName:"callback"}).then(g.hitch(this,function(a){this.onFetch({url:this.getValue(),data:a})?b.resolve("success"):b.reject("error")}),g.hitch(this,function(a){b.reject(a)})):b.reject("error")},_validating:function(){this._status="validating";e.removeClass(this.domNode,"jimu-serviceurl-input-invalid");e.removeClass(this.domNode,"jimu-serviceurl-input-valid");e.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";e.removeClass(this.domNode,"jimu-serviceurl-input-invalid");
e.removeClass(this.domNode,"jimu-serviceurl-input-validating");e.addClass(this.domNode,"jimu-serviceurl-input-valid")},_inValid:function(){this._status="invalid";e.removeClass(this.domNode,"jimu-serviceurl-input-validating");e.removeClass(this.domNode,"jimu-serviceurl-input-valid");e.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query jimu/utils".split(" "),
function(m,e,g,h,d,k,l,a,c,b){return m([e,g,h],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"tableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;"\x3e\x3ccolgroup\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"\x3e\x3c/thead\x3e\x3ctbody class\x3d"simple-table-tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",autoHeight:!0,selectable:!1,fields:null,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);this._initSelf()},
startup:function(){this.inherited(arguments);this._updateUI()},_initSelf:function(){this._initAttachPoints();this.own(b.bindClickAndDblclickEvents(this.table,d.hitch(this,function(a){if(a=b.getAncestorDom(a.target||a.srcElement,function(a){return k.hasClass(a,"simple-table-row")&&k.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),d.hitch(this,function(a){if(a=b.getAncestorDom(a.target||a.srcElement,function(a){return k.hasClass(a,"simple-table-row")&&k.hasClass(a,"not-empty")},
this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var a=Math.random().toString();this._name="jimu_table_"+a.slice(2,a.length);this.thead=c("thead",this.domNode)[0];this.tbody=c("tbody",this.domNode)[0];if(this.fields&&0<this.fields.length){var f=k.create("tr",{},this.thead);l.forEach(this.fields,d.hitch(this,function(a){var b="auto";"actions"===a.type&&(a.name="actions");a.hidden?b=1:void 0!==a.width&&null!==a.width?b=a.width:"actions"===a.type&&!a.name&&(a.width=this._calculateActionsWidth(a)+
20,b=a.width);k.create("col",{width:b},this.colgroup);b=k.create("th",{innerHTML:a.title,title:a.title},f);k.addClass(b,"simple-table-field");a.hidden&&k.addClass(b,"hidden-column");a["class"]&&k.addClass(b,a["class"]);k.addClass(b,a.name)}));k.empty(this.headDiv);a=d.clone(this.tableDiv);k.place(a,this.headDiv)}else this.fields=null},_initAttachPoints:function(){this.table=c("table",this.bodyDiv)[0];this.colgroup=c("colgroup",this.bodyDiv)[0];this.head=c("thead",this.bodyDiv)[0];this.tbody=c("tbody",
this.bodyDiv)[0]},clear:function(){var a=this._getNotEmptyRows();k.empty(this.tbody);l.forEach(a,d.hitch(this,function(a){this._onDeleteRow(a)}));this._updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var b=[];this.fields&&(a&&0<a.length)&&l.forEach(a,d.hitch(this,function(a){b.push(this.addRow(a,!0))}));this._updateUI();return b},addRow:function(a,b){this._rowIndex++;var c={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof a)return c;
var e=l.filter(this.fields,d.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),e=l.filter(e,d.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,a[b.name]).length}));if(0<e.length)return c.errorCode=this.REPEATING_ERROR,c.errorMessage="repeating data",c.repeatFields=e,c;var g=k.create("tr",{"class":"simple-table-row not-empty"},this.tbody);k.setAttr(g,"rowId","row"+this._rowIndex);l.forEach(this.fields,d.hitch(this,function(b){var c=a[b.name],d=b.type,f=null;"actions"===
d?this._createActionsTd(g,b):("text"===d?f=this._createTextTd(g,b,c):"radio"===d?f=this._createRadioTd(g,b,c):"checkbox"===d?f=this._createCheckboxTd(g,b,c):"empty"===d?f=this._createEmptyTd(g,b):"extension"===d&&(f=this._createExtensionTd(g,b,c)),b.hidden&&k.addClass(f,"hidden-column"))}));b||this._updateUI();c.success=!0;c.tr=g;c.errorMessage=null;this._onAddRow(g);return c},deleteRow:function(a){a&&(k.destroy(a),this._updateUI(),this._onDeleteRow(a))},selectRow:function(a){this.selectable&&(c(".simple-table-row",
this.tbody).removeClass("jimu-state-active"),k.addClass(a,"jimu-state-active"),this._onSelectRow(a))},_updateUI:function(){this._updateRowClassName();this._updateHeight()},_updateHeight:function(){if(this.autoHeight){var a=this.getRows();k.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*(0<a.length?a.length:1)+1+"px")}},_updateRowClassName:function(){var a=c("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&(a=c("."+this._classRowUpDiv,a)[0])&&k.removeClass(a,this._classJimuStateDisabled);
if(a=c("."+this._classLastSimpleTableRow,this.tbody)[0])(a=c("."+this._classRowDownDiv,a)[0])&&k.removeClass(a,this._classJimuStateDisabled);a=c("."+this._classSimpleTableRow,this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);l.forEach(a,d.hitch(this,function(a,b){0===b%2?k.addClass(a,"odd"):k.addClass(a,"even")}));if(0<a.length){var b=a[0];k.addClass(b,this._classFirstSimpleTableRow);(b=c("."+this._classRowUpDiv,
b)[0])&&k.addClass(b,this._classJimuStateDisabled);a=a[a.length-1];k.addClass(a,this._classLastSimpleTableRow);(a=c("."+this._classRowDownDiv,a)[0])&&k.addClass(a,this._classJimuStateDisabled)}},_createTextTd:function(a,b,c){var d=null;return d=b.editable?this._createEditableTextTd(a,b,c):this._createNormalTextTd(a,b,c)},_createNormalTextTd:function(a,b,d){var e=k.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');k.addClass(e,
b.name);var g=c("div",e)[0];g.innerHTML=d||"";g.title=d||"";b["class"]&&k.addClass(e,b["class"]);k.place(e,a);return e},_createEditableTextTd:function(b,f,e){var g=k.toDom('\x3ctd class\x3d"editable-text-td '+f.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');k.addClass(g,"simple-table-cell");k.place(g,b);f["class"]&&k.addClass(g,f["class"]);var l=c("div",g)[0],h=c("input",g)[0];l.innerHTML=e||
"";""!==l.innerHTML&&(l.title=l.innerHTML);h.value=l.innerHTML;this.own(a(l,"dblclick",d.hitch(this,function(a){a.stopPropagation();h.value=l.innerHTML;k.setStyle(l,"display","none");k.setStyle(h,"display","inline");h.focus()})));this.own(a(h,"blur",d.hitch(this,function(){h.value=d.trim(h.value);var a=l.innerHTML,c=h.value;""!==c?f.unique?0<this.getRowDataArrayByFieldValue(f.name,c,b).length?h.value=a:l.innerHTML=c:l.innerHTML=c:h.value=a;k.setStyle(h,"display","none");k.setStyle(l,"display","block")})));
return g},_createRadioTd:function(a,b,d){var e=k.toDom('\x3ctd class\x3d"radio-td '+b.name+'"\x3e\x3cinput type\x3d"radio" /\x3e\x3c/td\x3e');k.addClass(e,"simple-table-cell");k.place(e,a);b["class"]&&k.addClass(e,b["class"]);a=c("input",e)[0];a.name=b.radio&&"row"===b.radio?this._name+this._rowIndex:this._name+b.name;a.checked=!0===d;return e},_createCheckboxTd:function(a,b,d){var e=k.toDom('\x3ctd class\x3d"checkbox-td '+b.name+'"\x3e\x3cinput type\x3d"checkbox" /\x3e\x3c/td\x3e');k.addClass(e,
"simple-table-cell");k.place(e,a);b["class"]&&k.addClass(e,b["class"]);c("input",e)[0].checked=!0===d;return e},_createActionsTd:function(b,f){var e=k.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');k.addClass(e,"simple-table-cell");var g=c(".action-item-parent",e)[0];k.place(e,b);f["class"]&&k.addClass(e,f["class"]);l.forEach(f.actions,d.hitch(this,function(f){"up"===f?(f=k.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},
g),f.title=this.nls.moveUp,this.own(a(f,"click",d.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowUp(b)){a=c(".simple-table-row",this.tbody);var d=l.indexOf(a,b);if(0<d&&(a=a[d-1]))k.place(b,a,"before"),this._updateUI(),this.emit("row-up",b)}})))):"down"===f?(f=k.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},g),f.title=this.nls.moveDown,this.own(a(f,"click",d.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowDown(b)){a=c(".simple-table-row",
this.tbody);var d=l.indexOf(a,b);if(d<a.length-1&&(a=a[d+1]))k.place(b,a,"after"),this._updateUI(),this.emit("row-down",b)}})))):"edit"===f?(f=k.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},g),f.title=this.nls.edit,this.own(a(f,"click",d.hitch(this,function(a){a.stopPropagation();this.onBeforeRowEdit(b)&&this._onActionsEdit(b)})))):"delete"===f&&(f=k.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},g),
f.title=this.nls.deleteRow,this.own(a(f,"click",d.hitch(this,function(a){a.stopPropagation();this.onBeforeRowDelete(b)&&this.deleteRow(b)}))))}));var h=this._calculateActionsWidth(f)+"px";k.setStyle(g,"width",h);return e},_calculateActionsWidth:function(a){return 20*l.map(a.actions,function(a){return"up"===a||"down"===a||"edit"===a||"delete"===a}).length},_createEmptyTd:function(a,b){var c=k.create("td",{"class":b.name},a);k.addClass(c,"simple-table-cell");k.addClass(c,"empty-text-td");b["class"]&&
k.addClass(c,b["class"]);return c},_createExtensionTd:function(a,b,c){a=k.create("td",{"class":b.name},a);k.addClass(a,"simple-table-cell");k.addClass(a,"extension-td");b["class"]&&k.addClass(a,b["class"]);b.create&&"function"===typeof b.create&&b.create(a);b.setValue&&"function"===typeof b.setValue&&b.setValue(a,c);return a},editRow:function(a,b){var e={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof b||!k.isDescendant(a,this.tbody))return e;
var g=d.mixin([],this.fields),g=l.filter(g,d.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),g=l.filter(g,d.hitch(this,function(c){return 0<this.getRowDataArrayByFieldValue(c.name,b[c.name],a).length}));if(0<g.length)return e.errorCode=this.REPEATING_ERROR,e.errorMessage="repeating data",e.repeatFields=g,e;var h=c(".simple-table-cell",a);l.forEach(this.fields,d.hitch(this,function(a,c){if(b.hasOwnProperty(a.name)){var d=h[c],e=b[a.name],g=a.type;"text"===g?a.editable?this._editEditableText(d,
a,e):this._editNormalText(d,a,e):"radio"===g?this._editRadio(d,a,e):"checkbox"===g?this._editCheckbox(d,a,e):"extension"===g&&this._editExtension(d,a,e)}}));e.success=!0;e.tr=a;e.errorMessage=null;this._onEditRow(a);return e},_editNormalText:function(a,b,d){a=c("div",a)[0];a.innerHTML=d||"";a.title=a.innerHTML},_editEditableText:function(a,b,d){b=c("div",a)[0];b.innerHTML=d||"";c("input",a)[0].value=b.innerHTML},_editRadio:function(a,b,d){c("input",a)[0].checked=!0===d},_editCheckbox:function(a,b,
d){c("input",a)[0].checked=!0===d},_editExtension:function(a,b,c){b.setValue&&"function"===typeof b.setValue&&b.setValue(a,c)},_getAllRows:function(){return c(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var a=this._getAllRows();return l.filter(a,d.hitch(this,function(a){return!k.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return l.filter(a,d.hitch(this,function(a){return k.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=
null,b=c(".simple-table-row",this.tbody),b=l.filter(b,d.hitch(this,function(a){return!k.hasClass(a,"empty")&&k.hasClass(a,"jimu-state-active")}));0<b.length&&(a=b[0]);return a},getSelectedRowData:function(){var a=null,b=this.getSelectedRow();b&&(a=this._getRowDataByTr(b));return a},getData:function(a){var b=this._getNotEmptyRows();a&&(b=l.filter(b,d.hitch(this,function(b){return b!==a})));return l.map(b,d.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},
_getRowDataByTr:function(a){var b=null;if(a)b={};else return null;l.forEach(this.fields,d.hitch(this,function(d){var e=d.type;if("actions"!==e){var g=d.name;b[g]=null;var k=c("."+g,a)[0];k&&("text"===e?(d=c("div",k)[0],b[g]=d.innerHTML):"radio"===e?(d=c("input",k)[0],b[g]=d.checked):"checkbox"===e?(d=c("input",k)[0],b[g]=d.checked):"extension"===e&&d.getValue&&"function"===typeof d.getValue&&(b[g]=d.getValue(k,d)))}}));return b},getRowDataArrayByFieldValue:function(a,b,c){var e=[];if(!this.fields||
!l.some(this.fields,d.hitch(this,function(b){return b.name===a})))return[];c=this.getData(c);return e=l.filter(c,d.hitch(this,function(c){return c[a]==b}))},_onClickRow:function(a){this.emit("row-click",a)},_onDblClickRow:function(a){this.emit("row-dblclick",a)},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a){this.emit("row-delete",a)},_onEnterRow:function(a){this.emit("row-enter",
a)},_onClearRows:function(a){this.emit("rows-clear",a)},_onActionsEdit:function(a){this.emit("actions-edit",a)},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},onBeforeRowDelete:function(a){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(m,e,g,h,d,k,l,a,
c,b){return m([l,a,k],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new c(null,this.containerNode);var a=100*(1/this.tabs.length);this.isNested&&h.addClass(this.domNode,
"nested");g.forEach(this.tabs,function(b){this._createTab(b,a)},this)}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);b.setVerticalCenter(this.domNode)},_createTab:function(a,b){var c;c=h.create("div",{innerHTML:a.title,"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":b+"%"},label:a.title},this.controlNode);this.viewStack.viewType=a.content.domNode?"dijit":"dom";a.content.label=a.title;this.viewStack.addView(a.content);
this.own(d(c,"click",e.hitch(this,this.onSelect,a.title)));c.label=a.title;this.controlNodes.push(c)},onSelect:function(a){this.selectTab(a)},selectTab:function(a){this._selectControl(a);this.viewStack.switchView(a);this.emit("tabChanged",a)},_selectControl:function(a){g.forEach(this.controlNodes,function(b){h.removeClass(b,"jimu-state-selected");b.label===a&&h.addClass(b,"jimu-state-selected")})}})})},"jimu/dijit/ViewStack":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html",
"dojo/_base/array","dijit/_WidgetBase"],function(m,e,g,h,d){return m(d,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);h.forEach(this.views,e.hitch(this,function(d){1===d.nodeType?(g.place(d,this.domNode),g.addClass(d,"view"),g.setStyle(d,"display","none")):d.domNode&&(g.place(d.domNode,this.domNode),g.addClass(d.domNode,"view"),g.setStyle(d.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);
0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var d="",e=this.getSelectedView();e&&(d=e.label);return d},getViewByLabel:function(d){for(var e=0;e<this.views.length;e++)if(d===this.views[e].label)return this.views[e];return null},addView:function(d){this.views.push(d);1===d.nodeType?(g.place(d,this.domNode),g.addClass(d,"view")):d.domNode&&(g.place(d.domNode,this.domNode),g.addClass(d.domNode,"view"))},removeView:function(d){var e=
this.views.length;this.views=h.filter(this.views,function(a){return d!==a});e!==this.views.length&&(1===d.nodeType?g.destroy(d):d.domNode&&d.destroyRecursive())},switchView:function(d){var l,a;l="number"===typeof d?this.views[d]:"string"===typeof d?this.getViewByLabel(d):d;this.views.forEach(e.hitch(this,function(c){c&&(1===c.nodeType?a=c:c.domNode&&(a=c.domNode),c===l?(g.setStyle(a,"display","block"),c.domNode&&!c._started&&(c.startup(),c._started=!0)):g.setStyle(a,"display","none"))}));this._currentView=
l;this.onViewSwitch(l)},onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack".split(" "),function(m,e,g,h,d,k,l,a,c,b,n){return m([a,c,k],{templateString:b,selected:"",tabs:null,average:!1,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,postCreate:function(){this.inherited(arguments);
this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(a){var b=l("td",this.tabTr);g.forEach(b,e.hitch(this,function(b,c){h.removeClass(b,"jimu-state-active");b.label===a&&(h.addClass(b,"jimu-state-active"),this._currentIndex=c)}));this.controlNode.removeChild(this.controlTable);h.place(this.controlTable,this.controlNode);this.viewStack.switchView(a);this.emit("tabChanged",a)},addTab:function(a){if(!this.average){var b=
l("td:last-child",this.tabTr);0<b.length&&h.destroy(b[0])}0<g.filter(this.tabs,function(b){return b.title===a.title}).length?console.error("tab title conflict: "+a.title):(this.tabs.push(a),this._createTab(a),this.average||(b=h.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e'),h.place(b,this.tabTr)))},removeTab:function(a){var b=-1;if(g.some(this.tabs,function(c,d){if(c.title===a)return b=d,!0})){var c=
this.tabs.splice(b,1)[0],d=l("td",this.tabTr),e;g.some(d,function(b){if(b.label===a)return e=b,!0})&&h.destroy(e);this.viewStack.removeView(c.content)}},showShelter:function(){h.setStyle(this.shelter,"display","block")},hideShelter:function(){h.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},_initSelf:function(){this.viewStack=new n(null,this.containerNode);g.forEach(this.tabs,function(a){this._createTab(a)},
this);if(this.average)this.controlTable.style.tableLayout="fixed";else{var a=h.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');h.place(a,this.tabTr)}},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(a){var b=h.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');b.label=a.title||"";h.place(b,this.tabTr);var c=
l(".tab-item-div",b)[0];c.innerHTML=b.label;c.label=b.label;a.content.label=b.label;this.viewStack.addView(a.content);this.own(d(b,"click",e.hitch(this,this._onSelect,a.title)))},_onSelect:function(a){this.selectTab(a)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(m,e,g,h){return m([h],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",constructor:function(){this.items=[];
this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(e.hitch(this,function(d){this._placeItem(d)}));this.resize()},_placeItem:function(d){d.domNode?g.place(d.domNode,this.domNode):g.place(d,this.domNode)},addItem:function(d){this.items.push(d);this._placeItem(d);this.resize()},addItems:function(d){this.items=this.items.concat(d);this.items.forEach(e.hitch(this,function(d){this._placeItem(d)}));this.resize()},removeItem:function(d){var e;for(e=0;e<this.items.length;e++)if(this.items[e].label===
d){this.items[e].domNode?this.items[e].destroy():g.destroy(this.items[e]);this.items.splice(e,1);this.resize();break}},empty:function(){var d;for(d=0;d<this.items.length;d++)this.items[d].domNode?this.items[d].destroy():g.destroy(this.items[d]);this.items=[]},resize:function(){var d,k,l;d=g.getMarginBox(this.domNode);k=this.getItemSize(d);l=Math.floor((d.w+this.hmargin)/(k.width+this.hmargin));this.items.forEach(e.hitch(this,function(a,c){this.setItemPosition(a,c,k,l)}))},getItemSize:function(d){var e=
{},g;if("fixWidth"===this.strategy)e.width=this.itemSize.width,e.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(g=0;g<this.itemSize.length;g++){if(d.w<=this.itemSize[g].screenWidth){e.width=this.itemSize[g].width;e.height=this.itemSize[g].height;break}}else"fixCols"===this.strategy&&(e.width=(d.w-this.hmargin*(this.maxCols-1))/this.maxCols,e.height="number"===typeof this.itemSize.height?this.itemSize.height:e.width*parseFloat(this.itemSize.height.substring(0,this.itemSize.height.length-
1))/100);return e},setItemPosition:function(d,e,l,a){e++;var c=e%a;e=Math.ceil(e/a);0===c&&(c=a);a={position:"absolute",top:(this.vmargin+l.height)*(e-1)+"px"};a[window.isRTL?"right":"left"]=(this.hmargin+l.width)*(c-1)+"px";0<=l.width&&(a.width=l.width+"px");0<=l.height&&(a.height=l.height+"px");g.setStyle(d.domNode?d.domNode:d,a)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer esri/toolbars/draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r){return m([e,g,h,n],{templateString:d,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);var a={};this.drawLayerId&&(a.id=
this.drawLayerId);this.drawLayer=new p(a);this._initDefaultSymbols();this._initTypes();a=b(".draw-item",this.domNode);this.own(a.on("click",k.hitch(this,this._onItemClick)));this.own(c(this.btnClear,"click",k.hitch(this,this.clear)));this.map&&this.setMap(this.map);l.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none")},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.drawToolBar&&
this.drawToolBar.deactivate();this.drawLayer&&this.map&&this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;this.inherited(arguments)},setMap:function(a){a&&(this.map=a,this.map.addLayer(this.drawLayer),this.drawToolBar=new t(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(c(this.drawToolBar,"draw-end",k.hitch(this,this._onDrawEnd))))},setPointSymbol:function(a){this.pointSymbol=
a;this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(a){this.polylineSymbol=a;this.drawToolBar.setLineSymbol(a)},setPolygonSymbol:function(a){this.polygonSymbol=a;this.drawToolBar.setFillSymbol(a)},setTextSymbol:function(a){this.textSymbol=a},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();this.drawToolBar&&this.drawToolBar.deactivate();b(".draw-item",this.domNode).removeClass("jimu-state-active")},activate:function(a){var c=
null,d=b(".draw-item",this.domNode);"TEXT"===a?(a="POINT",c=this.textIcon):(d=d.filter(function(b){return b.getAttribute("data-geotype")===a}),0<d.length&&(c=d[0]));c&&this._activate(c)},onIconSelected:function(a,b,c){this.emit("icon-selected",a,b,c)},onDrawEnd:function(a,b,c){this.emit("draw-end",a,b,c)},onClear:function(){this.emit("clear")},addGraphic:function(a){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(a)},removeGraphic:function(a){this.drawLayer.remove(a)},_initDefaultSymbols:function(){var a=
{style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},b={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},c={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=s.fromJson(a));this.polylineSymbol||(this.polylineSymbol=s.fromJson(b));this.polygonSymbol||(this.polygonSymbol=s.fromJson(c))},
_initTypes:function(){this.types instanceof Array||(this.types=["point","polyline","polygon"]);var c=b(".draw-item",this.domNode);c.style("display","none");a.forEach(c,k.hitch(this,function(b){var c=b.getAttribute("data-commontype"),c=0<=a.indexOf(this.types,c);if(null!==this.geoTypes)var d=b.getAttribute("data-geotype"),c=c&&0<=a.indexOf(this.geoTypes,d);l.setStyle(b,"display",c?"block":"none")}))},_onItemClick:function(a){a=a.target||a.srcElement;l.hasClass(a,"jimu-state-active")?this.deactivate():
this._activate(a)},_activate:function(a){b(".draw-item",this.domNode).removeClass("jimu-state-active");l.addClass(a,"jimu-state-active");var c=a.getAttribute("data-geotype"),d=a.getAttribute("data-commontype"),f=t[c];this.disableWebMapPopup();this.drawToolBar.activate(f);this.onIconSelected(a,c,d)},_onDrawEnd:function(a){var c=b(".draw-item.jimu-state-active",this.domNode)[0],d=c.getAttribute("data-geotype"),c=c.getAttribute("data-commontype"),e=null,e="extent"===a.geometry.type?r.fromExtent(a.geometry):
a.geometry;a=e.type;var g=null,g="point"===a||"multipoint"===a?l.hasClass(this.textIcon,"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===a||"polyline"===a?this.polylineSymbol:this.polygonSymbol,e=new f(e,g,null,null);this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(e);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(e,d,c)}})})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w,v,x,B,D,C,F,A){var z=m(s,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(b,c){this.markerSymbol=new r(r.STYLE_SOLID,10,new q(q.STYLE_SOLID,new d([255,0,0]),2),new d([0,0,0,0.25]));this.lineSymbol=new q(q.STYLE_SOLID,new d([255,0,0]),2);this.fillSymbol=new u(u.STYLE_SOLID,new q(q.STYLE_SOLID,new d([255,0,0]),2),new d([0,0,0,0.25]));this._points=[];this._mouse=!l("esri-touch")&&!l("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=e.mixin(e.mixin({},this._defaultOptions),c||{});if(a("ios")||a("android"))this._options.showTooltips=!1;this._onKeyDownHandler=e.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=e.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=e.hitch(this,this._onMouseUpHandler);this._onClickHandler=e.hitch(this,this._onClickHandler);this._onMouseMoveHandler=e.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=e.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=e.hitch(this,this._onDblClickHandler);this._updateTooltip=e.hitch(this,this._updateTooltip);this._hideTooltip=e.hitch(this,this._hideTooltip);this._redrawGraphic=e.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(a){this.respectDrawingVertexOrder=a},setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},
setFillSymbol:function(a){this.fillSymbol=a},activate:function(a,b){this._geometryType&&this.deactivate();var c=this.map,d=h.connect,f=z;this._options=e.mixin(e.mixin({},this._options),b||{});c.navigationManager.setImmediateClick(!1);switch(a){case f.ARROW:case f.LEFT_ARROW:case f.RIGHT_ARROW:case f.UP_ARROW:case f.DOWN_ARROW:case f.TRIANGLE:case f.CIRCLE:case f.ELLIPSE:case f.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));l("esri-touch")&&!l("esri-pointer")&&
(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case f.POINT:this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);break;case f.LINE:case f.EXTENT:case f.FREEHAND_POLYLINE:case f.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),
this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));l("esri-touch")&&!l("esri-pointer")&&(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),
this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case f.POLYLINE:case f.POLYGON:case f.MULTI_POINT:c.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._onDblClickHandler_connect=d(c,"onDblClick",this._onDblClickHandler);this._dblClickZoom=c.isDoubleClickZoom;c.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+
a);return}this._onKeyDown_connect=d(c,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=d(c,"onExtentChange",this._redrawGraphic);this._geometryType=a;this._toggleTooltip(!0);c.snappingManager&&("freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType)&&(c.snappingManager._startSelectionLayerQuery(),c.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var a=this.map;this._clear();var b=h.disconnect;b(this._onMouseMoveHandler_connect);
b(this._onMouseDownHandler_connect);b(this._onMouseDragHandler_connect);b(this._onMouseUpHandler_connect);b(this._onMouseDownHandler2_connect);b(this._onMouseDragHandler2_connect);b(this._onMouseUpHandler2_connect);b(this._onClickHandler_connect);b(this._onDblClickHandler_connect);b(this._onKeyDown_connect);b(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=
this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;a.snappingManager&&(a.snappingManager._stopSelectionLayerQuery(),a.snappingManager._killOffSnapping());switch(this._geometryType){case z.CIRCLE:case z.ELLIPSE:case z.TRIANGLE:case z.ARROW:case z.LEFT_ARROW:case z.RIGHT_ARROW:case z.UP_ARROW:case z.DOWN_ARROW:case z.RECTANGLE:case z.LINE:case z.EXTENT:case z.FREEHAND_POLYLINE:case z.FREEHAND_POLYGON:this._activateMapTools(!0,
!1,!1,!0);break;case z.POLYLINE:case z.POLYGON:case z.MULTI_POINT:this._dblClickZoom&&a.enableDoubleClickZoom()}b=this._geometryType;this._geometryType=null;a.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(b)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._tGraphic&&this.map.graphics.remove(this._tGraphic,!0);this._graphic=this._tGraphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},
finishDrawing:function(){var a,b=this._points,c=this.map.spatialReference,d=z,b=b.slice(0,b.length);switch(this._geometryType){case d.POLYLINE:if(!this._graphic||2>b.length)return;a=new B(c);a.addPath([].concat(b));break;case d.POLYGON:if(!this._graphic||3>b.length)return;a=new D(c);b=[].concat(b,[b[0].offset(0,0)]);!D.prototype.isClockwise(b)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),b.reverse());
a.addRing(b);break;case d.MULTI_POINT:a=new C(c),g.forEach(b,function(b){a.addPoint(b)})}h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_drawEnd:function(a){if(a){var b=this.map.spatialReference,c;this.onDrawEnd(a);b&&(b.isWebMercator()?c=x.webMercatorToGeographic(a,!0):4326===b.wkid&&(c=v.fromJson(a.toJson())));this.onDrawComplete({geometry:a,geographicGeometry:c})}},_normalizeRect:function(a,b,c){var d=a.x;a=a.y;var f=b.x;b=b.y;var e=Math.abs(d-
f),g=Math.abs(a-b);return{x:Math.min(d,f),y:Math.max(a,b),width:e,height:g,spatialReference:c}},_onMouseDownHandler:function(a){this._dragged=!1;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=b||a.mapPoint,d=z;b=this.map;var f=b.spatialReference;this._points.push(c.offset(0,0));switch(this._geometryType){case d.LINE:this._graphic=b.graphics.add(new w(new B({paths:[[[c.x,c.y],[c.x,c.y]]],spatialReference:f}),this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);
break;case d.FREEHAND_POLYLINE:this._oldPoint=a.screenPoint;c=new B(f);c.addPath(this._points);this._graphic=b.graphics.add(new w(c,this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case d.CIRCLE:case d.ELLIPSE:case d.TRIANGLE:case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.RECTANGLE:case d.FREEHAND_POLYGON:this._oldPoint=a.screenPoint,c=new D(f),c.addRing(this._points),this._graphic=b.graphics.add(new w(c,this.fillSymbol),
!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)}l("esri-touch")&&a.preventDefault()},_onMouseMoveHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[this._points.length-1];a=b||a.mapPoint;b=this._tGraphic;var d=b.geometry;switch(this._geometryType){case z.POLYLINE:case z.POLYGON:d.setPoint(0,0,{x:c.x,y:c.y}),d.setPoint(0,1,{x:a.x,y:a.y}),b.setGeometry(d)}},_onMouseDragHandler:function(a){if(this._graphic||this._points.length)if(l("esri-touch")&&
!this._points.length)a.preventDefault();else{this._dragged=!0;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0],d=b||a.mapPoint,f=this.map,g=f.spatialReference;b=this._graphic;var k=z,p=f.toScreen(c),n=f.toScreen(d),h=[],h=n.x-p.x,n=n.y-p.y,m=Math.sqrt(h*h+n*n);switch(this._geometryType){case k.CIRCLE:this._hideTooltip();b.geometry=D.createCircle({center:p,r:m,numberOfPoints:60,map:f});b.setGeometry(b.geometry);break;case k.ELLIPSE:this._hideTooltip();
b.geometry=D.createEllipse({center:p,longAxis:h,shortAxis:n,numberOfPoints:60,map:f});b.setGeometry(b.geometry);break;case k.TRIANGLE:this._hideTooltip();h=[[0,-m],[0.8660254037844386*m,0.5*m],[-0.8660254037844386*m,0.5*m],[0,-m]];b.geometry=this._toPolygon(h,p.x,p.y);b.setGeometry(b.geometry);break;case k.ARROW:this._hideTooltip();c=n/m;f=h/m;d=0.25*f*m;g=0.25*m/(n/h);m*=0.25*c;h=[[h,n],[h-d*(1+24/g),n+24*f-m],[h-d*(1+12/g),n+12*f-m],[-12*c,12*f],[12*c,-12*f],[h-d*(1-12/g),n-12*f-m],[h-d*(1-24/g),
n-24*f-m],[h,n]];b.geometry=this._toPolygon(h,p.x,p.y);b.setGeometry(b.geometry);break;case k.LEFT_ARROW:this._hideTooltip();h=0>=h?[[h,0],[0.75*h,n],[0.75*h,0.5*n],[0,0.5*n],[0,-0.5*n],[0.75*h,-0.5*n],[0.75*h,-n],[h,0]]:[[0,0],[0.25*h,n],[0.25*h,0.5*n],[h,0.5*n],[h,-0.5*n],[0.25*h,-0.5*n],[0.25*h,-n],[0,0]];b.geometry=this._toPolygon(h,p.x,p.y);b.setGeometry(b.geometry);break;case k.RIGHT_ARROW:this._hideTooltip();h=0<=h?[[h,0],[0.75*h,n],[0.75*h,0.5*n],[0,0.5*n],[0,-0.5*n],[0.75*h,-0.5*n],[0.75*
h,-n],[h,0]]:[[0,0],[0.25*h,n],[0.25*h,0.5*n],[h,0.5*n],[h,-0.5*n],[0.25*h,-0.5*n],[0.25*h,-n],[0,0]];b.geometry=this._toPolygon(h,p.x,p.y);b.setGeometry(b.geometry);break;case k.UP_ARROW:this._hideTooltip();h=0>=n?[[0,n],[-h,0.75*n],[-0.5*h,0.75*n],[-0.5*h,0],[0.5*h,0],[0.5*h,0.75*n],[h,0.75*n],[0,n]]:[[0,0],[-h,0.25*n],[-0.5*h,0.25*n],[-0.5*h,n],[0.5*h,n],[0.5*h,0.25*n],[h,0.25*n],[0,0]];b.geometry=this._toPolygon(h,p.x,p.y);b.setGeometry(b.geometry);break;case k.DOWN_ARROW:this._hideTooltip();
h=0<=n?[[0,n],[-h,0.75*n],[-0.5*h,0.75*n],[-0.5*h,0],[0.5*h,0],[0.5*h,0.75*n],[h,0.75*n],[0,n]]:[[0,0],[-h,0.25*n],[-0.5*h,0.25*n],[-0.5*h,n],[0.5*h,n],[0.5*h,0.25*n],[h,0.25*n],[0,0]];b.geometry=this._toPolygon(h,p.x,p.y);b.setGeometry(b.geometry);break;case k.RECTANGLE:this._hideTooltip();h=[[0,0],[h,0],[h,n],[0,n],[0,0]];b.geometry=this._toPolygon(h,p.x,p.y);b.setGeometry(b.geometry);break;case k.LINE:b.setGeometry(e.mixin(b.geometry,{paths:[[[c.x,c.y],[d.x,d.y]]]}));break;case k.EXTENT:b&&f.graphics.remove(b,
!0);b=new F(this._normalizeRect(c,d,g));b._originOnly=!0;this._graphic=f.graphics.add(new w(b,this.fillSymbol),!0);f.snappingManager&&f.snappingManager._setGraphic(this._graphic);break;case k.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){l("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry);break;case k.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){l("esri-touch")&&
a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry)}l("esri-touch")&&a.preventDefault()}},_canDrawFreehandPoint:function(a){if(!this._oldPoint)return!1;var b=this._oldPoint.x-a.screenPoint.x,c=this._oldPoint.y-a.screenPoint.y,d=this._options.tolerance;if((0>b?-1*b:b)<d&&(0>c?-1*c:c)<d)return!1;b=new Date;if(b-this._startTime<this._options.drawTime)return!1;this._startTime=b;this._oldPoint=a.screenPoint;return!0},
_onMouseUpHandler:function(a){if(!this._dragged||!this._graphic)this._clear();else{0===this._points.length&&this._points.push(a.mapPoint.offset(0,0));var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0];b=b||a.mapPoint;var d=this.map.spatialReference,f=z,e;switch(this._geometryType){case f.CIRCLE:case f.ELLIPSE:case f.TRIANGLE:case f.ARROW:case f.LEFT_ARROW:case f.RIGHT_ARROW:case f.UP_ARROW:case f.DOWN_ARROW:case f.RECTANGLE:e=this._graphic.geometry;break;
case f.LINE:e=new B({paths:[[[c.x,c.y],[b.x,b.y]]],spatialReference:d});break;case f.EXTENT:e=(new F(this._normalizeRect(c,b,d))).getExtent();break;case f.FREEHAND_POLYLINE:e=new B(d);e.addPath([].concat(this._points,[b.offset(0,0)]));break;case f.FREEHAND_POLYGON:e=new D(d),c=[].concat(this._points,[b.offset(0,0),this._points[0].offset(0,0)]),!D.prototype.isClockwise(c)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),
c.reverse()),e.addRing(c)}l("esri-touch")&&a.preventDefault();this._clear();this._drawEnd(e)}},_onClickHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);a=b||a.mapPoint;b=this.map;var c=b.toScreen(a),d=z;this._points.push(a.offset(0,0));switch(this._geometryType){case d.POINT:this._drawEnd(a.offset(0,0));this._setTooltipMessage(0);break;case d.POLYLINE:1===this._points.length?(c=new B(b.spatialReference),c.addPath(this._points),this._graphic=b.graphics.add(new w(c,
this.lineSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=h.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new w(new B({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.lineSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,
1,a.offset(0,0)),b.setGeometry(c));break;case d.POLYGON:1===this._points.length?(c=new D(b.spatialReference),c.addRing(this._points),this._graphic=b.graphics.add(new w(c,this.fillSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=h.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new w(new B({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.fillSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,
0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,1,a.offset(0,0)),b.setGeometry(c));break;case d.MULTI_POINT:a=this._points;1===a.length?(c=new C(b.spatialReference),c.addPoint(a[a.length-1]),this._graphic=b.graphics.add(new w(c,this.markerSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)):(this._graphic.geometry.addPoint(a[a.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));
break;case d.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],c.x,c.y);break;case d.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],c.x,c.y);break;case d.DOWN_ARROW:this._addShape([[0,
0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],c.x,c.y);break;case d.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],c.x,c.y);break;case d.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],c.x-48,c.y+48);break;case d.CIRCLE:this._clear();this._drawEnd(D.createCircle({center:c,r:48,numberOfPoints:60,map:b}));break;case d.ELLIPSE:this._clear(),this._drawEnd(D.createEllipse({center:c,longAxis:48,shortAxis:24,numberOfPoints:60,
map:b}))}this._setTooltipMessage(this._points.length)},_addShape:function(a,b,c){this._setTooltipMessage(0);this._clear();this._drawEnd(this._toPolygon(a,b,c))},_toPolygon:function(a,b,c){var d=this.map,f=new D(d.spatialReference);f.addRing(g.map(a,function(a){return d.toMap({x:a[0]+b,y:a[1]+c})}));return f},_onDblClickHandler:function(a){var b,c=this._points,d=this.map.spatialReference,f=z;l("esri-touch")&&c.push(a.mapPoint);var e=c[c.length-1],n=c[c.length-2],c=e&&n&&e.x===n.x&&e.y===n.y?c.slice(0,
c.length-1):c.slice(0,c.length);switch(this._geometryType){case f.POLYLINE:if(!this._graphic||2>c.length){h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new B(d);b.addPath([].concat(c));break;case f.POLYGON:if(!this._graphic||2>c.length){h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new D(d);a=[].concat(c,[c[0].offset(0,0)]);!D.prototype.isClockwise(a)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+
" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),a.reverse());b.addRing(a);break;case f.MULTI_POINT:b=new C(d),g.forEach(c,function(a){b.addPoint(a)})}h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(b)},_onKeyDownHandler:function(a){a.keyCode===c.ESCAPE&&(h.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(a){this._options.showTooltips&&(a?this._tooltip||
(this._tooltip=b.create("div",{"class":"tooltip"},this.map.container),f.isBodyLtr()||n.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=h.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=h.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=h.connect(this.map,"onMouseMove",this._updateTooltip)):
this._tooltip&&(h.disconnect(this._onTooltipMouseEnterHandler_connect),h.disconnect(this._onTooltipMouseLeaveHandler_connect),h.disconnect(this._onTooltipMouseMoveHandler_connect),b.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var a=this._tooltip;a&&(a.style.display="none")},_setTooltipMessage:function(a){var b=this._tooltip;if(b){var c="";switch(this._geometryType){case z.POINT:c=A.toolbars.draw.addPoint;break;case z.ARROW:case z.LEFT_ARROW:case z.RIGHT_ARROW:case z.UP_ARROW:case z.DOWN_ARROW:case z.TRIANGLE:case z.RECTANGLE:case z.CIRCLE:case z.ELLIPSE:c=
A.toolbars.draw.addShape;break;case z.LINE:case z.EXTENT:case z.FREEHAND_POLYLINE:case z.FREEHAND_POLYGON:c=A.toolbars.draw.freehand;break;case z.POLYLINE:case z.POLYGON:c=A.toolbars.draw.start;1===a?c=A.toolbars.draw.resume:2<=a&&(c=A.toolbars.draw.complete);break;case z.MULTI_POINT:c=A.toolbars.draw.addMultipoint,1<=a&&(c=A.toolbars.draw.finish)}b.innerHTML=c}},_updateTooltip:function(a){var b=this._tooltip;if(b){var c;a.clientX||a.pageY?(c=a.clientX,a=a.clientY):(c=a.clientX+k.body().scrollLeft-
k.body().clientLeft,a=a.clientY+k.body().scrollTop-k.body().clientTop);b.style.display="none";n.set(b,{left:c+this._options.tooltipOffset+"px",top:a+"px"});b.style.display=""}},_redrawGraphic:function(a,b,c,d){if(c||this.map.wrapAround180)(a=this._graphic)&&a.setGeometry(a.geometry),(a=this._tGraphic)&&a.setGeometry(a.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawEnd:function(){}});e.mixin(z,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",
POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});return z})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(m,e,g,h,d){return m([d],{declaredClass:"esri.toolbars._Toolbar",constructor:function(d){this.map=
d},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(d,e,a,c){var b=this.map;d&&(this._mapNavState={isDoubleClickZoom:b.isDoubleClickZoom,isClickRecenter:b.isClickRecenter,isPan:b.isPan,isRubberBandZoom:b.isRubberBandZoom,isKeyboardNavigation:b.isKeyboardNavigation,isScrollWheelZoom:b.isScrollWheelZoom},b.disableDoubleClickZoom(),
b.disableClickRecenter(),b.disablePan(),b.disableRubberBandZoom(),b.disableKeyboardNavigation());e&&b.hideZoomSlider();a&&b.hidePanArrows();c&&b.graphics.disableMouseEvents()},_activateMapTools:function(d,e,a,c){var b=this.map,g=this._mapNavState;d&&g&&(g.isDoubleClickZoom&&b.enableDoubleClickZoom(),g.isClickRecenter&&b.enableClickRecenter(),g.isPan&&b.enablePan(),g.isRubberBandZoom&&b.enableRubberBandZoom(),g.isKeyboardNavigation&&b.enableKeyboardNavigation(),g.isScrollWheelZoom&&b.enableScrollWheelZoom());
e&&b.showZoomSlider();a&&b.showPanArrows();c&&b.graphics.enableMouseEvents()}})})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(m,e,g,h){return m([g],{required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,declaredClass:"jimu.dijit.URLInput",postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:
"Invalid Url"},postCreate:function(){this.inherited(arguments);e.addClass(this.domNode,"jimu-url-input")},validator:function(d){if(isFinite(d))return!1;var e="^"+h.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),e=RegExp(e,"g").test(d);return this.rest?(d=/\/rest\/services/gi.test(d),e&&d):e}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(m,e,g){var h=m.getObject("validate.regexp",!0,g);return h=g.validate.regexp={ipAddress:function(d){d=
"object"==typeof d?d:{};"boolean"!=typeof d.allowDottedDecimal&&(d.allowDottedDecimal=!0);"boolean"!=typeof d.allowDottedHex&&(d.allowDottedHex=!0);"boolean"!=typeof d.allowDottedOctal&&(d.allowDottedOctal=!0);"boolean"!=typeof d.allowDecimal&&(d.allowDecimal=!0);"boolean"!=typeof d.allowHex&&(d.allowHex=!0);"boolean"!=typeof d.allowIPv6&&(d.allowIPv6=!0);"boolean"!=typeof d.allowHybrid&&(d.allowHybrid=!0);var e=[];d.allowDottedDecimal&&e.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
d.allowDottedHex&&e.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");d.allowDottedOctal&&e.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");d.allowDecimal&&e.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");d.allowHex&&e.push("0[xX]0*[\\da-fA-F]{1,8}");d.allowIPv6&&e.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");d.allowHybrid&&e.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
d="";0<e.length&&(d="("+e.join("|")+")");return d},host:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowIP&&(d.allowIP=!0);"boolean"!=typeof d.allowLocal&&(d.allowLocal=!1);"boolean"!=typeof d.allowPort&&(d.allowPort=!0);"boolean"!=typeof d.allowNamed&&(d.allowNamed=!1);var e=d.allowPort?"(\\:\\d+)?":"",g="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)";d.allowIP&&(g+="|"+h.ipAddress(d));d.allowLocal&&(g+="|localhost");d.allowNamed&&
(g+="|^[^-][a-zA-Z0-9_-]*");return"("+g+")"+e},url:function(d){d="object"==typeof d?d:{};"scheme"in d||(d.scheme=[!0,!1]);return e.buildGroupRE(d.scheme,function(d){return d?"(https?|ftps?)\\://":""})+h.host(d)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},emailAddress:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowCruft&&(d.allowCruft=!1);d.allowPort=!1;var e="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+h.host(d);d.allowCruft&&
(e="\x3c?(mailto\\:)?"+e+"\x3e?");return e},emailAddressList:function(d){d="object"==typeof d?d:{};"string"!=typeof d.listSeparator&&(d.listSeparator="\\s;,");var e=h.emailAddress(d);return"("+e+"\\s*["+d.listSeparator+"]\\s*)*"+e+"\\s*["+d.listSeparator+"]?\\s*"},numberFormat:function(d){d="object"==typeof d?d:{};"undefined"==typeof d.format&&(d.format="###-###-####");return e.buildGroupRE(d.format,function(d){return e.escapeString(d,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},
province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(d){d="object"==typeof d?d:{};"boolean"!=typeof d.allowTerritories&&(d.allowTerritories=!0);"boolean"!=typeof d.allowMilitary&&(d.allowMilitary=!0);var e="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";d.allowTerritories&&(e+="|AS|FM|GU|MH|MP|PW|PR|VI");d.allowMilitary&&(e+="|AA|AE|AP");return"("+e+")"}}}})},
"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(m,e,g,h,d,k,l,a,c){return m([l,k],{baseClass:"jimu-panel jimu-on-screen-widget-panel",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(a){a.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(a){a.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(g.removeClass(this.foldableNode,"fold-up"),g.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(g.removeClass(this.foldableNode,"fold-down"),g.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(a){this.panelManager.closePanel(this);a.stopPropagation()},_normalizePositionObj:function(a){var c=this._getLayoutBox();a.left=
isFinite(a.left)?a.left:c.w-a.right;a.top=isFinite(a.top)?a.top:c.h-a.bottom;delete a.right;delete a.bottom;this.position=e.mixin(e.clone(this.position),a)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new c({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(a,c){this.disableMoveable();var f=g.getMarginBox(jimuConfig.layoutId);f.l=f.l-a+c;f.w+=2*(a-c);this.moveable=new d.boxConstrainedMoveable(this.domNode,{box:f,handle:this.titleNode,within:!0});this.own(h(this.moveable,
"Moving",e.hitch(this,this.onMoving)));this.own(h(this.moveable,"MoveStop",e.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){g.removeClass(this.titleNode,"title-normal");g.addClass(this.titleNode,"title-full");g.setStyle(this.foldableNode,"display",
"block");g.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(g.removeClass(this.foldableNode,"fold-up"),g.addClass(this.foldableNode,"fold-down")):(g.removeClass(this.foldableNode,"fold-down"),g.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){g.removeClass(this.titleNode,"title-full");g.addClass(this.titleNode,"title-normal");g.setStyle(this.foldableNode,"display","none");g.setStyle(this.maxNode,"display","none")},resize:function(a){var c=this._getPositionInfo(),
d={left:c.position.left,top:c.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};a&&(a.t=this.domNode.offsetTop,d.left=isFinite(a.l)?a.l:d.left,d.top=isFinite(a.t)?a.t:d.top,d.width=isFinite(a.w)?a.w:d.width,d.height=isFinite(a.h)?a.h:d.height,this._normalizePositionObj(e.clone(d)),this.makePositionInfoBox(),d.width=this._positionInfoBox.w,d.height=this._positionInfoBox.h);c.position=d;this._onResponsible(c);this.inherited(arguments)},_onResponsible:function(a){a.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(a.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(a){this._normalizePositionObj(a);this.makePositionInfoBox();a=this._getPositionInfo();this._onResponsible(a)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var a=jimuConfig.layoutId,
a="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return g.getMarginBox(a)},_getPositionInfo:function(){var a={isRunInMobile:!1,position:{left:0,top:5}},c=this._getLayoutBox(),d=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return a.isRunInMobile=!0,a;a.position.left=window.isRTL?c.w-d:d;var d=this._positionInfoBox.t,e=c.h-d;d>=e?d>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):e>=this._positionInfoBox.h&&(a.position.top=
this._positionInfoBox.t+40+3);!a.isRunInMobile&&a.position.left+this._positionInfoBox.w>c.w&&(a.position.left-=this._positionInfoBox.w);return a},_setMobilePosition:function(){g.place(this.domNode,jimuConfig.layoutId);var b=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(b.zIndex=this.position.zIndex);var c=a.getPositionStyle(b);e.mixin(c,b.borderRadiusStyle);g.setStyle(this.domNode,c)},_setDesktopPosition:function(a){g.place(this.domNode,jimuConfig.mapId);g.setStyle(this.domNode,
{left:a.left+"px",right:"auto",top:a.top+"px",width:(a.width||this.position.width||this._originalBox.w)+"px",height:(a.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(a){g.setStyle(a.node,"opacity",0.9)},onMoveStop:function(a){g.setStyle(a.node,"opacity",1);a=g.getMarginBox(a.node);this._normalizePositionObj(e.clone({left:a.l,top:a.t,width:a.w,height:a.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q){m.experimental("dojox.layout.ResizeHandle");var u=p("dojox.layout._ResizeHelper",r,{show:function(){f.set(this.domNode,"display","")},hide:function(){f.set(this.domNode,"display","none")},resize:function(a){n.setMarginBox(this.domNode,a)}});return p("dojox.layout.ResizeHandle",[r,q],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,t.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=s.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new u({id:"dojoxGlobalResizeHelper"})).placeAt(l.body()),
b.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=e.partial(b.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(a){if(!this._isSizing&&
(g.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=s.byId(this.targetId))?this.targetWidget.domNode:c.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var b=n.position(this.targetDomNode,!0);this._resizeHelper.resize({l:b.x,t:b.y,w:b.w,h:b.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:b.x,t:b.y})}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};
var b=f.getComputedStyle(this.targetDomNode),e="border-model"===n.boxModel?{w:0,h:0}:n.getPadBorderExtents(this.targetDomNode,b),h=n.getMarginExtents(this.targetDomNode,b);this.startSize={w:f.get(this.targetDomNode,"width",b),h:f.get(this.targetDomNode,"height",b),pbw:e.w,pbh:e.h,mw:h.w,mh:h.h};!this.isLeftToRight()&&"absolute"==f.get(this.targetDomNode,"position")&&(b=n.position(this.targetDomNode,!0),this.startPosition={l:b.x,t:b.y});this._pconnects=[g.connect(l.doc,t.move,this,"_updateSizing"),
g.connect(l.doc,t.release,this,"_endSizing")];d.stop(a)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(d){return!1}this._activeResizeLastEvent=a;var f=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),e=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
f:0);e=this._checkConstraints(a,this.startSize.h-(this._resizeY?e:0));if((c=c||this.startPosition)&&this._resizeX)e.l=c.l+f,e.w!=a&&(e.l+=a-e.w),e.t=c.t;switch(b){case "margin":e.w+=this.startSize.mw,e.h+=this.startSize.mh;case "border":e.w+=this.startSize.pbw,e.h+=this.startSize.pbh}return e},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
d=this.startSize.h,f=c*b-d*a;0>f?a=b*c/d:0<f&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(b){var c=this.targetWidget&&e.isFunction(this.targetWidget.resize),d=this._getNewCoords(b,c&&"margin");if(!1!==d&&(c?this.targetWidget.resize(d):this.animateSizing?a[this.animateMethod]([k.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:d.w}},duration:this.animateDuration}),k.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:d.h}},
duration:this.animateDuration})]).play():f.set(this.targetDomNode,{width:d.w+"px",height:d.h+"px"}),this.intermediateChanges))this.onResize(b)},_endSizing:function(a){h.forEach(this._pconnects,g.disconnect);var b=e.partial(g.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"jimu/LayerInfos/LayerInfoForCollection":function(){define(["dojo/_base/declare",
"dojo/_base/array","esri/graphicsUtils","./LayerInfo","./LayerInfoFactory"],function(m,e,g,h,d){return m(h,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection"}},getExtent:function(){var d=[],h;e.forEach(this.originOperLayer.featureCollection.layers,function(a){d=d.concat(a.layerObject.graphics)});0===d.length?h=null:(h=1===d.length?d[0].getLayer().fullExtent:g.graphicsExtent(d),h=this._convertGeometryToMapSpatialRef(h));return h},initVisible:function(){var d=
!1,e;for(e=0;e<this.newSubLayers.length;e++)d=d||this.newSubLayers[e].layerObject.visible;d&&(this._visible=!0)},_setTopLayerVisible:function(d){this._visible=d?!0:!1;e.forEach(this.newSubLayers,function(d){d.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var g=[];e.forEach(this.originOperLayer.featureCollection.layers,function(e){this._getLayerIndexesInMapByLayerId(e.layerObject.id)&&(e=d.getInstance().create({layerObject:e.layerObject,title:e.layerObject.label||
e.layerObject.title||e.layerObject.name||e.layerObject.id||" ",id:e.id||" ",collection:{layerInfo:this},selfType:"collection",showLegend:e.showLegend,parentLayerInfo:this}),g.push(e),e.init())},this);g.reverse();return g},_obtainLayerIndexesInMap:function(){var d=[],e,a;for(a=0;a<this.newSubLayers.length;a++)(e=this._getLayerIndexesInMapByLayerId(this.newSubLayers[a].layerObject.id))&&d.push(e);return d},moveLeftOfIndex:function(d){var e;for(e=this.newSubLayers.length-1;0<=e;e--)this.map.reorderLayer(this.newSubLayers[e].layerObject,
d)},moveRightOfIndex:function(d){var e;for(e=0;e<this.newSubLayers.length;e++)this.map.reorderLayer(this.newSubLayers[e].layerObject,d)},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic esri/config esri/tasks/ProjectParameters esri/SpatialReference esri/geometry/webMercatorUtils".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n){return m(null,{originOperLayer:null,layerObject:null,map:null,title:null,id:null,newSubLayers:null,parentLayerInfo:null,_oldIsShowInMap:null,_eventHandles:null,constructor:function(a,b){this.originOperLayer=a;this.layerObject=a.layerObject;this.map=b;this.title=this.originOperLayer.title;this.id=this.originOperLayer.id;this.parentLayerInfo=a.parentLayerInfo?a.parentLayerInfo:null;this.nls=window.jimuNls.layerInfosMenu;this._eventHandles=[];this._bindEvent()},init:function(){this.newSubLayers=
this.obtainNewSubLayers();this.initVisible();this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap()},isGraphicLayer:function(){var a=this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},getExtent:function(){},getOpacity:function(){var a,b=0;for(a=0;a<this.newSubLayers.length;a++)if(this.newSubLayers[a].layerObject.opacity)b=this.newSubLayers[a].layerObject.opacity>
b?this.newSubLayers[a].layerObject.opacity:b;else return 1;return b},setOpacity:function(a){e.forEach(this.newSubLayers,function(b){b.layerObject.setOpacity&&b.layerObject.setOpacity(a)})},moveLeftOfIndex:function(a){this.map.reorderLayer(this.layerObject,a)},moveRightOfIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var b=this.getSubLayers(),c=0;c<b.length;c++)if(b[c].traversal(a))return!0},findLayerInfoById:function(a){var b=null,c=0;if(this.id&&
this.id===a)return this;for(c=0;c<this.newSubLayers.length&&!(b=this.newSubLayers[c].findLayerInfoById(a));c++);return b},setTopLayerVisible:function(a){this._setTopLayerVisible(a)},_setTopLayerVisible:function(a){},setSubLayerVisible:function(a,b){},setLayerVisiblefromTopLayer:function(){},initVisible:function(){},isVisible:function(){return this._visible},_obtainLayerIndexesInMap:function(){var a=[],b;(b=this._getLayerIndexesInMapByLayerId(this.id))&&a.push(b);return a},_getLayerIndexesInMapByLayerId:function(a){var b;
for(b=0;b<this.map.graphicsLayerIds.length;b++)if(this.map.graphicsLayerIds[b]===a)return{isGraphicLayer:!0,index:b};for(b=0;b<this.map.layerIds.length;b++)if(this.map.layerIds[b]===a)return{isGraphicLayer:!1,index:b};return null},_convertGeometryToMapSpatialRef:function(d){var e=new h;if(this.map.spatialReference.equals(d.spatialReference))return e.resolve([d]),e;if(this.map.spatialReference.isWebMercator()&&d.spatialReference.equals(new b(4326)))return e.resolve([n.geographicToWebMercator(d)]),
e;if(this.map.spatialReference.equals(new b(4326))&&d.spatialReference.isWebMercator())return e.resolve([n.webMercatorToGeographic(d)]),e;e=new c;e.geometries=[d];e.outSR=this.map.spatialReference;return a.defaults.geometryService.project(e)},_isShowInMapChanged:function(a){var b=this.isShowInMap();if(a!==b){!1===b&&this.map.infoWindow.hide();var c=[];this.traversal(function(a){c.push(a)});l.publish("layerInfos/layerInfo/isShowInMapChanged",c)}},_isShowInMapChanged2:function(){var a=this.isShowInMap();
!1===a&&this.map.infoWindow.hide();this._oldIsShowInMap!==a&&(this._oldIsShowInMap=a,l.publish("layerInfos/layerInfo/isShowInMapChanged",[this]));e.forEach(this.getSubLayers(),function(a){a._isShowInMapChanged2()})},_visibleChanged:function(){l.publish("layerInfos/layerInfo/visibleChanged",[this])},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return k.create("div",{"class":"legends-div"})},drawLegends:function(a,b){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},
_isItemLayer:function(){return this.originOperLayer.itemId||this.layerObject._itemId},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},getLayerObject:function(){var a=new h;this.layerObject?a.resolve(this.layerObject):a.reject("layerObject is null");return a},getSubLayers:function(){return this.newSubLayers},isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},isShowInMap:function(){for(var a=
!0,b=this;b;)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},getLayerType:function(){var a=[null],b=new h;this.layerObject.declaredClass&&(a=this.layerObject.declaredClass.split("."));b.resolve(a[a.length-1]);return b},getPopupInfo:function(){return this.originOperLayer.popupInfo},loadInfoTemplate:function(){var a=new h;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?this.originOperLayer.layerDefinition.definitionExpression:
null},getShowLegendOfWebmap:function(){for(var a=this,b=!0;a;)b=b&&a._getShowLegendOfWebmap(),a=a.parentLayerInfo;return b},getUrl:function(){return this.layerObject.url},hasLayerTypes:function(a){},getSupportTableInfo:function(){var a=new h,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},c=this.getLayerType(),e=this.getLayerObject();d({type:c,layerObject:e}).then(g.hitch(this,function(c){var d=c.type;c=c.layerObject;b.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(b.isSupportedLayer=
!0);if(c){if(!c.url||c.capabilities&&0<=c.capabilities.indexOf("Query"))b.isSupportQuery=!0}else b.isSupportQuery=!1;a.resolve(b)}),function(){a.resolve(b)});return a},removeSubLayerById:function(a){var b=[];e.forEach(this.newSubLayers,function(c){c.id!==a&&b.push(c)});this.newSubLayers=b},destroy:function(){e.forEach(this._eventHandles,function(a){a.remove()});this.inherited(arguments)},destroyLayerInfo:function(){e.forEach(this.newSubLayers,function(a){a.destroyLayerInfo()});this.destroy()},_bindEvent:function(){if(this.layerObject&&
!this.layerObject.empty){var a=this.layerObject.on("visibility-change",g.hitch(this,this._onVisibilityChanged));this._eventHandles.push(a)}},_onVisibilityChanged:function(){this.initVisible();this._visibleChanged();this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/lang ./LayerInfoFactory".split(" "),function(m,e,g,h,d,k,l,a,c,
b,n){return m(a,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,constructor:function(a,b){this._initJsapiLayerInfos();this.initSubLayerVisible();this._sublayerIdent={definitions:[],empty:!0,defLoad:new h};this._sublayerIdent.definitions[this.layerObject.layerInfos.length-1]=null;this._initControlPopup()},_initJsapiLayerInfos:function(){var a=e.filter(this.originOperLayer.layers,function(a){return b.isDefined(a.id)&&b.isDefined(a.name)&&b.isDefined(a.minScale)&&b.isDefined(a.maxScale)&&
b.isDefined(a.parentLayerId)&&b.isDefined(a.defaultVisibility)});this._jsapiLayerInfos=0<a.length?a:this.layerObject.layerInfos},_idIsInJsapiLayerInfos:function(a){return 0<e.filter(this._jsapiLayerInfos,function(b){return b.id===a}).length?!0:!1},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:g.clone(this.layerObject.infoTemplates)};this.layerObject._infoTemplates=g.clone(this.layerObject.infoTemplates);k.after(this.layerObject,"setInfoTemplates",g.hitch(this,
function(){this.layerObject._infoTemplates=g.clone(this.layerObject.infoTemplates);this.controlPopupInfo.infoTemplates=g.clone(this.layerObject.infoTemplates);this.traversal(function(a){a._afterSetInfoTemplates&&a._afterSetInfoTemplates()})}))},initSubLayerVisible:function(a){this.subLayerVisible=[];for(var b=this.subLayerVisible[this.layerObject.layerInfos.length-1]=0;b<this.subLayerVisible.length;b++)this.subLayerVisible[b]=0;a?e.forEach(a,function(a){this.subLayerVisible[a]++},this):this.originOperLayer.visibleLayers?
e.forEach(this.originOperLayer.visibleLayers,function(a){this.subLayerVisible[a]++},this):e.forEach(this.layerObject.layerInfos,function(a,b){a.defaultVisibility&&this.subLayerVisible[b]++},this)},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent)},initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(a){this.originOperLayer.layerObject.setVisibility(a);
this._visible=a},setSubLayerVisible:function(a){var b=[-1,-1,-1],c,d=e.filter(this.originOperLayer.layerObject.visibleLayers,function(a){return-1!==a}),g;for(g in a)if(a.hasOwnProperty(g)&&"function"!==typeof a[g]){var h=Number(g);a[g]?(c=e.indexOf(d,h),0>c&&d.push(h)):(c=e.indexOf(d,h),0<=c&&d.splice(c,1))}b=b.concat(d);this.originOperLayer.layerObject.setVisibleLayers(b)},obtainNewSubLayers:function(){var a=[],b=this.originOperLayer.layerObject,c=null,c="esri.layers.ArcGISDynamicMapServiceLayer"===
b.declaredClass?"dynamic":"tiled";e.forEach(b.layerInfos,function(d){var e=null,e=b.url+"/"+d.id,g=b.id+"_"+d.id;d.subLayerIds&&0<d.subLayerIds.length?(e={url:e,empty:!0},this._addNewSubLayer(a,e,g,d,c+"_group")):(e={url:e,empty:!0},this._addNewSubLayer(a,e,g,d,c))},this);var d=[];e.forEach(b.layerInfos,function(b,c){var d=b.parentLayerId;-1!==d&&this._idIsInJsapiLayerInfos(b.id)&&a[d].subLayers.push(a[c])},this);e.forEach(b.layerInfos,function(b,c){var e;-1===b.parentLayerId&&this._idIsInJsapiLayerInfos(b.id)&&
(e=n.getInstance().create(a[c]),d.push(e),e.init())},this);return d},_addNewSubLayer:function(a,b,c,d,e){a.push({layerObject:b,title:d.name||d.id||" ",id:c||" ",subLayers:[],mapService:{layerInfo:this,subId:d.id},selfType:"mapservice_"+e,parentLayerInfo:this})},_handleErrorSubLayer:function(a,b,c,d,e,g){a[b]={layerObject:null,title:g.name||g.id||" ",id:c||" ",subLayers:[],mapService:{layerInfo:this,subId:d}}},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&
this.layerObject.setOpacity(a)},getLegendInfo:function(a){var b=new h;this._legendInfo?b.resolve(this._legendInfo):this._legendRequest(a).then(g.hitch(this,function(a){this._legendInfo=a.layers;b.resolve(this._legendInfo)}),function(){b.reject()});return b},_legendRequest:function(a){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(a)},_legendRequestServer:function(){var a=this.layerObject.url+"/legend",b={f:"json"};this.layerObject._params.dynamicLayers&&
(b.dynamicLayers=d.stringify(this._createDynamicLayers(this.layerObject)),"[{}]"===b.dynamicLayers&&(b.dynamicLayers="[]"));return c({url:a,content:b,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(a){return c({url:a+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(a){var b=[],c;e.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();
var e;a.layerDefinitions&&a.layerDefinitions[d.id]&&(e=a.layerDefinitions[d.id]);e&&(c.definitionExpression=e);var g;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(g=a.layerDrawingOptions[d.id]);g&&(c.drawingInfo=g.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getLayerDefinition:function(){var a=new h;this._request(this.layerObject.url).then(g.hitch(this,function(b){a.resolve(b)}),function(b){console.error(b.message||b);a.resolve(null)});return a},_getSublayerDefinition:function(a){var b;
this._sublayerIdent.definitions[a]?(b=new h,b.resolve(this._sublayerIdent.definitions[a])):b=this._layerAndTableRequest(a);return b},_layerAndTableRequest:function(a){return 10.11<=this.layerObject.version?this._allLayerAndTableServer(a):this._allLayerAndTable(a)},_allLayerAndTableServer:function(a){var b=new h,c=this.layerObject.url+"/layers";this._sublayerIdent.empty?(this._sublayerIdent.empty=!1,this._request(c).then(g.hitch(this,function(c){this._sublayerIdent.definitions=c.layers;this._sublayerIdent.defLoad.resolve();
b.resolve(this._sublayerIdent.definitions[a])}),g.hitch(this,function(a){console.error(a.message||a);this._sublayerIdent.defLoad.reject();this._sublayerIdent.defLoad=new h;this._sublayerIdent.empty=!0;b.resolve(null)}))):this._sublayerIdent.defLoad.then(g.hitch(this,function(){b.resolve(this._sublayerIdent.definitions[a])}),function(a){console.error(a.message||a);b.resolve(null)});return b},_allLayerAndTable:function(a){var b=new h;this._request(this.layerObject.url+"/"+a).then(g.hitch(this,function(c){this._sublayerIdent.definitions[a]=
c;b.resolve(c)}),function(a){console.error(a.message||a);b.resolve(null)});return b},_request:function(a){return c({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_getSublayerSettingOfWebmap:function(a){var b=e.filter(this.originOperLayer.layers,function(b){return b.id===a});return 1===b.length?b[0]:null},_getSublayerShowLegendOfWebmap:function(a){return(a=this._getSublayerSettingOfWebmap(a))?void 0!==a.showLegend?a.showLegend:!0:!0},_isGroupLayerBySubId:function(a){a=this.layerObject.layerInfos[a];
return a.subLayerIds&&0<a.subLayerIds.length?!0:!1},_subLayerVisibleChanged:function(){var a=[];this.traversal(function(b){a.push(b)});l.publish("layerInfos/layerInfo/visibleChanged",a)},_bindEvent:function(){this.inherited(arguments);if(this.layerObject&&!this.layerObject.empty)this.layerObject.on("visible-layers-change",g.hitch(this,this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(a){var b=a.visibleLayers;if(-1===b[0]&&-1===b[1]&&-1===b[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();
else{var c=[],d=[-1,-1,-1];e.forEach(b,function(a){var c=this.findLayerInfoById(this.id+"_"+a);if(this._isGroupLayerBySubId(a))c.traversal(function(a){b.push(a.originOperLayer.mapService.subId)});else for(;c&&c.originOperLayer.mapService;)b.push(c.originOperLayer.mapService.subId),c=c.parentLayerInfo},this);e.forEach(b,function(a){0>c.indexOf(a)&&c.push(a)},this);this.initSubLayerVisible(c);this.traversal(function(a){a.initVisible()});e.forEach(c,function(a){this._isGroupLayerBySubId(a)||d.push(a)},
this);this.layerObject.setVisibleLayers(d)}}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefault dojo/Deferred".split(" "),function(m,e,g,h,d,k,l,a){return m(k,{constructor:function(a,b){},getExtent:function(){var a=this.originOperLayer.layerObject.getLayers(),b=null,d;e.forEach(a,function(a){d=this._convertGeometryToMapSpatialRef(a.initialExtent);b=b?b.union(d):d},this);return b},
initVisible:function(){var a=!1,b;for(b=0;b<this.newSubLayers.length;b++)a=a||this.newSubLayers[b].layerObject.visible;a&&(this._visible=!0)},_setTopLayerVisible:function(a){this._visible=a?!0:!1;e.forEach(this.newSubLayers,function(a){a.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var a=[],b=this.originOperLayer.layerObject.getLayers();e.forEach(b,function(b){this._getLayerIndexesInMapByLayerId(b.id)&&(b=new l({layerObject:b,title:b.label||b.title||
b.name||b.id||" ",id:b.id||" ",collection:{layerInfo:this},selfType:"kml",parentLayerInfo:this},this.map),a.push(b),b.init())},this);return a}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred ./LayerInfo dojox/gfx dojo/dom-construct dojo/dom-attr dojo/aspect esri/symbols/jsonUtils esri/dijit/PopupTemplate esri/dijit/Legend".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f){var p=m(d,{_legendsNode:null,controlPopupInfo:null,
constructor:function(){this._initControlPopup()},getExtent:function(){var a=this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent;if(a)return this._convertGeometryToMapSpatialRef(a);a=new h;a.resolve(null);return a},initVisible:function(){var a=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){var a=this.originOperLayer.collection.layerInfo,b=this.layerObject.visible;if(a._oldIsShowInMap!==a.isShowInMap())return;this._visible=b?!0:!1;a._onVisibilityChanged()}else this._visible=
a=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;c.after(this.layerObject,"setInfoTemplate",g.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||
(this.layerObject.infoTemplate=null)}))},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?a?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):(a?this.layerObject.show():this.layerObject.hide(),this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&
this.layerObject.show():this.layerObject.hide()},createLegendsNode:function(){var a=l.create("div",{"class":"legends-div jimu-leading-margin1"},document.body);l.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+"/images/loading.gif"},a);return a},drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},_initLegendsNodeByLegendDijit:function(a){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded)l.empty(a),
(new f({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:f.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},a)).startup()},_initLegendsNode:function(c){var d=[],f=this.layerObject;if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length))l.empty(c),f.renderer&&(f.renderer.infos?d=g.clone(f.renderer.infos):d.push({label:f.renderer.label,symbol:f.renderer.symbol}),f.renderer&&(f.renderer.defaultSymbol&&0<d.length)&&
d.push({label:f.renderer.defaultLabel||"others",symbol:f.renderer.defaultSymbol}),e.forEach(d,function(d){d.legendDiv=l.create("div",{"class":"legend-div"},c);d.symbolDiv=l.create("div",{"class":"legend-symbol jimu-float-leading"},d.legendDiv);d.labelDiv=l.create("div",{"class":"legend-label jimu-float-leading",innerHTML:d.label||" "},d.legendDiv);if("textsymbol"===d.symbol.type)a.set(d.symbolDiv,"innerHTML",d.symbol.text);else{var e=k.createSurface(d.symbolDiv,50,50);d=b.getShapeDescriptors(d.symbol);
e.createShape(d.defaultShape).setFill(d.fill).setStroke(d.stroke).setTransform(k.matrix.translate(25,25))}},this))},obtainNewSubLayers:function(){var a=[];this.originOperLayer.subLayers&&0!==this.originOperLayer.subLayers.length&&e.forEach(this.originOperLayer.subLayers,function(b){b=new p(b,this.map);a.push(b);b.init()},this);return a},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},
_getDefaultPopupTemplate:function(a){var b=null;if(a&&a.fields){var c={title:a.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]};e.forEach(a.fields,function(b){b.name!==a.objectIdField&&c.fieldInfos.push({fieldName:b.name,visible:!0,label:b.alias,isEditable:!1})});b=new n(c)}return b},enablePopup:function(){this.controlPopupInfo.enablePopup=!0;this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=
null},loadInfoTemplate:function(){var a=new h;this.controlPopupInfo.infoTemplate||(this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject));a.resolve(this.controlPopupInfo.infoTemplate);return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate}});return p})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/has dojo/sniff dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w,v,x,B,D,C,F,A,z,E,H,K,P,G,J,M,y){var L=e([M,s],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,defaultText:"Aa",gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(a,b){g.mixin(this,y.widgets.legend);this._i18n=y.widgets.legend;a=a||
{};a.map?b?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===a.respectVisibility?!1:!0,this.arrangement=a.arrangement===L.ALIGN_RIGHT?L.ALIGN_RIGHT:L.ALIGN_LEFT,this.arrangement===L.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={}):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},
postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],m.locale&&-1!==m.locale.indexOf(c)&&(-1!==m.locale.indexOf("-")?-1!==m.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},
startup:function(){this.inherited(arguments);this._initialize();9>a("ie")&&(this._repaintItems=g.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],h.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?
!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)p.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",
_initialize:function(){this.layerInfos&&(this.layers=[],h.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=
!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],b=[];h.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);var d;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==c.declaredClass&&(d=c.getLayers(),h.forEach(d,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==c.declaredClass&&(d=c.getFeatureLayers(),h.forEach(d,function(a){b.push(a.id)},this))},this);h.forEach(this.map.graphicsLayerIds,
function(c){var d=this.map.getLayer(c);-1==h.indexOf(a,c)&&-1==h.indexOf(b,c)&&(this._isSupportedLayerType(d)&&d._params&&d._params.drawMode)&&(d.arcgisProps&&d.arcgisProps.title&&(d._titleForLegend=d.arcgisProps.title),this.layers.push(d))},this)}this._createLegend()},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=d.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=d.connect(this.map,"onLayerAdd",
this,"_updateAllMapLayers"),this._olrConnect=d.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=d.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),h.forEach(this.layers,function(a){a.ovcConnect=d.connect(a,"onVisibilityChange",this,"_refreshLayers");a.oscConnect=d.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(a.odcConnect=d.connect(a,"_onDynamicLayersChange",
g.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(a.oirConnect=d.connect(a,"onRenderingChange",g.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.oivrConnect=d.connect(a,"onRendererChange",g.hitch(this,"_refreshLayers")))},this))},_deactivate:function(){this._ozeConnect&&d.disconnect(this._ozeConnect);this._olaConnect&&d.disconnect(this._olaConnect);this._olroConnect&&d.disconnect(this._olroConnect);
this._olrConnect&&d.disconnect(this._olrConnect);h.forEach(this.layers,function(a){a.ovcConnect&&d.disconnect(a.ovcConnect);a.oscConnect&&d.disconnect(a.oscConnect);a.odcConnect&&d.disconnect(a.odcConnect);a.oirConnect&&d.disconnect(a.oirConnect);a.oivrConnect&&d.disconnect(a.oivrConnect)},this)},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},
_updateAllMapLayers:function(){this.layers=[];h.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);h.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&(a._params&&a._params.drawMode)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1;t.set(this.domNode,"position","relative");p.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+
"..."},this.domNode);var c=[];h.forEach(this.layers,function(b){if("esri.layers.KMLLayer"==b.declaredClass||"esri.layers.GeoRSSLayer"==b.declaredClass){var e;b.loaded?("esri.layers.KMLLayer"==b.declaredClass?e=b.getLayers():"esri.layers.GeoRSSLayer"==b.declaredClass&&(e=b.getFeatureLayers(),this.hideLayersInLegend[b.id]&&(e=h.filter(e,function(a){return-1==h.indexOf(this.hideLayersInLegend[b.id],a.id)},this))),h.forEach(e,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&b._titleForLegend&&
(a._titleForLegend=b._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_polygons),c.push(a))},this)):d.connect(b,"onLoad",g.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===b.declaredClass)if(b.loaded){if((!this._respectVisibility||this._respectVisibility&&b.visible)&&0<b.layerInfos.length&&
h.some(b.layerInfos,function(a){return a.legendURL})){var f=!1;h.forEach(b.layerInfos,function(c){c.legendURL&&-1<h.indexOf(b.visibleLayers,c.name)&&(f||(p.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(b._titleForLegend||b.name||b.id)+"\x3c/span\x3e"},this.domNode),f=!0),p.create("div",{innerHTML:"\x3cimg src\x3d'"+c.legendURL+"'/\x3e"},this.domNode),a=!0)},this)}}else d.connect(b,"onLoad",g.hitch(this,function(){this.refresh(this.layerInfos)}));else c.push(b)},this);var e=
[];h.forEach(c,function(a){if(a.loaded){if((!this._respectVisibility||this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var b=p.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});p.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},p.create("td",{align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%"},b)))));p.place(b,this.id,"first");
a.legendResponse||a.renderer?this._createLegendForLayer(a):e.push(this._legendRequest(a))}}else var c=d.connect(a,"onLoad",this,function(a){d.disconnect(c);c=null;this.refresh()})},this);0===e.length&&!a?(f.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):(new b(e)).addCallback(g.hitch(this,function(b){a?f.byId(this.id+"_msg").innerHTML="":f.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()}))},_createLegendForLayer:function(a){if(a.legendResponse||a.renderer){var b=
!1;if(a.legendResponse){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?h.forEach(c,function(c,d){if(!this.hideLayersInLegend[a.id]||-1==h.indexOf(this.hideLayersInLegend[a.id],c.id)){var e=this._buildLegendItems(a,c,d);b=b||e}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,
{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(t.set(f.byId(this.id+"_"+a.id),"display","block"),t.set(f.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);d.connect(a,"onLoad",g.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";(c=a._getToken())&&(b+="?token\x3d"+c);var d=
g.hitch(this,"_processLegendResponse"),c={f:"json"};a._params.dynamicLayers&&(c.dynamicLayers=n.stringify(this._createDynamicLayers(a)),"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));a._params.bandIds&&(c.bandIds=a._params.bandIds);a._params.renderingRule&&(c.renderingRule=a._params.renderingRule);return x({url:b,content:c,callbackParamName:"callback",load:function(b,c){d(a,b,c)},error:v.defaults.io.errorHandler})},_legendRequestTools:function(b){var c=b.url.toLowerCase().indexOf("/rest/"),c=b.url.substring(0,
c)+b.url.substring(c+5,b.url.length),c=this._legendUrl+"?soapUrl\x3d"+window.escape(c);if(!a("ie")||8<a("ie"))c+="\x26returnbytes\x3dtrue";var d=g.hitch(this,"_processLegendResponse");return x({url:c,content:{f:"json"},callbackParamName:"callback",load:function(a,c){d(b,a,c)},error:v.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,f.byId(this.id+"_"+a.id)&&p.empty(f.byId(this.id+"_"+a.id)),p.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},
p.create("td",{align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%"},f.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+k.toJson(b))},_buildLegendItems:function(a,b,c){var d=!1,e=f.byId(this.id+"_"+a.id),g=b.parentLayerId;if(b.subLayerIds)a=p.create("div",{id:this.id+"_"+a.id+"_"+b.id+"_group",style:{display:"none"},"class":-1==g?0<c?"esriLegendGroupLayer":"":this._legendAlign},-1==g?e:f.byId(this.id+
"_"+a.id+"_"+g+"_group")),p.create("td",{innerHTML:u.encode(b.name),align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&a.visibleLayers&&-1==(","+a.visibleLayers+",").indexOf(","+b.id+","))return d;c=p.create("div",{id:this.id+"_"+a.id+"_"+b.id,style:{display:"none"},"class":-1<g?this._legendAlign:""},-1==g?e:f.byId(this.id+"_"+a.id+"_"+g+"_group"));p.create("td",{innerHTML:u.encode(b.name)||"",
align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%","class":"esriLegendLayerLabel"},c))));a.legendResponse?d=d||this._buildLegendItems_Tools(a,b,c):a.renderer&&(d=d||this._buildLegendItems_Renderer(a,b,c))}return d},_buildLegendItems_Tools:function(a,b,c){var d=b.parentLayerId,e=this.map.getScale(),g=!1,n=function(a,b){var c,d;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(d=0;d<b.dynamicLayerInfos[d].length;d++){if(b.dynamicLayerInfos[d].mapLayerId==a[c].layerId)return a[c]}else if(b.id==
a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,b,e)){var k=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var l=this._getEffectiveScale(a,b);if(l.minScale&&l.minScale<e||l.maxScale&&l.maxScale>e)k=!1}if(k){var e=n(a.legendResponse.layers,b),m=e.legendType,q=e.legend;if(q){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&
this._sanitizeLegendResponse(a,e,b);c=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);var s=p.create("tbody",{},c);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(c,a,b);h.forEach(q,function(c){if(!(10.1<=a.version&&!c.values&&1<q.length&&(a._hideDefaultSymbol||"\x3call other values\x3e"===c.label||!c.label&&!("esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version))))if(c.url&&0===c.url.indexOf("http")||c.imageData&&0<c.imageData.length)g=
!0,this._buildRow_Tools(c,s,a,b.id,m)},this)}}}g&&(t.set(f.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<d&&(t.set(f.byId(this.id+"_"+a.id+"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,a,d)));return g},_sanitizeLegendResponse:function(a,b,c){var d=b.legend;if(10.1<=a.version&&1<d.length&&!b._sanitized){a=g.getObject("layerDefinition.drawingInfo.renderer",!1,c);var e,f;a||(a=g.getObject("drawingInfo.renderer",!1,c));h.some(d,function(a){if(a.values)return!0})&&h.some(d,function(a,
b){a.values||(f=b,e=a);return!!e});a?"uniqueValue"===a.type?e&&(d.splice(f,1),d.push(e)):"classBreaks"===a.type&&(e&&d.splice(f,1),d.reverse(),e&&d.push(e)):e&&(d.splice(f,1),d.push(e));b._sanitized=!0}},_buildRow_Tools:function(b,c,d,e,f){var g=p.create("tr",{},c),h;this.alignRight?(c=p.create("td",{align:this._isRightToLeft?"left":"right"},g),h=p.create("td",{align:this._isRightToLeft?"left":"right",width:35},g)):(h=p.create("td",{width:35,align:"center"},g),c=p.create("td",{},g));g=b.url;(!a("ie")||
9<=a("ie")||9>a("ie")&&"esri.layers.ArcGISImageServiceLayer"===d.declaredClass)&&b.imageData&&0<b.imageData.length?g="data:image/png;base64,"+b.imageData:0!==b.url.indexOf("http")&&(g=d.url+"/"+e+"/images/"+b.url,(e=d._getToken())&&(g+="?token\x3d"+e));e=p.create("img",{src:g,border:0,style:"opacity:"+d.opacity},h);b=p.create("td",{innerHTML:u.encode(b.label),align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%",dir:"ltr"},c))));f&&("Stretched"===f&&10.3<=d.version&&
"esri.layers.ArcGISImageServiceLayer"===d.declaredClass)&&(b.style.verticalAlign="top",b.style.lineHeight="1",e.style.marginBottom="-1px",e.style.display="block",c.style.verticalAlign="top");9>a("ie")&&(e.style.filter="alpha(opacity\x3d"+100*d.opacity+")")},_getVariable:function(a,b,c){var d;a&&(d=(a=a.getVisualVariablesForType(b,c))&&a[0]);return d},_getFieldAlias:function(a,b){var c=b.infoTemplate,c=c&&c.getFieldInfo&&c.getFieldInfo(a),d=g.isFunction(a)?null:b.getField(a),e=c||d,f="";e&&(f=c&&c.label||
d&&d.alias||e.name||e.fieldName);return f},_getDefaultHoverLabel:function(a,b){var c;if(a){var d=this._getVariable(a,"colorInfo",!1),e=this._getVariable(a,"opacityInfo",!1),f=this._getVariable(a,"sizeInfo",!1),d=d||f||e,g,h,n,k,l;a instanceof P?g=a.field:a instanceof F&&!a.attributeField2&&!a.attributeField3?(g=a.attributeField,d&&(n=d.field,k=d.normalizationField)):a instanceof A?d?(g=d.field,h=d.normalizationField):(g=a.attributeField,h=a.normalizationField,l="percent-of-total"===a.normalizationType):
a instanceof C&&d&&(g=d.field,h=d.normalizationField);(l=k&&"showOpNormField"||n&&"showOpField"||h&&"showNormField"||(l?"showNormPct":null)||g&&"showField"||null)&&(c=B.substitute({field:g&&this._getFieldAlias(g,b),normField:h&&this._getFieldAlias(h,b),opField:n&&this._getFieldAlias(n,b),opNormField:k&&this._getFieldAlias(k,b)},this._i18n[l]))}return c},_buildLegendItems_Renderer:function(a,b,c){var d=b.parentLayerId,e=this.map,n=e.getScale(),k=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,
b,n)){var l,m,q="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:a.renderer,s,r,v,x,D,w;if(q instanceof z&&(q=(e="zoom"===q.rangeType?q.getRendererInfoByZoom(e.getZoom()):q.getRendererInfoByScale(n))&&e.renderer,!q))return!1;var e=this._getVariable(q,"colorInfo",!1),n=this._getVariable(q,"opacityInfo",!1),B=this._getVariable(q,"sizeInfo",!1),G=this._getDefaultHoverLabel(q,a);e?(s=this._getMedianColor(q,e),e.field&&(v=g.isFunction(e.field)?null:a.getField(e.field))):
n&&(D=g.isFunction(n.field)?null:a.getField(n.field),w=n.normalizationField);B&&B.field&&(x=g.isFunction(B.field)?null:a.getField(B.field));if(q instanceof P)k=!0,this._showHeatRamp(a,b,q,c,G);else if(q instanceof E)k=!0,this._showDotDensityLegend(a,b,q,c);else if(q instanceof H)k=!0,m=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),l=p.create("tbody",{},m),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(m,a,b),q.latestObservationRenderer&&q.latestObservationRenderer instanceof
C&&this._buildRow_Renderer(a,q.latestObservationRenderer.symbol,s,u.encode(q.latestObservationRenderer.label)||this.NLS_currentObservations,null,l),q.observationRenderer&&q.observationRenderer instanceof C&&this._buildRow_Renderer(a,q.observationRenderer.symbol,s,u.encode(q.observationRenderer.label)||this.NLS_previousObservations,null,l);else if(q instanceof F){if(q.infos&&0<q.infos.length){k=!0;m=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);l=p.create("tbody",
{},m);(a._hoverLabel||a._hoverLabels||G)&&this._createHoverAction(m,a,b,G);var y=[];h.forEach(q.infos,function(b){var c=null;a._editable&&a.types&&(c=this._getTemplateFromTypes(a.types,b.value));var d=b.label;null==d&&(d=b.value);-1===h.indexOf(y,d)&&(y.push(d),this._buildRow_Renderer(a,b.symbol,s,u.encode(d),c,l))},this)}}else if(q instanceof A){if(q.infos&&0<q.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass){k=!0;w=v||x||D;if(!w||!this._isSmartRenderer(q,w.name))m=p.create("table",
{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),l=p.create("tbody",{},m),w=(q.normalizationField||"percent-of-total"===q.normalizationType)&&G?G:this._getFieldAlias(q.attributeField,a),this._buildRow_Renderer(a,null,s,u.encode(w),null,l);m=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);l=p.create("tbody",{},m);(a._hoverLabel||a._hoverLabels||G)&&this._createHoverAction(m,a,b,G);w=q.infos.slice(0).reverse();h.forEach(w,function(b){var c=
b.label;null==c&&(c=(c=v||x||D)&&this._isSmartRenderer(q,c.name)?q.normalizationField&&G?G:this._getFieldAlias(c.name,a):b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,s,u.encode(c),null,l)},this);if("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.renderer.style===K.STYLE_SCALAR||a.renderer.style===K.STYLE_SINGLE_ARROW))this._buildRow_Renderer(a,q.defaultSymbol,null,"",null,l),a._hideDefaultSymbol=!0}}else q instanceof C&&(k=!0,m=p.create("table",{cellpadding:0,
cellspacing:0,width:"95%","class":"esriLegendLayer"},c),l=p.create("tbody",{},m),(a._hoverLabel||a._hoverLabels||G)&&this._createHoverAction(m,a,b,G),r=null,a._editable&&(a.templates&&0<a.templates.length)&&(r=a.templates[0]),m=(v||D)&&x?null:v||D||x,this._buildRow_Renderer(a,q.symbol,s,u.encode(w&&G?G:m?this._getFieldAlias(m.name,a):q.label),r,l),r=q.symbol&&q.symbol.color,m&&(v=D=x=null));k&&(e&&e.field?(v&&this._isSmartRenderer(q,v.name)&&(v=null),this._showColorRamp(a,b,q,null,c,e,v,G)):n&&r&&
this._showColorRamp(a,b,q,r,c,n,D,G),B&&B.field&&(x&&this._isSmartRenderer(q,x.name)&&(x=null),this._showSizeLegend(a,b,q,B,s,c,x,G)));!a._hideDefaultSymbol&&q.defaultSymbol&&(k=!0,m=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),l=p.create("tbody",{},m),this._buildRow_Renderer(a,q.defaultSymbol,null,u.encode(q.defaultLabel)||"others",null,l))}k&&(t.set(f.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<d&&(t.set(f.byId(this.id+"_"+a.id+"_"+d+"_group"),
"display","block"),this._findParentGroup(a.id,d)));return k},_isSmartRenderer:function(a,b){return a instanceof A&&a.infos&&1===a.infos.length&&a.attributeField===b},_showColorRamp:function(a,b,c,d,e,f,g,h){var n;n=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);e=p.create("tbody",{},n);(a._hoverLabel||a._hoverLabels||h)&&this._createHoverAction(n,a,b,h);g&&this._addSubHeader(e,this._getFieldAlias(g.name,a));b=this._getRampStops(c,f,d);b.length&&this._drawColorRamp(e,
b,!0,a,this._getRampBorderColor(c))},_getMedianColor:function(a,b){var c,d;b.colors?(c=b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c){var d,e,f,g,n=!1;b.colors||b.opacityValues?(e=b.maxDataValue-b.minDataValue,d=h.map([0,0.25,0.5,0.75,1],function(a){f=b.minDataValue+a*e;return Number(f.toFixed(6))}),this._checkPrecision(0,4,d)):b.stops&&(d=h.map(b.stops,function(a){return a.value}),
(n=h.some(b.stops,function(a){return!!a.label}))&&(g=h.map(b.stops,function(a){return a.label})));var k=d[0],p,m,q;e=d[d.length-1]-k;return h.map(d,function(f,h){c?(p=new l(c.toRgba()),m=a.getOpacity(f,{opacityInfo:b}),null!=m&&(p.a=m)):p=a.getColor(f,{colorInfo:b});q="";0===h?q=this._specialChars.lt+" ":h===d.length-1&&(q=this._specialChars.gt+" ");return{value:f,color:p,offset:1-(f-k)/e,label:n?g[h]:q+D.format(f)}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,e=c[a],f=c[d],g=
c[b],h=Math.floor(e),n=Math.floor(f),k=Math.floor(g);h===e&&(k===g&&n!==f&&h!==n&&k!==n)&&(c[d]=n);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;if(a instanceof C)b=a.symbol;else if(a instanceof F||a instanceof A)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawColorRamp:function(b,c,d,e,f){var g=p.create("tr",{},b),n,k,m,q,s,v=c.length-1,x;q=0;this.alignRight?(b=p.create("td",{align:this._isRightToLeft?
"left":"right"},g),n=p.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},g)):(n=p.create("td",{width:this.gradientWidth,align:"center"},g),b=p.create("td",{},g));var D=f&&0<f.a&&!(240<=f.r&&240<=f.g&&240<=f.b);k=p.create("div",{"class":D?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},n);g=p.create("div",{"class":"esriLegendColorRamp"},k);n=t.get(g,"width");D&&(f=9>a("ie")?f.toHex():"rgba("+f.toRgba().join(",")+")",t.set(g,
"border",this.colorRampBorder+" "+f));d?(f=this.gradientHeight*v,t.set(g,"height",f+"px")):f=t.get(g,"height");t.set(k,"height",f+"px");g=r.createSurface(g,n,f);9>a("ie")&&(q=g.getEventSource(),t.set(q,"position","relative"),t.set(q.parentNode,"position","relative"),q=1);try{d&&h.forEach(c,function(a,b){a.offset=b/v}),s=g.createRect({x:-q,y:-q,width:n+q,height:f+q}),s.setFill({type:"linear",x1:0,y1:0,x2:0,y2:f,colors:c}).setStroke(null),g.createRect({width:n,height:f}).setFill(new l([255,255,255,
1-e.opacity])).setStroke(null),this._surfaceItems.push(g)}catch(C){g.clear(),g.destroy()}h.forEach(c,function(a,b){if(a.label){x="top:"+100*a.offset+"%;";var d="";0===b&&(d+=" esriLegendColorRampTickFirst");b===c.length-1&&(d+=" esriLegendColorRampTickLast");p.create("div",{"class":"esriLegendColorRampTick"+d,innerHTML:"\x26nbsp;",style:x},k)}});m=p.create("div",{"class":"esriLegendColorRampLabels",style:{height:f+this.gradientHeight+"px"}},b);d?h.forEach(c,function(a){p.create("div",{"class":"esriLegendColorRampLabel",
innerHTML:u.encode(a.label)||"\x26nbsp;"},m)}):(p.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},m),p.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(f+this.gradientHeight-2*this.gradientHeight)+"px;"},m))},_showHeatRamp:function(a,b,c,d,e){var f,g=c.field;f=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);d=p.create("tbody",{},f);(a._hoverLabel||a._hoverLabels||e)&&this._createHoverAction(f,
a,b,e);(g=g&&a.getField(g))&&this._addSubHeader(d,this._getFieldAlias(g.name,a));b=this._getHeatmapStops(c);b.length&&this._drawColorRamp(d,b,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var c,d,e,f;if(b&&b[0])if(c=b.length-1,a=b[0]&&null!=b[0].ratio){if((a=b[c])&&1!==a.ratio)b=b.slice(0),b.push({ratio:1,color:a.color}),c++}else d=b[0].value,e=b[c].value-d,b=h.map(b,function(a){return{color:a.color,ratio:(a.value-d)/e}});else a&&a[0]&&(c=a.length-1,f=1/(a.length-1),b=h.map(a,
function(a,b){return{color:a,ratio:b*f}}));b=h.map(b,function(a,b){var d="";0===b?d="Low":b===c&&(d="High");return{color:a.color,label:d,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,b,c,d){var e=c.legendOptions,f,n,k,l,m,q,s,r=this.dotDensitySwatchSize,t=Math.round(r/2);e&&(n=e.backgroundColor,k=e.outline,l=e.valueUnit,m=e.dotCoverage);m=(m||this.dotCoverage)/100;s=Math.round(r*r/Math.pow(c.dotSize,2)*m);d=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},
d);q=p.create("tbody",{},d);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(d,a,b);this._addSubHeader(q,B.substitute({value:c.dotValue,unit:l||""},this.NLS_dotValue));h.forEach(c.fields,function(b){b=g.mixin({},b);b.numPoints=s;f=new G(c._generateImageSrc(r,r,[b],{x:0,y:0},{x:r,y:r},n),k||c.outline,r,r);b=a.getField(b.name)||b;this._buildRow_Renderer(a,f,null,u.encode(this._getFieldAlias(b.name,a)),null,q,{type:"path",path:"M "+-t+","+-t+" L "+t+","+-t+" L "+t+","+t+" L "+-t+","+t+" L "+
-t+","+-t+" E"})},this)},_showSizeLegend:function(a,b,c,d,e,f,g,n){var k=d.legendOptions,k=k&&k.customValues,l,m,q=this._getSizeSymbol(c,e);"unknown"!==d.valueUnit||(!q||!k&&(null==d.minSize||null==d.maxSize))||(e=p.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},f),l=p.create("tbody",{},e),(a._hoverLabel||a._hoverLabels||n)&&this._createHoverAction(e,a,b,n),g&&this._addSubHeader(l,this._getFieldAlias(g.name,a)),m=k||this._getDataValues(c,q,d),m.reverse(),h.forEach(m,
function(b,e){q=J.fromJson(q.toJson());this._applySize(q,c,d,b);b=D.format(b);var f="";0===e?f=this._specialChars.gt+" ":e===m.length-1&&(f=this._specialChars.lt+" ");f="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+u.encode(f+b)+"\x3c/span\x3e";this._buildRow_Renderer(a,q,null,f,null,l)},this))},_getSizeSymbol:function(a,b){var c;if(a instanceof C)c=a.symbol;else if(a instanceof K)c=a.defaultSymbol;else if(a instanceof F||a instanceof A)c=a.infos[0].symbol;if(c=-1!==c.type.indexOf("fillsymbol")?
null:c)c=J.fromJson(c.toJson()),b&&c.setColor(new l(b.toRgba()));return c},_getDataValues:function(a,b,c,d,e){d=null==d?5:d;e=null==e?20:e;var f=a.getSizeRangeAtScale(c,this.map.getScale());d=this._interpolateSizeRange(f,d);var g=h.map(d,function(a){return this._getDataValueFromSize(a,c,f)},this),n,k,g=D.round(g);for(n=1;n<g.length-1;n++)if(k=this._roundDataValue(a,b,c,g[n],g[n-1],e))g[n]=k[0],d[n]=k[1];return g},_interpolateSizeRange:function(a,b){var c=a.minSize,d=(a.maxSize-c)/(b-1),e,f=[];for(e=
0;e<b;e++)f.push(c+d*e);return f},_getDataValueFromSize:function(a,b,c){var d=c.minSize;c=c.maxSize;var e=b.minDataValue;b=b.maxDataValue;return a=a<=d?e:a>=c?b:(a-d)/(c-d)*(b-e)+e},_roundDataValue:function(a,b,c,d,e,f){var g=this._getSize(b,a,c,d);e=this._getSize(b,a,c,e);var n,h=D.getDigits(d),k=h.integer,h=h.fractional,l,p,m,q,s,r,t,v,u,x,C;0<d&&1>d&&(n=Math.pow(10,h),d*=n,k=D.getDigits(d).integer);for(k-=1;0<=k&&!(l=Math.pow(10,k),h=Math.floor(d/l)*l,l*=Math.ceil(d/l),null!=n&&(h/=n,l/=n),p=(h+
l)/2,p=D.round([h,p,l],{indexes:[1]})[1],m=this._getSize(b,a,c,h),q=this._getSize(b,a,c,l),s=this._getSize(b,a,c,p),r=D.getPctChange(g,m,e,null),t=D.getPctChange(g,q,e,null),v=D.getPctChange(g,s,e,null),u=r.prev<=f,x=t.prev<=f,u&&x&&(r.prev<=t.prev?(u=!0,x=!1):(x=!0,u=!1)),u?C=[h,m]:x?C=[l,q]:v.prev<=f&&(C=[p,s]),C);k--);return C},_applySize:function(a,b,c,d){var e=a.type;b=this._getSize(a,b,c,d);switch(e){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":e=a.width;c=a.height;
a.setHeight(b);a.setWidth(b*(e/c));break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,d){return b.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,b,c,d,e,f,g){var h=p.create("tr",{},f),n;this.alignRight?(f=p.create("td",{align:this._isRightToLeft?"left":"right"},h),b&&(n=p.create("td",{align:this._isRightToLeft?"left":
"right",width:35},h))):(b&&(n=p.create("td",{width:35,align:"center"},h)),f=p.create("td",{},h));var k=h=30;if(b){if("simplemarkersymbol"==b.type)h=Math.min(Math.max(h,b.size+12),125),k=Math.min(Math.max(k,b.size+12),125);else if("picturemarkersymbol"==b.type)h=Math.min(Math.max(h,b.width),125),k=Math.min(b.height||k,125);else if("textsymbol"==b.type){var l,m;b.text||(l=b.text,m=!0,b.setText(this.defaultText));h=Math.min(Math.max(h,b.getWidth()+12),125);k=Math.min(Math.max(k,b.getHeight()+12),125);
m&&b.setText(l)}var q=p.create("div",{style:"width:"+h+"px;height:"+k+"px;"},n)}B.isDefined(d)&&"number"===typeof d&&(d=""+d);p.create("td",{innerHTML:d||"",align:this._align},p.create("tr",{},p.create("tbody",{},p.create("table",{width:"95%"},f))));b&&(a=this._drawSymbol(q,b,c,h,k,e,a,g),this._surfaceItems.push(a))},_addSubHeader:function(a,b){var c=p.create("tr",{},a),c=p.create("td",{align:this._align,colspan:2},c);p.create("td",{innerHTML:u.encode(b)||"",align:this._align},p.create("tr",{},p.create("tbody",
{},p.create("table",{width:"95%"},c))))},_drawSymbol:function(b,c,d,e,f,h,n,k){c=J.fromJson(c.toJson());var p=n.opacity;d&&c.setColor(new l(d.toRgba()));if("simplelinesymbol"===c.type||"cartographiclinesymbol"===c.type||"textsymbol"===c.type){if(!c.color)return;d=c.color.toRgba();d[3]*=p;c.color.setColor(d)}else"simplemarkersymbol"===c.type||"simplefillsymbol"===c.type?(c.color&&(d=c.color.toRgba(),d[3]*=p,c.color.setColor(d)),c.outline&&c.outline.color&&(d=c.outline.color.toRgba(),d[3]*=p,c.outline.color.setColor(d))):
"picturemarkersymbol"===c.type&&(b.style.opacity=p,b.style.filter="alpha(opacity\x3d("+100*p+"))");b=r.createSurface(b,e,f);9>a("ie")&&(d=b.getEventSource(),t.set(d,"position","relative"),t.set(d.parentNode,"position","relative"));h=this._getDrawingToolShape(c,h)||J.getShapeDescriptors(c);var m,p=(d=h.defaultShape)&&"text"===d.type;try{p&&!d.text&&(d.text=this.defaultText),m=b.createShape(k||d).setFill(h.fill).setStroke(h.stroke),p&&m.setFont(h.font)}catch(s){b.clear();b.destroy();return}var v=m.getBoundingBox();
k=v.width;h=v.height;var p=-(v.x+k/2),u=-(v.y+h/2);d=b.getDimensions();p={dx:p+d.width/2,dy:u+d.height/2};if("simplemarkersymbol"===c.type&&"path"===c.style)e=n._getScaleMatrix(v,c.size),m.applyTransform(q.scaleAt(e.xx,e.yy,{x:d.width/2,y:d.height/2}));else if(k>e||h>f)n=k/e>h/f,e=((n?e:f)-5)/(n?k:h),g.mixin(p,{xx:e,yy:e});m.applyTransform(p);return b},_getDrawingToolShape:function(a,b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};
break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){h.forEach(this._surfaceItems,
function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&g.isArray(a.children)&&h.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,c,e){if(e=b._hoverLabel||b._hoverLabels&&b._hoverLabels[c.id]||e)e=u.encode(e),b.mouseMoveHandler=b.mouseMoveHandler||{},b.mouseMoveHandler[c.id]=d.connect(a,"onmousemove",g.hitch(this,function(a,b){this.mouseX=b.clientX;
this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(f.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(g.hitch(this,function(a,b,c){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,f.byId(this.id+"_hoverLabel")){var d=f.byId(this.id+"_hoverLabel");d.innerHTML="\x3cspan\x3e"+c+"\x3c/span\x3e";t.set(d,"top",b+"px");t.set(d,"left",a+15+"px");t.set(d,"display","")}else p.create("div",{innerHTML:"\x3cspan\x3e"+c+"\x3c/span\x3e",
id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},e)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[c.id]=d.connect(a,"onmouseout",g.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(f.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;h.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)d.disconnect(b.mouseMoveHandler[a]);
if(b.mouseOutHandler)for(a in b.mouseOutHandler)d.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],c;h.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[d.id]&&(e=a.layerDefinitions[d.id]);e&&(c.definitionExpression=e);var f;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(f=a.layerDrawingOptions[d.id]);f&&(c.drawingInfo=f.toJson());c.minScale=d.minScale||0;c.maxScale=
d.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,e=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<e.length;d++)if(c==e[d].id){-1<e[d].parentLayerId&&(t.set(f.byId(this.id+"_"+a+"_"+e[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,e[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,
d){var e=a.layer.dynamicLayerInfos||a.layer.layerInfos,f,g;for(f=0;f<e.length;f++)if(e[f].id===c&&e[f].subLayerIds)for(g=0;g<e[f].subLayerIds.length;g++){var n=e[f].subLayerIds[g];-1===h.indexOf(d,n)&&(d.push(n),b(n,d))}}a.layer.layerInfos&&h.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,e=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var f=a.legendResponse.layers[d];
if(b.id==f.layerId){var g,h;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==f.minScale&&a.tileInfo&&(g=a.tileInfo.lods[0].scale),0==f.maxScale&&a.tileInfo&&(h=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(g=Math.min(a.minScale,f.minScale)||a.minScale||f.minScale,h=Math.max(a.maxScale,f.maxScale));if(0<g&&g<c||h>c)e=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)e=!1;return e},_getServiceTitle:function(a){var b=a._titleForLegend;b||
((b=a.url)?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===
a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],B.isDefined(a)&&(b+=" ("+a+")"));return u.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(B.isDefined(b.parentLayerId)){var e=a.layerInfos,f=b.parentLayerId,g;for(g=e.length-1;0<=g;g--)if(e[g].id==f)if(0==c&&0<e[g].minScale?c=e[g].minScale:0<c&&0==e[g].minScale||0<c&&0<e[g].minScale&&(c=Math.min(c,
e[g].minScale)),d=Math.max(d||0,e[g].maxScale||0),-1<e[g].parentLayerId)f=e[g].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===
a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1}});g.mixin(L,{ALIGN_LEFT:0,ALIGN_RIGHT:1});return L})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(m,e,g,h){var d=function(d,a){return d-a},k={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(d){var a=String(d),c=a.match(k._reNumber);
d={integer:0,fractional:0};c&&c[1]?(d.integer=c[1].split("").length,d.fractional=c[3]?c[3].split("").length:0):-1<a.toLowerCase().indexOf("e")&&(c=a.split("e"),a=c[0],c=c[1],a&&c&&(a=Number(a),c=Number(c),(d=0<c)||(c=Math.abs(c)),a=k.getDigits(a),d?(a.integer+=c,a.fractional=c>a.fractional?0:a.fractional-c):(a.fractional+=c,a.integer=c>a.integer?1:a.integer-c),d=a));return d},getFixedNumbers:function(d,a){var c,b;c=Number(d.toFixed(a));b=c<d?c+1/Math.pow(10,a):c-1/Math.pow(10,a);return[c,b]},getPctChange:function(d,
a,c,b){var e={prev:null,next:null},f;null!=c&&(f=d-c,c=a-c-f,e.prev=Math.floor(Math.abs(100*c/f)));null!=b&&(f=b-d,c=b-a-f,e.next=Math.floor(Math.abs(100*c/f)));return e},round:function(e,a){var c=e.slice(0),b,g,f,h,m,s,r,q,u,w=!a||null==a.tolerance?2:a.tolerance,v=a&&a.indexes;if(v)v.sort(d);else{v=[];for(s=0;s<c.length;s++)v.push(s)}for(s=0;s<v.length;s++)if(u=v[s],b=c[u],g=0===u?null:c[u-1],f=u===c.length-1?null:c[u+1],h=k.getDigits(b),h=h.fractional){r=0;for(q=!1;r<=h&&!q;)m=k.getFixedNumbers(b,
r),m=m[0],q=k.hasMinimalChange(b,m,g,f,w),r++;q&&(c[u]=m)}return c},hasMinimalChange:function(d,a,c,b,e){d=k.getPctChange(d,a,c,b);a=null==d.prev||d.prev<=e;c=null==d.next||d.next<=e;return a&&c||d.prev+d.next<=2*e},_reAllZeros:RegExp("\\"+g.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(d,a){a=a||{places:20,round:-1};var c=e.format(d,a);c&&(c=c.replace(k._reSomeZeros,"$1").replace(k._reAllZeros,""));return c}};return k})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define(["dojo/_base/declare",
"dojo/_base/array","esri/graphicsUtils","./LayerInfo","./LayerInfoFactory"],function(m,e,g,h,d){return m(h,{constructor:function(){},getExtent:function(){var d=this.layerObject.items;if(0===d.length)return null;d=g.graphicsExtent(d);return this._convertGeometryToMapSpatialRef(d)},initVisible:function(){var d=!1,e;for(e=0;e<this.newSubLayers.length;e++)d=d||this.newSubLayers[e].layerObject.visible;d&&(this._visible=!0)},_setTopLayerVisible:function(d){this._visible=d?!0:!1;e.forEach(this.newSubLayers,
function(d){d.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var g=[],h=this.layerObject.getFeatureLayers();e.forEach(h,function(a){a=d.getInstance().create({layerObject:a,title:a.label||a.title||a.name||a.id||" ",id:a.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});g.push(a);a.init()},this);return g},_obtainLayerIndexesInMap:function(){var d=[],e,a;for(a=0;a<this.newSubLayers.length;a++)(e=this._getLayerIndexesInMapByLayerId(this.newSubLayers[a].layerObject.id))&&
d.push(e);return d},moveLeftOfIndex:function(d){var e;for(e=this.newSubLayers.length-1;0<=e;e--)this.map.reorderLayer(this.newSubLayers[e].layerObject,d)},moveRightOfIndex:function(d){var e;for(e=0;e<this.newSubLayers.length;e++)this.map.reorderLayer(this.newSubLayers[e].layerObject,d)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS ./LayerInfoFactory esri/layers/FeatureLayer".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n){return m(a,{constructor:function(a,b){this.layerObject=a.layerObject},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.extent)},initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(a){this.layerObject.setVisibility(a);this._visible=a},setSubLayerVisible:function(a){var b=[],c,b=g.clone(this.originOperLayer.layerObject.visibleLayers),d;for(d in a)if(a.hasOwnProperty(d)&&"function"!==
typeof a[d]){var h=a[d],n=d.toString();c=e.indexOf(b,n);h?0>c&&b.push(n):0<=c&&b.splice(c,1)}this.originOperLayer.layerObject.setVisibleLayers(b)},obtainNewSubLayers:function(){var a=[];e.forEach(this.layerObject.layerInfos,function(c){c=b.getInstance().create({layerObject:this.layerObject,title:c.label||c.title||c.name||" ",id:c.name||" ",wms:{layerInfo:this,subId:c.name,wmsLayerInfo:c},selfType:"wms",parentLayerInfo:this});a.push(c);c.init()},this);return a},_bindEvent:function(){this.inherited(arguments);
this.layerObject&&!this.layerObject.empty&&l.after(this.layerObject,"setVisibleLayers",g.hitch(this,this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(){var a=[];this.traversal(function(b){b.initVisible();a.push(b)});h.publish("layerInfos/layerInfo/visibleChanged",a);this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),
function(m,e,g,h,d,k,l){return m(l,{constructor:function(a,c){this.layerObject=a.layerObject},getExtent:function(){},initVisible:function(){var a=[],a=!1,a=g.clone(this.originOperLayer.layerObject.visibleLayers);this._visible=a=0<=e.indexOf(a,this.originOperLayer.id)?!0:!1},_setTopLayerVisible:function(a){var c=this.originOperLayer.wms;this._visible=a?!0:!1;var b={};b[c.subId]=a;c.layerInfo.setSubLayerVisible(b)},drawLegends:function(a){this._initLegendsNode(a)},_initLegendsNode:function(a){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var c=
d.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});k(c,"load",function(){d.empty(a);var b=d.create("div",{"class":"legend-div"},a);h.place(c,b)})}else d.empty(a)},obtainNewSubLayers:function(){return[]},getOpacity:function(){},setOpacity:function(a){},_bindEvent:function(){},_onVisibleLayersChanged:function(){}})})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo ./LayerInfoFactory".split(" "),
function(m,e,g,h,d,k,l){return m(k,{constructor:function(a,c,b){this.noLegend=b},getExtent:function(){},initVisible:function(){var a=!1,c=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<c.layerInfo.subLayerVisible[c.subId]&&(a=!0);this._visible=a},_setTopLayerVisible:function(a){var c;if(this.originOperLayer.mapService&&(c=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length)){a?c.layerInfo.subLayerVisible[c.subId]++:c.layerInfo.subLayerVisible[c.subId]--;this._visible=
a;var b={};this.traversal(function(a){0===a.getSubLayers().length&&(b[a.originOperLayer.mapService.subId]=a.isVisbleOrInvisilbe())});c.layerInfo.setSubLayerVisible(b)}},setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(a){},_sevVisible:function(a){this.visible=a},obtainNewSubLayers:function(){var a=[];e.forEach(this.originOperLayer.subLayers,function(c){c.parentLayerInfo=this;c=l.getInstance().create(c);a.push(c);c.init()},this);return a},getOpacity:function(){},setOpacity:function(a){},
getLayerObject:function(){var a=new h;this.layerObject.empty?d({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(g.hitch(this,function(c){var b=this.layerObject.url;this.layerObject=c;this.layerObject.url=b;a.resolve(this.layerObject)}),function(c){a.reject(c)}):a.resolve(this.layerObject);return a},getLayerType:function(){var a=new h;a.resolve("GroupLayer");return a},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)}})})},
"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(m,e){return m(e,{constructor:function(e,h){},initVisible:function(){var e=!1,h=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<h.layerInfo.subLayerVisible[h.subId]&&(e=!0);this._visible=e},_setTopLayerVisible:function(e){var h;this.originOperLayer.mapService&&(h=this.originOperLayer.mapService,e?h.layerInfo.subLayerVisible[h.subId]++:h.layerInfo.subLayerVisible[h.subId]--,
this._visible=e,this.visbleOrInvisilbe())},visbleOrInvisilbe:function(){var e=this.originOperLayer.mapService,h={};h[e.subId]=this.isVisbleOrInvisilbe();e.layerInfo.setSubLayerVisible(h)},isVisbleOrInvisilbe:function(){for(var e=this.originOperLayer.mapService,h=-1,d=e.subId,k=0,l=e.layerInfo.layerObject.layerInfos;;){h++;k+=e.layerInfo.subLayerVisible[d];if(-1===l[d].parentLayerId)return k>h?!0:!1;d=l[d].parentLayerId}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/dom-construct ./LayerInfoForDefault esri/layers/FeatureLayer esri/layers/RasterLayer".split(" "),
function(m,e,g,h,d,k,l,a){return m(k,{_legendsNode:null,_loadLegends:function(a){var b=new h;this.originOperLayer.mapService.layerInfo.getLegendInfo(a).then(g.hitch(this,function(a){b.resolve(a)}));return b},drawLegends:function(a,b){this._loadLegends(b).then(g.hitch(this,function(b){this._initLegendsNode(b,a)}))},_initLegendsNode:function(a,b){var g=this.originOperLayer.mapService;if(a){d.empty(b);for(var f=null,h=0;h<a.length;h++)if(a[h].layerId===g.subId){f=a[h];break}if(f){var k=d.create("table",
{"class":"legend-table",style:"font-size: 12px"},b);e.forEach(f.legend,function(a){if("\x3call other values\x3e"!==a.label){var b=d.create("tr",{"class":"legend-tr",style:"border: 1px solid"},k),c=d.create("td",{"class":"legend-symbol-td",style:""},b),e=null,e=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;d.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",src:e},c);d.create("td",{"class":"legend-label-td",innerHTML:a.label||
" ",style:"padding-left: 5px"},b)}},this)}}},_initControlPopup:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,b=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:a.infoTemplates&&a.infoTemplates[b]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,b=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&a.infoTemplates&&delete a.infoTemplates[b]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},
getLayerObject:function(){var c=new h;this.getLayerType().then(g.hitch(this,function(b){this.layerObject.empty?(this.layerObject="RasterLayer"===b?new a(this.layerObject.url):new l(this.layerObject.url),this.layerObject.on("load",g.hitch(this,function(){c.resolve(this.layerObject)})),this.layerObject.on("error",g.hitch(this,function(){c.resolve(null)}))):this.layerObject.loaded?c.resolve(this.layerObject):(this.layerObject.on("load",g.hitch(this,function(){c.resolve(this.layerObject)})),this.layerObject.on("error",
g.hitch(this,function(){c.resolve(null)})))}),g.hitch(this,function(){c.resolve(null)}));return c},getPopupInfo:function(){var a=null,b=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(b)for(var d=0;d<b.length;d++)if(b[d].id===this.originOperLayer.mapService.subId){a=b[d].popupInfo;break}return a},getFilterOfWebmap:function(){var a=null,b=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(b)for(var d=0;d<b.length;d++)if(b[d].id===this.originOperLayer.mapService.subId){a=
b[d].layerDefinition?b[d].layerDefinition.definitionExpression:null;break}return a},getLayerType:function(){var a=new h,b=this.originOperLayer.mapService;b.layerInfo._getSublayerDefinition(b.subId).then(g.hitch(this,function(b){b?a.resolve(b.type.replace(/\ /g,"")):a.resolve(null)}),function(){a.resolve(null)});return a},getSupportTableInfo:function(){var a=new h,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(g.hitch(this,function(d){b.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&
(b.isSupportedLayer=!0);d=this.originOperLayer.mapService;d.layerInfo._getSublayerDefinition(d.subId).then(g.hitch(this,function(d){d&&0<=d.capabilities.indexOf("Data")&&(b.isSupportQuery=!0);a.resolve(b)}),function(){a.resolve(b)})}),function(){a.resolve(b)});return a},enablePopup:function(){var a=this.originOperLayer.mapService.layerInfo,b=a.layerObject,d=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!0;a.controlPopupInfo.infoTemplates&&(b.infoTemplates||(b.infoTemplates=
{}),b.infoTemplates[d]=a.controlPopupInfo.infoTemplates[d])},disablePopup:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,b=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;a.infoTemplates&&delete a.infoTemplates[b]},loadInfoTemplate:function(){var a=new h,b=this.originOperLayer.mapService.layerInfo,d=this.originOperLayer.mapService.subId;b.controlPopupInfo.infoTemplates&&b.controlPopupInfo.infoTemplates[d]?a.resolve(b.controlPopupInfo.infoTemplates[d]):
(b.controlPopupInfo.infoTemplates||(b.controlPopupInfo.infoTemplates={}),b._getSublayerDefinition(d).then(g.hitch(this,function(e){e=this._getDefaultPopupTemplate(e);b.controlPopupInfo.infoTemplates[d]={infoTemplate:e,layerUrl:null};a.resolve(e)}),g.hitch(this,function(){a.resolve(null)})));return a},getInfoTemplate:function(){var a=this.originOperLayer.mapService.layerInfo,b=this.originOperLayer.mapService.subId;return a.controlPopupInfo.infoTemplates&&a.controlPopupInfo.infoTemplates[b]&&a.controlPopupInfo.infoTemplates[b].infoTemplate?
a.controlPopupInfo.infoTemplates[b].infoTemplate:null},_onVisibilityChanged:function(){}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../lang ../domUtils ./layer ./ImageServiceLayerMixin ../SpatialReference ../geometry/Point".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f,p,t){return m([n,f],{declaredClass:"esri.layers.RasterLayer",managedSuspension:!0,constructor:function(a,
b){this.drawMode=b&&void 0!==b.drawMode?b.drawMode:!0;this.drawType=b&&b.drawType?b.drawType:"2d";this._initialize(a,b);(null===this.format||void 0===this.format)&&this.setImageFormat("LERC",!0)},opacity:1,setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){if(this.opacity!=a)this.onOpacityChange(this.opacity=a)},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>d("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));
else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();this._displayTimer=this._displayTimer||setTimeout(e.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);
this._displayTimer=null},_setMap:function(a,b){this.inherited(arguments);var d=this._canvas=k.create("canvas",{id:"canvas",width:a.width+"px",height:a.height+"px",style:"position: absolute; left: 0px; top: 0px;"},b);c.isDefined(this.opacity)&&l.set(d,"opacity",this.opacity);(this._context=d.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(g.connect(a,
"onPan",this,this._panHandler));this._connects.push(g.connect(a,"onPanEnd",this,this._panEndHandler));this._connects.push(g.connect(a,"onZoom",this,this._onZoomHandler));this._connects.push(g.connect(a,"onZoomEnd",this,this._onZoomEndHandler));this._connects.push(g.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(g.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(g.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(g.connect(this,
"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};this.evaluateSuspension();if(this.suspended&&!a.loaded)var e=g.connect(a,"onLoad",this,function(){g.disconnect(e);e=null;this.evaluateSuspension()});return d},_unsetMap:function(a,b){h.forEach(this._connects,g.disconnect,this);this._canvas&&b.removeChild(this._canvas);this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=
null;this.inherited(arguments)},_canDraw:function(){return this._map&&this._canvas&&this._context?!0:!1},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){l.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};if(this._canDraw&&this.drawMode)if(this._useBrowserDecoding())this._fireUpdateEnd();else if(this.drawMode)if(!this.pixelData||
!this.pixelData.pixelBlock)this.clear();else{var a=this.pixelData.pixelBlock,b=this._context,c=b.createImageData(a.width,a.height);c.data.set(a.getAsRGBA());b.putImageData(c,0,0);this._fireUpdateEnd()}},_panHandler:function(a,b){l.set(this._canvas,{left:this._startRect.left+b.x+"px",top:this._startRect.top+b.y+"px"})},_panEndHandler:function(a,b){b&&(this._startRect.left+=b.x,this._startRect.top+=b.y)},_onZoomHandler:function(a,b,c){var d=this._startRect;a=d.width*b;b*=d.height;var e=d.left-(a-d.width)*
(c.x-d.left)/d.width;c=d.top-(b-d.height)*(c.y-d.top)/d.height;l.set(this._canvas,{left:e+"px",top:c+"px",width:a+"px",height:b+"px"});this._endRect={left:e,top:c,width:a,height:b}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,b,c){l.set(this._canvas,{width:b+"px",height:c+"px"});this._startRect.width=this._canvas.width=b;this._startRect.height=this._canvas.height=c},_extentChangeHandler:function(a,b,c,d){this.suspended||(this._fireUpdateStart(),
a=this._map,this._requestData(a.extent,a.width,a.height))},_visibilityChangeHandler:function(a){a?b.show(this._canvas):b.hide(this._canvas)},_opacityChangeHandler:function(a){l.set(this._canvas,"opacity",a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w,v,x,B,D,C,F,A,z,E,H,K){return m(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(a,b){this.useMapTime=b&&b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0},_initialize:function(a,b){this._url=s.urlToObject(a);this.raster=new B(a);this.infoTemplate=b&&b.infoTemplate;var c=b&&b.imageServiceParameters;this.format=c&&c.format;this.compressionTolerance=c&&c.compressionTolerance?
c.compressionTolerance:0.01;this.interpolation=c?c.interpolation:null;this.compressionQuality=c?c.compressionQuality:null;this.bandIds=c?c.bandIds:null;this.mosaicRule=c?c.mosaicRule:null;this.renderingRule=c?c.renderingRule:null;this.useMapDimensionValue=b&&b.hasOwnProperty("useMapDimensionValue")?!!b.useMapDimensionValue:!0;this.activeMapDimensions=b&&b.activeMapDimensions;this._params=e.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,
bandIds:this.bandIds?this.bandIds.join(","):null},c?c.toJson():{});this.pixelFilter=b&&b.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=e.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=e.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=e.hitch(this,this._initLayer);this._queryVisibleRastersHandler=e.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=
[];this._rasterAttributeTableFeatures=[];this._loadCallback=b&&b.loadCallback;(c=b&&b.resourceInfo)?this._initLayer(c):p({url:this._url.path,content:e.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,b){if(!(null===a||void 0===a)){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var c=this.minScale,d=this.maxScale;e.mixin(this,
a);this.minScale=c;this.maxScale=d;this.initialExtent=this.fullExtent=this.extent=new r(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var g=this.minValues,h=this.maxValues,n=this.meanValues,k=this.stdvValues,l=this.bands=[],c=0,d=this.bandCount;c<d;c++)l[c]={min:g[c],max:h[c],mean:n[c],stddev:k[c]};this.timeInfo=(c=this.timeInfo)&&c.timeExtent?new A(c):null;d=this.fields=[];if(g=a.fields)for(c=
0;c<g.length;c++)d.push(new z(g[c]));this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);f.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);f.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);c={};a.defaultMosaicMethod?(c.method=a.defaultMosaicMethod,c.operation=a.mosaicOperator,c.sortField=a.sortField,c.sortValue=a.sortValue):c.method=w.METHOD_NONE;this.defaultMosaicRule=new w(c);this.defaultMosaicRule.ascending=
!0;this._setDefaultRenderingRule(!0);this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(e.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=e.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=e.clone(a.fields))}));this._isVectorData()&&
!f.isDefined(this.pixelFilter)&&(this.vectorFieldPixelFilter=new C,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===this.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(e.hitch(this,this._setFlowRepresentation)));this.loaded=!0;this.onLoad(this);if(c=this._loadCallback)delete this._loadCallback,c(this)}},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new g(t._dfdCanceller);10<this.version?
(b._pendingDfd=p({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=k.isDebug,b.errback(a));return b},getRasterAttributeTable:function(){var a=this._url.path+"/rasterAttributeTable",b=new g(t._dfdCanceller);10<this.version&&this.hasRasterAttributeTable?(b._pendingDfd=p({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},
function(a){b.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=k.isDebug,b.errback(a));return b},_getRasterAttributeTableFeatures:function(){var a=new g;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(e.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=
e.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},getCustomRasterFields:function(a){var b=a?a.rasterAttributeTableFieldPrefix:"",c={name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};a=this.fields?e.clone(this.fields):[];var d=a.length;a[d]={name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||
this.fields&&0<this.fields.length)a[d+1]=c;if(f.isDefined(this.pixelFilter)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType))a[d+2]={name:"Raster.Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},a[d+3]={name:"Raster.Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"};this._rasterAttributeTableFields&&0<this._rasterAttributeTableFields.length&&(c=h.filter(this._rasterAttributeTableFields,
function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),c=h.map(c,function(a){var c=e.clone(a);c.name=b+a.name;return c}),a=a.concat(c));return a},_prepareGetImageParameters:function(a,b,c,g){g=f.isDefined(g)?g:this._params;var h=a.spatialReference.wkid||d.toJson(a.spatialReference.toJson(!1));delete g._ts;e.mixin(g,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:h,bboxSR:h,size:b+","+c},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete g.compressionTolerance;
g.format&&"LERC"===g.format.toUpperCase()&&(g.compressionTolerance=this.compressionTolerance);g.token=this._getToken()},getImageUrl:function(a,b,d,g,h){h=f.isDefined(h)?h:this._params;this._prepareGetImageParameters(a,b,d,h);a=e.clone(h);this._cleanupRequestParams(a);b=this._url.path+"/exportImage?";d=s.addProxy(b+c.objectToQuery(e.mixin(a,{f:"image"})));var k=a.token;d.length>n.defaults.io.postLength||this.useMapImage?this._jsonRequest=p({url:b,content:e.mixin(a,{f:"json"}),callbackParamName:"callback",
load:function(a,b){var c=a.href;k&&(c+=-1===c.indexOf("?")?"?token\x3d"+k:"\x26token\x3d"+k);g(s.addProxy(c))},error:this._errorHandler}):g(d)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setCompressionTolerance:function(a,b){this.compressionTolerance=a;b||this.refresh(!0)},
setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=d.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},
setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?d.toJson(a.toJson()):null;if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=
w.METHOD_NONE);c.where=a;c=new w(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a},getPixelData:function(a){return a?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},
queryVisibleRasters:function(a,b,c,d){var e=this._map,f=t._fixDfd(new g(t._dfdCanceller));this._visibleRasters=[];var h,n,k=!0,l;if(this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&0<this.infoTemplate.info.fieldInfos.length){k=!1;l=this.infoTemplate.info;for(h=0;h<l.fieldInfos.length;h++)if((n=l.fieldInfos[h])&&"raster.servicepixelvalue"!==n.fieldName.toLowerCase()&&(n.visible||l.title&&-1<l.title.toLowerCase().indexOf(n.fieldName.toLowerCase()))){k=!0;break}}h=new K;
h.geometry=a.geometry;h.returnGeometry=this._map.spatialReference.equals(this.spatialReference);h.returnCatalogItems=k;h.timeExtent=a.timeExtent;h.mosaicRule=this.mosaicRule?this.mosaicRule:null;h.renderingRule=this.renderingRule?this.renderingRule:null;e&&(a=new q((e.extent.xmax-e.extent.xmin)/(2*e.width),(e.extent.ymax-e.extent.ymin)/(2*e.height),e.extent.spatialReference),h.pixelSize=a);var p=this;a=new H(this.url);(f._pendingDfd=a.execute(h)).addCallbacks(function(a){p._queryVisibleRastersHandler(a,
b,c,d,f)},function(a){p._resolve([a],null,d,f,!0)});return f},_queryVisibleRastersHandler:function(a,b,c,g,n){function k(){var a=this.getCustomRasterFields(b),d=this._getDomainFields(a),g=b?b.returnDomainValues:!1,p=b&&b.rasterAttributeTableFieldPrefix,t,s,v,u,x,C,w,B,z;this._getRasterAttributeTableFeatures().then(e.hitch(this,function(a){for(t=0;t<q.length;t++){F=q[t];F.setInfoTemplate(this.infoTemplate);F._layer=this;if(l){s=l;m&&m.length>=t&&(v=m[t],s=v.replace(/ /gi,", "));F.attributes["Raster.ItemPixelValue"]=
s;F.attributes["Raster.ServicePixelValue"]=l;if(this.pixelFilter){z=s.replace(" ","").split(",");var b=new D({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});h.forEach(z,function(a){b.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:b,extent:new r(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)F.attributes["Raster.Magnitude"]=
b.pixels[0][0],F.attributes["Raster.Direction"]=b.pixels[1][0]}if(a&&0<a.length&&(u=h.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==s:a.attributes.VALUE==s}),0<u.length&&(x=e.clone(u[0]),p&&x))){B={};for(C in x.attributes)x.attributes.hasOwnProperty(C)&&(w=p+C,B[w]=x.attributes[C]);x.attributes=B;F.attributes=e.mixin(F.attributes,x.attributes)}}g&&(d&&0<d.length)&&h.forEach(d,function(a){if(a){var b=F.attributes[a.name];f.isDefined(b)&&(b=
this._getDomainValue(a.domain,b),f.isDefined(b)&&(F.attributes[a.name]=b))}},this);A.push(F);this._visibleRasters.push(F)}this._resolve([A,null,!0],null,c,n)}))}var l=a.value,m,q,t=0,s=0,v=this,x=this.objectIdField,C;if(a.catalogItems){g=0;var w,B,z=a.catalogItems.features.length;w=0;q=Array(z);m=Array(z);C=Array(z);for(t=0;t<z;t++)-1<a.properties.Values[t].toLowerCase().indexOf("nodata")&&w++;w=z-w;for(t=0;t<z;t++)B=-1<a.properties.Values[t].toLowerCase().indexOf("nodata")?w++:g++,q[B]=a.catalogItems.features[t],
m[B]=a.properties.Values[t],C[B]=q[B].attributes[x]}this._visibleRasters=[];var F;a=-1<l.toLowerCase().indexOf("nodata");l&&(!q&&!a)&&(x="ObjectId",q=[],F=new E(new r(this.fullExtent),null,{ObjectId:0}),q.push(F));var A=[];q?!this._map.spatialReference.equals(this.spatialReference)&&C&&0<C.length?p({url:this._url.path+"/query",content:{f:"json",objectIds:C.join(","),returnGeometry:!0,outSR:d.toJson(v._map.spatialReference.toJson()),outFields:x},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===
a.features.length)v._resolve([A,null,null],null,c,n);else{for(t=0;t<a.features.length;t++)for(s=0;s<q.length;s++)q[s].attributes[x]==a.features[t].attributes[x]&&(q[s].geometry=new u(a.features[t].geometry),q[s].geometry.setSpatialReference(v._map.spatialReference));k.call(v)}},error:function(a){v._resolve([A,null,null],null,c,n)}}):k.call(this):this._resolve([A,null,null],null,c,n)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},
_getDomainFields:function(a){if(a){var b=[];h.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;h.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_requestData:function(a,b,c){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=e.clone(a);var d=a._normalize(!0);this._prepareGetImageParameters(d,b,c);b=e.clone(this._params);this._cleanupRequestParams(b);b.extent=
a;c=null;this._useBrowserDecoding()&&(c=new F({ctx:this._context}));b={imageServiceParameters:b,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:c?e.hitch(c,"decode"):null};this._rasterReadPromise=this.raster.read(b,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a)},_setPixelData:function(a){a=this._clonePixelData(a);
this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this._drawPixelData(),this._rasterReadPromise=null},_drawPixelData:function(){},_requestDataErrorHandler:function(a){},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=e.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=a.clone();return b},_getPixelBlockFromCanvas:function(a,b,c){a=a.getImageData(0,0,b,c).data;
for(var d=b*c,e=0,f=0,g=new Uint8Array(d),h=new Uint8Array(d),n=new Uint8Array(d),k=new Uint8Array(d),l=Infinity,p=Infinity,m=Infinity,q=-Infinity,t=-Infinity,r=-Infinity,s,v,u,e=0;e<d;e++)s=a[f++],v=a[f++],u=a[f++],l=l<s?l:s,q=q>s?q:s,p=p<v?p:v,t=t>v?t:v,m=m<u?m:u,r=r>u?r:u,g[e]=s,h[e]=v,n[e]=u,k[e]=a[f++]&1;return new D({width:b,height:c,pixels:[g,h,n],pixelType:"U8",mask:k,statistics:[{minValue:l,maxValue:q},{minValue:p,maxValue:t},{minValue:m,maxValue:r}]})},_useBrowserDecoding:function(){return(void 0===
this.pixelFilter||null===this.pixelFilter)&&("jpeg"==this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=this._url.path+"/multiDimensionalInfo",b=new g(t._dfdCanceller);if(this._multidimensionalInfo)return b.resolve(this._multidimensionalInfo),b;10.3<=this.version&&this.hasMultidimensions?(b._pendingDfd=p({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(e.hitch(this,function(a){this._multidimensionalInfo=
a.multidimensionalInfo;b.callback(a.multidimensionalInfo)}),function(a){b.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=k.isDebug,b.errback(a));return b},getDefaultMultidimensionalDefinition:function(){var a,b,c,d,f=[],h=new g(t._dfdCanceller);if(this._defaultMultidimensionalDefinition)return h.resolve(this._defaultMultidimensionalDefinition),h;h._pendingDfd=this.getMultidimensionalInfo();h._pendingDfd.then(e.hitch(this,function(e){a=e;b=a.variables[0].name;c=a.variables[0].dimensions;
for(d in c)c.hasOwnProperty(d)&&(c[d].hasRanges&&!0==c[d].hasRanges?f.push(new x({variableName:b,dimensionName:c[d].name,isSlice:!1,values:[c[d].values[0]]})):f.push(new x({variableName:b,dimensionName:c[d].name,isSlice:!0,values:[c[d].extent[0]]})));this._defaultMultidimensionalDefinition=f;h.callback(f)}),function(a){h.errback(a)});return h},_setDefaultMultidimensionalDefinition:function(a){var b,c={};this.getDefaultMultidimensionalDefinition().then(e.hitch(this,function(d){b=d;0<b.length&&(this.mosaicRule?
(c=e.clone(this.mosaicRule),c.multidimensionalDefinition=b):this.defaultMosaicRule?(c=e.clone(this.defaultMosaicRule),c.multidimensionalDefinition=b):c=new w({multidimensionalDefinition:b}),this.setMosaicRule(c,a))}))},_setDefaultRenderingRule:function(a){var b={};if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"None"!=this.rasterFunctionInfos[0].name)b.rasterFunction=this.rasterFunctionInfos[0].name;
else if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"==this.declaredClass&&10.3<this.version){var c="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;b.rasterFunction="Resample";b.rasterFunctionArguments={ResamplingType:c,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}}}b.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new v(b),this.setRenderingRule(this.defaultRenderingRule,a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var b=
new w(d.fromJson(a.mosaicRule));if(b&&b.multidimensionalDefinition&&0<b.multidimensionalDefinition.length){var c=h.filter(b.multidimensionalDefinition,function(a){return"StdTime"!==a.dimensionName});b.multidimensionalDefinition=c;a.mosaicRule=d.toJson(b.toJson())}}var b="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent".split(" "),e;for(e in b)a.hasOwnProperty(b[e])&&delete a[b[e]];return a},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===
this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific "===this.serviceDataType},_isVectorData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType},_createPixelData:function(a){a=new D({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var b=this.fullExtent.getCenter(),b=new r(b.x,b.y,b.x+this.pixelSizeX,b.y+this.pixelSizeY,this.spatialReference);
return{pixelBlock:a,extent:b}},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&t._resDfd(d,a,e)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=l.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(l.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,b){this.useMapTime=a;this._toggleTime();!b&&
this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))}})})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(m,e,g,h,d,k){var l=m(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,
viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(a){e.isObject(a)&&(e.mixin(this,a),a.mosaicMethod&&(this.method=a.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),a.fids&&(this.objectIds=a.fids),a.viewpoint&&
(this.viewpoint=new k(a.viewpoint)))},toJson:function(){var a=null,c=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(c)for(var a=[],b=0;b<c;b++)a.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[b].declaredClass?this.multidimensionalDefinition[b].toJson():this.multidimensionalDefinition[b]);a={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?
this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:a};return d.filter(a,function(a){if(null!==a)return!0})},_getMethodEnum:function(a){if(a){var c=l.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":c=l.METHOD_ATTRIBUTE;break;case "center":c=l.METHOD_CENTER;break;case "lockraster":c=l.METHOD_LOCKRASTER;break;case "nadir":c=l.METHOD_NADIR;break;case "northwest":c=l.METHOD_NORTHWEST;break;case "seamline":c=l.METHOD_SEAMLINE;break;case "viewpoint":c=
l.METHOD_VIEWPOINT}return c}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return l.OPERATION_FIRST;case "last":return l.OPERATION_LAST;case "max":return l.OPERATION_MAX;case "min":return l.OPERATION_MIN;case "blend":return l.OPERATION_BLEND;case "mean":return l.OPERATION_MEAN;case "sum":return l.OPERATION_SUM}}});e.mixin(l,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",
METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});return l})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(m,e,g,h,d){var k=m(null,{declaredClass:"esri.layers.RasterFunction",
functionName:null,arguments:null,functionArguments:null,variableName:null,outputPixelType:null,constructor:function(d){if(e.isObject(d)){var a=0;this.functionName=d.rasterFunction;this.functionArguments=e.clone(d.rasterFunctionArguments||d.arguments);e.mixin(this,d);if(d=this.functionArguments)if(d.Raster=this._toRasterFunction(d.Raster),d.Raster2=this._toRasterFunction(d.Raster2),d.DEM=this._toRasterFunction(d.DEM),d.FillRaster=this._toRasterFunction(d.FillRaster),d.Rasters&&d.Rasters.length)for(a=
0;a<d.Rasters.length;a++)d.Rasters[a]=this._toRasterFunction(d.Rasters[a])}},_toRasterFunction:function(d){return d&&(d.rasterFunction||d.functionName)?new k(d):d},_rfToJson:function(d){d&&"esri.layers.RasterFunction"===d.declaredClass&&(d=d.toJson());return d},toJson:function(){var g=e.clone(this.functionArguments||this.arguments);if(g&&(g.Raster=this._rfToJson(g.Raster),g.Raster2=this._rfToJson(g.Raster2),g.DEM=this._rfToJson(g.DEM),g.FillRaster=this._rfToJson(g.FillRaster),g.Rasters&&g.Rasters.length)){var a,
c=[];for(a=0;a<g.Rasters.length;a++)c.push(this._rfToJson(g.Rasters[a]));g.Rasters=c}return d.filter({rasterFunction:this.functionName,rasterFunctionArguments:g,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(a){if(null!==a&&void 0!==a)return!0})}});return k})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(m,e,g,h,d){return m(null,{declaredClass:"esri.layers.DimensionalDefinition",
variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(d){e.isObject(d)&&e.mixin(this,d)},toJson:function(){return d.filter({variableName:this.variableName,dimensionName:this.dimensionName,values:this.values,isSlice:this.isSlice},function(d){return null!==d})}})})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r){var q,u,w,v=null,x=null,B=function(a){"U1"===a||"U2"===a||"U4"===a||"U8"===a?(a="U8",x=Math.pow(2,8)-1,v=Uint8Array):"U16"===a?(x=x||Math.pow(2,16)-1,v=Uint16Array):"U32"===a?(x=x||Math.pow(2,32)-1,v=Uint32Array):"S8"===a?(x=x||0-Math.pow(2,7),v=Int8Array):"S16"===a?(x=x||0-Math.pow(2,15),v=Int16Array):"S32"===a?(x=x||0-Math.pow(2,31),v=Int32Array):v=Float32Array;return a};return e(b,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),
validFormats:"lerc jpeg jpgpng png png8 png24 png32 bip bsq".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){if(!a)throw"Image Service URL is not defined";this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(b,c,e){var f=this,l=new h(t._dfdCanceller);if(10>a("ie"))throw"This browser is not supported.";if(!b.imageServiceParameters)throw"Insufficient parameters to read data";var p=g.clone(b.imageServiceParameters),
m=b.pixelType;d.some(this.validPixelTypes,function(a){return a===m})||(p.pixelType="F32");d.some(this.validFormats,function(a){return a.toLowerCase()===p.format.toLowerCase()})||(p.format="lerc");var q=b.decodeFunc,s;this._prepareGetImageParameters(p);l._pendingDfd=n({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",content:g.mixin(p,{f:"image"}),load:function(a){var b=p.format.toUpperCase();"BSQ"!==b&&"BIP"!==b&&(b=f._getFormat(a));if("ERROR"===b)a=Error(String.fromCharCode.apply(null,
new Uint8Array(a))),a.log=k.isDebug,f._resolve([a],null,e,l,!0);else{if(void 0===q||null===q)q=f._getFormatDecoderDfd(b);q?q(a,{width:p.width,height:p.height,planes:null,pixelType:m,noDataValue:p.noData}).then(function(a){s={pixelBlock:a,extent:p.extent};f._resolve([s,p],"onRasterReadComplete",c,l)},function(a){f._resolve([a],null,e,l,!0)}):(a=Error("Format '"+p.format+"' is not supported."),a.log=k.isDebug,f._resolve([a],null,e,l,!0))}},error:function(a){f._resolve([a],null,e,l,!0)}});return l.promise},
onRasterReadComplete:function(){},_prepareGetImageParameters:function(a){if(a.size&&a.bbox){var b=a.size.split(",");a.width=parseFloat(b[0]);a.height=parseFloat(b[1]);a.extent||(b=a.bbox.split(","),a.extent=new f(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]),new p(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";
var b=a.extent,c=b.spatialReference.wkid||l.toJson(b.spatialReference.toJson());delete a._ts;g.mixin(a,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:c,bboxSR:c,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,c){var d=a.ymax-a.ymin,e=a.xmax-a.xmin;c>=b?a.ymax=a.ymin+e*b/c:(e=d*c/b,a.xmax=a.xmin+e);return a},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&t._resDfd(d,a,e)},_getFormatDecoderDfd:function(a){var b=
null;switch(a){case "LERC":b=this._decodeLerc;break;case "JPEG":b=this._decodeJpeg;break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip}b=g.hitch(this,b);return function(a,c){var d=new h;try{var e=b(a,c);d.resolve(e)}catch(f){d.reject(f)}return d}},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="JPEG":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?b="PNG":67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===
a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?b="LERC":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(b="ERROR");return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,b){if(!q)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(b);var c=(new q).decode(a);if(c.height!==b.height||c.width!==b.width)throw"The decoded image dimensions are incorrect.";
var d=[],e,f;for(e=0;e<c.pixels.length;e++)f=c.pixels[e],d.push(this._calculateBandStatistics(f));return new s({width:c.width,height:c.height,pixels:c.pixels,pixelType:"U8",mask:c.mask,statistics:d})},_decodePng:function(a,b){if(!u)throw"The png decoder module is not loaded.";this._validateDecodeParams(b);var c=new Uint8Array(a),d=new u(c),c=new Uint8Array(4*b.width*b.height);d.copyToImageData(c,d.decodePixels());for(var e=d=0,f,e=new Uint8Array(b.width*b.height),d=0;d<b.width*b.height;d++)e[d]=c[4*
d+3];for(var g=new s({width:b.width,height:b.height,pixels:[],pixelType:"U8",mask:e,statistics:[]}),d=0;3>d;d++){f=new Uint8Array(b.width*b.height);for(e=0;e<b.width*b.height;e++)f[e]=c[4*e+d];g.addData({pixels:f,statistics:this._calculateBandStatistics(f)})}return g},_decodeBsq:function(a,b){if(!w)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(b);x=b.noDataValue;b.pixelType=B(b.pixelType);var c=w.decodeBSQ(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:v,noDataValue:x}),
d=[],e,f=null;for(e=0;e<c.pixels.length;e++)f=c.pixels[e],d.push(this._calculateBandStatistics(f));return new s({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,statistics:d})},_decodeBip:function(a,b){this._validateDecodeParams(b);x=b.noDataValue;b.pixelType=B(b.pixelType);var c=w.decodeBIP(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:v,noDataValue:x}),d=[],e,f=null;for(e=0;e<c.pixels.length;e++)f=c.pixels[e],d.push(this._calculateBandStatistics(f));
return new s({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,statistics:d})},_decodeLerc:function(a,b){this._validateDecodeParams(b);x=b.noDataValue;b.pixelType=B(b.pixelType);for(var c=0,d,e=0,f,g=a.byteLength-10;e<g;){var h=r.decode(a,{inputOffset:e,encodedMaskData:d,returnMask:0===c?!0:!1,returnEncodedMask:0===c?!0:!1,returnFileInfo:!0,pixelType:v,noDataValue:x}),e=h.fileInfo.eofOffset;0===c&&(d=h.encodedMaskData,f=new s({width:b.width,height:b.height,pixels:[],
pixelType:b.pixelType,mask:h.maskData,statistics:[]}));c++;if(h.height!==b.height||h.width!==b.width)throw"The decoded image dimensions are incorrect";f.addData({pixels:h.pixelData,statistics:{minValue:h.minValue,maxValue:h.maxValue,noDataValue:h.noDataValue}})}return f},_calculateBandStatistics:function(a){var b=Infinity,c=-Infinity,d=a.length,e,f=0;for(e=0;e<d;e++)f=a[e],b=f<b?f:b,c=f>c?f:c;return{minValue:b,maxValue:c}},_loadRasterFormatModules:function(){10>a("ie")||m(["./rasterFormats/JpgPlus",
"./rasterFormats/Png","./rasterFormats/Raw"],function(a,b,c){q=a;u=b;w=c})}})})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,e,g,h){return m([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],constructor:function(d){if(d){if(!d.width||Math.floor(d.width)!==d.width)throw"PixelBlock: incorrect width";if(!d.height||Math.floor(d.height)!==d.height)throw"PixelBlock: incorrect height";
if(!d.pixels||!d.statistics)throw"PixelBlock: pixel data or statistics not present";this.width=d.width;this.height=d.height;this.pixels=d.pixels;this.pixelType=d.pixelType||null;this.statistics=d.statistics;this.mask=d.mask||null}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(d){if(!d.pixels||!d.statistics)throw"Pixel data or statistics are not present";if(d.pixels.length!==
this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(d.statistics);this.pixels.push(d.pixels)},getAsRGBA:function(){var d=new ArrayBuffer(4*this.width*this.height);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(d);break;default:this._fillFrom8Bit(d)}return new Uint8ClampedArray(d)},getAsRGBAFloat:function(){var d=new Float32Array(4*this.width*this.height);this._fillFrom32Bit(d);return d},clone:function(){var d=
new this.constructor;d.width=this.width;d.height=this.height;d.pixelType=this.pixelType;this.mask&&(d.mask=new Uint8Array(this.mask));var g,h;if(this.pixels){d.pixels=[];h=this.pixels.length;for(g=0;g<h;g++)d.pixels[g]=new Float32Array(this.pixels[g])}if(this.statistics){d.statistics=[];h=this.statistics.length;for(g=0;g<h;g++)d.statistics[g]=e.clone(this.statistics[g])}return d},_fillFrom8Bit:function(d){var e=this.pixels,g=this.mask;if(!d||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var a,c,b;a=c=b=e[0];3<=e.length&&(c=e[1],b=e[2]);var e=new Uint32Array(d),h=this.width*this.height;if(a.length!==h)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(g&&g.length===h)for(d=0;d<h;d++)g[d]&&(e[d]=-16777216|b[d]<<16|c[d]<<8|a[d]);else for(d=0;d<h;d++)e[d]=-16777216|b[d]<<16|c[d]<<8|a[d]},_fillFromNon8Bit:function(d){var e=this.pixels,g=this.mask,a=this.statistics;if(!d||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var c=1,b=0;a&&0<a.length?(b=a[0].minValue,c=255/(a[0].maxValue-a[0].minValue)):(c=255,"S8"===this.pixelType?(b=-128,c=127):"U16"===this.pixelType?c=65535:"S16"===this.pixelType?(b=-32768,c=32767):"U32"===this.pixelType?c=4294967295:"S32"===this.pixelType?(b=-2147483648,c=2147483647):"F32"===this.pixelType?(b=-3.4*1E39,c=3.4*1E39):"F64"===this.pixelType&&(b=-Number.MAX_VALUE,c=Number.MAX_VALUE),c=255/(c-b));d=new Uint32Array(d);var a=this.width*this.height,h,f,p;h=e[0];if(h.length!==a)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
if(3<=e.length)if(f=e[1],p=e[2],g&&g.length===a)for(e=0;e<a;e++)g[e]&&(d[e]=-16777216|(p[e]-b)*c<<16|(f[e]-b)*c<<8|(h[e]-b)*c);else for(e=0;e<a;e++)d[e]=-16777216|(p[e]-b)*c<<16|(f[e]-b)*c<<8|(h[e]-b)*c;else if(g&&g.length===a)for(e=0;e<a;e++)f=(h[e]-b)*c,g[e]&&(d[e]=-16777216|f<<16|f<<8|f);else for(e=0;e<a;e++)f=(h[e]-b)*c,d[e]=-16777216|f<<16|f<<8|f},_fillFrom32Bit:function(d){var e=this.pixels,g=this.mask;if(!d||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var a,c,b;a=c=b=e[0];3<=e.length&&(c=e[1],b=e[2]);var h=this.width*this.height;if(a.length!==h)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var f=0;if(g&&g.length===h)for(e=0;e<h;e++)d[f++]=a[e],d[f++]=c[e],d[f++]=b[e],d[f++]=g[e];else for(e=0;e<h;e++)d[f++]=a[e],d[f++]=c[e],d[f++]=b[e],d[f++]=255}})})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var m={defaultNoDataValue:-3.4027999387901484E38,decode:function(g,h){var d;h=h||{};var k=h.inputOffset||
0,l=h.encodedMaskData||null===h.encodedMaskData,a={},c=new Uint8Array(g,k,10);a.fileIdentifierString=String.fromCharCode.apply(null,c);if("CntZImage"!=a.fileIdentifierString.trim())throw"Unexpected file identifier string: "+a.fileIdentifierString;var k=k+10,b=new DataView(g,k,24);a.fileVersion=b.getInt32(0,!0);a.imageType=b.getInt32(4,!0);a.height=b.getUint32(8,!0);a.width=b.getUint32(12,!0);a.maxZError=b.getFloat64(16,!0);k+=24;if(!l)if(b=new DataView(g,k,16),a.mask={},a.mask.numBlocksY=b.getUint32(0,
!0),a.mask.numBlocksX=b.getUint32(4,!0),a.mask.numBytes=b.getUint32(8,!0),a.mask.maxValue=b.getFloat32(12,!0),k+=16,0<a.mask.numBytes){var l=new Uint8Array(Math.ceil(a.width*a.height/8)),b=new DataView(g,k,a.mask.numBytes),c=b.getInt16(0,!0),n=2,f=0;do{if(0<c)for(;c--;)l[f++]=b.getUint8(n++);else for(var p=b.getUint8(n++),c=-c;c--;)l[f++]=p;c=b.getInt16(n,!0);n+=2}while(n<a.mask.numBytes);if(-32768!==c||f<l.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=l;k+=a.mask.numBytes}else 0==
(a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue)&&(l=new Uint8Array(Math.ceil(a.width*a.height/8)),a.mask.bitset=l);b=new DataView(g,k,16);a.pixels={};a.pixels.numBlocksY=b.getUint32(0,!0);a.pixels.numBlocksX=b.getUint32(4,!0);a.pixels.numBytes=b.getUint32(8,!0);a.pixels.maxValue=b.getFloat32(12,!0);k+=16;l=a.pixels.numBlocksX;c=a.pixels.numBlocksY;l+=0<a.width%l?1:0;c+=0<a.height%c?1:0;a.pixels.blocks=Array(l*c);n=1E9;for(p=f=0;p<c;p++)for(var t=0;t<l;t++){var s=0,b=new DataView(g,k,Math.min(10,
g.byteLength-k)),r={};a.pixels.blocks[f++]=r;var q=b.getUint8(0);s++;r.encoding=q&63;if(3<r.encoding)throw"Invalid block encoding ("+r.encoding+")";if(2===r.encoding)k++,n=Math.min(n,0);else{if(0!==q&&2!==q){q>>=6;r.offsetType=q;if(2===q)r.offset=b.getInt8(1),s++;else if(1===q)r.offset=b.getInt16(1,!0),s+=2;else if(0===q)r.offset=b.getFloat32(1,!0),s+=4;else throw"Invalid block offset type";n=Math.min(r.offset,n);if(1===r.encoding)if(q=b.getUint8(s),s++,r.bitsPerPixel=q&63,q>>=6,r.numValidPixelsType=
q,2===q)r.numValidPixels=b.getUint8(s),s++;else if(1===q)r.numValidPixels=b.getUint16(s,!0),s+=2;else if(0===q)r.numValidPixels=b.getUint32(s,!0),s+=4;else throw"Invalid valid pixel count type";}k+=s;if(3!=r.encoding)if(0===r.encoding){b=(a.pixels.numBytes-1)/4;if(b!==Math.floor(b))throw"uncompressed block has invalid length";s=new ArrayBuffer(4*b);q=new Uint8Array(s);q.set(new Uint8Array(g,k,4*b));s=new Float32Array(s);for(q=0;q<s.length;q++)n=Math.min(n,s[q]);r.rawData=s;k+=4*b}else 1===r.encoding&&
(b=Math.ceil(r.numValidPixels*r.bitsPerPixel/8),s=Math.ceil(b/4),s=new ArrayBuffer(4*s),q=new Uint8Array(s),q.set(new Uint8Array(g,k,b)),r.stuffedData=new Uint32Array(s),k+=b)}}a.pixels.minValue=n;a.eofOffset=k;var k=null!=h.noDataValue?h.noDataValue:m.defaultNoDataValue,c=h.encodedMaskData,s=h.returnMask,n=0,f=a.pixels.numBlocksX,p=a.pixels.numBlocksY,t=Math.floor(a.width/f),r=Math.floor(a.height/p),b=2*a.maxZError,c=c||(a.mask?a.mask.bitset:null),u,l=new (h.pixelType||Float32Array)(a.width*a.height);
s&&c&&(u=new Uint8Array(a.width*a.height));for(var s=new Float32Array(t*r),w,v,q=0;q<=p;q++){var x=q!==p?r:a.height%p;if(0!==x)for(var B=0;B<=f;B++){var D=B!==f?t:a.width%f;if(0!==D){var C=q*a.width*r+B*t,F=a.width-D,A=a.pixels.blocks[n],z,E;if(2>A.encoding){if(0===A.encoding)z=A.rawData;else{z=A.stuffedData;E=A.bitsPerPixel;w=A.numValidPixels;v=A.offset;var H=b,K=s,P=a.pixels.maxValue,G=(1<<E)-1,J=0,M=void 0,y=0,L=void 0,O=void 0,Q=Math.ceil((P-v)/H),M=4*z.length-Math.ceil(E*w/8);z[z.length-1]<<=
8*M;for(M=0;M<w;M++)0===y&&(O=z[J++],y=32),y>=E?(L=O>>>y-E&G,y-=E):(y=E-y,L=(O&G)<<y&G,O=z[J++],y=32-y,L+=O>>>y),K[M]=L<Q?v+L*H:P;z=s}E=0}else d=2===A.encoding?0:A.offset;var N;if(c)for(v=0;v<x;v++){C&7&&(N=c[C>>3],N<<=C&7);for(w=0;w<D;w++)C&7||(N=c[C>>3]),N&128?(u&&(u[C]=1),l[C++]=2>A.encoding?z[E++]:d):(u&&(u[C]=0),l[C++]=k),N<<=1;C+=F}else if(2>A.encoding)for(v=0;v<x;v++){for(w=0;w<D;w++)l[C++]=z[E++];C+=F}else for(v=0;v<x;v++){for(w=0;w<D;w++)l[C++]=d;C+=F}if(1===A.encoding&&E!==A.numValidPixels)throw"Block and Mask do not match";
n++}}}d=u;u={width:a.width,height:a.height,pixelData:l,minValue:a.pixels.minValue,maxValue:a.pixels.maxValue,noDataValue:k};d&&(u.maskData=d);h.returnEncodedMask&&a.mask&&(u.encodedMaskData=a.mask.bitset?a.mask.bitset:null);if(h.returnFileInfo&&(u.fileInfo=e(a),h.computeUsedBitDepths)){d=u.fileInfo;N=a.pixels.numBlocksX*a.pixels.numBlocksY;z={};for(E=0;E<N;E++)k=a.pixels.blocks[E],0===k.encoding?z.float32=!0:1===k.encoding?z[k.bitsPerPixel]=!0:z[0]=!0;a=Object.keys(z);d.bitDepths=a}return u}},e=function(e){return{fileIdentifierString:e.fileIdentifierString,
fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,minValue:e.pixels.minValue,noDataValue:this.noDataValue}}};return m})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),
function(m,e,g,h,d,k){return m(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(d){e.mixin(this,d);this.isDataUV=d&&d.isDataUV?d.isDataUV:!1;this.computeMagnitudeAndDirection=e.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(d,a){this.inputUnit=d;this.outputUnit=a;this.unitConversionFactor=
1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var d=k.indexOf(this.speedUnits,this.inputUnit),a=k.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=d&&0<=a){var c=[1,0.277778,0.514444,0.3048,0.44704,0];this.unitConversionFactor=c[d]/c[a]}},computeMagnitudeAndDirection:function(e){if(!d.isDefined(e))throw"Could not compute magnitude and direction. No pixel data is available.";var a=e.pixelBlock;if(!d.isDefined(a)||2!==a.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var c=e.extent,b=(c.xmax-c.xmin)/a.width,g=(c.ymax-c.ymin)/a.height,f=c.xmin+b/2,c=c.ymax-g/2;a.statistics[0].minValue=0;a.statistics[0].maxValue=0;var h=180/Math.PI,k=[],m=0,r=0,q=0,u=!d.isDefined(a.mask),w,v,x,B,D,C,F,A;D=F=Infinity;C=A=-Infinity;for(m=0;m<a.height;m++)for(r=0;r<a.width;r++,q++)if(k.push([f+b*r,c-g*m]),u||a.mask[q])x=w=a.pixels[0][q]*this.unitConversionFactor,B=v=a.pixels[1][q],this.isDataUV&&(x=Math.sqrt(w*w+v*v),B=90-h*Math.atan2(v,w),a.pixels[0][q]=x*this.unitConversionFactor,
a.pixels[1][q]=B),x>C&&(C=x),x<D&&(D=x),B>A&&(A=B),B<F&&(F=B);a.statistics[0].maxValue=C;a.statistics[0].minValue=D;a.statistics[1].maxValue=A;a.statistics[1].minValue=F;e.locations=k;return e}})})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(m,e,g,h){var d;return e(null,{constructor:function(d){this.ctx=d.ctx;this._loadRasterFormatModule()},decode:function(d,e){if(!e.width||!e.height)throw"Native decoding requires the image format, width and height";
var a=new g,c,b=new Uint8Array(d),h=this._getFormat(d);if("error"===h)throw"invalid format";"jpeg"===h&&(c=this._getMask(b,e));var f="",p,m;for(p=0;p<b.length;p+=65535)m=b.subarray(p,p+65535>b.length-1?b.length-1:p+65535),f+=String.fromCharCode.apply(null,m);var b="data:image/"+h+";base64,"+window.btoa(f),s=new Image,r;s.src=b;var q=this;s.onload=function(){q.ctx.clearRect(0,0,e.width,e.height);q.ctx.drawImage(s,0,0);var b=q.ctx.getImageData(0,0,s.width,s.height);r=b.data;if(c)for(p=0;p<c.length;p++)r[4*
p+3]=c[p]?255:0;q.ctx.putImageData(b,0,0);a.resolve(null)};s.onerror=function(){a.reject("cannot load image")};return a},_getFormat:function(d){d=new Uint8Array(d,0,10);var e="error";255===d[0]&&216===d[1]?e="jpeg":137===d[0]&&(80===d[1]&&78===d[2]&&71===d[3])&&(e="png");return e},_getMask:function(e,g){var a;try{if(!d)throw"The zlib decoder module is not loaded.";var c=0,b=0,h=Math.round(e.length/2);1===h%2&&(h+=1);for(var f=e.length-2,c=h;c<f&&!(255===e[c]&&217===e[c+1]);c++);h=c+=2;if(h<e.length-
1){var p=(new d(e.subarray(h))).getBytes();a=new Uint8Array(g.width*g.height);for(c=h=0;c<p.length;c++)for(b=7;0<=b;b--)a[h++]=p[c]>>b&1}}catch(m){}return a},_loadRasterFormatModule:function(){10>h("ie")||m(["./Zlib"],function(e){d=e})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(m,e,g,h,d,k,l,a){m=m(l,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",
constructor:function(a){this._url.path+="/identify";this._handler=e.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(c,b,d,e,g){try{var h=new a(c);this._successHandler([h],"onComplete",d,g)}catch(k){this._errorHandler(k,e,g)}},execute:function(a,b,g,f){var h=f.assembly;a=this._encode(e.mixin({},this._url.query,{f:"json"},a.toJson(h&&h[0])));var k=this._handler,l=this._errorHandler;return d({url:this._url.path,content:a,callbackParamName:"callback",
load:function(a,c){k(a,c,b,g,f.dfd)},error:function(a){l(a,g,f.dfd)}})},onComplete:function(){}});k._createWrappers(m);return m})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(m,e,g,h,d,k){return m(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(e){e.catalogItems&&(this.catalogItems=new k(e.catalogItems));e.location&&(this.location=d.fromJson(e.location));
this.catalogItemVisibilities=e.catalogItemVisibilities;this.name=e.name;this.objectId=e.objectId;this.value=e.value;this.properties=e.properties}})})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(m,e,g,h,d,k,l){return m(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,pixelSizeX:null,pixelSizeY:null,
pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(a){var c=a&&a.geometry||this.geometry;a={geometry:c,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?g.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?g.toJson(this.renderingRule.toJson()):null};c&&(a.geometryType=l.getJsonType(c));c=this.timeExtent;a.time=c?c.toJson().join(","):null;k.isDefined(this.pixelSizeX)&&k.isDefined(this.pixelSizeY)?
a.pixelSize=g.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(a.pixelSize=this.pixelSize?g.toJson(this.pixelSize.toJson()):null);return a}})})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(m,e){return m(e,{constructor:function(e,h){this.noLegend=!0},getExtent:function(){},initVisible:function(){},_setTopLayerVisible:function(e){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},
setOpacity:function(e){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred ./LayerInfoForDefault esri/layers/FeatureLayer".split(" "),function(m,e,g,h,d,k){return m(d,{isTable:null,constructor:function(){this.newSubLayers=[];this.isTable=!0},init:function(){},getLayerObject:function(){var d=new h;this.layerObject.empty?this.layerObject.url?
(this.layerObject=new k(this.layerObject.url,this.layerObject.options||{}),this.layerObject.on("load",e.hitch(this,function(){d.resolve(this.layerObject)})),this.layerObject.on("error",e.hitch(this,function(){d.resolve(null)}))):this.layerObject.featureCollectionData?(this.layerObject=new k(this.layerObject.featureCollectionData,this.layerObject.options||{}),d.resolve(this.layerObject)):d.resolve(null):d.resolve(this.layerObject);return d},getLayerType:function(){var d=new h;d.resolve("Table");return d},
isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return g.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplate:void 0}}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all esri/request ./LayerInfoForDefault".split(" "),function(m,e,g,h,d,k,l,
a){return m(a,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=this.layerObject.serviceDataType&&("esriImageServiceDataTypeVector-UV"===this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.layerObject.serviceDataType)?"ArcGISImageServiceVectorLayer":"ArcGISImageServiceLayer"},_initLegendsNode:function(a){10.2<=this.layerObject.version?this._legendRequestServer().then(h.hitch(this,function(b){e.empty(a);
g.forEach(b.layers,function(b){g.forEach(b.legend,function(b){if("\x3call other values\x3e"!==b.label){var d=e.create("div",{"class":"legend-div"},a),g=e.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},d),h=null,h=b.imageData?"data:"+b.contentType+";base64,"+b.imageData:b.url;e.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:h},g);e.create("div",{"class":"legend-label jimu-float-leading",
innerHTML:b.label||" "},d)}},this)},this)}),h.hitch(this,function(){e.empty(a)})):e.empty(a)},_legendRequestServer:function(){var a=this.layerObject.url+"/legend",b={f:"json"};this.layerObject._params.bandIds&&(b.bandIds=this.layerObject._params.bandIds);this.layerObject._params.renderingRule&&(b.renderingRule=this.layerObject._params.renderingRule);return l({url:a,content:b,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var a=new d,b={isSupportedLayer:!1,isSupportQuery:!1,
layerType:null},e=this.getLayerType(),f=this.getLayerObject();k({type:e,layerObject:f}).then(h.hitch(this,function(d){var e=d.type;d=d.layerObject;b.layerType=e;0<=this._getLayerTypesOfSupportTable().indexOf(e)&&(b.isSupportedLayer=!0);d.capabilities&&0<=d.capabilities.indexOf("Catalog")?b.isSupportQuery=!0:b.isSupportedLayer=!1;a.resolve(b)}),function(){a.resolve(b)});return a}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred",
"dojo/promise/all","./LayerInfoForDefault"],function(m,e,g,h,d){return m(d,{getSupportTableInfo:function(){var d=new g,l={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,otherReasonCanNotSupport:!0},a=this.getLayerType(),c=this.getLayerObject();h({type:a,layerObject:c}).then(e.hitch(this,function(a){var c=a.type;a=a.layerObject;l.layerType=c;0<=this._getLayerTypesOfSupportTable().indexOf(c)&&(l.isSupportedLayer=!0);if((c=a.getLatestObservations())&&0<c.length)l.otherReasonCanNotSupport=!1;d.resolve(l)}),
function(){d.resolve(l)});return d}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(m,e,g,h,d,k,l,a,c){return k("dijit.layout._LayoutWidget",[e,g,h],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);l.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);
var a=this.getParent&&this.getParent();if(!a||!a.isLayoutContainer)this.resize(),this.own(d.on("resize",m.hitch(this,"resize")))}},resize:function(b,d){var e=this.domNode;b&&a.setMarginBox(e,b);var g=d||{};m.mixin(g,b||{});if(!("h"in g)||!("w"in g))g=m.mixin(a.getMarginBox(e),g);var h=c.getComputedStyle(e),k=a.getMarginExtents(e,h),l=a.getBorderExtents(e,h),g=this._borderBox={w:g.w-(k.w+l.w),h:g.h-(k.h+l.h)},k=a.getPadExtents(e,h);this._contentBox={l:c.toPixelValue(e,h.paddingLeft),t:c.toPixelValue(e,
h.paddingTop),w:g.w-k.w,h:g.h-k.h};this.layout()},layout:function(){},_setupChild:function(a){l.add(a.domNode,this.baseClass+"-child "+(a.baseClass?this.baseClass+"-"+a.baseClass:""))},addChild:function(a,c){this.inherited(arguments);this._started&&this._setupChild(a)},removeChild:function(a){l.remove(a.domNode,this.baseClass+"-child"+(a.baseClass?" "+this.baseClass+"-"+a.baseClass:""));this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r){n("dijit-legacy-requires")&&r(0,function(){m(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return g("dijit.Menu",s,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):e.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return p.get(this._iframeContentDocument(a))||
this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(e){e=h.byId(e,this.ownerDocument);var g;if("iframe"==e.tagName.toLowerCase()){var n=e;g=this._iframeContentWindow(n);g=f.body(g.document)}else g=e==f.body(this.ownerDocument)?this.ownerDocument.documentElement:e;var k={node:e,
iframe:n};d.set(e,"_dijitMenu"+this.id,this._bindings.push(k));var p=c.hitch(this,function(c){var d=this.selector,e=d?function(a){return b.selector(d,a)}:function(a){return a},f=this;return[b(c,e(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<this._lastKeyDown+500||f._scheduleOpen(this,n,{x:a.pageX,y:a.pageY},a.target)}),b(c,e("keydown"),function(b){if(93==b.keyCode||b.shiftKey&&b.keyCode==a.F10||this.leftClickToOpen&&b.keyCode==
a.SPACE)b.stopPropagation(),b.preventDefault(),f._scheduleOpen(this,n,null,b.target),this._lastKeyDown=(new Date).getTime()})]});k.connects=g?p(g):[];n&&(k.onloadHandler=c.hitch(this,function(){var a=this._iframeContentWindow(n),a=f.body(a.document);k.connects=p(a)}),n.addEventListener?n.addEventListener("load",k.onloadHandler,!1):n.attachEvent("onload",k.onloadHandler))},unBindDomNode:function(a){var b;try{b=h.byId(a,this.ownerDocument)}catch(c){return}a="_dijitMenu"+this.id;if(b&&d.has(b,a)){for(var e=
d.get(b,a)-1,f=this._bindings[e],g;g=f.connects.pop();)g.remove();(g=f.iframe)&&(g.removeEventListener?g.removeEventListener("load",f.onloadHandler,!1):g.detachEvent("onload",f.onloadHandler));d.remove(b,a);delete this._bindings[e]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(a){function b(){r.refocus&&s&&s.focus();t.close(r)}var c=a.target,
d=a.iframe,e=a.coords,f=!e;this.currentTarget=a.delegatedTarget;if(e){if(d){a=k.position(d,!0);var c=this._iframeContentWindow(d),c=k.docScroll(c.document),g=l.getComputedStyle(d),p=l.toPixelValue,m=(n("ie")&&n("quirks")?0:p(d,g.paddingLeft))+(n("ie")&&n("quirks")?p(d,g.borderLeftWidth):0),d=(n("ie")&&n("quirks")?0:p(d,g.paddingTop))+(n("ie")&&n("quirks")?p(d,g.borderTopWidth):0);e.x+=a.x+m-c.x;e.y+=a.y+d-c.y}}else e=k.position(c,!0),e.x+=10,e.y+=10;var r=this,d=this._focusManager.get("prevNode");
a=this._focusManager.get("curNode");var s=!a||h.isDescendant(a,this.domNode)?d:a;t.open({popup:this,x:e.x,y:e.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});this.focus();f||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);t.close(this)}},destroy:function(){e.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare",
"./Grid","./OnDemandList"],function(m,e,g){return m("dgrid.OnDemandGrid",[e,g],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(m,e,g,h,d,k,l){function a(a,b){b&&b.nodeType&&a.appendChild(b)}function c(a,b,c,d){if(this.formatter){d=this.formatter;var e=this.grid.formatterScope;c.innerHTML="string"===typeof d&&e?e[d](b,a):this.formatter(b,a)}else null!=b&&c.appendChild(document.createTextNode(b))}
var b=8>h("ie")&&!h("quirks");e=e("dgrid.Grid",k,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!=typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,b){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&(a=a.target);var c;if(a.nodeType){do{if(this._rowIdToObject[a.id])break;var d=a.columnId;if(d){b=d;c=a;break}a=a.parentNode}while(a&&a!=this.domNode)}if(!c&&"undefined"!=typeof b){var e=this.row(a);if(d=e&&e.element)for(var d=
d.getElementsByTagName("td"),g=0;g<d.length;g++)if(d[g].columnId==b){c=d[g];break}}if(null!=a)return{row:e||this.row(a),column:b&&this.column(b),element:c}},createRowCells:function(a,c,e,g){var k=d("table.dgrid-row-table[role\x3dpresentation]"),m=9>h("ie")||h("quirks")?d(k,"tbody"):k,q,u,w,v,x,B,D,C,F,A;e=e||this.subRows;u=0;for(w=e.length;u<w;u++){B=e[u];q=d(m,"tr");B.className&&d(q,"."+B.className);v=0;for(x=B.length;v<x;v++){D=B[v];C=D.id;F=D.field?".field-"+l.escapeCssIdentifier(D.field,"-"):
"";(A="function"===typeof D.className?D.className(g):D.className)&&(F+="."+A);F=d(a+(".dgrid-cell.dgrid-cell-padding"+(C?".dgrid-column-"+l.escapeCssIdentifier(C,"-"):"")+F.replace(/ +/g,"."))+"[role\x3d"+("th"===a?"columnheader":"gridcell")+"]");F.columnId=C;b?(C=d(F,"!dgrid-cell-padding div.dgrid-cell-padding"),F.contents=C):C=F;if(A=D.colSpan)F.colSpan=A;if(A=D.rowSpan)F.rowSpan=A;c(C,D);q.appendChild(F)}}return k},left:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,-(b||
1),"dgrid-cell"))},right:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,b||1,"dgrid-cell"))},renderRow:function(b,e){var g=this.createRowCells("td",function(d,g){var h=b;g.get?h=g.get(b):"field"in g&&"_item"!=g.field&&(h=h[g.field]);g.renderCell?a(d,g.renderCell(b,h,d,e)):c.call(g,b,h,d,e)},e&&e.subRows,b);return d("div[role\x3drow]\x3e",g)},renderHeader:function(){var c=this,e=this.headerNode,k=e.childNodes.length;for(e.setAttribute("role","row");k--;)d(e.childNodes[k],"!");
k=this.createRowCells("th",function(c,d){var e=d.headerNode=c;b&&(c=c.parentNode);var f=d.field;f&&(c.field=f);if(d.renderHeaderCell)a(e,d.renderHeaderCell(e));else if("label"in d||d.field)e.appendChild(document.createTextNode("label"in d?d.label:d.field));!1!==d.sortable&&(f&&"_item"!=f)&&(c.sortable=!0,c.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[k.id=this.id+"-header"]=this.columns;e.appendChild(k);this._sortListener&&this._sortListener.remove();this._sortListener=
g(k,"click,keydown",function(a){if("click"==a.type||32==a.keyCode||!h("opera")&&13==a.keyCode){var b=a.target,d,k,p;do if(b.sortable){p=[{attribute:d=b.field||b.columnId,descending:(k=c._sort[0])&&k.attribute==d&&!k.descending}];d={bubbles:!0,cancelable:!0,grid:c,parentType:a.type,sort:p};g.emit(a.target,"dgrid-sort",d)&&(c._sortNode=b,c.set("sort",p));break}while((b=b.parentNode)&&b!=e)}})},resize:function(){var a=this.headerNode.firstChild,b=this.contentNode,c;this.inherited(arguments);if(!h("ie")||
7<h("ie")&&!h("quirks"))if(b.style.width="",b&&a&&(c=a.offsetWidth)!=b.offsetWidth)b.style.width=c+"px"},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(a,b){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(a){var b=this.columns,c;for(c in b){var d=b[c];if(d.field==a)return d.headerNode}},updateSortArrow:function(a,b){this._lastSortedArrow&&(d(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),
d(this._lastSortedArrow,"!"),delete this._lastSortedArrow);b&&(this._sort=a);if(a[0]){var c=a[0].attribute,e=a[0].descending,c=this._sortNode||this._findSortArrowParent(c),g;delete this._sortNode;c&&(c=c.contents||c,g=this._lastSortedArrow=d("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),g.innerHTML="\x26nbsp;",c.insertBefore(g,c.firstChild),d(c,e?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(a,b){return this.addCssRule("#"+l.escapeCssIdentifier(this.domNode.id)+
" .dgrid-column-"+l.escapeCssIdentifier(a,"-"),b)},_configColumns:function(a,b){var c=[],d=b instanceof Array;l.each(b,function(e,g){"string"==typeof e&&(b[g]=e={label:e});!d&&!e.field&&(e.field=g);g=e.id=e.id||(isNaN(g)?g:a+g);this._configColumn&&(this._configColumn(e,g,b,a),g=e.id);d&&(this.columns[g]=e);e.grid=this;"function"===typeof e.init&&e.init();c.push(e)},this);return d?b:c},_destroyColumns:function(){var a=this.subRows,b=a&&a.length,c,d,e,g;this.cleanup();for(c=0;c<b;c++){d=0;for(g=a[c].length;d<
g;d++)e=a[c][d],"function"===typeof e.destroy&&e.destroy()}},configStructure:function(){var a=this.subRows,b=this._columns=this.columns;this.columns=!b||b instanceof Array?{}:b;if(a)for(b=0;b<a.length;b++)a[b]=this._configColumns(b+"-",a[b]);else this.subRows=[this._configColumns("",b)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns();this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this._destroyColumns();this.subRows=
a;this._updateColumns()},setColumns:function(a){m.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",a)},setSubRows:function(a){m.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",a)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});
e.appendIfNode=a;e.defaultRenderCell=c;return e})},"put-selector/put":function(){(function(m){var e,g=/[-+,> ]/;m([],e=function(h,d){function k(d){function e(){q&&(r&&q!=r)&&(r==d&&(p||(p=g.test(x)&&h.createDocumentFragment()))?p:r).insertBefore(q,s||null)}for(var p,m,s,r,q,u=arguments,w=u[0],v=0;v<u.length;v++){var x=u[v];if("object"==typeof x){m=!1;if(x instanceof Array){q=h.createDocumentFragment();for(var B=0;B<x.length;B++)q.appendChild(k(x[B]));x=q}if(x.nodeType)q=x,e(),r=x,s=0;else for(B in x)q[B]=
x[B]}else if(m)m=!1,q.appendChild(h.createTextNode(x));else{1>v&&(d=null);m=!0;if(w=x.replace(l,function(g,l,p,m,t,w){l&&(e(),"-"==l||"+"==l?(r=(s=q||r).parentNode,q=null,"+"==l&&(s=s.nextSibling)):("\x3c"==l?r=q=(q||r).parentNode:(","==l?r=d:q&&(r=q),q=null),s=0),q&&(r=q));if((g=!p&&m)||!q&&(p||t))"$"==g?(g=u[++v],r.appendChild(h.createTextNode(g))):(g=g||k.defaultTag,(l=b&&u[v+1]&&u[v+1].name)&&(g="\x3c"+g+' name\x3d"'+l+'"\x3e'),q=c&&~(a=g.indexOf("|"))?h.createElementNS(c[g.slice(0,a)],g.slice(a+
1)):h.createElement(g));if(p)if("$"==m&&(m=u[++v]),"#"==p)q.id=m;else if(l=(g=q.className)&&(" "+g+" ").replace(" "+m+" "," "),"."==p)q.className=g?(l+m).substring(1):m;else if("!"==x){var B;b?k("div",q,"\x3c").innerHTML="":(B=q.parentNode)&&B.removeChild(q)}else l=l.substring(1,l.length-1),l!=g&&(q.className=l);t&&("$"==w&&(w=u[++v]),"style"==t?q.style.cssText=w:(p="!"==t.charAt(0)?(t=t.substring(1))&&"removeAttribute":"setAttribute",w=""===w?t:w,c&&~(a=t.indexOf("|"))?q[p+"NS"](c[t.slice(0,a)],
t.slice(a+1),w):q[p](t,w)));return""}))throw new SyntaxError("Unexpected char "+w+" in "+x);e();r=w=q||r}}d&&p&&d.appendChild(p);return w}g=d||g;var l=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,a,c=!1;h=h||document;var b="object"==typeof h.createElement;k.addNamespace=function(a,b){h.createElementNS?(c||(c={}))[a]=b:h.namespaces.add(a,b)};k.defaultTag="div";k.forDocument=e;return k})})(function(m,e,g){g=g||e;"function"===typeof define?define([],
function(){return g()}):"undefined"==typeof window?require("./node-html")(module,g):put=g()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),function(m,e,g,h,d,k,l,a,c){function b(a,b){c(document.body,a,".dgrid-scrollbar-measure");var d=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return d}function n(a){var b=
a?"."+a.replace(u,"."):"";this._class&&(b="!"+this._class.replace(u,"!")+b);c(this.domNode,b);this._class=a}function f(){return this._class}function p(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function t(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)}a("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var s,r;d.add("dom-scrollbar-width",function(a,c,d){return b(d,"Width")});d.add("dom-scrollbar-height",
function(a,c,d){return b(d,"Height")});d.add("dom-rtl-scrollbar-left",function(a,b,e){a=c("div");c(document.body,e,".dgrid-scrollbar-measure[dir\x3drtl]");c(e,a);b=!!d("ie")||!!d("trident")||a.offsetLeft>=d("dom-scrollbar-width");e.className="";document.body.removeChild(e);c(a,"!");e.removeAttribute("dir");return b});var q=0,u=/ +/g,w=7>d("ie")&&!d("quirks")?function(){var a,b,c;if(this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,c=this._prevWinDims||[],c[0]!==b||c[1]!==
a))this.resize(),this._prevWinDims=[b,a]}:function(){this._started&&this.resize()};return e("dgrid.List",d("touch")?l:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:
document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){var f=this.domNode=b||c("div"),g;a?(this.params=a,e.safeMixin(this,a),g=a["class"]||a.className||f.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=f.id=f.id||this.id||"dgrid_"+q++;null===this.useTouchScroll&&(this.useTouchScroll=!d("dom-scrollbar-width"));this.buildRendering();
g&&n.call(this,g);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,e=this,f,g,n,l;l=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";c(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(b?".ui-widget":""));f=this.headerNode=c(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));
(d("quirks")||8>d("ie"))&&c(a,"div.dgrid-spacer");g=this.bodyNode=c(a,"div.dgrid-scroller");d("ff")&&(g.tabIndex=-1);this.headerScrollNode=c(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));n=this.footerNode=c("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));c(a,n);l&&(a.className+=" dgrid-rtl"+(d("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));h(g,"scroll",function(b){e.showHeader&&(f.scrollLeft=b.scrollLeft||g.scrollLeft);b.stopPropagation();
h.emit(a,"scroll",{scrollTarget:g})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=c(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=h(window,"resize",k.throttleDelayed(w,this)))},postCreate:d("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},
resize:function(){var a=this.bodyNode,b=this.headerNode,c=this.footerNode,e=b.offsetHeight,f=this.showFooter?c.offsetHeight:0,g=d("quirks")||7>d("ie");this.headerScrollNode.style.height=a.style.marginTop=e+"px";a.style.marginBottom=f+"px";g&&(a.style.height="",a.style.height=Math.max(this.domNode.offsetHeight-e-f,0)+"px",f&&(c.style.bottom="1px",setTimeout(function(){c.style.bottom=""},0)));s||(s=d("dom-scrollbar-width"),r=d("dom-scrollbar-height"),d("ie")&&(s++,r++),k.addCssRule(".dgrid-scrollbar-width",
"width: "+s+"px"),k.addCssRule(".dgrid-scrollbar-height","height: "+r+"px"),17!=s&&!g&&(k.addCssRule(".dgrid-header-row","right: "+s+"px"),k.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+s+"px")));g&&(b.style.width=a.clientWidth+"px",setTimeout(function(){b.scrollLeft=a.scrollLeft},0))},addCssRule:function(a,b){var c=k.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(c);return c},on:function(a,b){var c=h(this.domNode,a,b);d("dom-addeventlistener")||this._listeners.push(c);return c},
cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=this.columns){var c=document.getElementById(b);c&&this.removeRow(c,!0)}for(b=0;b<a.length;b++)(c=a[b])&&c.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();delete this._listeners}this._started=!1;this.cleanup();c(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();
this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},newRow:function(a,b,d,e,f){if(b){var g=this.insertRow(a,b,d,e,f);c(g,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){c(g,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return g}},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&c(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+
"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,c){function d(){var b=arguments;if(-1<q)for(var f=0;f<b.length;f++){var g=b[f],h=p[g?0:p.length-1];if(h=h&&e(h)){var n=h[g?"previousSibling":"nextSibling"];n&&(n=k.row(n));n&&n.element!=h&&(g=g?"unshift":"push",a[g](n.data),p[g](n.element),c.count++)}}}function e(a){return!g.isDescendant(a,k.domNode)&&document.getElementById(a.id)?k.row(a.id.slice(k.id.length+5)).element:
a}function f(a){s=k.insertRow(a,t,null,n++,c);s.observerIndex=q;return s}function h(a){u=a.slice(0);(m=b?b.parentNode:k.contentNode)&&m.parentNode&&(m!==k.contentNode||a.length)?(m.insertBefore(t,b||null),(s=a[a.length-1])&&k.adjustRowIndices(s)):l[q]&&k.cleanEmptyObservers&&"undefined"!==typeof q&&(l[q].cancel(),l[q]=0,k._numObservers--);p=a;r&&(r.rows=p)}c=c||{};var k=this,n=c.start||0,l=this.observers,p,m,q;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){k._numObservers++;var r=
a.observe(function(f,g,h){var n,l,r;-1<g&&p[g]&&(n=p.splice(g,1)[0],n.parentNode==m&&((l=n.nextSibling)&&g!=h&&l.rowIndex--,k.removeRow(n)),c.count--,k._processScroll&&k._processScroll());if(-1<h){if(p.length)if(0===h)r=(r=p[h])&&e(r);else{if(r=p[h-1])r=e(r),r=(r.connected||r).nextSibling}else r=k._getFirstRowSibling&&k._getFirstRowSibling(m);n&&(r&&n.id===r.id)&&(r=(r.connected||r).nextSibling);r&&!r.parentNode&&(r=document.getElementById(r.id));n=b&&b.parentNode||r&&r.parentNode||k.contentNode;
if(n=k.newRow(f,n,r,c.start+h,c))if(n.observerIndex=q,p.splice(h,0,n),!l||h<g)l=n.previousSibling,l=!l||l.rowIndex+1==n.rowIndex||0==n.rowIndex?n:l;c.count++}0===g?d(1,1):g===a.length-(-1===h?0:1)&&d(0,0);g!=h&&l&&k.adjustRowIndices(l);k._onNotification(p,f,g,h)},!0);q=l.push(r)-1}var t=document.createDocumentFragment(),s,u;if(a.map){if(p=a.map(f,console.error),p.then)return a.then(function(b){a=b;return p.then(function(a){h(a);d(1,1,0,0);return u})})}else{p=[];for(var w=0,Q=a.length;w<Q;w++)p[w]=
f(a[w])}h(p);d(1,1,0,0);return u},_onNotification:function(a,b,c,d){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,c,d,e){var f=e.parentId,f=this.id+"-row-"+(f?f+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g));g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1==d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?
" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,c||null);h&&this.adjustRowIndices(h);g.rowIndex=d;return g},renderRow:function(a,b){return c("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||c(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!=
this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||
e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:d("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):t.call(this,a)}:t,getScrollPosition:d("touch")?function(){return this.useTouchScroll?this.inherited(arguments):p.call(this)}:p,get:function(a){var b="_get"+a.charAt(0).toUpperCase()+
a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:f,_setClass:n,_getClassName:f,_setClassName:n,_setSort:function(a,b){this._sort="string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();this._lastCollection&&(a.length&&
("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(c,d){var e=c[a],f=d[a];void 0===e&&(e="");void 0===f&&(f="");return e==f?0:e>f==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){m.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;c(b,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();
a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){m.deprecated("setShowHeader(...)",'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;c(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(m,e){m.add("dom-contains",function(a,b,d){return!!d.contains});var g=[],h,d,k,l=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,a={defaultDelay:15,
throttle:function(c,b,d){var e=!1;d=d||a.defaultDelay;return function(){e||(e=!0,c.apply(b,arguments),setTimeout(function(){e=!1},d))}},throttleDelayed:function(c,b,d){var e=!1;d=d||a.defaultDelay;return function(){if(!e){e=!0;var a=arguments;setTimeout(function(){e=!1;c.apply(b,a)},d)}}},debounce:function(c,b,d){var e;d=d||a.defaultDelay;return function(){e&&(clearTimeout(e),e=null);var a=arguments;e=setTimeout(function(){c.apply(b,a)},d)}},each:function(a,b,d){var e,g;if(a)if("number"===typeof a.length){e=
0;for(g=a.length;e<g;e++)b.call(d,a[e],e,a)}else for(e in a)b.call(d,a[e],e,a)},contains:function(a,b){return m("dom-contains")?a.contains(b):a.compareDocumentPosition(b)&8},addCssRule:function(a,b){h||(h=e(document.getElementsByTagName("head")[0],"style"),h=h.sheet||h.styleSheet,d=h.deleteRule?"deleteRule":"removeRule",k=h.cssRules?"cssRules":"rules");var n=g.length;g[n]=(h.cssRules||h.rules).length;h.addRule?h.addRule(a,b):h.insertRule(a+"{"+b+"}",g[n]);return{get:function(a){return h[k][g[n]].style[a]},
set:function(a,b){"undefined"!==typeof g[n]&&(h[k][g[n]].style[a]=b)},remove:function(){var a=g[n],b,c;if(void 0!==a){h[d](a);g[n]=void 0;b=n+1;for(c=g.length;b<c;b++)g[b]>a&&g[b]--}}}},escapeCssIdentifier:function(a,b){return"string"===typeof a?a.replace(l,b||"\\$1"):a}};return a})},"xstyle/has-class":function(){define(["dojo/has"],function(m){var e={};return function(){for(var g,h=arguments,d=0;d<h.length;d++)if(g=h[d],!e[g]){e[g]=!0;var k=g.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),l=m(k[2]),
a=-k[4];if((0<a?a<=l&&(-k[5]||a)>=l:!!l)==!k[1])document.documentElement.className+=" has-"+g}}})},"xstyle/css":function(){define(["require"],function(m){function e(e,h,d){var k=document.documentElement;e=k.insertBefore(document.createElement(e),k.firstChild);e.id=h;h=(e.currentStyle||getComputedStyle(e,null))[d];k.removeChild(e);return h}return{load:function(g,h,d,k){function l(){var a=e("x-parse",null,"content");a&&"none"!=a?h([eval(a)],d):d()}var a=h.toUrl(g),c=h.cache["url:"+a];if(c)return c.xCss&&
(c=c.cssText),m(["./util/createStyleSheet"],function(a){a(c)}),l();if("none"==e("div",g.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return l();m(["./load-css"],function(b){b(a,l)})}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(m,e,g,h,d,k,l,a,c){return g("dgrid.OnDemandList",[m,e],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,
farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:a.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var b=this;l(this.bodyNode,"scroll",a[this.pagingMethod](function(a){b._processScroll(a)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(a,e){function f(a){c(v,"!");if(a)throw g._refreshDeferred&&(g._refreshDeferred.reject(a),delete g._refreshDeferred),
a;}var g=this,k=e&&e.container||this.contentNode,l={query:a,count:0,options:e},m,q=this.preload,u,w={node:c(k,"div.dgrid-preload",{rowIndex:0}),count:0,query:a,next:l,options:e};w.node.style.height="0";l.node=m=c(k,"div.dgrid-preload");l.previous=w;m.rowIndex=this.minRowsPerPage;q?((l.next=q.next)&&m.offsetTop>=q.node.offsetTop?l.previous=q:(l.next=q,l.previous=q.previous),l.previous.next=l,l.next.previous=l):this.preload=l;var v=c(m,"-div.dgrid-loading");c(v,"div.dgrid-below").innerHTML=this.loadingMessage;
e=h.mixin(this.get("queryOptions"),e,{start:0,count:this.minRowsPerPage},"level"in a?{queryLevel:a.level}:null);this._trackError(function(){return u=a(e)});if("undefined"===typeof u)f();else return d.when(g.renderArray(u,m,e),function(a){return d.when("undefined"===typeof u.total?u.length:u.total,function(b){var d=a.length,f=m.parentNode,h=g.noDataNode;c(v,"!");"queryLevel"in e||(g._total=b);0===b&&f&&(h&&(c(h,"!"),delete g.noDataNode),g.noDataNode=h=c("div.dgrid-no-data"),f.insertBefore(h,g._getFirstRowSibling(f)),
h.innerHTML=g.noDataMessage);for(h=f=0;h<d;h++)f+=g._calcRowHeight(a[h]);d&&f&&(g.rowHeight=f/d);b-=d;l.count=b;m.rowIndex=d;b?m.style.height=Math.min(b*g.rowHeight,g.maxEmptySpace)+"px":(m.style.display="none",e.count++);g._previousScrollPosition&&(g.scrollTo(g._previousScrollPosition),delete g._previousScrollPosition);g._processScroll();g._refreshDeferred&&(g._refreshDeferred.resolve(u),delete g._refreshDeferred);return a},f)},f),u},refresh:function(a){var c=this,e=a&&a.keepScrollPosition,g;"undefined"===
typeof e&&(e=this.keepScrollPosition);e&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return e=this._refreshDeferred=new d,g=c.renderQuery(function(a){return c.store.query(c.query,a)}),"undefined"===typeof g&&e.reject(),e.then(function(a){c._refreshTimeout=setTimeout(function(){l.emit(c.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:c,results:a});c._refreshTimeout=null},0);delete c._refreshDeferred;return a},function(a){delete c._refreshDeferred;
throw a;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var c=a.nextSibling;return c&&!/\bdgrid-preload\b/.test(c.className)?c.offsetTop-a.offsetTop:a.offsetHeight},lastScrollTop:0,_processScroll:function(a){function e(a,b,d,g){var h=k.farOffRemoval,n=a.node;if(b>2*h){for(var l,m=n[d],p=0,q=0,r=[];l=m;){var s=k._calcRowHeight(l);if(p+s+h>b||0>m.className.indexOf("dgrid-row")&&0>m.className.indexOf("dgrid-loading"))break;
m=l[d];p+=s;q+=l.count||1;k.removeRow(l,!0);r.push(l)}a.count+=q;g?(n.rowIndex-=q,f(a)):n.style.height=n.offsetHeight+p+"px";var u=c("div",r);setTimeout(function(){c(u,"!")},1)}}function f(a,b){a.node.style.height=Math.min(a.count*k.rowHeight,b?Infinity:k.maxEmptySpace)+"px"}function g(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var k=this,l=k.bodyNode;a=a&&a.scrollTop||this.getScrollPosition().y;var l=l.offsetHeight+a,m,q,u=k.preload,w=k.lastScrollTop,v=k.bufferRows*k.rowHeight,
x=v-k.rowHeight,B,D,C,F=!0;for(k.lastScrollTop=a;u&&!u.node.offsetWidth;)u=u.previous;for(;u&&u!=m;){m=k.preload;k.preload=u;q=u.node;var A=q.offsetTop;if(l+1+x<A)u=g(u,F=!1);else if(a-1-x>A+q.offsetHeight)u=g(u,F=!0);else{var z=((q.rowIndex?a-v:l)-A)/k.rowHeight,A=(l-a+2*v)/k.rowHeight,E=Math.max(Math.min((a-w)*k.rowHeight,k.maxRowsPerPage/2),k.maxRowsPerPage/-2),A=A+Math.min(Math.abs(E),10);0==q.rowIndex&&(z-=A);z=Math.max(z,0);10>z&&(0<z&&A+z<k.maxRowsPerPage)&&(A+=Math.max(0,z),z=0);A=Math.min(Math.max(A,
k.minRowsPerPage),k.maxRowsPerPage,u.count);if(0==A)u=g(u,F);else{var A=Math.ceil(A),z=Math.min(Math.floor(z),u.count-A),H=h.mixin(k.get("queryOptions"),u.options);u.count-=A;var K=q,P,G=k.queryRowsOverlap;if(E=(0<q.rowIndex||q.offsetTop>a)&&u){var J=u.previous;J&&(e(J,a-(J.node.offsetTop+J.node.offsetHeight),"nextSibling"),0<z&&J.node==q.previousSibling?(z=Math.min(u.count,z),u.previous.count+=z,f(u.previous,!0),q.rowIndex+=z,G=0):A+=z,u.count-=z);H.start=q.rowIndex-G;H.count=Math.min(A+G,k.maxRowsPerPage);
q.rowIndex=H.start+H.count}else u.next&&(e(u.next,u.next.node.offsetTop-l,"previousSibling",!0),K=q.nextSibling,K==u.next.node?(u.next.count+=u.count-z,u.next.node.rowIndex=z+A,f(u.next),u.count=z,G=0):P=!0),H.start=u.count,H.count=Math.min(A+G,k.maxRowsPerPage);P&&(K&&K.offsetWidth)&&(P=K.offsetTop);f(u);"level"in u.query&&(H.queryLevel=u.query.level);if("queryLevel"in H||!(H.start>k._total||0>H.count)){q=c(K,"-div.dgrid-loading[style\x3dheight:"+A*k.rowHeight+"px]");c(q,"div.dgrid-"+(E?"below":
"above")).innerHTML=k.loadingMessage;q.count=A;var M=u.query(H);if(void 0===k._trackError(function(){return M})){c(q,"!");return}(function(a,b,e,g){C=d.when(k.renderArray(g,a,H),function(h){D=g;K=a.nextSibling;c(a,"!");if(e&&K&&K.offsetWidth){var n=k.getScrollPosition();k.scrollTo({x:n.x,y:n.y+K.offsetTop-e,preserveMomentum:!0})}d.when(g.total||g.length,function(a){"queryLevel"in H||(k._total=a);b&&(b.count=a-b.node.rowIndex,0===b.count&&H.count++,f(b))});k._processScroll();return h},function(b){c(a,
"!");throw b;})}).call(this,q,E,P,M);u=u.previous}}}}if(C&&(B=this._refreshDeferred))delete this._refreshDeferred,d.when(C,function(){B.resolve(D)})},removeRow:function(a,c){if(a){var d=a.previousSibling,e=a.nextSibling,d=d&&(null!=d.observerIndex?d.observerIndex:d.previousObserverIndex),g=e&&(null!=e.observerIndex?e.observerIndex:e.nextObserverIndex),e=a.observerIndex;a.observerIndex=void 0;c&&(a.nextObserverIndex=g,a.previousObserverIndex=d);if(this.cleanEmptyObservers&&(-1<e&&e!==d&&e!==g)&&(d=
this.observers,g=d[e])){if(!c)for(var h=g.rows,l=0;l<h.length;l++)if(h[l]!=a&&k.isDescendant(h[l],this.domNode))return this.inherited(arguments);g.cancel();this._numObservers--;d[e]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),function(m,e,g,h,d,k,l){function a(a){return a}function c(a){if("object"!==typeof a)a=Error(a);else if("cancel"===a.dojoType)return;
a.grid=this;d.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return e("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};k.before(this,"configStructure",g.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},
destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_updateNotifyHandle:function(a){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);a&&("function"===typeof a.notify&&this.shouldObserveStore)&&(this._notifyHandle=k.after(a,"notify",g.hitch(this,"_onNotify"),!0),a=this.get("sort"),(!a||!a.length)&&console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},
_setStore:function(a,c,d){this._updateNotifyHandle(a);this.store=a;this.dirty={};this.set("query",c,d)},_setQuery:function(a,c){var d=c&&c.sort;this.query=void 0!==a?a:this.query;this.queryOptions=c||this.queryOptions;this._started&&(d?this.set("sort",d):this.refresh())},setStore:function(a,c,d){m.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",a,c,d)},setQuery:function(a,c){m.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",
a,c)},_getQueryOptions:function(){var a=g.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)a.sort=this._sort;return a},_getQuery:function(){var a=this.query;return"object"==typeof a&&null!=a?g.delegate(a,{}):a},_setSort:function(a,c){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(a,c){this.inherited(arguments);a&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var a=this.inherited(arguments);
this.store||(this.noDataNode=l(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return a},renderArray:function(){var a=this,c=this.inherited(arguments);this.store||h.when(c,function(c){c.length&&a.noDataNode&&l(a.noDataNode,"!")});return c},insertRow:function(a,c,d,e,h){var k=this.store,l=this.dirty,k=k&&k.getIdentity(a),m;k in l&&!(k in this._updating)&&(m=l[k]);m&&(a=g.delegate(a,m));return this.inherited(arguments)},updateDirty:function(a,c,d){var e=this.dirty,
g=e[a];g||(g=e[a]={});g[c]=d},setDirty:function(a,c,d){m.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(a,c,d)},save:function(){function a(b,g){return function(a){var k=c._columnsWithSet,l=c._updating,m,q;if("function"===typeof a.set)a.set(g);else for(m in g)a[m]=g[m];for(m in k)q=k[m].set(a),void 0!==q&&(a[m]=q);l[b]=!0;return h.when(d.put(a),function(){delete e[b];delete l[b]})}}var c=this,d=this.store,e=this.dirty,g=new h,k=g.promise,l=function(a){var b;return c.getBeforePut||
!(b=c.row(a).data)?function(){return d.get(a)}:function(){return b}},m;for(m in e)var u=a(m,e[m]),k=k.then(l(m)).then(u);g.resolve();return k},revert:function(){this.dirty={};this.refresh()},_trackError:function(b){var d;"string"==typeof b&&(b=g.hitch(this,b));try{d=b()}catch(e){c.call(this,e)}return h.when(d,a,g.hitch(this,c))},newRow:function(){var a=this.inherited(arguments);this.noDataNode&&(l(this.noDataNode,"!"),delete this.noDataNode);return a},removeRow:function(a,c){var d={element:a};!c&&
(this.noDataMessage&&this.up(d).element===a&&this.down(d).element===a)&&(this.noDataNode=l(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(m,e,g,h,d,k,l,a,c){function b(a,b){for(var c=a.unselectable=b?"on":
"",d=a.getElementsByTagName("*"),e=d.length;--e;)"INPUT"===d[e].tagName||"TEXTAREA"===d[e].tagName||(d[e].unselectable=c)}function n(a,c){var e=a.bodyNode,f=c?"text":21>d("ff")?"-moz-none":"none";p&&"msUserSelect"!==p?e.style[p]=f:d("dom-selectstart")?!c&&!a._selectstartHandle?a._selectstartHandle=h(e,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):c&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):(b(e,
!c),!c&&!a._unselectableHandle?a._unselectableHandle=k.after(a,"renderRow",function(a){b(a,!0);return a}):c&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle))}d.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});d.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});d.add("css-user-select",function(a,b,c){a=c.style;b=["Khtml","O","ms","Moz","Webkit"];c=b.length;var d="userSelect";do if("undefined"!==
typeof a[d])return d;while(c--&&(d=b[c]+"UserSelect"));return!1});d.add("dom-selectstart","undefined"!==typeof document.onselectstart);var f=d("mac")?"metaKey":"ctrlKey",p=d("css-user-select"),t=(l=d("pointer"))&&"MS"===l.slice(0,2),s=l?l+(t?"Down":"down"):"mousedown",r=l?l+(t?"Up":"up"):"mouseup";return e("dgrid.Selection",null,{selectionDelegate:".dgrid-row",selectionEvents:s+","+r+",dgrid-cellfocusin",selectionTouchEvents:d("touch")?a.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},
selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},
_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){m.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?n(this,a):n(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,
b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&!("dgrid-cellfocusin"===a.type&&"mousedown"===a.parentType||a.type===r&&b!=this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===s&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](a,b);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){var c=a.keyCode?a.ctrlKey:a[f];this._lastSelected===
b?this.select(b,null,!c||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c=this._lastSelected,d=a.keyCode?a.ctrlKey:a[f],e;a.shiftKey||(e=d?null:!0,c=null);this.select(b,c,e);c||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?!this.isSelected(b):!(a.keyCode?a.ctrlKey:a[f]))&&this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,
null,null)},_initSelectionEvents:function(){var b=this,c=this.contentNode,e=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};d("touch")&&!d("pointer")&&this.selectionTouchEvents?(h(c,a.selector(e,this.selectionTouchEvents),function(a){b._handleSelect(a,this);b._ignoreMouseSelect=this}),h(c,h.selector(e,this.selectionEvents),function(a){b._ignoreMouseSelect!==this?b._handleSelect(a,this):a.type===r&&(b._ignoreMouseSelect=null)})):h(c,h.selector(e,this.selectionEvents),function(a){b._handleSelect(a,
this)});this.addKeyHandler&&this.addKeyHandler(32,function(a){b._handleSelect(a,a.target)});if(this.allowSelectAll)this.on("keydown",function(a){a[f]&&(65==a.keyCode&&!/\bdgrid-input\b/.test(a.target.className))&&(a.preventDefault(),b[b.allSelected?"clearSelection":"selectAll"]())});this._setStore&&k.after(this,"_setStore",function(){b._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(c,d,e){c=d||c&&c[b.idProperty||"id"];if(null!=c&&(d=(c=
b.row(c))&&b.selection[c.id]))b[e](c,null,d)}var b=this,c=this.store,d,e;this._removeDeselectSignals&&this._removeDeselectSignals();c&&c.notify?(d=k.before(c,"notify",function(b,c){b||a(b,c,"deselect")}),e=k.after(c,"notify",function(b,c){a(b,c,"select")},!0),this._removeDeselectSignals=function(){d.remove();e.remove()}):(d=k.before(this,"removeRow",function(a,b){var c;b||(c=this.row(a))&&c.id in this.selection&&this.deselect(c)}),this._removeDeselectSignals=function(){d.remove()})},allowSelect:function(a){return!0},
_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];h.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,b,d){var e,f,g;"undefined"===typeof d&&(d=!0);a.element||(a=this.row(a));if(!1===d||this.allowSelect(a))if(e=
this.selection,f=!!e[a.id],null===d&&(d=!f),g=a.element,!d&&!this.allSelected?delete this.selection[a.id]:e[a.id]=d,g&&(d?c(g,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):c(g,"!dgrid-selected!ui-state-active")),d!==f&&g&&this._selectionEventQueues[(d?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element){e=this._determineSelectionDirection(g,b);e||(b=document.getElementById(b.id),e=this._determineSelectionDirection(g,b));for(;a.element!=b&&(a=this[e](a));)this._select(a,
null,d)}}else this._lastSelected=g,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:d("dom-comparedocumentposition")?function(a,b){var c=b.compareDocumentPosition(a);return c&1?!1:2===c?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>
a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===
typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);g.when(b,function(b){var c=a.selection,d,e,f;for(d=0;d<b.length;d++)e=a.row(b[d]),(f=e.id in c?c[e.id]:a.allSelected)&&a._select(e,null,f);a._fireSelectionEvents()});
return b}})})},"xstyle/main":function(){define("xstyle/main",["require","put-selector/put"],function(m,e){function g(a,b){return a&&a.then?a.then(b):b(a)}function h(a,b,c){return g(a,function(a){var d=b[0];if(!a)return c(d||a);if(d&&a.get)return h(a.get(d),b.slice(1),c);if(a.receive)return a.receive(d?function(a){h(a,b,c)}:c);if(d)return h(a[d],b.slice(1),c);c(a)})}function d(a,b,c){h(a,b.slice(0,b.length-1),function(a){var d=b[b.length-1];a.set?a.set(d,c):a[d]=c})}function k(a){a=A.getElementsByTagName(a);
for(var b=0;b<a.length;b++)c(a[b])}function l(){return this.join("")}function a(a){this.value=a}function c(a,d,e){function f(){m(["xstyle/load-imports"],function(b){b(a,function(){c(a,d,!0)})})}var g=a.sheet||a.styleSheet||a,h=g.needsParsing,k=g.rules||g.cssRules;if(g.imports&&!e&&g.imports.length)return f();if(!h)for(var l=0;l<k.length;l++){var n=k[l];if(n.href&&!e)return f();n.selectorText&&"x-"==n.selectorText.substring(0,2)&&(h=!0,/^'/.test(n.style.content))}b(g.localSource||(g.ownerNode||g.ownerElement).innerHTML,
g,d)}function b(c,d,e){function f(a,b,c){(C[a]||(C[a]={}))[b]=c}function h(a){C[a]||(C[a]={});f("selector","x-"+a,{onRule:function(b){b.eachProperty(function(b,c){var d=c.toString();do{d=d.match(/([^, \(]+)(?:[, ]+(.+))?/);if(!d)break;var e=d[1];if("module"==e)return f(a,b,c[1].args[0]);if("default"==e){if("pseudo"==a)try{A.querySelectorAll("x:"+b);break}catch(g){}}else if("prefix"!=e)return f(a,b,function(){return c})}while(d=d[2])})}})}function k(){}function n(a){this.caller=a;this.args=[]}function p(a,
b){b.onRule();var c=C.selector[a];c&&t(c,"onRule",b)}function t(a,b,c,f){if(a){var g=I,h=function(a){"string"==typeof a&&d.addRule(g.fullSelector(),a);0==--G&&e&&e(d)};G++;var k=function(a){function e(a){console.error("Error occurred processing "+b.slice(2).toLowerCase()+" "+c+("{"==g.operator?' in rule "'+g.selector+'" {'+g.cssText:"")+". "+a.message);a&&console.error(a)}try{var k=a[b](c,f,g,d);g instanceof n&&(g.result=k);k&&k.then?k.then(h,e):h(k)}catch(l){e(l)}};"string"==typeof a?m([a],k):k(a)}}
function y(c,d){function f(a,b){b||(k+=a);if(E)if(E.push)"string"==typeof E[E.length-1]&&"string"==typeof a?E[E.length-1]+=a:a&&E.push(a);else if("string"==typeof E&&"string"==typeof a)E+=a;else{var c=[E,a];c.toString=l;E=c}else E=a}I=H;for(var g=w.lastIndex=0,h=!0,k="",n=!0;;){var m=w.exec(c),r=m[4],s=m[1],A=m[2],m=m[3],Q,N,E,R,m=m&&z(m),s=z(s);if(n){if(A?(k=N=s,Q=A.charAt(0),R="?"==A.charAt(1)):k=m=s,E=m,N||"/"!=r)n=!1}else m=m?s+A:s,f(m);switch(r){case "'":case '"':var S="'"==r?v:x;S.lastIndex=
w.lastIndex;(r=S.exec(c))||error("unterminated string");r=r[1];w.lastIndex=S.lastIndex;f(new a(r));continue;case "/":"*"==c[w.lastIndex]?(B.lastIndex=w.lastIndex+1,B.exec(c),w.lastIndex=B.lastIndex):f("/");continue;case "\\":r=S.lastIndex++;f(c.charAt(r));continue;case "(":case "{":case "[":var U=!1;if("{"==r){n=!0;f(s=I.newRule(k),!0);if(Q){h=!1;if(!A||"\x3e"==A.charAt(1))E.creating=!0;"\x3d"==Q&&m&&(U=!0)}I.root&&h&&(s.cssRule=d.cssRules[g++])}else A=m.match(/(.*?)([\w-]*)$/),f(s=I.newCall(A[2],
E,I)),s.ref=q(I,A[2]),(E.calls||(E.calls=[])).push(s);s.parent=I;s.selector=E.creating?".x-generated-"+D++:I.root?k:I.selector+" "+k;U&&(A=q(I,m.match(/[^\s]+$/)[0],!0))&&u(A,s);I.currentName=N;I.currentSequence=E;I.assignmentOperator=Q;J.push(I=s);I.operator=r;I.start=w.lastIndex;k="";I.selector&&I.selector.replace(/:([-\w]+)/,function(a,b){var c=C.pseudo[b];c&&t(c,"onPseudo",b,I)});E=N=null;continue}if(E)if(s=E[0],s.charAt&&"@"==s.charAt(0))"import"==E[0].slice(1,7)&&(A=b.getStyleSheet(d.cssRules[g++],
E,d),G++,m=w.lastIndex,y(A.localSource,A),w.lastIndex=m);else try{I[":"==Q?"setValue":"declareProperty"](N,E,R)}catch(T){console.error(T.stack||T)}switch(r){case ":":n=!0;Q=":";break;case "}":case ")":case "]":F[I.operator]!=r&&console.error("Incorrect opening operator "+I.operator+" with closing operator "+r);N=null;I.cssText=c.slice(I.start,w.lastIndex-1);"}"==r&&(p(I.selector,I),h=!0,k="");J.pop();I=J[J.length-1];E=I.currentSequence;N=I.currentName;Q=I.assignmentOperator;I.root&&"}"==r&&(n=!0,
Q=!1);break;case "":e&&e();return;case ";":E=null,n=!0,Q=h=!1,k=""}}}d.addRule||(d.addRule=function(a,b,c){return this.insertRule(a+"{"+b+"}",0<=c?c:this.cssRules.length)});d.deleteRule||(d.deleteRule=d.removeRule);var C={property:{}};h("property");h("function");h("pseudo");C["function"]["var"]=O;C["function"]["extends"]=O;var G=1;(d.href||location.href).replace(/[^\/]+$/,"");k.prototype={eachProperty:function(a){for(var b=this.values||0,c=0;c<b.length;c++){var d=b[c];a.call(this,d||"unnamed",b[d])}},
fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){return(this.rules||(this.rules={}))[a]=new k},newCall:function(a,b,c){return new n(a)},addSheetRule:function(a,b){if(b&&"@"!=a.charAt(0)){var c=d.addRule(a,b);-1==c&&(c=d.cssRules.length-1);return d.cssRules[c]}},onRule:function(){this.getCssRule()},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},
declareProperty:function(a,b,c){if("\x3e"==b[0].toString().charAt(0))a||(this.generator=b,b=s(b,this),O.addRenderer("",b,this,b));else{var d=a in E.style||q(this,a);if(!c||!d)(this.properties||(this.properties={}))[a]=b,d&&console.warn('Overriding existing property "'+a+'"')}},setValue:function(a,b){var c=this.values||(this.values=[]);c.push(a);c[a]=b;if(c=b.calls)for(var d=0;d<c.length;d++){var e=c[d],f=e.ref;f&&"function"==typeof f.call&&f.call(e,this,a,b)}if(a){do{if(c=q(this,a)){var h=this;g(r(h,
a,c),function(c){c=c.splice?c:[c];for(var d=0;d<c.length&&!c[d].put(b,h,a);d++);});break}a=a.substring(0,a.lastIndexOf("-"))}while(a)}},cssText:""};var R=n.prototype=new k;R.declareProperty=R.setValue=function(a,b){this.args.push(b)};R.toString=function(){var a=this.operator;return a+this.args+F[a]};var I,H=new k;H.root=!0;H.properties={Math:Math,module:function(a){return{then:function(b){m([a],b)}}},item:{forElement:function(a){for(;!a.item;)a=a.parentNode;return{element:a,receive:function(b){b(a.item)}}}},
prefix:{put:function(a,b,c){if("string"==typeof E.style[K+c])return b.addSheetRule(b.selector,K+c+":"+a)}},"var":{put:function(a,b,c){(b.variables||(b.variables={}))[c]=a;b=(b=b.variableListeners)&&b[c]||0;for(c=0;c<b.length;c++)b[c](a)},call:function(a,b,c,d){this.receive(function(a){b.addSheetRule(b.selector,c+": "+d.toString().replace(/var\([^)]+\)/g,a))},b,a.args[0])},receive:function(a,b,c){var d=b;do{if(b=d.variables&&d.variables[c])return d=d.variableListeners||(d.variableListeners={}),(d[c]||
(d[c]=[])).push(a),a(b);d=d.parent}while(d);a()}},on:{put:function(a,b,c){console.log("add event listener");r(b,c,a)}}};H.css=c;H.parse=y;var J=[H];y(c,d);0==--G&&e&&e(d);return H}function n(){k("link");k("style");if(!y)if(y=!0,P["dom-qsa2.1"]){for(var a=0,b=J.length;a<b;a++)f(J[a]);p()}else for(var c=A.all,a=0,b=c.length;a<b;a++)t(c[a])}function f(a){for(var b=A.querySelectorAll(a.selector),c=a.name,d=0,e=b.length;d<e;d++){var f=b[d],g=f.elementalStyle;g||(g=f.elementalStyle={},f.elementalSpecificities=
{});var h=f.renderings;h||(h=f.renderings=[],M.push(f));h.push({name:c,rendered:g[c]==a.propertyValue,renderer:a});g[c]=a.propertyValue}}function p(){for(var a=0;a<M.length;a++){var b=M[a],c=b.renderings,d=b.elementalStyle;delete b.renderings;for(var f=0;f<c.length;f++){var g=c[f],h=g.renderer,k=h.rendered;L=d[g.name]==h.propertyValue;if(!k&&L)try{h.render(b)}catch(l){console.error(l,l.stack),e(b,"div.error",l.toString())}k&&(!L&&h.unrender)&&(h.unrender(b),c.splice(f--,1))}}M=[]}function t(a,b){for(var c=
0,d=J.length;c<d;c++){var e=J[c];(!b||b==e.selector)&&(G?G.call(a,e.selector):a.currentStyle[e.name]==e.propertyValue)&&e.render(a)}}function s(a,b){D++;a=a.sort?a:[a];return function(c,d){for(var f=c,h=0,k=a.length;h<k;h++){var l=a[h];try{if(l.eachProperty)if(l.args)if("("==l.operator){var n=a[h+1];n&&n.eachProperty&&e(f,n.selector);var m=l.args.toString(),p=r(l,0,m);(function(a,c){g(p,function(d){d.forElement&&(d=d.forElement(c));var f=a.appendChild(A.createTextNode("Loading"));d.receive(function(b){if(b&&
b.sort){f&&(f.parentNode.removeChild(f),f=null);var c=n&&n.eachProperty&&n.get("each");c&&(c=s(c,n));b.forEach(c?function(b){c(a,b)}:function(b){e(a,C[a.tagName]||"div",b)})}else"value"in a?(a.value=b,a["-x-variable"]=d):f.nodeValue=b},b,m)})})(f,c)}else e(f,l.toString());else e(f,l.selector),O.update(f,l.selector);else if("string"==typeof l){"\x3d"==l.charAt(0)&&(l=l.slice(1));for(var q=l.split(","),l=0,t=q.length;l<t;l++){var u=q[l].trim();if(u){var u=u.replace(/\([^)]*\)/,function(a){}),w=e(0==
l?f:c,u);d&&(w.item=d);n=a[h+1];w!=f&&(!n||!n.eachProperty)&&O.update(w);f=w}}}else f.appendChild(A.createTextNode(l.value))}catch(v){console.error(v,v.stack),f.appendChild(A.createTextNode(v))}}return f}}function r(a,b,c){function e(){var a=k.length+1,b=[],c=[],f,l,n=function(d){return function(e){b[d]=e;a--;if(0>=a){l=!0;f=p?p.apply(this,b):b[0];for(e=0;e<c.length;e++)c[e](f)}}};if(p)for(var m=0;m<k.length;m++){var r=k[m];h(r[0],r.slice(1),n(m))}else{var r=k[0],q={then:function(a){c.push(a)}};g(r[0],
function(a){q=a;for(var b=1;b<r.length;b++)if(q&&q.get)q=q.get(r[b]);else{q={receive:function(b){h(a,r.slice(1),b)},put:function(a){d(resolve,r.slice(1),a)}};break}for(b=0;b<c.length;b++)c[b](q)});return q}n(-1)();return f&&f.then?f:{receive:function(a){c&&c.push(a);l&&a(f)}}}var f=a["var-expr-"+b];if(k)return f;var k=[],l;k.id=D++;var n=[],m;c=c.join?c.join(""):c.toString();f=c.match(/^[\w_$\/\.-]*$/);c=c.replace(/("[^\"]*")|([\w_$\.\/-]+)/g,function(b,c,d){if(d){m=d.split("/");b=m.join("_");n.push(b);
k.push(m);c=m[0];d=q(a,c);if("string"==typeof d||d instanceof Array)d=r(a,c,d);else if(!d)throw Error('Could not find reference "'+c+'"');d.forElement&&(l=!0);m[0]=d}return b});if(!f)var p=Function.apply(this,n.concat(["return xstyleReturn("+c+")"]));k.func=p;a["var-expr-"+b]=k;return a["var-expr-"+b]=l?{forElement:function(b){for(var c,d=b;!G.call(b,a.selector);)b=b.parentNode;for(b=0;b<k.length;b++){var f=k[b],g=f[0];g.forElement&&(g=f[0]=g.forElement(d));f=g.element;if(d!=c){for(;d!=f;){if(d==
c)return;d=d.parentNode}c=d}}d=c["expr-result-"+k.id];d||(c["expr-result-"+k.id]=d=e(),d.element=c);return d}}:e()}function q(a,b,c){do{var d=a.properties&&a.properties[b]||c&&a.rules&&a.rules[b];a=a.parent}while(!d&&a);return d}function u(a,b){b.cssText+=a.cssText;"values,properties,variables,calls".replace(/\w+/g,function(c){a[c]&&(b[c]=Object.create(a[c]))});var c=b.getCssRule();a.eachProperty(function(a,d){b.setValue(a,d);if(a){var e=c.style;e[a]||(e[a]=d)}});a.generator&&b.declareProperty(null,
a.generator)}var w=/\s*([^{\}\[\]\(\)\/\\'":=;]*)([=:]\??\s*([^{\}\[\]\(\)\/\\'":;]*))?([{\}\[\]\(\)\/\\'":;]|$)/g,v=/((?:\\.|[^'])*)'/g,x=/((?:\\.|[^"])*)"/g,B=/\*\//g,D=0,C={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},F={"{":"}","[":"]","(":")"},A=document,z="".trim?function(a){return a.trim()}:function(a){return a.replace(/^\s+|\s+$/g,"")},E=A.createElement("div");a.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};var H=navigator.userAgent,
K=-1<H.indexOf("WebKit")?"-webkit-":-1<H.indexOf("Firefox")?"-moz-":-1<H.indexOf("MSIE")?"-ms-":-1<H.indexOf("Opera")?"-o-":"";b.getStyleSheet=function(a,b){return a.styleSheet};A.addEventListener("change",function(a){a=a.target;var b=a["-x-variable"];b.put&&b.put(a.value)});var E=A.createElement("div"),P={"dom-qsa2.1":!!E.querySelectorAll},G=E.matches||E.matchesSelector||E.webkitMatchesSelector||E.mozMatchesSelector||E.msMatchesSelector||E.oMatchesSelector,J=[],M=[],y;/e/.test(A.readyState||"")?
setTimeout(n,200):A.addEventListener("DOMContentLoaded",n);var L,O={process:c,vendorPrefix:K,applyProperty:function(a,b){return"opacity"==a&&"-ms-"==K?"filter: alpha(opacity\x3d"+100*b+"); zoom: 1;":K+a+":"+b+";"},onFunction:function(a,b,c){},onCall:function(a,b){function c(){var b=e,f="extends"==a?"rules":"variables";do{if(!b)throw Error('Could not find "'+d[0]+'" in the defined '+f);var g=b[f]&&b[f][d[0]],b=b.parent}while(!g);return g}var d=b.args,e=b.parent;if("extends"==a){var f=c();u(f,e)}else if("var"==
a)return function(a){a.addSheetRule(a.selector,a.currentName+": "+a.currentSequence.toString().replace(/var\([^)]+\)/g,c()))}},parse:b,addRenderer:function(a,b,c,d){a={selector:c.selector,propertyValue:b,name:a,render:d};J.push(a);y&&f(a);p()},update:t,clearRenderers:function(){J=[]},load:function(a,b,c,d){b(["xstyle/css"],function(e){e.load(a,b,c,d)})}};return O});xstyleReturn=function(m){return 1==arguments.length?m:[].slice.call(arguments)}},"dojo/store/Memory":function(){define(["../_base/declare",
"./util/QueryResults","./util/SimpleQueryEngine"],function(m,e,g){return m("dojo.store.Memory",null,{constructor:function(e){for(var d in e)this[d]=e[d];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:g,get:function(e){return this.data[this.index[e]]},getIdentity:function(e){return e[this.idProperty]},put:function(e,d){var g=this.data,l=this.index,a=this.idProperty,a=e[a]=d&&"id"in d?d.id:a in e?e[a]:Math.random();if(a in l){if(d&&!1===d.overwrite)throw Error("Object already exists");
g[l[a]]=e}else l[a]=g.push(e)-1;return a},add:function(e,d){(d=d||{}).overwrite=!1;return this.put(e,d)},remove:function(e){var d=this.index,g=this.data;if(e in d)return g.splice(d[e],1),this.setData(g),!0},query:function(g,d){return e(this.queryEngine(g,d)(this.data))},setData:function(e){e.items?(this.idProperty=e.identifier||this.idProperty,e=this.data=e.items):this.data=e;this.index={};for(var d=0,g=e.length;d<g;d++)this.index[e[d][this.idProperty]]=d}})})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],
function(m){return function(e,g){function h(d){d=m.filter(d,e);var h=g&&g.sort;h&&d.sort("function"==typeof h?h:function(a,b){for(var d,e=0;d=h[e];e++){var g=a[d.attribute],k=b[d.attribute],g=null!=g?g.valueOf():g,k=null!=k?k.valueOf():k;if(g!=k)return!!d.descending==(null==g||g>k)?-1:1}return 0});if(g&&(g.start||g.count)){var a=d.length;d=d.slice(g.start||0,(g.start||0)+(g.count||Infinity));d.total=a}return d}switch(typeof e){default:throw Error("Can not query with a "+typeof e);case "object":case "undefined":var d=
e;e=function(e){for(var g in d){var a=d[g];if(a&&a.test){if(!a.test(e[g],e))return!1}else if(a!=e[g])return!1}return!0};break;case "string":if(!this[e])throw Error("No filter function "+e+" was found in store");e=this[e];case "function":}h.matches=e;return h}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f){g.isAsync||
a(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var p=e("dojo.dnd.Source",n,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){h.mixin(this,h.mixin({},b));var e=this.accept;if(e.length){this.accept={};for(var f=0;f<e.length;++f)this.accept[e[f]]=1}this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState=
"";this.isSource&&d.add(this.node,"dojoDndSource");this.targetState="";this.accept&&d.add(this.node,"dojoDndTarget");this.horizontal&&d.add(this.node,"dojoDndHorizontal");this.topics=[c.subscribe("/dnd/source/over",h.hitch(this,"onDndSourceOver")),c.subscribe("/dnd/start",h.hitch(this,"onDndStart")),c.subscribe("/dnd/drop",h.hitch(this,"onDndDrop")),c.subscribe("/dnd/cancel",h.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var c=0;c<
b.length;++c){for(var d=a.getItem(b[c].id).type,e=!1,f=0;f<d.length;++f)if(d[f]in this.accept){e=!0;break}if(!e)return!1}return!0},copyState:function(a,b){if(a)return!0;2>arguments.length&&(b=this==f.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){p.superclass.destroy.call(this);m.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!(this.isDragging&&"Disabled"==this.targetState)){p.superclass.onMouseMove.call(this,
a);var c=f.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var d=this.getSelectedNodes();d.length&&c.startDrag(this,d,this.copyState(b.getCopyKeyState(a),!0))}if(this.isDragging){d=!1;if(this.current){if(!this.targetBox||this.targetAnchor!=this.current)this.targetBox=k.position(this.current,!0);d=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/2==k.isBodyLtr(this.current.ownerDocument):a.pageY-
this.targetBox.y<this.targetBox.h/2}if(this.current!=this.targetAnchor||d!=this.before)this._markTargetAnchor(d),c.canDrop(!this.current||c.source!=this||!(this.current.id in this.selection))}}},onMouseDown:function(a){if(!this.mouseDown&&this._legalMouseDown(a)&&(!this.skipForm||!b.isFormElement(a)))this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,p.superclass.onMouseDown.call(this,a)},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,p.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==
a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=f.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,b,c){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?c?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(a,b);this._changeState("Target",b?"":"Disabled");this==a&&f.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,
b,c,d){if(this==d)this.onDrop(a,b,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,c){if(this!=a)this.onDropExternal(a,b,c);else this.onDropInternal(b,c)},onDropExternal:function(a,c,d){var e=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,c){return e.call(this,a.getItem(b.id).data,
c)}:d?function(c){var d=a.getItem(c.id);c=c.cloneNode(!0);c.id=b.getUniqueId();return{node:c,data:d.data,type:d.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);return{node:b,data:c.data,type:c.type}};this.selectNone();!d&&!this.creator&&a.selectNone();this.insertNodes(!0,c,this.before,this.current);!d&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=e},onDropInternal:function(a,c){var d=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(c)this._normalizedCreator=
this.creator?function(a,b){return d.call(this,this.getItem(a.id).data,b)}:function(a){var c=this.getItem(a.id);a=a.cloneNode(!0);a.id=b.getUniqueId();return{node:a,data:c.data,type:c.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=d}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){p.superclass.onOverEvent.call(this);
f.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){p.superclass.onOutEvent.call(this);f.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){this.current==this.targetAnchor&&this.before==a||(this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&
this._addItemClass(this.targetAnchor,this.before?"Before":"After"))},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!l.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(d.contains(a,"dojoDndHandle"))return!0;
if(d.contains(a,"dojoDndItem")||d.contains(a,"dojoDndIgnore"))break}return!1}});return p})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f){var p=e("dojo.dnd.Selector",f,{constructor:function(a,d){d||(d={});this.singular=d.singular;this.autoSync=d.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;
this.events.push(c(this.node,b.press,h.hitch(this,"onMouseDown")),c(this.node,b.release,h.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var b=new a,c=n._empty,e;for(e in this.selection)e in c||b.push(d.byId(e));return b},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,b){this._addItemClass(d.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=n._empty,
b;for(b in this.selection)if(!(b in a)){var c=d.byId(b);this.delItem(b);k.destroy(c)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||g.global;var c=this.selection,d=n._empty,e;for(e in c)e in d||a.call(b,this.getItem(e),e,this)},sync:function(){p.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],b=n._empty,c;for(c in this.selection)c in b||this.getItem(c)||a.push(c);m.forEach(a,function(a){delete this.selection[a]},
this);return this},insertNodes:function(a,b,c,d){var e=this._normalizedCreator;this._normalizedCreator=function(b,c){var d=e.call(this,b,c);a?(this.anchor?this.anchor!=d.node&&(this._removeItemClass(d.node,"Anchor"),this._addItemClass(d.node,"Selected")):(this.anchor=d.node,this._removeItemClass(d.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[d.node.id]=1):(this._removeItemClass(d.node,"Selected"),this._removeItemClass(d.node,"Anchor"));return d};p.superclass.insertNodes.call(this,
b,c,d);this._normalizedCreator=e;return this},destroy:function(){p.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!n.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,l.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){n.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=
b[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var c=0,d;c<b.length&&!(d=b[c],d==this.anchor||d==this.current);++c);for(++c;c<b.length;++c){d=b[c];if(d==this.anchor||d==this.current)break;this._addItemClass(d,"Selected");this.selection[d.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?n.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=
this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):n.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=
1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=c(this.node,
b.move,h.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=n._empty,b;for(b in this.selection)if(!(b in a)){var c=d.byId(b);c&&this._removeItemClass(c,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return p})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n,f,p,t){e=e("dojo.dnd.Container",c,{skipForm:!1,allowNested:!1,constructor:function(a,b){this.node=k.byId(a);b||(b={});this.creator=b.creator||null;this.skipForm=b.skipForm;this.parent=b.dropParent&&k.byId(b.dropParent);this.map={};this.current=null;this.containerState="";l.add(this.node,"dojoDndContainer");(!b||!b._skipStartup)&&this.startup();this.events=[n(this.node,p.over,h.hitch(this,"onMouseOver")),n(this.node,p.out,h.hitch(this,"onMouseOut")),n(this.node,"dragstart",
h.hitch(this,"onSelectStart")),n(this.node,"selectstart",h.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(a,b){b=b||g.global;var c=this.map,d=t._empty,e;for(e in c)e in d||a.call(b,c[e],e,this);return b},clearItems:function(){this.map={}},getAllNodes:function(){return f((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var c=
this.getItem(b.id);if(c){a[b.id]=c;return}}else b.id=t.getUniqueId();var c=b.getAttribute("dndType"),d=b.getAttribute("dndData");a[b.id]={data:d||b.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,b,c){this.parent.firstChild?b?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var d;if(c)for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),c.parentNode.insertBefore(d.node,c);else for(b=0;b<
a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);return this},destroy:function(){m.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,c){a._skipStartup=!0;return new c(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=
a[0])}this.defaultCreator=t._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&b!=this.node;)try{b=b.parentNode}catch(c){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(b){a=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){if(!this.skipForm||!t.isFormElement(a))a.stopPropagation(),a.preventDefault()},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var c="dojoDnd"+a,d=a.toLowerCase()+"State";l.replace(this.node,c+b,c+this[d]);this[d]=b},_addItemClass:function(a,b){l.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){l.remove(a,"dojoDndItem"+b)},
_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&l.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(a,b){var c=(this.creator||this.defaultCreator).call(this,a,b);h.isArray(c.type)||(c.type=["text"]);c.node.id||(c.node.id=t.getUniqueId());l.add(c.node,"dojoDndItem");return c}});t._createNode=function(b){return!b?t._createSpan:function(c){return a.create(b,{innerHTML:c})}};t._createTrTd=function(b){var c=
a.create("tr");a.create("td",{innerHTML:b},c);return c};t._createSpan=function(b){return a.create("span",{innerHTML:b})};t._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};t._defaultCreator=function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?t._createTrTd:t._createNode(t._defaultCreatorNodes[a]);return function(a,c){var d=a&&h.isObject(a),e,f;d&&a.tagName&&a.nodeType&&a.getAttribute?(e=a.getAttribute("dndData")||a.innerHTML,d=(d=a.getAttribute("dndType"))?d.split(/\s*,\s*/):
["text"],f=a):(e=d&&a.data?a.data:a,d=d&&a.type?a.type:["text"],f=("avatar"==c?t._createSpan:b)(String(e)));f.id||(f.id=t.getUniqueId());return{node:f,data:e,type:d}}};return e})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f,p,t){var s=e("dojo.dnd.Manager",[k],{constructor:function(){this.source=this.avatar=
null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:l("touch")?0:16,OFFSET_Y:l("touch")?-64:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=Boolean(this.target),this.avatar.update());b.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),b.publish("/dnd/source/over",null)):b.publish("/dnd/source/over",null)},startDrag:function(a,
e,f){function k(a){a.preventDefault();a.stopPropagation()}p.autoScrollStart(h.doc);this.source=a;this.nodes=e;this.copy=Boolean(f);this.avatar=this.makeAvatar();h.body().appendChild(this.avatar.node);b.publish("/dnd/start",a,e,this.copy);this.events=[c(h.doc,n.move,g.hitch(this,"onMouseMove")),c(h.doc,n.release,g.hitch(this,"onMouseUp")),c(h.doc,"keydown",g.hitch(this,"onKeyDown")),c(h.doc,"keyup",g.hitch(this,"onKeyUp")),c(h.doc,"dragstart",k),c(h.body(),"selectstart",k)];d.add(h.body(),"dojoDnd"+
(f?"Copy":"Move"))},canDrop:function(a){a=Boolean(this.target&&a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){d.remove(h.body(),["dojoDndCopy","dojoDndMove"]);m.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new t(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var b=this.avatar;b&&(p.autoScrollNodes(a),b=b.node.style,
b.left=a.pageX+this.OFFSET_X+"px",b.top=a.pageY+this.OFFSET_Y+"px",b=Boolean(this.source.copyState(f.getCopyKeyState(a))),this.copy!=b&&this._setCopyStatus(b));l("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var c=Boolean(this.source.copyState(f.getCopyKeyState(a)));b.publish("/dnd/drop/before",this.source,this.nodes,c,this.target,a);b.publish("/dnd/drop",this.source,this.nodes,c,this.target,a)}else b.publish("/dnd/cancel");this.stopDrag()}},
onKeyDown:function(c){if(this.avatar)switch(c.keyCode){case a.CTRL:c=Boolean(this.source.copyState(!0));this.copy!=c&&this._setCopyStatus(c);break;case a.ESCAPE:b.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(b){this.avatar&&b.keyCode==a.CTRL&&(b=Boolean(this.source.copyState(!1)),this.copy!=b&&this._setCopyStatus(b))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();d.replace(h.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?
"Move":"Copy"))}});f._manager=null;s.manager=f.manager=function(){f._manager||(f._manager=new s);return f._manager};return s})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(m,e,g,h,d,k,l,a){return m("dojo.dnd.Avatar",null,{constructor:function(a){this.manager=a;this.construct()},construct:function(){var a=k.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",
margin:"0px"}}),b=this.manager.source,d,e=k.create("tbody",null,a),g=k.create("tr",null,e),m=k.create("td",null,g),s=Math.min(5,this.manager.nodes.length),r=0;l("highcontrast")&&k.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},m);k.create("span",{innerHTML:b.generateText?this._generateText():""},m);for(h.set(g,{"class":"dojoDndAvatarHeader",style:{opacity:0.9}});r<s;++r)b.creator?d=b._normalizedCreator(b.getItem(this.manager.nodes[r].id).data,"avatar").node:(d=this.manager.nodes[r].cloneNode(!0),
"tr"==d.tagName.toLowerCase()&&(g=k.create("table"),k.create("tbody",null,g).appendChild(d),d=g)),d.id="",g=k.create("tr",null,e),m=k.create("td",null,g),m.appendChild(d),h.set(g,{"class":"dojoDndAvatarItem",style:{opacity:(9-r)/10}});this.node=a},destroy:function(){k.destroy(this.node);this.node=!1},update:function(){d.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(l("highcontrast")){var c=g.byId("a11yIcon"),b="+";this.manager.canDropFlag&&!this.manager.copy?b="\x3c ":!this.manager.canDropFlag&&
!this.manager.copy?b="o":this.manager.canDropFlag||(b="x");c.innerHTML=b}a("tr.dojoDndAvatarHeader td span"+(l("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(m,e,g,h){return m("dijit.CheckedMenuItem",
g,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:h,checked:!1,_setCheckedAttr:function(d){this.domNode.setAttribute("aria-checked",d?"true":"false");this._set("checked",d)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(d){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(d)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(m,e,g,h,d,k,l,a,c,b,n){var f=c("dijit.ColorPalette",[g,h,d],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:e,baseClass:"dijitColorPalette",_dyeFactory:function(a,b,c,d){return new this._dyeClass(a,
b,c,d)},buildRendering:function(){this.inherited(arguments);this._dyeClass=c(f._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],l.getLocalization("dojo","colors",this.lang))}});f._Color=c("dijit._Color",a,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":m.toUrl("./themes/a11y/colors7x10.png"),"3x4":m.toUrl("./themes/a11y/colors3x4.png")},constructor:function(b,c,d,e){this._title=e;this._row=c;this._col=d;this.setColor(a.named[b])},getValue:function(){return this.toHex()},fillCell:function(a,c){var d=n.substitute(k("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:c,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});b.place(d,a)}});return f})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(m,e,g,h,d,k,l,a,c,b,n){return m("dijit._PaletteMixin",a,{defaultTimeout:500,timeoutChangeRate:0.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?k.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(a,b){this._cells=[];var e=this._blankGif;this.own(l(this.gridNode,c,k.hitch(this,"_onCellClick")));for(var g=0;g<a.length;g++)for(var m=h.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),q=0;q<a[g].length;q++){var u=a[g][q];if(u){var w=this._dyeFactory(u,g,q,b[u]),u=h.create("td",{"class":this.cellClass,tabIndex:"-1",title:b[u],role:"gridcell"},m);w.fillCell(u,e);u.idx=this._cells.length;this._cells.push({node:u,
dye:w})}}this._xDim=a[0].length;this._yDim=a.length;var v={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},x;for(x in v)this.own(n.addKeyListener(this.domNode,{keyCode:d[x],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=v[x];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){b.focus(this._currentFocus)},
_onCellClick:function(a){for(var c=a.target;"TD"!=c.tagName;){if(!c.parentNode||c==this.gridNode)return;c=c.parentNode}var d=this._getDye(c).getValue();this._setCurrent(c);b.focus(c);this._setValueAttr(d,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&e.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&e.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,b){0<=this._selectedCell&&g.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var c=0;c<this._cells.length;c++)if(a==this._cells[c].dye.getValue()){this._selectedCell=c;g.add(this._cells[c].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(b||void 0===b)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,c){if(-1!=c){var d=this._currentFocus.idx+a;d<this._cells.length&&-1<d&&(d=this._cells[d].node,this._setCurrent(d),this.defer(k.hitch(b,"focus",d)))}},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(m){return m})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(m,e,g,h,d,k,l,a,c){h("dijit-legacy-requires")&&k(0,function(){m(["dijit/form/RadioButton"])});return e("dijit.form.CheckBox",[l,a],{templateString:c,baseClass:"dijitCheckBox",_setValueAttr:function(a,
c){"string"==typeof a&&(this.inherited(arguments),a=!0);this._created&&this.set("checked",a,c)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&d("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&d("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");
this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(m,e){return m("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(g){this._set("readOnly",g);e.set(this.focusNode,"readOnly",g)},_setLabelAttr:void 0,_getSubmitValue:function(e){return null==e||""===e?"on":e},_setValueAttr:function(g){g=this._getSubmitValue(g);this._set("value",g);e.set(this.focusNode,
"value",g)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));e.set(this.focusNode,"value",this.value)},_onClick:function(e){return this.readOnly?(e.stopPropagation(),e.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(m,e,g){return m("dijit.form.ComboBox",[e,g],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(m,e,g,h,d,k,l,a,c){return m("dijit.form.ComboBoxMixin",[a,k],{dropDownClass:l,hasDownArrow:!0,templateString:c,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(a){this._set("hasDownArrow",a);this._buttonNode.style.display=a?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(a){a.get||h.mixin(a,{_oldAPI:!0,get:function(a){var b=new e;this.fetchItemByIdentity({identity:a,
onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,b){var c=new e(function(){g.abort&&g.abort()});c.total=new e;var g=this.fetch(h.mixin({query:a,onBegin:function(a){c.total.resolve(a)},onComplete:function(a){c.resolve(a)},onError:function(a){c.reject(a)}},b));return d(c)}});this._set("store",a)},postMixInProperties:function(){var a=this.params.store||this.store;a&&this._setStoreAttr(a);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var c=this.declaredClass;h.mixin(this.store,{getValue:function(a,b){g.deprecated(c+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return a[b]},getLabel:function(a){g.deprecated(c+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return a.name},fetch:function(a){g.deprecated(c+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
h.hitch(this,function(b){(new b({objectStore:this})).fetch(a)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(m,e,g,h,d,k,l,a,c,b,n){e=e("dijit.form._AutoCompleterMixin",n,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(b){var c=0;if("number"==typeof b.selectionStart)c=b.selectionStart;else if(a("ie")){var d=b.ownerDocument.selection.createRange().duplicate();b=b.createTextRange();d.move("character",0);b.move("character",0);try{b.setEndPoint("EndToEnd",d),c=String(b.text).replace(/\r/g,"").length}catch(e){}}return c},_setCaretPos:function(a,c){c=parseInt(c);b.selectInputText(a,c,c)},_setDisabledAttr:function(a){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var b=a.charCode||a.keyCode;if(!(b==h.ALT||b==h.CTRL||b==h.META||b==h.SHIFT)){var c=this.dropDown,d=null;this._abortQuery();this.inherited(arguments);if(!a.altKey&&!a.ctrlKey&&!a.metaKey)switch(this._opened&&(d=c.getHighlightedOption()),b){case h.PAGE_DOWN:case h.DOWN_ARROW:case h.PAGE_UP:case h.UP_ARROW:this._opened&&this._announceOption(d);a.stopPropagation();a.preventDefault();break;case h.ENTER:if(d){if(d==
c.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(d==c.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case h.TAB:b=this.get("displayedValue");if(c&&(b==c._messages.previousMessage||b==c._messages.nextMessage))break;d&&this._selectOption(d);case h.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(a){var c=this.focusNode;b.selectInputText(c,c.value.length);var d=this.ignoreCase?"toLowerCase":"substr";0==a[d](0).indexOf(this.focusNode.value[d](0))?(d=this.autoComplete?this._getCaretPos(c):c.value.length,d+1>c.value.length&&(c.value=a,b.selectInputText(c,d))):(c.value=a,b.selectInputText(c))},_openResultList:function(a,b,c){var e=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();!a.length&&0==c.start?this.closeDropDown():(this._nextSearch=this.dropDown.onPage=
d.hitch(this,function(b){a.nextPage(-1!==b);this.focus()}),this.dropDown.createOptions(a,c,d.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in c?(c.direction?this.dropDown.highlightFirstOption():c.direction||this.dropDown.highlightLastOption(),e&&this._announceOption(this.dropDown.getHighlightedOption())):this.autoComplete&&(!this._prev_key_backspace&&!/^[*]+$/.test(b[this.searchAttr].toString()))&&this._announceOption(this.dropDown.containerNode.firstChild.nextSibling))},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),b=this.dropDown;b&&(a==b._messages.previousMessage||a==b._messages.nextMessage)?this._setValueAttr(this._lastValueReported,
!0):"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState());this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,b,c){var d="";a&&(c||(c=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),d=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):c);this.set("value",d,b,c,a)},_announceOption:function(a){if(a){var b;if(a==
this.dropDown.nextButton||a==this.dropDown.previousButton)b=a.innerHTML,this.item=void 0,this.value="";else{var c=this.dropDown.items[a.getAttribute("item")];b=(this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]).toString();this.set("item",c,!1,b)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",g.get(a,"id"));this._autoCompleteText(b)}},_selectOption:function(a){this.closeDropDown();a&&this._announceOption(a);
this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var b=this.id+"_popup";this.dropDown=new (d.isString(this.dropDownClass)?d.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:d.hitch(this,this._selectOption),id:b,
dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new c({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var b=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,b):a[b]}}},postCreate:function(){var a=k('label[for\x3d"'+this.id+'"]');a.length&&
(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);m.after(this,"onSearch",d.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var b=this.labelType;"none"!=this.highlightMatch&&("text"==this.labelType&&this._lastInput)&&(a=this.doHighlight(a,this._lastInput),b="html");return{html:"html"==b,label:a}},doHighlight:function(a,b){var c=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?
"g":""),d=this.queryExpr.indexOf("${0}");b=l.escapeString(b);return this._escapeHtml(a.replace(RegExp((0==d?"^":"")+"("+b+")"+(d==this.queryExpr.length-4?"$":""),c),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,
b){return(b._oldAPI?b.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,b,c,d){this._set("item",d||null);null==a&&(a="");this.inherited(arguments)}});a("dojo-bidi")&&e.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return e})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(m,
e,g,h,d,k){function l(a){return{id:a.value,value:a.value,name:g.trim(a.innerText||a.textContent||"")}}return m("dijit.form.DataList",d,{constructor:function(a,c){this.domNode=e.byId(c);g.mixin(this,a);this.id&&k.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:h("option",this.domNode).map(l)}])},destroy:function(){k.remove(this.id)},fetchSelectedItem:function(){var a=h("\x3e option[selected]",this.domNode)[0]||h("\x3e option",this.domNode)[0];return a&&l(a)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),
function(m,e,g,h,d,k,l){return m("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(a){this._set("list",a)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(a){return RegExp("^"+a.replace(/(\\.)|(\*)|(\?)|\W/g,function(a,b,d,e){return d?".*":e?".":b?b:"\\"+a})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&
(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(a){if(!this.disabled&&!this.readOnly){var c=a.charOrCode;if(!("type"in a&&"key"==a.type.substring(0,3)&&(a.altKey||(a.ctrlKey||a.metaKey)&&"x"!=c&&"v"!=c||c==e.SHIFT))){this._prev_key_backspace=
a=!1;switch(c){case e.DELETE:case e.BACKSPACE:a=this._maskValidSubsetError=this._prev_key_backspace=!0;break;default:a="string"==typeof c||229==c}if(a)if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(a){this._abortQuery();var c=this,b=g.clone(this.query),e={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},f=
d.substitute(this.queryExpr,[a.replace(/([\\\*\?])/g,"\\$1")]),h,l=function(){var a=c._fetchHandle=c.store.query(b,e);!c.disabled&&!(c.readOnly||h!==c._lastQuery)&&k(a,function(d){c._fetchHandle=null;!c.disabled&&(!c.readOnly&&h===c._lastQuery)&&k(a.total,function(a){d.total=a;var f=c.pageSize;if(isNaN(f)||f>d.total)f=d.total;d.nextPage=function(a){e.direction=a=!1!==a;e.count=f;a?(e.start+=d.length,e.start>=d.total&&(e.count=0)):(e.start-=f,0>e.start&&(e.count=Math.max(f+e.start,0),e.start=0));0>=
e.count?(d.length=0,c.onSearch(d,b,e)):l()};c.onSearch(d,b,e)})},function(a){c._fetchHandle=null;c._cancelingQuery||console.error(c.declaredClass+" "+a.toString())})};g.mixin(e,this.fetchProperties);this.store._oldAPI?h=f:(h=this._patternToRegExp(f),h.toString=function(){return f});this._lastQuery=b[this.searchAttr]=h;this._queryDeferHandle=this.defer(l,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var a=this.list;a&&
(this.store=l.byId(a))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(m,e,g,h,d,k,l,a){return m("dijit.form._ComboBoxMenu",[d,k,a,l],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(e.add(this.previousButton,"dijitMenuItemRtl"),e.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var a=this.ownerDocument.createElement("div");a.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");a.setAttribute("role","option");return a},onHover:function(a){e.add(a,"dijitMenuItemHover")},onUnhover:function(a){e.remove(a,
"dijitMenuItemHover")},onSelect:function(a){e.add(a,"dijitMenuItemSelected")},onDeselect:function(a){e.remove(a,"dijitMenuItemSelected")},_page:function(a){var b=0,d=this.domNode.scrollTop,e=g.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();b<e;){var h=this.getHighlightedOption();if(a){if(!h.previousSibling||"none"==h.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!h.nextSibling||"none"==h.nextSibling.style.display)break;this.selectNextNode()}h=
this.domNode.scrollTop;b+=(h-d)*(a?-1:1);d=h}},handleKey:function(a){switch(a.keyCode){case h.DOWN_ARROW:return this.selectNextNode(),!1;case h.PAGE_DOWN:return this._page(!1),!1;case h.UP_ARROW:return this.selectPreviousNode(),!1;case h.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(m,e,g,h,d){var k=e("dijit.form._ComboBoxMenuMixin"+
(h("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=d.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(d){this._set("value",d);this.onChange(d)},onClick:function(d){if(d==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(d==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(d)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(d,a){var c=this._createMenuItem(),b=a(d);b.html?c.innerHTML=b.label:c.appendChild(c.ownerDocument.createTextNode(b.label));""==c.innerHTML&&(c.innerHTML="\x26#160;");return c},createOptions:function(d,a,c){this.items=d;this.previousButton.style.display=0==a.start?"none":"";g.set(this.previousButton,"id",this.id+
"_prev");m.forEach(d,function(a,b){var d=this._createOption(a,c);d.setAttribute("item",b);g.set(d,"id",this.id+b);this.nextButton.parentNode.insertBefore(d,this.nextButton)},this);var b=!1;d.total&&!d.total.then&&-1!=d.total?a.start+a.count<d.total?b=!0:a.start+a.count>d.total&&a.count==d.length&&(b=!0):a.count==d.length&&(b=!0);this.nextButton.style.display=b?"":"none";g.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var d=this.containerNode;2<d.childNodes.length;)d.removeChild(d.childNodes[d.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});h("dojo-bidi")&&(k=e("dijit.form._ComboBoxMenuMixin",
k,{_createOption:function(){var d=this.inherited(arguments);this.applyTextDir(d);return d}}));return k})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(m,e,g,h){return m("dijit.form._ListMouseMixin",h,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(d,e){this._setSelectedAttr(e,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(e)})},_onMouseDown:function(d,e){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(e,!1)},_onMouseUp:function(d,e){this._isDragging=!1;var g=this.selected,a=this._hoveredNode;g&&e==g?this.defer(function(){this._onClick(d,
g)}):a&&this.defer(function(){this._onClick(d,a)})},_onMouseOut:function(d,e){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(d,e){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=e;this.onHover(e);this._isDragging&&this._setSelectedAttr(e,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(m,e,g){return m("dijit.form._ListBase",null,{selected:null,_listConnect:function(g,d){var k=this;return k.own(e(k.containerNode,e.selector(function(d,a,c){return d.parentNode==c},g),function(e){k[d](e,this)}))},selectFirstNode:function(){for(var e=this.containerNode.firstChild;e&&"none"==e.style.display;)e=e.nextSibling;this._setSelectedAttr(e,!0)},selectLastNode:function(){for(var e=this.containerNode.lastChild;e&&"none"==e.style.display;)e=e.previousSibling;this._setSelectedAttr(e,
!0)},selectNextNode:function(){var e=this.selected;if(e){for(e=e.nextSibling;e&&"none"==e.style.display;)e=e.nextSibling;e?this._setSelectedAttr(e,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var e=this.selected;if(e){for(e=e.previousSibling;e&&"none"==e.style.display;)e=e.previousSibling;e?this._setSelectedAttr(e,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(e,d){if(this.selected!=e){var k=this.selected;if(k)this.onDeselect(k);
e&&(d&&g.scrollIntoView(e),this.onSelect(e));this._set("selected",e)}else if(e)this.onSelect(e)}})})},"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cimg data-dojo-attach-point\x3d"loadingImg"/\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"dijit/form/Select"\r\n\t\t\t\t\t\t style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'0\' selected\x3d"selected"\x3e${nls.basic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'1\'\x3eA-Z\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'2\'\x3e${nls.arrows}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'3\'\x3e${nls.business}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'4\'\x3e${nls.cartographic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'5\'\x3e${nls.nationalParkService}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'6\'\x3e${nls.outdoorRecreation}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'7\'\x3e${nls.peoplePlaces}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'8\'\x3e${nls.safetyHealth}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'9\'\x3e${nls.shapes}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'10\'\x3e${nls.transportation}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n                        data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e${nls.outlineWidth}:\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n                        data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"inputText" type\x3d"text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv style\x3d"min-width: 170px;"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e0%\x3c/li\x3e\r\n      \x3cli\x3e50%\x3c/li\x3e\r\n      \x3cli\x3e100%\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"POINT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cspan class\x3d"drawings-clear jimu-float-trailing" data-dojo-attach-point\x3d"btnClear"\x3e${nls.clear}\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"text" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(m){m(['dojo/i18n!*preload*jimu/nls/main*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main".split(" "),function(m,e,g,h,d,k,l,a,c,b,n,f,p,t,s,r,q,u,w,v,x,B){k={};"function"!==typeof b.getAll&&(b.getAll=function(a){var c=[];(a=b(a))&&c.push(a);return c});window.jimuNls=B;q.setProtocolErrorHandler(function(){return!0});
q=w.getAncestorWindow();var D=!1;try{D=0===q.location.href.indexOf("https://")}catch(C){console.log(C),D="https:"===window.location.protocol}s.setRequestPreCallback(function(a){a.content&&a.content.printFlag&&(a.timeout=3E5);D&&(a.url=a.url.replace(/^http(s?):\/\//gi,"//"));-1!==a.url.indexOf("/queryRelatedRecords?")&&!w.isHostedService(a.url)&&(a.url=a.url.replace("FeatureServer","MapServer"));return a});l(window,"mousedown",function(b){if(a.isMiddle(b))return b.preventDefault(),b.stopPropagation(),
b.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=d.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="1.3";window.productVersion=
"Online 3.9";k.initApp=function(){var a,b;console.log("jimu.js init...");b=window.location.search;a=""===b?{}:b=p.queryToObject(b.substr(1));g.getInstance();h.setStyle(jimuConfig.loadingId,"display","none");h.setStyle(jimuConfig.mainPageId,"display","block");b=e.getInstance({mapId:jimuConfig.mapId},jimuConfig.layoutId);a=m.getInstance(a);b.startup();a.loadConfig()};return k});